function escapeRegExp(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function formatNumber(a,b){var c=a.toString();if(0>a)return c;if(b&&b>c.length)for(;b>c.length;)c="0"+c;return c}function extractDigits(a,b){b=b||a.length;var c=a.match(/^\d+/g),d=c&&c[0];return d?d.length<=b?d:d.substr(0,b):""}function removeQuatos(a){return stringDelimiter.test(a)?a.substr(1,a.length-2):a}function parseStringToDateLabels(a,b,c){var d={};if(null==a||null==b||null==c)return d;b.split(dateLabelsRegExp);return b.split(dateLabelsRegExp).forEach(function(b){var e;switch(b){case"d":case"dd":case"M":case"MM":case"h":case"hh":case"H":case"HH":case"m":case"mm":case"s":case"ss":e=2;case"yy":case"yyy":case"yyyy":e=e||4,d[b]=extractDigits(a,e),e=d[b].length;break;case"tt":e=0,a.toUpperCase().startsWith(c.DateTimeFormat.AMDesignator.toUpperCase())?e=c.DateTimeFormat.AMDesignator.length:a.toUpperCase().startsWith(c.DateTimeFormat.PMDesignator.toUpperCase())&&(e=c.DateTimeFormat.PMDesignator.length),d[b]=a.substr(0,e);break;default:e=0,b=removeQuatos(b),a.startsWith(b)&&(e=b.length)}a=a.slice(e)}),a.length>0?{}:d}function getTime(a,b){var c=parseInt(a.HH||a.H),d=parseInt(a.hh||a.h||a.time||12);if(isNaN(c)&&!isNaN(d)&&d>=1&&12>=d){if(null==a.tt)a.time||(c=0);else switch(a.tt.toUpperCase()){case b.DateTimeFormat.AMDesignator.toUpperCase():c=d;break;case b.DateTimeFormat.PMDesignator.toUpperCase():c=d%12+12}}var e=parseInt(a.mm||a.m||a.time||0),f=parseInt(a.ss||a.s||0);return isNaN(c)||isNaN(e)?NaN:1e3*(60*(60*c+e)+f)}function makeDOMException(){var e,tmp;try{return eval("new DOMException(DOMException.INVALID_CHARACTER_ERR)")}catch(tmp){var ex=new Error("DOM Exception 5");return ex.code=ex.number=5,ex.name=ex.description="INVALID_CHARACTER_ERR",ex.toString=function(){return"Error: "+ex.name+": "+ex.message},ex}}function getbyte64(a,b){var c=ALPHA_1.indexOf(a.charAt(b));if(-1===c)throw makeDOMException();return c}function decode(a){a=""+a;var b,c,d,e=a.length;if(0===e)return a;if(e%4!==0)throw makeDOMException();b=0,a.charAt(e-1)===PADCHAR_1&&(b=1,a.charAt(e-2)===PADCHAR_1&&(b=2),e-=4);var f=[];for(c=0;e>c;c+=4)d=getbyte64(a,c)<<18|getbyte64(a,c+1)<<12|getbyte64(a,c+2)<<6|getbyte64(a,c+3),f.push(String.fromCharCode(d>>16,d>>8&255,255&d));switch(b){case 1:d=getbyte64(a,c)<<18|getbyte64(a,c+1)<<12|getbyte64(a,c+2)<<6,f.push(String.fromCharCode(d>>16,d>>8&255));break;case 2:d=getbyte64(a,c)<<18|getbyte64(a,c+1)<<12,f.push(String.fromCharCode(d>>16))}return f.join("")}function getbyte(a,b){var c=a.charCodeAt(b);if(c>255)throw makeDOMException();return c}function encode(a){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var b,c,d=PADCHAR_1,e=ALPHA_1,f=[];a=""+a;var g=a.length-a.length%3;if(0===a.length)return a;for(b=0;g>b;b+=3)c=getbyte(a,b)<<16|getbyte(a,b+1)<<8|getbyte(a,b+2),f.push(e.charAt(c>>18)),f.push(e.charAt(c>>12&63)),f.push(e.charAt(c>>6&63)),f.push(e.charAt(63&c));switch(a.length-g){case 1:c=getbyte(a,b)<<16,f.push(e.charAt(c>>18)+e.charAt(c>>12&63)+d+d);break;case 2:c=getbyte(a,b)<<16|getbyte(a,b+1)<<8,f.push(e.charAt(c>>18)+e.charAt(c>>12&63)+e.charAt(c>>6&63)+d)}return f.join("")}var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),__assign=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},NerveImplementation;!function(a){var b=function(){function b(b){this.master=b,this.observers=[],this.bulkChangingModeStackedCount=0,this.changingPeriod=$.Deferred().resolve(),this.changeNotifier=new a.CallLater(this.notifyChange.bind(this)),this.rules=[],this.initializeSnapshot(),this.resetChangeInfo()}return b.prototype.getSnapshot=function(a){if(!this.snapshotCache){for(var b in this.dirtyProperties)this.refreshSubSnapshot(this.dirtyProperties[b]);this.dirtyProperties={},this.snapshotCache=this.createSnapshotCache()}return this.snapshotCache},b.prototype.definitelyMarkAsChanged=function(a){this.defnitelyMarkedAsChanged=!0,this.markAsChanged(a)},b.prototype.markAsChanged=function(b,c){this.ensureChangingPeriodStarted();var d=b.FieldSchema,e=new a.FieldSchemaSet([d]);if(this.changedFields.addFieldSchema(d),c){this.subChanges.push(c);var f=c.FieldSchemas.map(d.__nerve__.shadowMapper);e.addFieldSchemas(f)}this.markFieldsAsChanged(e)},b.prototype.markAsDeleted=function(){this.markFieldsAsChanged([this.master.Schema])},b.prototype.startBulkEditMode=function(){++this.bulkChangingModeStackedCount},b.prototype.endBulkEditMode=function(){--this.bulkChangingModeStackedCount<=0&&(this.bulkChangingModeStackedCount=0,this.changeNotifier.flush())},b.prototype.observe=function(b,c){var d=this.observers[this.getIndexOfObserverInfo(b)];d?c?d.fieldSet.addFieldSchemas(c):d.fieldSet=this.getAllFields().clone():this.observers.push({callback:b,fieldSet:new a.FieldSchemaSet(c||this.getAllFields())})},b.prototype.unobserve=function(a,b){var c=this.getIndexOfObserverInfo(a),d=this.observers[c];d&&(b?b.forEach(function(a){d.fieldSet.removeFieldSchemas(a.__nerve__.allContainedFields)}):d.fieldSet.clear(),0===d.fieldSet.Count&&this.observers.splice(c,1))},b.prototype.addRule=function(a){this.rules.indexOf(a)<0&&this.rules.push(a)},b.prototype.removeRule=function(a){var b=this.rules.indexOf(a);b>=0&&this.rules.splice(b,1)},b.prototype.markSubSnapshotAsDirty=function(a){var b=this;if(a.length){this.snapshotCache=void 0,a.forEach(function(a){return b.dirtyProperties[a.Name]=a});var c=this.Master.__nerve__.membership,d=c&&c.Parent.__nerve__.changeManager;d&&d.markSubSnapshotAsDirty([c.Property])}},b.prototype.getChangingPeriod=function(){return this.changingPeriod.promise()},Object.defineProperty(b.prototype,"Master",{get:function(){return this.master},enumerable:!0,configurable:!0}),b.prototype.createChange=function(a){var b=this.Master.__nerve__.deleted&&!this.markedAsDeleted;return{BeingDeleted:b,DefinitelyMarked:this.defnitelyMarkedAsChanged,FieldSchemas:Object.freeze(a.toArray()),Master:this.Master,NewValues:b?null:this.getSnapshot(),OldValues:this.snapshotBeforeChange,SubChanges:Object.freeze(this.subChanges),UpdateNeeded:b}},b.prototype.resetChangeInfo=function(){this.changedFields=new a.FieldSchemaSet,this.subChanges=[],this.snapshotBeforeChange=this.getSnapshot(),this.markedAsDeleted=this.master.Deleted,this.defnitelyMarkedAsChanged=!1},b.prototype.notifyChangeIfNeed=function(){this.bulkChangingModeStackedCount>0?this.changeNotifier.callOnceLater():this.changeNotifier.callImmediately()},b.prototype.anythingChanged=function(){return this.changedFields.Count>0||this.Master.__nerve__.deleted},b.prototype.markFieldsAsChanged=function(a){this.changedFields.addFieldSchemas(a),this.underRuling?this.changedByRules=!0:this.notifyChangeIfNeed()},b.prototype.shouldObserverBeNotified=function(a,b){return a.fieldSet.intersect(b.FieldSchemas)},b.prototype.removeUnchangedFields=function(a,b){},b.prototype.getMembership=function(){return this.Master.__nerve__.membership},b.prototype.getParentChangeManager=function(){var a=this.Master.Parent;return a&&a.__nerve__.changeManager},b.prototype.getIndexOfObserverInfo=function(a){for(var b=0;b<this.observers.length;++b)if(this.observers[b].callback===a)return b},b.prototype.notifyChange=function(){var a=this;if(this.applyRules(),this.endCurrentChangingPeriod(),this.defnitelyMarkedAsChanged||this.Master.Deleted||this.removeUnchangedFields(this.changedFields,this.snapshotBeforeChange),this.anythingChanged()){var b=Object.freeze(this.createChange(this.changedFields));this.resetChangeInfo();var c=this.Master.__nerve__.membership;if(c&&c.Property.Mounted){var d=c.Parent.__nerve__.changeManager;d&&d.markAsChanged(c.Property,b)}this.observers.concat().forEach(function(c){a.shouldObserverBeNotified(c,b)&&c.callback(b)})}},b.prototype.applyRules=function(){var b=this;this.underRuling=!0;var c=0,d=this.changedFields,e=this.subChanges,f=[],g=function(){var g=h.rules.filter(function(a){return!a.InterestedFields||b.changedFields.intersect(a.InterestedFields)});if(!g.length)return"break";if(++c>8*h.rules.length)return h.warnForAgainstingRules(f),"break";var i=h.changedFields,j=h.subChanges;h.changedFields=new a.FieldSchemaSet,h.subChanges=[];var k=h.Master.__nerve__.deleted&&!h.markedAsDeleted;g.forEach(function(a){b.changedByRules=!1,a.onChange({Master:b.Master,BeingDeleted:k,FieldSchemas:i.toArray(),OldValues:b.snapshotBeforeChange,SubChanges:j}),b.changedByRules&&f.push(a)}),d.addFieldSchemas(h.changedFields),e.push.apply(e,h.subChanges)},h=this;do{var i=g();if("break"===i)break}while(this.changedFields.Count);this.underRuling=!1,this.changedFields=d,this.subChanges=e},b.prototype.warnForAgainstingRules=function(b){Nerve.Debugger.warn("following rules might do against each other: "+JSON.stringify(b.map(function(a){return a.Name}))+" (master: "+a.getMasterName(this.Master)+")")},b.prototype.getAllFields=function(){return this.Master.Schema.__nerve__.allContainedFields},b.prototype.ensureChangingPeriodStarted=function(){"pending"!==this.changingPeriod.state()&&(this.changingPeriod=$.Deferred())},b.prototype.endCurrentChangingPeriod=function(){this.changingPeriod.resolve()},b}();a.BranchChangeManager=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function a(a){this.popupRequired=a}return a.prototype.updateDirtiness=function(){if(this.popupRequired){var a=this.getProperty(),b=a.ParentMaster.__nerve__.dirtyChecker;b.setMemberDirtiness(a.Name,this.isDirty())}},a}();a.DirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(b,c,d){var e=a.call(this,d)||this;return e.memberDirtinesses={},e.dirtinessCount=0,e.master=b,e.existingInSource=c,e}return __extends(b,a),Object.defineProperty(b.prototype,"Master",{get:function(){return this.master},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ExistingInSource",{get:function(){return this.existingInSource},set:function(a){this.existingInSource=a,this.updateDirtiness()},enumerable:!0,configurable:!0}),b.prototype.isDirty=function(){if(this.master.__nerve__.deleted){var a=this.Master.Parent,b=a&&a.__nerve__.deleted;return!b&&this.existingInSource}return 0!==this.dirtinessCount},b.prototype.setMemberDirtiness=function(a,b){!this.memberDirtinesses[a]!=!b&&(b?(this.memberDirtinesses[a]=!0,0===this.dirtinessCount++&&this.updateDirtiness()):(delete this.memberDirtinesses[a],0===--this.dirtinessCount&&this.updateDirtiness()))},b.prototype.getDirtyKeys=function(){return Object.keys(this.memberDirtinesses)},b.prototype.getProperty=function(){return this.master.__nerve__.membership.Property},b}(a.DirtyChecker);a.BranchDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.markAsChanged=function(a,c){c&&c.BeingDeleted?this.Master.deleteItems([a.getter()]):b.prototype.markAsChanged.call(this,a,c)},c.prototype.onPropertiesAdded=function(a){a.length&&(this.addedProperties=this.addedProperties.concat(a),this.snapshot=void 0,this.markSubSnapshotAsDirty(a),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields))},c.prototype.onPropertiesRemoved=function(a){var b=this;a.length&&(a.forEach(function(a){var c=b.addedProperties.indexOf(a);c>=0?b.addedProperties.splice(c,1):b.removedProperties.push(a),b.indexChanges[a.Name]&&(delete b.indexChanges[a.Name],--b.indexChangedPropertyCount)}),this.snapshot=void 0,this.markSubSnapshotAsDirty(a),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields))},c.prototype.onPropertyIndexChange=function(a,b){this.markSubSnapshotAsDirty([a]),this.indexChanges[a.Name]?this.indexChanges[a.Name].NewIndex=a.Index:(this.indexChanges[a.Name]={OldIndex:b,NewIndex:a.Index},++this.indexChangedPropertyCount),this.notifyChangeIfNeed()},c.prototype.initializeSnapshot=function(){var b=this.Master.Schema[0];a.FieldSchema.isLeaf(b)?this.getSubSnapshot=c.getSubSnapshotForLeafContent:this.getSubSnapshot=c.getSubSnapshotForMasterContent,this.createSnapshot()},c.prototype.refreshSubSnapshot=function(a){this.snapshot&&!a.Deleted&&(this.snapshot[a.Index]=this.getSubSnapshot(a.getter()))},c.prototype.createSnapshotCache=function(){return this.snapshot||this.createSnapshot(),this.snapshot.concat()},c.prototype.createChange=function(a){var c=this,d=b.prototype.createChange.call(this,a),e=function(a){return a.getter()},f=function(a){return c.getSubSnapshot(a)};d.AddedModels=Object.freeze(this.addedProperties.map(e)),d.AddedItemsAsSnapshots=Object.freeze(d.AddedModels.map(f)),d.RemovedModels=Object.freeze(this.removedProperties.map(e)),d.RemovedItemsAsSnapshots=Object.freeze(d.RemovedModels.map(f));var g={};Object.keys(this.indexChanges).forEach(function(a){var b=c.indexChanges[a];null!=b.NewIndex&&null!=b.OldIndex&&(g[b.NewIndex]=b.OldIndex)}),d.ChangedIndexMap=Object.freeze(g);var h=this.Master.Schema[0];return d.UpdateNeeded||h.__nerve__.info.Attributes.IsLocalField||(d.UpdateNeeded=d.AddedModels.length>0||d.RemovedModels.length>0||d.SubChanges.some(function(a){return a.UpdateNeeded})),d},c.prototype.resetChangeInfo=function(){b.prototype.resetChangeInfo.call(this),this.addedProperties=[],this.removedProperties=[],this.indexChanges={},this.indexChangedPropertyCount=0},c.prototype.anythingChanged=function(){return this.addedProperties.length>0||this.removedProperties.length>0||this.indexChangedPropertyCount>0||b.prototype.anythingChanged.call(this)},c.prototype.shouldObserverBeNotified=function(a,c){return Object.keys(c.ChangedIndexMap).length?!0:b.prototype.shouldObserverBeNotified.call(this,a,c)},c.prototype.createSnapshot=function(){this.snapshot=[];for(var a=this.Master.Model,b=0;b<a.length;++b)this.snapshot[b]=this.getSubSnapshot(a[b])},c.getSubSnapshotForLeafContent=function(a){return a},c.getSubSnapshotForMasterContent=function(b){return a.getMasterFromModel(b).getSnapshot()},c}(a.BranchChangeManager);a.CollectionChangeManager=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e.updateMembersWithSourceData([]),e}return __extends(c,b),c.prototype.initializeSourceData=function(a){var b=this;this.updateMembersWithSourceData(a||[]),this.getProperties().forEach(function(a){var c=a.getDirtyChecker(),d=b.sourceData[b.getSourceIndexForProperty(a)];c.initializeSourceData(d)}),this.updateDirtinessForLength(this.Master.Model.length)},c.prototype.getDelta=function(){return Nerve.Debugger.todo("get delta for collection is not supported yet.")},c.prototype.getSnapshotToUpdate=function(){return this.getProperties().map(function(a){return a.getDirtyChecker()}).map(function(a){return a.getSnapshotToUpdate()})},c.prototype.getSourceData=function(){return a.FieldSchema.cloneSourceData(this.sourceData,this.Master.Schema)},c.prototype.setSourceData=function(a){this.setSourceDataInternal(a||[])},c.prototype.onSourceDataReceived=function(a){a=a||[],this.updateMembersWithSourceData(a),this.Master.Model.__nerve__.onSourceDataReceived(a),this.updateDirtinessForLength(this.Master.Model.length)},c.prototype.updateDirtinessForLength=function(a){this.setMemberDirtiness("length",a!==this.getSourceDataLength())},c.prototype.updateDirtinessForIndexChange=function(a){if(a.Deleted)this.setMemberDirtiness(a.Name,!1);else{var b=a.getDirtyChecker();b.setSourceData(this.sourceData[a.Index])}},c.prototype.getSourceDataLength=function(){return this.sourceData.length},c.prototype.setSourceDataInternal=function(b){var c=this;this.updateMembersWithSourceData(b),this.getProperties().forEach(function(b){var d=b.getDirtyChecker(),e=c.getSourceIndexForProperty(b);d.setSourceData(c.sourceData[e]),d instanceof a.BranchDirtyChecker&&(d.ExistingInSource=e<c.sourceData.length)}),this.updateDirtinessForLength(this.Master.Model.length)},c.prototype.getProperties=function(){return this.Master.Model.__nerve__.properties},c.prototype.updateMembersWithSourceData=function(a){var b=this;this.sourceData=a;var c=this.Master.Schema[0];c.__nerve__.withKey&&(this.sourceKeyIndexMap={},a.map(c.__nerve__.getKeyFromSourceData).forEach(function(a,c){a&&(b.sourceKeyIndexMap[a]=c)}))},c.prototype.getSourceIndexForProperty=function(a){var b=this.Master.Schema[0];return b.__nerve__.withKey?this.sourceKeyIndexMap[a.getKey()]:a.Index},c}(a.BranchDirtyChecker);a.CollectionDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a,b,c,d){void 0===d&&(d=!0),n(a,b,{configurable:!1,enumerable:!!d,value:c,writable:!1})}function c(a,c,d){n(a,c,{configurable:!0,enumerable:!0,get:function(){var e=d();return delete a[c],b(a,c,e),e},set:function(){throw Error("Setting readonly field: "+c)}})}function d(a,b,c,d){d=d||function(){throw Error("Setting readonly field: "+b)},n(a,b,{configurable:!1,enumerable:!0,get:c,set:d})}function e(a,b){var c=a;for(var d in b)c[d]=b[d];return c}function f(a){return e({},a)}function g(a){Nerve.Debugger.assert(!Array.isArray(a),"array is not currently supported by readonly().");var c={};for(var d in a)b(c,d,a[d]);return c}function h(a,c){Nerve.Debugger.assert(c in a,"the field named "+c+" not been initialized yet."),b(a,c,a[c])}function i(a){return a?Array.prototype.slice.apply(a):[]}function j(a){return Array.isArray(a)?a:i(a)}function k(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(arguments.length){var d=$.Deferred();return d.resolve.apply(d,[a].concat(b)),d.promise()}return o}function l(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(arguments.length){var d=$.Deferred();return d.reject.apply(d,[a].concat(b)),d.promise()}return p}function m(a){return a.then(q,q)}function n(a,b,c){try{Object.defineProperty(a,b,c)}catch(d){var e=d&&d.message||"(no message)";Nerve.Debugger.throwError('Failed to set property "'+b+'": '+e)}}a.defineConstProperty=b,a.defineLazyProperty=c,a.defineProperty=d,a.extendObject=e,a.cloneObject=f,a.cloneAsReadonly=g,a.makePropertyReadonly=h,a.cloneCollectionAsArray=i,a.convertToArray=j;var o=$.Deferred().resolve().promise();a.getResolvedPromise=k;var p=$.Deferred().reject().promise();a.getRejectedPromise=l;var q=function(){return k()};a.always=m;var r=function(){function a(a,b){void 0===b&&(b=0),this.functionToCall=a,this.timeToWaitInMs=b}return a.prototype.callOnceLater=function(){var a=this;0!==this.timeToWaitInMs&&null!=this.handler&&this.clear(),null==this.handler&&(this.handler=setTimeout(function(){a.callImmediately()},this.timeToWaitInMs))},a.prototype.flush=function(){null!=this.handler&&(this.clear(),this.functionToCall())},a.prototype.callImmediately=function(){null!=this.handler&&this.clear(),this.functionToCall()},a.prototype.clear=function(){clearTimeout(this.handler),this.handler=void 0},a}();a.CallLater=r;var s=function(){function a(a){var b=this,c=$.Deferred();a.then(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.canceled||c.resolve.apply(c,a)},function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.canceled||c.reject.apply(c,a)}),this.cancelablePromise=c.promise()}return a.prototype.promise=function(){return this.cancelablePromise},a.prototype.cancel=function(){this.canceled=!0},a}();a.Cancelable=s}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(b,c,d){void 0===d&&(d=!1),a.defineConstProperty(b,"__nerve__",c,d)}var c=function(){function a(a){void 0===a&&(a={}),b(this,a)}return a}();a.NerveObject=c,a.defineNerveProperty=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(b){return b instanceof a.ModelBase?b.__nerve__.master:void Nerve.Debugger.throwError("Invalid parameter: please use '<your master>.Model.*' for the parameter.")}function c(a){return d(a).__nerve__.masterName}function d(a){return a instanceof e?a.constructor:void Nerve.Debugger.throwError("the parameter is not a nerve master object.")}a.getMasterFromModel=b,a.getMasterName=c;var e=function(b){function c(c){var d=b.call(this)||this,e=d.__nerve__,g=c&&c.Reserved&&c.Reserved.Membership;g&&(e.membership=a.cloneAsReadonly(g),a.makePropertyReadonly(e,"membership"));var h=!1;return a.defineProperty(e,"deleted",function(){return h},function(a){if(!h&&a){h=!0,e.dirtyChecker.updateDirtiness();var b=e.changeManager;b.startBulkEditMode(),e.markChildrenAsDeleted(),b.markAsDeleted(),b.endBulkEditMode()}}),e.instanceId=(++f).toString(),a.makePropertyReadonly(e,"instanceId"),d}return __extends(c,b),Object.defineProperty(c.prototype,"Schema",{get:function(){return Nerve.Debugger.toBeOverridden()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Model",{get:function(){return this.__nerve__.model},set:function(a){this.setData(a,this.Schema.__nerve__.subFields.toArray())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Parent",{get:function(){var a=this.__nerve__.membership;return a&&a.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Membership",{get:function(){var a=this.__nerve__.membership;return{Parent:a&&a.Parent,FieldSchema:a&&a.FieldSchema}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Deleted",{get:function(){return this.__nerve__.deleted},set:function(a){this.__nerve__.deleted=a},enumerable:!0,configurable:!0}),c.prototype.getInstanceId=function(){return this.__nerve__.instanceId},c.prototype.getSnapshot=function(a){return this.__nerve__.changeManager.getSnapshot(a)},c.prototype.bulkEdit=function(a){var b=this.__nerve__.changeManager;b&&b.startBulkEditMode();try{return a(this.Model)}finally{b&&b.endBulkEditMode()}},c.prototype.observe=function(a,b){return this.__nerve__.changeManager.observe(a,b)},c.prototype.unobserve=function(a,b){return this.__nerve__.changeManager.unobserve(a,b)},c.prototype.addRule=function(a){return this.__nerve__.changeManager.addRule(a)},c.prototype.removeRule=function(a){return this.__nerve__.changeManager.removeRule(a)},c}(a.NerveObject);a.MasterBase=e;var f=0}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a){var b=a;return!!b.__nerve__&&b.__nerve__.nerveObjectType===f}function c(a){return a instanceof g}function d(b,c){var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),b}(g);return a.defineNerveProperty(d,a.cloneAsReadonly({nerveObjectType:f,masterName:b}),!0),d.__nerve__.schema=a.FieldSchema.createRootFieldSchema(d,c),a.makePropertyReadonly(d.__nerve__,"schema"),d}function e(b){a.FieldSchema.isLeaf(b.Schema[0])||a.convertToArray(b.Model).map(a.getMasterFromModel).forEach(function(a){return a.Deleted=!0})}var f="collection master";a.isCollectionMasterClass=b,a.isCollectionMaster=c,a.createCollectionMasterClass=d;var g=function(b){function c(c){var d=this;c=c||{},d=b.call(this,c)||this;var f=d,g=d.__nerve__;g.markChildrenAsDeleted=function(){return e(f)},a.makePropertyReadonly(g,"markChildrenAsDeleted");var h=d.Schema.__nerve__,i=!h.withDataSource&&!h.info.Attributes.IsLocalField;return g.dirtyChecker=new a.CollectionDirtyChecker(f,c.ExistingInDataSource,i),a.makePropertyReadonly(g,"dirtyChecker"),g.model=new a.CollectionModel(f,c),a.makePropertyReadonly(g,"model"),g.changeManager=new a.CollectionChangeManager(f),a.makePropertyReadonly(g,"changeManager"),d}return __extends(c,b),c.prototype.addItems=function(a){return this.Model.__nerve__.addItems(a,!1).map(function(a){return a.getter()})},c.prototype.deleteItems=function(a){return this.Model.__nerve__.deleteItems(a,!1).map(function(a){return a.getter()})},c.prototype.itemsAddedInSource=function(a){return this.Model.__nerve__.addItems(a,!0).map(function(a){return a.getter()})},c.prototype.itemsDeletedInSource=function(a){return this.Model.__nerve__.deleteItems(a,!0).map(function(a){return a.getter()})},c.prototype.getItemWithKeyFields=function(a){var b=this.Schema[0].__nerve__.getKey(a),c=this.Model.__nerve__.keyToProperty[b];return c&&c.getter()},c.prototype.getIndexWithKeyFields=function(a){var b=this.Schema[0].__nerve__.getKey(a),c=this.Model.__nerve__.keyToProperty[b];return c?c.Index:-1},c.prototype.markAsChanged=function(a){var b=this.Model.__nerve__.properties[a];b&&this.__nerve__.changeManager.definitelyMarkAsChanged(b)},c.prototype.setComparer=function(a){this.Model.__nerve__.setComparer(a)},c.prototype.setData=function(b){this.Model.__nerve__.setData(a.convertToArray(b))},c}(a.MasterBase)}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.toJSON=function(){return this.__nerve__.master.getSnapshot()},b}(a.NerveObject);a.ModelBase=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a,b,e,f){var g=a.__nerve__.master,h=g.Schema[0],j=h.__nerve__.generateProperty,k=$.Deferred(),l=$.when(a.__nerve__.masterTreeReady,k.promise()),m=b.map(function(b){return j((++a.__nerve__.newestPropertyName).toString(),{InitialData:b,ExistingInDataSource:e,MasterTreeReady:l,Reserved:{Membership:{Parent:g,FieldSchema:h},ParentExistingInDataSource:f,Mounted:k}})});if(h.__nerve__.withKey){var n=a.__nerve__.keyToProperty;if(h.__nerve__.withDataSource){var o=h.__nerve__.keyFields.toArray();m.forEach(function(a){var b=a.Master;b.Synchronizer.ensureFieldsReady(o).done(function(){return c(n,a)})})}else m.forEach(function(a){return c(n,a)})}var p=a.__nerve__.properties,q=p.length;return g.bulkEdit(function(){p.push.apply(p,m),d(a);for(var b=q;b<p.length;++b)p[b].Index=b;g.__nerve__.dirtyChecker.updateDirtinessForLength(p.length);var c=a.__nerve__.propertyComparer;c&&i(a,c),k.resolve();var e=g.__nerve__.changeManager;e&&e.onPropertiesAdded(m)}),m}function c(b,c){var d=c.getKey();d in b&&Nerve.Debugger.throwError('duplicated key "'+d+'" at '+a.FieldSchema.getFieldPath(c.FieldSchema)+" is being added."),b[d]=c}function d(a){for(var b=a.__nerve__,c=b.properties.length;b.initializedLength<c;)e(a,b.initializedLength),++b.initializedLength}function e(b,c){a.defineProperty(b,c,function(){return this.__nerve__.properties[c].getter()},function(a){this.__nerve__.properties[c].setter(a)})}function f(a,b,c){var d=a.__nerve__.properties,e=d.filter(function(a){var c=a.getter();return b.some(function(a){return a===c})});return g(a,e,c),e}function g(a,b,c){var d=b.length;if(d>0){var e=a.__nerve__.properties,f=e.length,g=a.__nerve__.master;g.bulkEdit(function(){for(;d>0;--d){for(var i=b[d-1];--f>i.Index;)e[f].Index-=d;e.splice(f,1),i.markAsDeleted(c)}var j=g.Schema[0];if(j.__nerve__.withKey){var k=a.__nerve__.keyToProperty;if(j.__nerve__.withDataSource){var l=j.__nerve__.keyFields.toArray();b.forEach(function(a){var b=a.Master;b.Synchronizer.ensureFieldsReady(l).done(function(){return h(k,a)})})}else b.forEach(function(a){return h(k,a)})}g.__nerve__.dirtyChecker.updateDirtinessForLength(e.length),g.__nerve__.changeManager.onPropertiesRemoved(b)})}}function h(a,b){var c=b.getKey();b===a[c]&&delete a[c]}function i(a,b){b&&a.__nerve__.properties.sort(b);var c=a.__nerve__.master;c.bulkEdit(function(){a.__nerve__.properties.forEach(function(a,b){a.Index=b})})}function j(a,b){var c=a.__nerve__.master,d=a.__nerve__.master.Schema[0],e=a.__nerve__.properties,f={};b.map(d.__nerve__.getKey).forEach(function(a,b){return f[a]=b});var h={};e.forEach(function(a){return h[a.getKey()]=a});var j={};c.bulkEdit(function(){var c=[];for(var d in f){var e=f[d];if(d in h){var k=h[d];k.setter(b[e]),j[k.Name]=e,delete h[d]}else c.push(e)}var l=[];for(var d in h)l.push(h[d]);l.length&&(l.sort(function(a,b){return a.Index-b.Index}),g(a,l,!1)),c.length&&a.__nerve__.addItems(c.map(function(a){return b[a]}),!1).forEach(function(a,b){return j[a.Name]=c[b]});var m=function(a,b){return j[a.Name]-j[b.Name]},n=a.__nerve__.propertyComparer;n?i(a,function(a,b){return n(a,b)||m(a,b)}):i(a,m)})}function k(b,c){for(var d=b.__nerve__.master,e=(b.length,{}),f=a.convertToArray(b.__nerve__.master.getSnapshot()).slice(),h=[],j={},k=0;k<c.length;++k){var l=c[k],m=f.indexOf(l);0>m?h.push(l):(j[k]=m,f[m]=e)}for(var n=b.__nerve__.properties,o=[],k=0;k<f.length;++k)f[k]!==e&&o.push(n[k]);var p=n.slice();d.bulkEdit(function(){var a=b.__nerve__.addItems(h,!1);o.length&&(o.sort(function(a,b){return a.Index-b.Index}),g(b,o,!1)),Nerve.Debugger.assert(c.length===n.length,"All items should be updated into properties.");for(var d=0,e=0;e<c.length;++e)null==j[e]?n[e]=a[d++]:n[e]=p[j[e]];i(b,b.__nerve__.propertyComparer)})}function l(a,b){a.__nerve__.master.bulkEdit(function(){for(var c=a.length,d=Math.min(c,b.length),e=a.__nerve__.properties,f=0;d>f;++f)e[f].setter(b[f]);if(c<b.length)a.__nerve__.addItems(b.slice(a.length),!1);else if(c>b.length){var h=a.__nerve__.properties.slice(b.length);g(a,h,!1)}})}function m(b,c){var d=b.__nerve__.master;d.bulkEdit(function(){var e=d.Schema[0].__nerve__,f=b.__nerve__.keyToProperty,h={},j=[];c.map(e.getKeyFromSourceData).forEach(function(a,b){h[a]=b,a in f?f[a].getDirtyChecker().onSourceDataReceived(c[b]):j.push(c[b])});var k;k=e.withDataSource?function(a){var b=a.Master;return"resolved"===b.Synchronizer.existingInDataSource().state()&&!(a.getKey()in h)}:function(a){return!(a.getKey()in h)};var l=b.__nerve__.properties.filter(k);g(b,l,!0);var m=a.FieldSchema.convertFromSourceData(j,d.Schema);b.__nerve__.addItems(m,!0);var n=b.__nerve__.propertyComparer;n||(n=function(a,b){return h[a.getKey()]-h[b.getKey()]}),i(b,n)})}function n(b,c){var d=b.__nerve__.master;d.bulkEdit(function(){for(var e=b.length,f=Math.min(e,c.length),h=b.__nerve__.properties,i=0;f>i;++i)h[i].getDirtyChecker().onSourceDataReceived(c[i]);if(e<c.length){var j=c.slice(e),k=a.FieldSchema.convertFromSourceData(j,d.Schema);b.__nerve__.addItems(k,!0)}else if(e>c.length){var l=b.__nerve__.properties.slice(c.length);g(b,l,!0)}})}var o=function(c){function d(d,e){var g,h,o=this,p=d.Schema[0];p.__nerve__.withKey?(g=j,h=m):(g=p.__nerve__.info.IsLeaf?k:l,h=n);var q=e.Reserved&&e.Reserved.ParentExistingInDataSource;return o=c.call(this,{master:d,keyToProperty:p.__nerve__.withKey?{}:null,initializedLength:0,newestPropertyName:0,masterTreeReady:e.MasterTreeReady,properties:[],addItems:function(a,c){return b(o,a,c,q)},deleteItems:function(a,b){return f(o,a,b)},setData:function(a){return g(o,a)},onSourceDataReceived:function(a){return h(o,a)},setComparer:function(a){o.__nerve__.comparer=a,o.__nerve__.propertyComparer=a&&function(b,c){return a(b.getter(),c.getter())},a&&i(o,o.__nerve__.propertyComparer)}})||this,b(o,a.convertToArray(e.InitialData),e.ExistingInDataSource,q),o}return __extends(d,c),Object.defineProperty(d.prototype,"length",{get:function(){return this.__nerve__.properties.length},enumerable:!0,configurable:!0}),d}(a.ModelBase);a.CollectionModel=o}(NerveImplementation||(NerveImplementation={}));var Nerve;!function(a){var b;!function(a){function b(a,b){a||(console.assert(a,"Nerve - "+b),h("assert failed: "+b))}function c(a){return h("TODO: "+a)}function d(){return h("not implememented.")}function e(a,b){return b?b():void 0}function f(){return h("to be overridden.")}function g(a){console.warn("Nerve - warning: "+a),i("warning: "+a)}function h(a){throw Error("Nerve - "+a)}function i(a){try{throw Error("NerveLog - "+a)}catch(b){OfficeForm.Event.ErrorEvent.logData({type:OfficeForm.Event.ErrorType.ModelError,
errorInfo:b.stack})}}a.assert=b,a.todo=c,a.notImplemented=d,a.fakeImplemented=e,a.toBeOverridden=f,a.warn=g,a.throwError=h}(b=a.Debugger||(a.Debugger={}))}(Nerve||(Nerve={}));var NerveImplementation;!function(a){var b=function(a){function b(b,c){var d=a.call(this,c)||this;return d.property=b,d}return __extends(b,a),b.prototype.isDirty=function(){return this.sourceData!==this.convertModelToSourceData()},b.prototype.initializeSourceData=function(a){this.setSourceData(a)},b.prototype.getDelta=function(){return this.convertModelToSourceData()},b.prototype.getSnapshotToUpdate=function(){return this.convertModelToSourceData()},b.prototype.getSourceData=function(){return this.sourceData},b.prototype.setSourceData=function(a){void 0===a&&(a=null),this.sourceData=a,this.updateDirtiness()},b.prototype.onSourceDataReceived=function(a){var b=this.isDirty();this.setSourceData(a),b||this.property.setter(this.convertFromSourceData(a))},b.prototype.getProperty=function(){return this.property},b.prototype.convertModelToSourceData=function(){return this.property.getter()},b.prototype.convertFromSourceData=function(a){return a},b}(a.DirtyChecker);a.LeafDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.convertModelToSourceData=function(){return this.convert(this.getProperty().getter())},b.prototype.convertFromSourceData=function(a){return this.convert(a)},b.prototype.convert=function(a){if(null==a)return null;var b=this.getProperty().FieldSchema.__nerve__.enumType;return b[a]},b}(a.LeafDirtyChecker);a.EnumDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b,c="FieldSchema";!function(b){function d(a){var b=a,d=b&&b.__nerve__;return d&&d.nerveObjectType===c}function e(a){if(!d(a))throw Error("Invalid parameter: please use '<your master [class]>.Schema.*' for the parameter.");return!0}function f(a){return e(a),a.__nerve__.info}function g(a){return e(a),a.__nerve__.subFields.toArray()}function h(a){return f(a).FieldId}function i(a){return f(a).Name}function j(a){return f(a).Path}function k(a){return u[a]}function l(c,d){if(b.isLeaf(d)){if(d.__nerve__.asEnum){var e=d.__nerve__.enumType;if(e&&"string"==typeof c&&c in e)return e[c]}return c}if(b.isCollection(d))return a.convertToArray(c).map(function(a){return l(a,d[0])});if(c){var f={},g=d.__nerve__.sourceNameToClientName;return Object.keys(c).forEach(function(a){if(a in g){var b=g[a],e=d[b];f[b]=l(c[a],e)}}),f}return null}function m(c,d){if(b.isLeaf(d)){if(d.__nerve__.asEnum){var e=d.__nerve__.enumType;if(e&&"number"==typeof c&&c in e)return e[c]}return c}if(b.isCollection(d))return a.convertToArray(c).map(function(a){return m(a,d[0])});if(c){var f={};return Object.keys(d).forEach(function(a){if(a in c){var b=d[a];if(!b.__nerve__.info.Attributes.IsLocalField){var e=b.__nerve__.sourceName;f[e]=m(c[a],b)}}}),f}return null}function n(c,d){if(b.isLeaf(d))return c;if(b.isCollection(d))return a.convertToArray(c).map(function(a){return n(a,d[0])});if(c){var e={},f=d.__nerve__.sourceNameToClientName;return Object.keys(c).forEach(function(a){if(a in f){var b=d[f[a]];e[a]=n(c[a],b)}}),e}return null}function o(b,c){var d=b.__nerve__.masterName,e={enumTypeGetter:null,getKeyForReferenceType:null,info:{Attributes:a.Spec.getAttributes(c),FieldId:r(),IsCollection:!(!a.Spec.isFieldSpec(c)||!c.__nerve__.isCollection),IsLeaf:!1,Name:d,Path:d},parentMasterClass:b,shadowParent:null,withDataSource:!!b.__nerve__.dataSourceFactory};e.info.IsCollection&&a.defineLazyProperty(e,"withDataSource",function(){return f[0].__nerve__.withDataSource});var f=p(e);return Object.keys(c).forEach(function(d){a.defineLazyProperty(f,d,s(b,d,c[d]))}),f}function p(b){var d={};return b.info=a.cloneAsReadonly(b.info),b.nerveObjectType=c,b.shadowParent=b.shadowParent||null,b.shadowRoot=b.shadowRoot||d,a.defineLazyProperty(b,"sourceFieldSet",function(){var c=b.subFields.toArray().filter(function(a){return!a.__nerve__.info.Attributes.IsLocalField});return new a.FieldSchemaSet(c)}),a.defineLazyProperty(b,"sourceName",function(){return b.info.Attributes.SourceFieldName||b.info.Name}),a.defineLazyProperty(b,"sourceNameToClientName",function(){var a={};return b.sourceFieldSet.toArray().forEach(function(b){a[b.__nerve__.sourceName]=b.__nerve__.info.Name}),Object.freeze(a)}),a.defineLazyProperty(b,"subFields",function(){var b=new a.FieldSchemaSet;return Object.keys(d).forEach(function(a){b.addFieldSchema(d[a])}),b}),a.defineLazyProperty(b,"allContainedFields",function(){var b=new a.FieldSchemaSet([d]);return Object.keys(d).forEach(function(a){var c=d[a];b.addFieldSchemas(c.__nerve__.allContainedFields)}),b}),a.defineLazyProperty(b,"asEnum",function(){return!!b.enumType&&!b.info.Attributes.IsNumberTypeInDataSource}),a.defineLazyProperty(b,"enumType",function(){return b.enumTypeGetter&&b.enumTypeGetter()}),b.info.IsLeaf?a.defineLazyProperty(b,"getKey",function(){return Nerve.Debugger.assert(b.getKeyForReferenceType,"getKey has been called but no keyGetter specified for "+b.info.Path),b.getKeyForReferenceType}):a.defineLazyProperty(b,"getKey",function(){var c=b.keyFields.toArray().map(i).sort();return Nerve.Debugger.assert(c.length>0,"getKey has been called but there's no key fields of "+b.info.Path),function(b){var d=c;if(b instanceof a.ObjectModel){var e=b.__nerve__.master;if(a.isObjectMasterWithDataSource(e)){var f=e;if(d=c.filter(function(a){return f.isFieldReady(a)}),!d.length)return void 0}}var g={};return d.forEach(function(a){return g[a]=b[a]}),JSON.stringify(g)}}),a.defineLazyProperty(b,"getKeyFromSourceData",function(){var a=b.keyFields.toArray(),c=b.sourceNameToClientName,d=a.map(function(a){return a.__nerve__.sourceName});return function(a){var e={};return d.forEach(function(b){var d=c[b];e[d]=a[b]}),b.getKey(e)}}),a.defineLazyProperty(b,"keyFields",function(){return new a.FieldSchemaSet(b.subFields.toArray().filter(function(a){return a.__nerve__.info.Attributes.IsKeyField}))}),b.info.IsLeaf?a.defineLazyProperty(b,"withKey",function(){return!!b.getKeyForReferenceType}):a.defineLazyProperty(b,"withKey",function(){return b.keyFields.Count>0}),a.defineNerveProperty(d,b),a.defineConstProperty(d,"toJSON",function(){return"[Nerve] FieldSchema: ("+b.info.Path+")>"},!1),b.info.IsCollection&&a.defineConstProperty(d,"length",1,!1),u[b.info.FieldId]=d,d}function q(a,b){return a+"/"+b}function r(){return(t++).toString()}function s(c,d,e){var f=r();return function(){var g,h=q(c.__nerve__.masterName,d);if(a.Spec.isFieldSpec(e)){if(e.__nerve__.isLeaf)return b.createLeaf(f,c,e,d,h);e.__nerve__.isCollection?g=a.createCollectionMasterClass(h,e):e.__nerve__.masterClassGetter&&(g=e.__nerve__.masterClassGetter())}g||(g=a.createObjectMasterClass(h,e));var i=a.Spec.getAttributes(e);return b.createWithSubmasterClass(f,c,g,d,h,i)}}b.isFieldSchema=d,b.assertFieldSchema=e,b.getFieldInfo=f,b.getSubFields=g,b.getFieldId=h,b.getFieldName=i,b.getFieldPath=j,b.getFieldSchemaById=k,b.convertFromSourceData=l,b.convertToSourceData=m,b.cloneSourceData=n,b.createRootFieldSchema=o,b.createFieldSchemaWithMembers=p,b.getPath=q,b.createFieldSchemaId=r;var t=1,u={}}(b=a.FieldSchema||(a.FieldSchema={}))}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b;!function(b){function c(a){return a.__nerve__.info.IsCollection}function d(c,d,h,i,j,k){var l=h.Schema,m=l.__nerve__,n=b.createFieldSchemaWithMembers({enumTypeGetter:m.enumTypeGetter,getKeyForReferenceType:m.getKeyForReferenceType,info:{Attributes:k,FieldId:c,IsCollection:m.info.IsCollection,IsLeaf:m.info.IsLeaf,Name:i,Path:j||i},parentMasterClass:d,parentSchema:d.__nerve__.schema,shadowParent:l,shadowRoot:l,subMasterClassGetter:function(){return h},withDataSource:m.withDataSource}),o={};return o[b.getFieldId(h.__nerve__.schema)]=n,n.__nerve__.generateProperty=e(n),a.makePropertyReadonly(n.__nerve__,"generateProperty"),n.__nerve__.shadowMapper=f(n,o),a.makePropertyReadonly(n.__nerve__,"shadowMapper"),g(n,h.Schema,o),n}function e(b){return function(c,d){return new a.PropertyAsBranch(c,b,d)}}function f(a,c){return function d(e){var f=b.getFieldId(e),g=c[f];if(!g){var h=e.__nerve__.parentSchema,i=void 0;i=b.isFieldSchema(h)?d(h):a,g=i[b.getFieldName(e)],Nerve.Debugger.assert(g===c[f],"the new shadow should be added into the shadow map.")}return g}}function g(b,c,d){Object.keys(c).forEach(function(e){a.defineLazyProperty(b,e,h(b,c,e,d))})}function h(a,c,d,e){return function(){var f=c[d],h=f.__nerve__,i=b.createFieldSchemaWithMembers({enumTypeGetter:h.enumTypeGetter,getKeyForReferenceType:h.getKeyForReferenceType,info:{Attributes:h.info.Attributes,FieldId:b.createFieldSchemaId(),IsCollection:h.info.IsCollection,IsLeaf:h.info.IsLeaf,Name:d,Path:b.getPath(a.__nerve__.info.Path,d)},parentSchema:a,parentMasterClass:a.__nerve__.parentMasterClass,shadowParent:f,shadowRoot:h.shadowRoot,subMasterClassGetter:h.subMasterClassGetter,withDataSource:h.withDataSource});return e[b.getFieldId(f)]=i,g(i,f,e),i}}b.isCollection=c,b.createWithSubmasterClass=d}(b=a.FieldSchema||(a.FieldSchema={}))}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b;!function(b){function c(a){return a.__nerve__.info.IsLeaf}function d(c,d,f,g,h){var i=b.createFieldSchemaWithMembers({enumTypeGetter:f.__nerve__.enumTypeGetter,getKeyForReferenceType:f.__nerve__.keyGetter,info:{Attributes:a.Spec.getAttributes(f),FieldId:c,IsLeaf:!0,IsCollection:!1,Name:g,Path:h||g},parentMasterClass:d,parentSchema:d.__nerve__.schema,withDataSource:!1});return i.__nerve__.generateProperty=e(i),a.makePropertyReadonly(i.__nerve__,"generateProperty"),i}function e(b){return b.__nerve__.asEnum?function(c,d){return new a.PropertyAsEnum(c,b,d)}:function(c,d){return new a.PropertyAsLeaf(c,b,d)}}b.isLeaf=c,b.createLeaf=d}(b=a.FieldSchema||(a.FieldSchema={}))}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function b(a){a instanceof b?this.setData(a.data):this.newData(a)}return Object.defineProperty(b.prototype,"Count",{get:function(){return this.data.fieldCount},enumerable:!0,configurable:!0}),b.prototype.has=function(b){return this.hasId(a.FieldSchema.getFieldId(b))},b.prototype.hasId=function(a){return!!this.data.map[a]},b.prototype.intersect=function(a){if(Array.isArray(a))return a.some(this.has.bind(this));var b=this,c=a;if(c.Count<b.Count){var d=b;b=c,c=d}for(var e in b.data.map)if(c.data.map[e])return!0;return!1},b.prototype.intersection=function(c){var d=this;if(Array.isArray(c))return new b(c.filter(function(b){return a.FieldSchema.isFieldSchema(b)&&d.has(b)}));if(c instanceof b){var e=this,f=c;if(f.Count<e.Count){var g=e;e=f,f=g}var h=new b;for(var i in e.data.map)f.hasId(i)&&h.addFieldSchema(a.FieldSchema.getFieldSchemaById(i));return h}return new b},b.prototype.toArray=function(){return Object.keys(this.data.map).map(a.FieldSchema.getFieldSchemaById)},b.prototype.clone=function(){return new b(this)},b.prototype.clear=function(){this.newData()},b.prototype.addFieldSchema=function(a){this.has(a)||(this.ensureDataOwnership(),this.internalAddFieldSchema(a))},b.prototype.addFieldSchemas=function(a){var c,d=this;if(c=a instanceof b?a.toArray():a,c=c.filter(function(a){return!d.has(a)}),c.length){this.ensureDataOwnership();this.internalAddFieldSchema.bind(this);c.forEach(function(a){return d.internalAddFieldSchema(a)})}},b.prototype.removeFieldSchema=function(a){this.has(a)&&(this.ensureDataOwnership(),this.internalRemoveFieldSchema(a))},b.prototype.removeFieldSchemas=function(a){var c,d=this;c=a instanceof b?a.toArray():a,c=c.filter(function(a){return d.has(a)}),c.length&&(this.ensureDataOwnership(),c.forEach(function(a){return d.internalRemoveFieldSchema(a)}))},b.prototype.ensureDataOwnership=function(){1!==this.data.referenceCount&&this.newData(this.toArray())},b.prototype.internalAddFieldSchema=function(b){var c=a.FieldSchema.getFieldId(b);this.data.map[c]||(this.data.map[c]=!0,++this.data.fieldCount)},b.prototype.internalRemoveFieldSchema=function(b){var c=a.FieldSchema.getFieldId(b);this.data.map[c]&&(delete this.data.map[c],--this.data.fieldCount)},b.prototype.newData=function(a){this.setData({map:{},fieldCount:0,referenceCount:0}),a&&this.addFieldSchemas(a)},b.prototype.setData=function(a){this.data&&--this.data.referenceCount,this.data=a,++this.data.referenceCount},b}();a.FieldSchemaSet=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getSnapshot=function(c){var d=b.prototype.getSnapshot.call(this,c);if(!c)return d;var e={};return this.Master.Schema.__nerve__.subFields.intersection(c).toArray().map(a.FieldSchema.getFieldName).forEach(function(a){return e[a]=d[a]}),e},c.prototype.initializeSnapshot=function(){var b=this;this.snapshot={};var c=this.Master,d=c.Schema.__nerve__.subFields.toArray();if(a.isObjectMasterWithDataSource(c)){var e=c;d=d.filter(function(a){return e.isFieldReady(a)})}d.forEach(function(a){return b.refreshSubSnapshotWithFieldSchema(a)})},c.prototype.refreshSubSnapshot=function(a){this.refreshSubSnapshotWithFieldSchema(a.FieldSchema)},c.prototype.createSnapshotCache=function(){return Object.freeze(a.cloneObject(this.snapshot))},c.prototype.createChange=function(a){var c=b.prototype.createChange.call(this,a);return c.UpdateNeeded||(c.UpdateNeeded=a.toArray().some(function(a){return a.__nerve__.info.IsLeaf&&!a.__nerve__.info.Attributes.IsLocalField})),c.UpdateNeeded||(c.UpdateNeeded=c.SubChanges.filter(function(a){return a.UpdateNeeded}).some(function(b){var c=b.Master.Membership.FieldSchema;return a.has(c)&&!c.__nerve__.info.Attributes.IsLocalField})),c},c.prototype.removeUnchangedFields=function(b,c){var d=this,e=this.Master.Schema,f=b.toArray().filter(function(b){if(b.__nerve__.parentSchema===e&&a.FieldSchema.isLeaf(b)){var f=a.FieldSchema.getFieldName(b);return d.Master.Model[f]===c[f]}return!1});b.removeFieldSchemas(f)},c.prototype.refreshSubSnapshotWithFieldSchema=function(b){var c=a.FieldSchema.getFieldName(b),d=this.Master.Model[c];if(a.FieldSchema.isLeaf(b))this.snapshot[c]=d;else{var e=a.getMasterFromModel(d);this.snapshot[c]=e.getSnapshot()}},c}(a.BranchChangeManager);a.ObjectChangeManager=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initializeSourceData=function(a){a=this.getNormalizedSourceData(a);var b=this.Master.Schema,c=this.Master.Model.__nerve__.properties;for(var d in c){var e=b[d].__nerve__.sourceName;c[d].getDirtyChecker().initializeSourceData(a[e])}},c.prototype.getDelta=function(){var a=this;if(!this.isDirty())return void 0;var b=this.Master.Schema,c=(this.Master.Model,{});return this.getDirtyKeys().sort().forEach(function(d){var e=b[d].__nerve__.sourceName;c[e]=a.getSubDirtyCheckerWithClientName(d).getSnapshotToUpdate()}),c},c.prototype.getSnapshotToUpdate=function(){var a={},b=this.Master.Schema,c=this.getSubDirtyCheckers();for(var d in c){var e=b[d].__nerve__.sourceName;a[e]=c[d].getSnapshotToUpdate()}return a},c.prototype.getSourceData=function(){var a={},b=this.Master.Schema,c=this.getSubDirtyCheckers();for(var d in c){var e=b[d].__nerve__.sourceName;a[e]=c[d].getSourceData()}return a},c.prototype.setSourceData=function(a){var b=this;a=this.getNormalizedSourceData(a),Object.keys(a).forEach(function(c){b.getSubDirtyCheckerWithSourceName(c).setSourceData(a[c])})},c.prototype.onSourceDataReceived=function(b){var c=this;b=this.getNormalizedSourceData(b);var d,e=this.Master;if(a.isObjectMasterWithDataSource(e)){d=$.Deferred();var f=this.Master.Schema,g=f.__nerve__.sourceNameToClientName,h=Object.keys(b).map(function(a){return g[a]}).filter(function(a){return a});e.Synchronizer.markFieldsAsReady(h,d.promise())}e.bulkEdit(function(){Object.keys(b).forEach(function(a){c.getSubDirtyCheckerWithSourceName(a).onSourceDataReceived(b[a])})}),d&&d.resolve()},c.prototype.getNormalizedSourceData=function(a){var b=this.Master.Schema.__nerve__.sourceNameToClientName,c={};return a?Object.keys(a).filter(function(a){return a in b}).forEach(function(b){return c[b]=a[b]}):Object.keys(b).forEach(function(a){return c[a]=null}),c},c.prototype.getSubDirtyCheckers=function(){var b=this.Master.Model.__nerve__.properties,c={};return this.Master.Schema.__nerve__.subFields.toArray().filter(function(a){return!a.__nerve__.info.Attributes.IsLocalField}).map(a.FieldSchema.getFieldName).forEach(function(a){return c[a]=b[a].getDirtyChecker()}),c},c.prototype.getSubDirtyCheckerWithClientName=function(a){var b=this.Master.Model.__nerve__.properties[a];return b.getDirtyChecker()},c.prototype.getSubDirtyCheckerWithSourceName=function(a){var b=this.Master.Schema.__nerve__.sourceNameToClientName[a];return this.getSubDirtyCheckerWithClientName(b)},c}(a.BranchDirtyChecker);a.ObjectDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a){var b=a;return!!b.__nerve__&&b.__nerve__.nerveObjectType===j}function c(a){return a instanceof k}function d(a){var b=a,c=b.__nerve__;return!!c&&c.nerveObjectType===j&&!!c.dataSourceFactory}function e(a){return a instanceof l}function f(b,c,d){a.Spec.validateSpec(b,c);var e=d?l:k,f=function(a){function b(b,c){return a.call(this,b,c,d)||this}return __extends(b,a),Object.defineProperty(b,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),b}(e);return a.defineNerveProperty(f,a.cloneAsReadonly({nerveObjectType:j,masterName:b,dataSourceFactory:d}),!0),f.__nerve__.schema=a.FieldSchema.createRootFieldSchema(f,c),a.makePropertyReadonly(f.__nerve__,"schema"),f}function g(b,c){return c.map(function(c){var d=b.Schema;if("string"==typeof c){var e=d[c];if(a.FieldSchema.isFieldSchema(e))return e}else if(a.FieldSchema.isFieldSchema(c))return h(b,c);Nerve.Debugger.throwError("field "+c+" doesn't exist in master "+a.getMasterName(b))})}function h(b,c){for(var d=b.Schema,e=[];c.__nerve__.shadowRoot!==d;){var f=a.FieldSchema.getFieldName(c);e.push(f),c=c.__nerve__.parentSchema,c||Nerve.Debugger.throwError("field schema ("+a.FieldSchema.getFieldPath(c)+") is not a member schema of master ("+a.getMasterName(b)+")")}for(var g=d;e.length;){var f=e.pop();g=g[f]}return g}function i(b){b.Schema.__nerve__.subFields.toArray().filter(function(b){return!a.FieldSchema.isLeaf(b)}).map(a.FieldSchema.getFieldName).map(function(a){return b.Model.__nerve__.properties[a]}).map(function(a){return a.Master}).forEach(function(a){return a.Deleted=!0})}var j="object master";a.isObjectMasterClass=b,a.isObjectMaster=c,a.isObjectMasterClassWithDataSource=d,a.isObjectMasterWithDataSource=e,a.createObjectMasterClass=f;var k=function(b){function c(c,d,e){var f=this;c=c||{},d=d||{},f=b.call(this,c)||this;var g=f.__nerve__;g.markChildrenAsDeleted=function(){return i(f)},a.makePropertyReadonly(g,"markChildrenAsDeleted");var h=$.Deferred(),j=$.when(d.MasterReady,h.promise()),k=!e&&g.membership&&!g.membership.FieldSchema.__nerve__.info.Attributes.IsLocalField;g.dirtyChecker=new a.ObjectDirtyChecker(f,c.ExistingInDataSource,k),a.makePropertyReadonly(g,"dirtyChecker");var l;if(e?(g.synchronizer=new a.ObjectSynchronizer(f,c,d,j,e),l=g.synchronizer.existingInDataSource()):(g.synchronizer=null,l=c.Reserved&&c.Reserved.ParentExistingInDataSource),a.makePropertyReadonly(g,"synchronizer"),g.model=new a.ObjectModel(f,c.InitialData||{},c.ExistingInDataSource,j,$.when(c.MasterTreeReady,j),l),a.makePropertyReadonly(g,"model"),g.changeManager=new a.ObjectChangeManager(f),a.makePropertyReadonly(g,"changeManager"),e){var m=c.ExistingInDataSource?c.InitialData:null,n=a.FieldSchema.convertToSourceData(m,f.Schema);g.dirtyChecker.initializeSourceData(n)}return h.resolve(),f}return __extends(c,b),c.prototype.setData=function(b,c){var d=this.Model;if(b!==d){b=b||{};var e;if(c)e=g(this,c);else{var f=this.Schema;e=Object.keys(b).map(function(a){return f[a]}).filter(function(a){return a})}var h=[];this.bulkEdit(function(){e.map(a.FieldSchema.getFieldName).forEach(function(a){a in d?d[a]=b[a]:h.push(a)})}),h.length&&Nerve.Debugger.warn("following field(s) not found in "+a.getMasterName(this)+": "+h)}},c.prototype.getModelByFieldSchema=function(b){var c=b;a.FieldSchema.assertFieldSchema(c),c=h(this,c);for(var d=this.Schema,e=[];c!==d;){if(e.push(c),c.__nerve__.info.IsCollection)throw Error("unable to get model/value from collection "+a.FieldSchema.getFieldPath(c)+".");c=c.__nerve__.parentSchema}var f=this.Model;do c=e.pop(),f=f[a.FieldSchema.getFieldName(c)];while(e.length);return f},c}(a.MasterBase),l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b.prototype,"Synchronizer",{get:function(){return this.__nerve__.synchronizer},enumerable:!0,configurable:!0}),b.prototype.isFieldReady=function(a){return this.Synchronizer.isFieldReady(a)},b.prototype.ensureFieldsReady=function(a){return this.Synchronizer.ensureFieldsReady(a)},b.prototype.fieldsReady=function(a){return this.Synchronizer.fieldsReady(a)},b.prototype.getRelatedSourceFields=function(a){return a},b}(k);a.getTargetFieldSchemasOfObjectMaster=g}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(b){return a.isObjectMasterWithDataSource(b)?function(c,d){var e=function(){if(!b.isFieldReady(d)){var c=a.FieldSchema.getFieldPath(d);Nerve.Debugger.throwError("The field ("+c+") not ready yet.")}};return{getter:function(){return e(),c.getter()},setter:function(a){e(),c.setter(a)}}}:function(a,b){return{getter:function(){return a.getter()},setter:function(b){return a.setter(b)}}}}var c=function(c){function d(d,e,f,g,h,i){var j=this,k={};j=c.call(this,{master:d,properties:k})||this;var l=b(d);return Object.keys(d.Schema).forEach(function(b){var c=d.Schema[b],m=c.__nerve__.generateProperty(b,{InitialData:e[b],ExistingInDataSource:f,MasterTreeReady:h,Reserved:{Membership:{FieldSchema:c,Parent:d},ParentExistingInDataSource:i,Mounted:g}});k[b]=m;var n=l(m,c);a.defineProperty(j,b,n.getter,n.setter)}),j}return __extends(d,c),d}(a.ModelBase);a.ObjectModel=c}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b;!function(b){function c(b,c){var d;return d=h(b)?a.cloneObject(b.__nerve__):k(),m(d,c),a.extendObject(l(d,c),b)}function d(a,b,c){var d=k();return d.isLeaf=!0,d.basicTypeName=a,d.keyGetter=c||null,m(d,b),l(d,b)}function e(a,b){var c=k();return c.isLeaf=!0,c.basicTypeName="enum",c.enumTypeGetter=a,m(c,b),l(c,b)}function f(b,c){var d=k();if(a.isObjectMasterClass(b))d.masterClassGetter=function(){return b};else{if(!(b instanceof Function))throw Error("The parameter of Spec.fromMasterClass should be a master class of a function.");d.masterClassGetter=b}return l(d,c)}function g(b,c){var d;d=h(b)?b:a.isObjectMasterClass(b)||b instanceof Function?f(b):b;var e=k();e.isCollection=!0;var g=l(e,c);return a.defineConstProperty(g,0,d),g}function h(a){var b=a;return b&&b.__nerve__&&b.__nerve__.nerveObjectType===p}function i(a,b){b?Object.keys(b).forEach(function(c){return n(a+c,b[c])}):o(a,"there's no spec passed")}function j(a){return h(a)?a.__nerve__.attributes:q}function k(){return{attributes:q,basicTypeName:null,enumTypeGetter:null,isCollection:!1,isLeaf:!1,keyGetter:null,masterClassGetter:null,nullable:!1,nerveObjectType:p}}function l(b,c){var d={};return m(b,c),a.defineNerveProperty(d,a.cloneAsReadonly(b)),d}function m(a,b){if(b=b||{},b.IsKeyField){switch(a.basicTypeName){case"boolean":case"string":case"number":break;default:Nerve.Debugger.throwError('"isKeyField" only supported for basic type fields')}b.IsLocalField&&Nerve.Debugger.throwError("a local field can't be key field.")}var c={IsSourceGenerated:!!b.IsSourceGenerated,IsExpandedField:!!b.IsExpandedField,IsKeyField:!!b.IsKeyField,IsLocalField:!!b.IsLocalField,IsNumberTypeInDataSource:!!b.IsNumberTypeInDataSource,SourceFieldName:b.SourceFieldName};a.attributes=Object.freeze(c)}function n(a,b){b?h(b)?b.__nerve__.isCollection&&n(a+"[0]",b[0]):i(a,b):o(a,"empty field spec")}function o(a,b){throw Error("Spec error of "+a+": "+b+".")}var p="Spec",q=Object.freeze({IsKeyField:!1,IsLocalField:!1,IsNumberTypeInDataSource:!1,IsSourceGenerated:!1});b.fromObject=c,b.createLeaf=d,b.createEnumeration=e,b.fromObjectMasterClass=f,b.collectionOf=g,b.isFieldSpec=h,b.validateSpec=i,b.getAttributes=j}(b=a.Spec||(a.Spec={}))}(NerveImplementation||(NerveImplementation={}));var Nerve;!function(a){function b(b){return function(c){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];var f=a.getCollectionMasterFromModel(c),g=f[b];return g.apply(f,d)}}function c(a){return function(b,c){return f.createLeaf(a,b,c)}}a.convertToArray=NerveImplementation.convertToArray,NerveImplementation.makePropertyReadonly(a,"convertToArray"),a.getFieldSchemaInfo=NerveImplementation.FieldSchema.getFieldInfo,NerveImplementation.makePropertyReadonly(a,"getFieldSchemaInfo"),a.getSubFieldSchemas=NerveImplementation.FieldSchema.getSubFields,NerveImplementation.makePropertyReadonly(a,"getSubFieldSchemas"),a.convertFromSourceData=NerveImplementation.FieldSchema.convertFromSourceData,NerveImplementation.makePropertyReadonly(a,"convertFromSourceData"),a.convertToSourceData=NerveImplementation.FieldSchema.convertToSourceData,NerveImplementation.makePropertyReadonly(a,"convertToSourceData"),a.createObjectMasterClass=NerveImplementation.createObjectMasterClass,NerveImplementation.makePropertyReadonly(a,"createObjectMasterClass"),a.getObjectMasterFromModel=NerveImplementation.getMasterFromModel,NerveImplementation.makePropertyReadonly(a,"getObjectMasterFromModel"),a.getCollectionMasterFromModel=NerveImplementation.getMasterFromModel,NerveImplementation.makePropertyReadonly(a,"getCollectionMasterFromModel");var d={addItems:null,deleteItems:null,getIndexWithKeyFields:null,getItemWithKeyFields:null,itemsAddedInSource:null,itemsDeletedInSource:null,markAsChanged:null,setComparer:null};for(var e in d)d[e]=b(e);a.Collection=Object.freeze(d),NerveImplementation.makePropertyReadonly(a,"Collection");var f=NerveImplementation.Spec,g=(f.createLeaf("reference"),{create:f.fromObject,"boolean":c("boolean"),number:c("number"),string:c("string"),enumeration:f.createEnumeration,reference:c("reference"),collectionOf:f.collectionOf,fromMasterClass:f.fromObjectMasterClass});a.Spec=Object.freeze(g),NerveImplementation.makePropertyReadonly(a,"Spec")}(Nerve||(Nerve={}));var NerveImplementation;!function(a){var b=Nerve.Spec,c={InProcess:b["boolean"](),AllSucceeded:b["boolean"](),Scheduled:b["boolean"](),CreationError:b.reference(),CreationFailed:b["boolean"](),CreationInProcess:b["boolean"](),CreationScheduled:b["boolean"](),CreationRetryScheduled:b["boolean"](),QueryError:b.reference(),QueryFailed:b["boolean"](),QueryInProcess:b["boolean"](),UpdateError:b.reference(),UpdateFailed:b["boolean"](),UpdateInProcess:b["boolean"](),UpdateRetryScheduled:b["boolean"](),UpdateScheduled:b["boolean"]()},d=function(a){function b(){var b=a.call(this,{InitialData:{InProcess:!1,AllSucceeded:!0,Scheduled:!1,CreationError:null,CreationFailed:!1,CreationInProcess:!1,CreationRetryScheduled:!1,CreationScheduled:!1,QueryError:null,QueryFailed:!1,QueryInProcess:!1,UpdateError:null,UpdateFailed:!1,UpdateInProcess:!1,UpdateRetryScheduled:!1,UpdateScheduled:!1}})||this;return b.addRule(e),b.addRule(f),b.addRule(g),b}return __extends(b,a),b}(Nerve.createObjectMasterClass("Nerve.ObjectSynchronizerMaster",c));a.ObjectSynchronizerMaster=d;var e={Name:"InProcess",InterestedFields:[d.Schema.CreationInProcess,d.Schema.QueryInProcess,d.Schema.UpdateInProcess],onChange:function(a){var b=a.Master.Model;b.InProcess=b.CreationInProcess||b.QueryInProcess||b.UpdateInProcess}},f={Name:"AllSucceeded",InterestedFields:[d.Schema.CreationFailed,d.Schema.QueryFailed,d.Schema.UpdateFailed],onChange:function(a){var b=a.Master.Model;b.AllSucceeded=!(b.CreationFailed||b.QueryFailed||b.UpdateFailed)}},g={Name:"Scheduled",InterestedFields:[d.Schema.CreationScheduled,d.Schema.CreationRetryScheduled,d.Schema.UpdateScheduled,d.Schema.UpdateRetryScheduled],onChange:function(a){var b=a.Master.Model;b.Scheduled=b.CreationScheduled||b.CreationRetryScheduled||b.UpdateScheduled||b.UpdateRetryScheduled}}}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(c,d,e,f,g){var h=b.call(this)||this;h.deletionJob=$.Deferred(),h.updateJob=$.Deferred(),h.fieldReadinesses={},h.fieldReadinesseDeferreds={},h.queryJobsPerField={},h.syncJobWithDataSource=$.Deferred().resolve().promise(),h.retryTimesForUpdate=0,h.dataReceivedDuringSync=[],h.master=c,h.scheduler=new a.SchedulerStabilizer(e.Scheduler),h.initializeUpdateJob();var i=d.Reserved&&d.Reserved.ParentExistingInDataSource;h.dataSourcePromise=$.when(d.MasterTreeReady,f,i).then(function(){return g(c,function(a){return h.onSourceDataReceived(a)},e.DataSourceContext)});var j=h.getReadyFieldNames(d);if(j.length){var k=$.Deferred().resolve();j.forEach(function(a){h.fieldReadinesses[a]=!0,h.fieldReadinesseDeferreds[a]=k})}f.done(function(){c.observe(function(a){a.UpdateNeeded&&h.checkForUpdate()})});var l=!d.ExistingInDataSource;return l?h.createWithDataSource():(h.creationJob=f,h.creationJob.done(function(){return h.checkForUpdate()})),h}return __extends(c,b),c.prototype.flush=function(){var a=this;return this.scheduler.flush(),this.creationJob.then(function(){return a.updateJob})},c.prototype.existingInDataSource=function(){return this.creationJob},c.prototype.deletedFromDataSource=function(){var b=this;return this.creationJob.then(function(){return b.deletionJob.promise()},function(){return a.getResolvedPromise()})},c.prototype.isFieldReady=function(b){b=this.master.getRelatedSourceFields([b])[0];var c=a.getTargetFieldSchemasOfObjectMaster(this.master,[b])[0],d=a.FieldSchema.getFieldName(c);return!!this.fieldReadinesses[d]},c.prototype.ensureFieldsReady=function(b){var c=this;b=this.master.getRelatedSourceFields(b);var d=a.getTargetFieldSchemasOfObjectMaster(this.master,b),e=d.filter(function(a){return!c.isFieldReady(a)});return e.length?this.creationJob.then(function(){var b=d.filter(function(a){return!c.isFieldReady(a)});return b.length?c.query(b):a.getResolvedPromise()}).then(function(){return c.getChangingPeriod()}):a.getResolvedPromise()},c.prototype.fieldsReady=function(b){var c=this;b=this.master.getRelatedSourceFields(b);var d=a.getTargetFieldSchemasOfObjectMaster(this.master,b),e=d.map(a.FieldSchema.getFieldName).map(function(a){return c.fieldReadinesseDeferreds[a]||(c.fieldReadinesseDeferreds[a]=$.Deferred()),c.fieldReadinesseDeferreds[a].promise()});return $.when.apply($,e).then(function(){return c.getChangingPeriod()})},c.prototype.query=function(b){var c=this;b=this.master.getRelatedSourceFields(b);var d=a.getTargetFieldSchemasOfObjectMaster(this.master,b);return this.creationJob.then(function(){var b=[],e=$.Deferred(),f=e.then(function(){return c.queryWithDataSource(b)}),g=[];return d.filter(function(a){return!a.__nerve__.info.Attributes.IsLocalField}).forEach(function(d){var e=a.FieldSchema.getFieldName(d),h=c.queryJobsPerField[e];h&&"pending"===h.state()||(c.queryJobsPerField[e]=f,b.push(d.__nerve__.sourceName)),g.push(c.queryJobsPerField[e])}),b.length?e.resolve():e.reject(),$.when.apply($,g)}).then(function(){return c.getChangingPeriod()})},c.prototype.onSourceDataReceived=function(b){var c=this,d=a.FieldSchema.cloneSourceData(b,this.master.Schema);this.dataReceivedDuringSync.push(d),this.syncJobWithDataSource.then(function(){return c.flushReceivedDataDuringSync()})},c.prototype.onDeletedInDataSource=function(){this.getDirtyChecker().ExistingInSource=!1,
this.master.Deleted=!0},c.prototype.markFieldsAsReady=function(a,b){var c=this;a.forEach(function(a){return c.fieldReadinesses[a]=!0}),b.done(function(){var b=$.Deferred().resolve();a.forEach(function(a){c.fieldReadinesseDeferreds[a]?c.fieldReadinesseDeferreds[a].resolve():c.fieldReadinesseDeferreds[a]=b})})},c.prototype.initializeUpdateJob=function(){var a=this;this.updateJob=$.Deferred(),this.observe(function(){return a.changeUpdateJobState()},[this.Schema.UpdateError,this.Schema.UpdateFailed,this.Schema.UpdateInProcess,this.Schema.UpdateScheduled])},c.prototype.changeUpdateJobState=function(){var a=this.Model;a.UpdateScheduled||a.UpdateInProcess?"pending"!==this.updateJob.state()&&(this.updateJob=$.Deferred()):a.UpdateFailed?a.UpdateRetryScheduled||this.updateJob.reject(a.UpdateError):this.updateJob.resolve()},c.prototype.getReadyFieldNames=function(b){var c=this.master.Schema.__nerve__.subFields;if(b.ExistingInDataSource){var d=b.InitialData||{},e=[];return c.toArray().forEach(function(b){var c=a.FieldSchema.getFieldName(b);(b.__nerve__.info.Attributes.IsLocalField||c in d)&&e.push(c)}),e}return c.toArray().filter(function(a){return!a.__nerve__.info.Attributes.IsSourceGenerated}).map(a.FieldSchema.getFieldName)},c.prototype.checkForUpdate=function(){var a=this;this.getDirtyChecker().isDirty()?this.bulkEdit(function(){a.Model.UpdateScheduled=!0,$.when(a.creationJob,a.scheduler.scheduleUpdate()).done(function(){a.retryTimesForUpdate=0,a.update()})}):(this.scheduler.cancelUpdate(),this.Model.UpdateScheduled=!1)},c.prototype.update=function(){if(this.updating)return void(this.updatePended=!0);if(this.getDirtyChecker().isDirty()){if(this.onUpdateStart(),this.getDirtyChecker().isDirty())return this.master.__nerve__.deleted?this.deleteWithDataSource():this.updateWithDataSource();Nerve.Debugger.warn("onUpdateStart changes dirtiness."),this.onUpdateDone()}else this.onUpdateDone()},c.prototype.getDirtyChecker=function(){return this.master.__nerve__.dirtyChecker},c.prototype.createWithDataSource=function(){var a=this,b=$.Deferred();this.creationJob=b.promise();var c=this.master;this.bulkEdit(function(){a.Model.CreationScheduled=!0,a.dataSourcePromise.done(function(d){var e=function(){if(a.scheduler.cancelRetryForCreation(),c.__nerve__.deleted)return a.bulkEdit(function(){a.Model.CreationFailed=!1,a.Model.CreationInProcess=!1,a.Model.CreationRetryScheduled=!1,a.Model.CreationScheduled=!1});a.bulkEdit(function(){a.Model.CreationError=null,a.Model.CreationFailed=!1,a.Model.CreationInProcess=!0,a.Model.CreationRetryScheduled=!1,a.Model.CreationScheduled=!1});var g=a.getDirtyChecker(),h=g.getDelta()||{},i=g.getSnapshotToUpdate(),j=a.syncJobWithDataSource.then(function(){return d.add(h,{Master:c,Snapshot:i})}).then(function(d){c.bulkEdit(function(){g.ExistingInSource=!0,g.setSourceData(h),d&&a.onSourceDataReceivedInternal(d)}),a.bulkEdit(function(){a.Model.CreationInProcess=!1,a.checkForUpdate()}),b.resolve()}).fail(function(c){a.bulkEdit(function(){a.Model.CreationFailed=!0,a.Model.CreationError=c,a.Model.CreationInProcess=!1,a.Model.CreationRetryScheduled=!0,a.scheduler.retryForCreation(++f).done(e).fail(function(){a.Model.CreationRetryScheduled=!1,b.reject(c)})})});a.updateSyncJobWithDataSource(j)},f=0;e()})})},c.prototype.deleteWithDataSource=function(){var a=this,b=this.getDirtyChecker(),c=this.syncJobWithDataSource.then(function(){return a.dataSourcePromise}).then(function(c){var d=b.getSnapshotToUpdate();return c["delete"](d,{Master:a.master,Snapshot:d})}).then(function(){return b.ExistingInSource=!1});return this.updateSyncJobWithDataSource(c),c.done(function(){a.onUpdateDone(!1),a.deletionJob.resolve()}).fail(function(b){a.onUpdateFailed(b,!1,function(){a.deletionJob.reject(b)})})},c.prototype.queryWithDataSource=function(a){var b=this,c=this.syncJobWithDataSource.then(function(){return b.dataSourcePromise}).then(function(c){return b.bulkEdit(function(){b.Model.QueryError=null,b.Model.QueryInProcess=!0}),c.query(a,{Master:b.master,Snapshot:null})}).then(function(c){var d={};Object.keys(c).concat(a).forEach(function(a){return d[a]=c[a]}),b.onSourceDataReceivedInternal(d)});return this.updateSyncJobWithDataSource(c),c.done(function(){b.Model.QueryInProcess=!1}).fail(function(a){b.bulkEdit(function(){b.Model.QueryError=a,b.Model.QueryInProcess=!1})})},c.prototype.updateWithDataSource=function(){var a=this,b=this.getDirtyChecker(),c=b.getDelta(),d=b.getSnapshotToUpdate(),e=b.getSourceData();null==c&&Nerve.Debugger.warn("data is null when it's dirty.");var f=this.syncJobWithDataSource.then(function(){return a.dataSourcePromise}).then(function(b){return b.update(c,{Master:a.master,Snapshot:d,ValuesBefore:e})}).then(function(d){a.master.bulkEdit(function(){b.setSourceData(c),d&&a.onSourceDataReceivedInternal(d)})});return this.updateSyncJobWithDataSource(f),f.done(function(){return a.onUpdateDone(!0)}).fail(function(b){return a.onUpdateFailed(b,!0)})},c.prototype.onUpdateStart=function(){var a=this;this.updating=!0,this.updatePended=!1,this.scheduler.cancelRetryForUpdate(),this.bulkEdit(function(){a.Model.UpdateError=null,a.Model.UpdateFailed=!1,a.Model.UpdateInProcess=!0,a.Model.UpdateRetryScheduled=!1,a.Model.UpdateScheduled=!1})},c.prototype.onUpdateDone=function(a){var b=this;this.updating=!1,this.retryTimesForUpdate=0,this.scheduler.cancelRetryForUpdate(),this.bulkEdit(function(){b.Model.UpdateError=null,b.Model.UpdateFailed=!1,b.Model.UpdateInProcess=!1,b.Model.UpdateRetryScheduled=!1,b.Model.UpdateScheduled=!1,a&&(b.updatePended?b.update():b.checkForUpdate())})},c.prototype.onUpdateFailed=function(a,b,c){var d=this;return this.getDirtyChecker().isDirty()?(this.updating=!1,void this.bulkEdit(function(){d.Model.UpdateError=a,d.Model.UpdateFailed=!0,d.Model.UpdateInProcess=!1,d.Model.UpdateRetryScheduled=!0,d.Model.UpdateScheduled=!0,b&&d.updatePended?d.update():d.scheduler.retryForUpdate(++d.retryTimesForUpdate).done(function(){return d.update()}).fail(function(){d.bulkEdit(function(){d.Model.UpdateRetryScheduled=!1,d.Model.UpdateScheduled=!1}),c&&c()})})):void this.onUpdateDone()},c.prototype.onSourceDataReceivedInternal=function(b){var c=a.FieldSchema.cloneSourceData(b,this.master.Schema);this.getDirtyChecker().onSourceDataReceived(c)},c.prototype.updateSyncJobWithDataSource=function(b){var c=this;this.syncJobWithDataSource=a.always(b).then(function(){return c.flushReceivedDataDuringSync()})},c.prototype.flushReceivedDataDuringSync=function(){var a=this.getDirtyChecker(),b=this.dataReceivedDuringSync;this.dataReceivedDuringSync=[],this.master.bulkEdit(function(){b.forEach(function(b){return a.onSourceDataReceived(b)})})},c.prototype.getChangingPeriod=function(){return this.master.__nerve__.changeManager.getChangingPeriod()},c}(a.ObjectSynchronizerMaster);a.ObjectSynchronizer=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function a(a,b,c){var d=this;this.name=a,this.fieldSchema=b;var e=c.Reserved.Membership;this.parentMaster=e.Parent,e.Property=this,this.isMounted=!1,c.Reserved.Mounted.done(function(){return d.isMounted=!0})}return Object.defineProperty(a.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"FieldSchema",{get:function(){return this.fieldSchema},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ParentMaster",{get:function(){return this.parentMaster},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Index",{get:function(){return this.index},set:function(a){if(a!==this.index){var b=this.index;this.index=a;var c=this.ParentMaster;this.indexDirtinessUpdateNeeded()&&c.__nerve__.dirtyChecker.updateDirtinessForIndexChange(this),this.Mounted&&c.__nerve__.changeManager.onPropertyIndexChange(this,b)}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Mounted",{get:function(){return this.isMounted},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Deleted",{get:function(){return this.deleted},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ParentDirtyChecker",{get:function(){return this.ParentMaster.__nerve__.dirtyChecker},enumerable:!0,configurable:!0}),a.prototype.markAsDeleted=function(a){this.deleted=!0,this.Index=void 0},a.prototype.getKey=function(){return this.fieldSchema.__nerve__.getKey(this.getter())},a}();a.PropertyBase=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(b,c,d){var e=a.call(this,b,c,d)||this,f=c.__nerve__.subMasterClassGetter();return e.master=new f(d),e}return __extends(b,a),Object.defineProperty(b.prototype,"Master",{get:function(){return this.master},enumerable:!0,configurable:!0}),b.prototype.getter=function(){return this.master.Model},b.prototype.setter=function(a){this.master.setData(a,this.master.Schema.__nerve__.subFields.toArray())},b.prototype.markAsDeleted=function(b){a.prototype.markAsDeleted.call(this,b),b&&(this.getDirtyChecker().ExistingInSource=!1),this.master.Deleted=!0},b.prototype.getDirtyChecker=function(){return this.master.__nerve__.dirtyChecker},b.prototype.indexDirtinessUpdateNeeded=function(){return!this.FieldSchema.__nerve__.withDataSource},b}(a.PropertyBase);a.PropertyAsBranch=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;e.value=e.normalizeValue(d.InitialData);var f=!c.__nerve__.info.Attributes.IsLocalField;return e.dirtyChecker=e.createDirtyChecker(f),e}return __extends(c,b),c.prototype.getter=function(){return this.value},c.prototype.setter=function(a){if(a=this.normalizeValue(a),this.value!==a){this.value=a,this.dirtyChecker.updateDirtiness();var b=this.ParentMaster.__nerve__.changeManager;b.markSubSnapshotAsDirty([this]),b.markAsChanged(this)}},c.prototype.getDirtyChecker=function(){return this.dirtyChecker},c.prototype.normalizeValue=function(a){return null==a?null:a},c.prototype.createDirtyChecker=function(b){return new a.LeafDirtyChecker(this,b)},c.prototype.indexDirtinessUpdateNeeded=function(){return!0},c}(a.PropertyBase);a.PropertyAsLeaf=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.normalizeValue=function(a){var b=typeof a;if("string"===b||"number"===b){var c=this.FieldSchema.__nerve__.enumType;if(a in c)return"string"===b?c[a]:a}return null},c.prototype.createDirtyChecker=function(b){return new a.EnumDirtyChecker(this,b)},c}(a.PropertyAsLeaf);a.PropertyAsEnum=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function b(a){a?(this.creationRetryStabilizer=new c({retry:a.retryForCreation&&a.retryForCreation.bind(a),cancel:a.cancelRetryForCreation&&a.cancelRetryForCreation.bind(a)}),this.updateRetryStabilizer=new c({retry:a.retryForUpdate&&a.retryForUpdate.bind(a),cancel:a.cancelRetryForUpdate&&a.cancelRetryForUpdate.bind(a)})):(this.creationRetryStabilizer=new c,this.updateRetryStabilizer=new c),this.scheduler=a||{}}return b.prototype.scheduleUpdate=function(){return this.outputUpdateScheduleDeferred?(this.scheduler.postponeUpdate&&this.scheduler.postponeUpdate(),this.outputUpdateScheduleDeferred.promise()):this.createUpdateSchedule()},b.prototype.postponeUpdate=function(){this.scheduler.postponeUpdate&&this.scheduler.postponeUpdate()},b.prototype.flush=function(){if(this.creationRetryStabilizer.flush(),this.updateRetryStabilizer.flush(),this.cancelableUpdateSchedule&&(this.cancelableUpdateSchedule.cancel(),this.cancelableUpdateSchedule=void 0,this.scheduler.cancelUpdate&&this.scheduler.cancelUpdate()),this.outputUpdateScheduleDeferred){var a=this.outputUpdateScheduleDeferred;this.outputUpdateScheduleDeferred=void 0,a.resolve()}},b.prototype.cancelUpdate=function(){this.outputUpdateScheduleDeferred&&(this.outputUpdateScheduleDeferred.reject(),this.scheduler.cancelUpdate&&this.scheduler.cancelUpdate())},b.prototype.retryForCreation=function(a){return this.creationRetryStabilizer.retry(a)},b.prototype.cancelRetryForCreation=function(){return this.creationRetryStabilizer.cancel()},b.prototype.retryForUpdate=function(a){return this.updateRetryStabilizer.retry(a)},b.prototype.cancelRetryForUpdate=function(){return this.updateRetryStabilizer.cancel()},b.prototype.createUpdateSchedule=function(){var b=this;this.outputUpdateScheduleDeferred||(this.outputUpdateScheduleDeferred=$.Deferred());var c,d=this.outputUpdateScheduleDeferred;return c=this.scheduler.scheduleUpdate?this.scheduler.scheduleUpdate():a.getResolvedPromise(),this.cancelableUpdateSchedule=new a.Cancelable(c),this.cancelableUpdateSchedule.promise().always(function(){b.outputUpdateScheduleDeferred=void 0,b.cancelableUpdateSchedule=void 0}).done(function(){return d.resolve()}).fail(function(){return d.reject()}),d.promise()},b}();a.SchedulerStabilizer=b;var c=function(){function b(a){this.scheduler=a||{}}return b.prototype.retry=function(b){var c=this;if(!this.scheduler.retry)return a.getRejectedPromise();this.cancel();var d=$.Deferred();return this.deferred=d,this.cancelable=new a.Cancelable(this.scheduler.retry(b)),this.cancelable.promise().always(function(){c.deferred=void 0,c.cancelable=void 0}).done(function(){return d.resolve()}).fail(function(){return d.reject()}),d.promise()},b.prototype.flush=function(){if(this.cancelable&&(this.cancelable.cancel(),this.cancelable=void 0,this.scheduler.cancel&&this.scheduler.cancel()),this.deferred){var a=this.deferred;this.deferred=void 0,a.resolve()}},b.prototype.cancel=function(){this.cancelable&&(this.cancelable.cancel(),this.deferred=void 0,this.cancelable=void 0,this.scheduler.cancel&&this.scheduler.cancel())},b}()}(NerveImplementation||(NerveImplementation={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.Aad=0]="Aad",a[a.Msa=1]="Msa"}(c=b.AuthProvider||(b.AuthProvider={}));var d=function(){function d(){return d._instance?d._instance:void(d._instance=this)}return d.getInstance=function(){return new d},Object.defineProperty(d,"DesignPageURL",{get:function(){return window.location.origin+d.designPagePath},enumerable:!0,configurable:!0}),d.prototype.redirectToSignIn=function(b){var c=encodeURIComponent(b||window.location.href),d=OfficeFormServerInfo.userInfo.IsMsa,e="Response"===a.EnvironmentConfig.getPageType(),f=OfficeFormServerInfo.signInLink;d&&!e&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailHrdHostedUX)?(f=OfficeFormServerInfo.signInLinkMsa,f=a.Utilities.Html.updateUrlParam(f,"redirecturl",c)):f=a.Utilities.Html.updateUrlParam(f,"state",c),a.Authenticator.redirectToUrl(f,"Replace")},d.prototype.redirectWithPatchedRedirectUrl=function(){var b=window.location.hash,c=a.Utilities.Html.getQueries().redirecturl;if(c&&-1===c.indexOf("#")&&b){window.location.hash="";var d=window.location.href;return d=a.Utilities.Html.updateUrlParam(d,"redirecturl",encodeURIComponent(c+b)),a.Authenticator.redirectToUrl(d,"Assign"),!0}return!1},d.prototype.isUserLoggedIn=function(){return!!OfficeFormServerInfo.userInfo.UserId},d.prototype.isAuthTokenExpiredFailure=function(c){var e=c&&c.response&&c.response.statusCode;if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)&&e===b.ErrorCode.HttpStatusCode.Unauthorized){if(c&&c.response&&"Expired"===c.response.headers["X-FailureReason"])return!0;var f=d.parseInnerCodeFromError(c);if(f===b.ErrorCode.InnerCode.TokenExpired)return!0}return!1},d.prototype.isAntiForgeryTokenValidationFailure=function(c){var e=c&&c.response&&c.response.statusCode;if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)&&e===b.ErrorCode.HttpStatusCode.Forbidden){var f=d.parseInnerCodeFromError(c);if(f===b.ErrorCode.InnerCode.AntiForgeryTokenValidationError)return!0}return!1},d.prototype.refreshAuthToken=function(b,c){window.formsRefreshAuthTokenCallbacks||(window.formsRefreshAuthTokenCallbacks=[]);var e=function(a,d){!d&&a?b():c()};if(window.formsRefreshAuthTokenCallbacks.push(e),!window.formsRefreshAuthTokenCallback){var f=new a.Event.QosEvent(a.Event.QosEventNames.Auth.Auth.RefreshToken);f.start();var g=function(b,c){try{f.end({resultType:c?a.Event.ResultType.ExpectedFailure:a.Event.ResultType.Success}),$("#refreshAuthTokenFrame").remove();var d=window.formsRefreshAuthTokenCallbacks;if(c)d&&d.length>0&&d[0](b,c);else for(var e=0;e<d.length;++e)d[e](b,c)}finally{window.formsRefreshAuthTokenCallback=void 0,window.formsRefreshAuthTokenCallbacks=void 0}};if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.MsaSilentSignin))if(this.isUserLoggedIn()){var h=OfficeFormServerInfo.userInfo.IsMsa?d.signInLinkSilentMsa:d.signInLinkSilent,i=$("<iframe id='refreshAuthTokenFrame' style='display: none' src='"+h+"' />");i.on("load",null,null,function(a){window.setTimeout(function(){window.formsRefreshAuthTokenCallback&&window.formsRefreshAuthTokenCallback(!1,!0)},5e3)}),window.formsRefreshAuthTokenCallback=g,$(document.body).append(i)}else g(!1,!0);else{var i=$("<iframe id='refreshAuthTokenFrame' style='display: none' src='"+d.signInLinkSilent+"' />");i.on("load",null,null,function(a){window.setTimeout(function(){window.formsRefreshAuthTokenCallback&&window.formsRefreshAuthTokenCallback(!1,!0)},5e3)}),window.formsRefreshAuthTokenCallback=g,$(document.body).append(i)}}},d.prototype.detectUserLoggedIn=function(){var b=this;return a.EnvironmentConfig.isOsi()?this.detectUserLoggedInWithProvider(c.Aad).then(function(a){return a?c.Aad:b.detectUserLoggedInWithProvider(c.Msa).then(function(a){return a?c.Msa:$.Deferred().reject().promise()})}):$.Deferred().reject().promise()},d.prototype.detectUserLoggedInWithProvider=function(b){var e="detect-user-loggedIn-frame",f=$.Deferred();if(window.formsDetectUserLoggedInCallback)f.reject();else{var g=b===c.Msa?a.Event.QosEventNames.Auth.Auth.DetectUserLoggedInMSA:a.Event.QosEventNames.Auth.Auth.DetectUserLoggedInAAD,h=new a.Event.QosEvent(g);h.start();var i=function(b,c){window.formsDetectUserLoggedInCallback=void 0,h.end({resultType:c?a.Event.ResultType.ExpectedFailure:a.Event.ResultType.Success}),$("#"+e).remove(),f.resolve(b)},j=b===c.Msa?d.signInLinkSilentMsa:d.signInLinkSilent,k=$("<iframe id='"+e+"' style='display: none' src='"+j+"' />");k.on("load",null,null,function(a){window.setTimeout(function(){window.formsDetectUserLoggedInCallback&&window.formsDetectUserLoggedInCallback(!1,!0)},5e3)}),window.formsDetectUserLoggedInCallback=i,$(document.body).append(k)}return f.promise()},d.parseInnerCodeFromError=function(b){var c=b&&b.response&&a.Utilities.tryParseJson(b.response.body);return c.error&&parseInt(c.error.code)},d.signOutInIframe=function(){if(a.EnvironmentConfig.isOsi()){var b=new a.Event.QosEvent(a.Event.QosEventNames.Auth.Auth.SignOutInIframe);b.start();var c=$('<iframe style="display: none" src="'+OfficeFormServerInfo.signOutLink+'" />');c.on("load",null,null,function(c){b.end({resultType:a.Event.ResultType.Success})}),$(document.body).append(c)}},d.signInWithOtherAccount=function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Error.ErrorPage.SignInWithOtherAccount}),a.EnvironmentConfig.isOsi()&&d.getInstance().detectUserLoggedInWithProvider(c.Msa).then(function(b){if(b)a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Error.ErrorPage.SignOutInIframeInProgress}),a.Authenticator.redirectToUrl(OfficeFormServerInfo.signOutLink,"Assign");else{var c=a.Authenticator.getProtocol()+window.location.host+"#Login=True";a.Authenticator.redirectToUrl(c,"Replace")}})},d.signInLinkSilent=OfficeFormServerInfo.signInLinkSilent,d.signInLinkSilentMsa=OfficeFormServerInfo.signInLinkSilentMsa,d.designPagePath="/Pages/DesignPage.aspx",d}();b.AuthTokenHelper=d}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){a[a.Succeeded=0]="Succeeded",a[a.Failed=1]="Failed"}(b=a.AsyncResultStatus||(a.AsyncResultStatus={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){}(b=a.Exports||(a.Exports={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){a[a.BackSpace=8]="BackSpace",a[a.Tab=9]="Tab",a[a.Enter=13]="Enter",a[a.Shift=16]="Shift",a[a.Esc=27]="Esc",a[a.Space=32]="Space",a[a.End=35]="End",a[a.Home=36]="Home",a[a.ArrowLeft=37]="ArrowLeft",a[a.ArrowUp=38]="ArrowUp",a[a.ArrowRight=39]="ArrowRight",a[a.ArrowDown=40]="ArrowDown",a[a.Delete=46]="Delete",a[a.Eight=56]="Eight",a[a.PlaceHolder=229]="PlaceHolder"}(b=a.KeyCode||(a.KeyCode={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.NotFound=404]="NotFound"}(b=a.HttpStatusCode||(a.HttpStatusCode={}));var c;!function(a){a[a.UpdateFormFailed=609]="UpdateFormFailed",a[a.GetFormFailed=612]="GetFormFailed",a[a.ExceedMaximumFormLimition=650]="ExceedMaximumFormLimition",a[a.CDBTableNotFound=674]="CDBTableNotFound",a[a.TableReadOnly=636]="TableReadOnly",a[a.NoPermission=700]="NoPermission",a[a.RequireLogin=701]="RequireLogin",a[a.UserNotAllowed=702]="UserNotAllowed",a[a.DisabledByTenantAdmin=703]="DisabledByTenantAdmin",a[a.AntiForgeryTokenValidationError=704]="AntiForgeryTokenValidationError",a[a.UserNeedMultiFactorAuth=705]="UserNeedMultiFactorAuth",a[a.TokenExpired=711]="TokenExpired",a[a.NotRolloutMsaUser=712]="NotRolloutMsaUser",a[a.ImageNotFound=805]="ImageNotFound",a[a.InvalidFormId=1001]="InvalidFormId",a[a.FormClosed=5e3]="FormClosed",a[a.MultiResponseNotAllowed=5001]="MultiResponseNotAllowed",a[a.FormNotStarted=5002]="FormNotStarted",a[a.FormEnded=5003]="FormEnded",a[a.FormSettingJSONParseError=5004]="FormSettingJSONParseError",a[a.NoODPermissionForOpenInExcel=5117]="NoODPermissionForOpenInExcel",a[a.FailedToCreatePermission=5501]="FailedToCreatePermission",a[a.FailedToDeletePermission=5503]="FailedToDeletePermission",a[a.CreateInfoNotCompletePermission=5504]="CreateInfoNotCompletePermission",a[a.DeleteNotExistPermission=5506]="DeleteNotExistPermission",a[a.CopyNotAllowed=5550]="CopyNotAllowed",a[a.FailedToTurnOnAllowCopy=5551]="FailedToTurnOnAllowCopy",a[a.FailedToTurnOffAllowCopy=5552]="FailedToTurnOffAllowCopy",a[a.IncorrectShareToken=5553]="IncorrectShareToken",a[a.ImageUploadFailed=5200]="ImageUploadFailed",a[a.ImageTypeConvertFailed=5201]="ImageTypeConvertFailed",a[a.ImageProviderGetCDBTokenFailed=5202]="ImageProviderGetCDBTokenFailed",a[a.EmbedFormNeedAuth=10001]="EmbedFormNeedAuth",a[a.WorkBookLostFocus=10100]="WorkBookLostFocus",a[a.GetTableDataFailed=10101]="GetTableDataFailed",a[a.InvalidWorkBookSchema=10102]="InvalidWorkBookSchema",a[a.DeleteFormFailed=10201]="DeleteFormFailed",a[a.DeleteFormSuccessed=10202]="DeleteFormSuccessed",a[a.DownloadExcelFileFailed=10203]="DownloadExcelFileFailed",a[a.DownloadExcelFileFailedOnIos=10204]="DownloadExcelFileFailedOnIos",a[a.ReexportToExcelFailed=10205]="ReexportToExcelFailed",a[a.DownloadExcelFileTimeout=10206]="DownloadExcelFileTimeout",a[a.FormCreationFromQTIFailed=10300]="FormCreationFromQTIFailed",a[a.FormCreationFromQTITimeout=10301]="FormCreationFromQTITimeout",a[a.NetworkIssue=15001]="NetworkIssue",a[a.GetGraphAPITokenFailed=15002]="GetGraphAPITokenFailed",a[a.LoginNotSupportInCurrentBrowser=15003]="LoginNotSupportInCurrentBrowser",a[a.SurveyUrlInvalid=2e4]="SurveyUrlInvalid",a[a.UnableToConnectToFormsPro=20001]="UnableToConnectToFormsPro"}(c=a.InnerCode||(a.InnerCode={}))}(b=a.ErrorCode||(a.ErrorCode={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(b,c){if(!b&&!a.EnvironmentConfig.isProduction()&&!a.EnvironmentConfig.isProdAlternative()){var d=(new Error).stack;console.assert(b,c,d)}}function d(){return _.omit(J.getQueries(),"embed","oembedsso","themecolor","preview")}function e(){return!!J.getQueries().embed}function f(){return OfficeFormServerInfo.isOembedSPO}function g(){return!!J.getQueries().oembedsso&&!!J.getQueries().preview}function h(a){return void 0===a&&(a=!0),a&&(j()||i())?!0:!1}function i(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.TeamSSO)&&a.EnvironmentSettings.IsTeamsIntegration&&a.EnvironmentConfig.isProduction()&&"Analyze"!==a.EnvironmentConfig.getPageType()?!0:!1}function j(){return a.EnvironmentSettings.IsAssignmentsIntegration}function k(){var a=navigator.userAgent.toLowerCase();return-1!==a.search("windows nt 10.")}function l(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("msie")||-1!==a.indexOf("trident/")}function m(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("edge/")}function n(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox/")}function o(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))}function p(){return $(window).width()<=768}function q(){return/ip(hone|od|ad)/.test(navigator.userAgent.toLowerCase())&&!window.MSStream}function r(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("mac os x")&&-1!==a.indexOf("version/9")&&-1!==a.indexOf("safari")}function s(){var a=navigator.userAgent;return!!a.match(/android/i)}function t(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("tbs/")}function u(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("micromessenger/")}function v(){var a,b;return a=document.createElement("div"),a.style.color="rgb(83,7,13)",document.body.appendChild(a),b=document.defaultView?document.defaultView.getComputedStyle(a,null).color:a.currentStyle.color,b=b.replace(/ /g,""),document.body.removeChild(a),"rgb(83,7,13)"!==b}function w(a){var b=_.clone(a);return _.each(b,function(a,c){_.isObject(a)&&(b[c]=w(a))}),b}function x(a){try{var b=JSON.parse(a);return b}catch(c){return a}}function y(a){return _.keys(a).filter($.isNumeric).map(function(a){return parseInt(a)})}function z(a){return _.keys(a).filter($.isNumeric).map(function(b){return a[b]})}function A(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a=a.filter(function(a){return!!a}),!a.length)return $.Deferred().reject().promise();var c=$.Deferred(),d=a.length,e=function(a){0===--d&&c.reject(a)};return a.forEach(function(a){a.done(function(a){return c.resolve(a)}).fail(e)}),c.promise()}function B(a,b,c){var d=new Date;d.setTime(d.getTime()+c);var e="expires="+d.toUTCString(),f="path=/";document.cookie=a+"="+b+"; "+e+"; "+f}function C(a){a+="=";var b=document.cookie.split(";").filter(function(b){return b.indexOf(a)>=0});if(b.length>0){var c=b[0].trim();return c.substring(a.length,c.length)}return null}function D(a){B(a,null,(new Date).getTime()-9999)}function E(a){for(var b=0,c=0;c<a.length;c++)b=a.charCodeAt(c)+((b<<5)-b);return b}function F(){return document&&document.body&&"rtl"===document.body.getAttribute("dir")}function G(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}a.Exports.Utilities=b;var H;!function(a){function b(a){return null===a?void 0:a}function c(a){return void 0===a?null:a}a.nullToUndefined=b,a.undefinedToNull=c}(H=b.Conversion||(b.Conversion={}));var I=function(){function a(){}return a.isLocalDateEqual=function(a,b){return a&&b?a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate():void 0},a.compareLocalTime=function(a,b){if(a&&b){var c=1e3*(60*(60*a.getHours()+a.getMinutes())+a.getSeconds())+a.getMilliseconds(),d=1e3*(60*(60*b.getHours()+b.getMinutes())+b.getSeconds())+b.getMilliseconds();return c-d}return void 0},a.getTimeStamp=function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Math.floor(Date.now())},a}();b.DateTime=I;var J;!function(b){function c(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return a.map(function(a){return a&&a.trim()}).filter(function(a){return!!a}).join(" ")}function d(a){return f(a||window.location.search.substring(1))}function e(a){return f(a||window.location.hash.substring(1))}function f(a){var b={};return a&&a.trim().split("&").forEach(function(a){var c=a.split("="),d=c[0].trim();if(d){var e=decodeURIComponent(c[1]||"").trim();b[d]?Array.isArray(b[d])?b[d].push(e):b[d]=[b[d],e]:b[d]=e}}),b}function g(a){var b=document.createElement("a");return b.href=a,b.href}function h(a){var b=document.createElement("a");return b.href=a,b.hostname}function i(a,b,c){var d=a.indexOf("#"),e=-1===d?"":a.substr(d);a=-1===d?a:a.substr(0,d);var f=new RegExp("([?&])"+b+"=.*?(&|$)","i"),g=-1!==a.indexOf("?")?"&":"?";return a=a.match(f)?a.replace(f,"$1"+b+"="+c+"$2"):a+g+b+"="+c,a+e}function j(a,b,c,d,e){d=d||0,c=c||0;var f=b.height(),g=a.outerHeight();if(a.offset()&&b.offset()){var h=a.offset().top-b.offset().top;if(0>h)return void b.scrollTop(b.scrollTop()+h-(g+c>f?0:c));var i=Math.min(g,f),j=h+i-f;f>g+c+d?(i=g+d,j=h+i-f):f>g+c&&(i=g+c,j=h-c),j>0&&(e?b.animate({scrollTop:b.scrollTop()+j},"fast"):b.scrollTop(b.scrollTop()+j))}}function k(a,b){void 0===b&&(b=!0);var c=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;");return b&&(c=c.replace(/'/g,"&apos;")),c}function l(a,b){var d=_.extend({},a);for(var e in b)switch(e){case"className":case"aria-labelledby":case"aria-describedby":d[e]=c(d[e],b[e]);break;case"children":case"defaultValue":case"value":null!=b[e]&&(null!=d[e]?d[e]=[].concat(d[e],b[e]):d[e]=b[e]);break;case"style":null!=d[e]?_.extend(d[e],b[e]):d[e]=b[e];break;case"onCopy":case"onCut":case"onPaste":case"onCompositionEnd":case"onCompositionStart":case"onCompositionUpdate":case"onFocus":case"onBlur":case"onChange":case"onInput":case"onSubmit":case"onLoad":case"onError":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onAbort":case"onCanPlay":case"onCanPlayThrough":case"onDurationChange":case"onEmptied":case"onEncrypted":case"onEnded":case"onLoadedData":case"onLoadedMetadata":case"onLoadStart":case"onPause":case"onPlay":case"onPlaying":case"onProgress":case"onRateChange":case"onSeeked":case"onSeeking":case"onStalled":case"onSuspend":case"onTimeUpdate":case"onVolumeChange":
case"onWaiting":case"onClick":case"onContextMenu":case"onDoubleClick":case"onDrag":case"onDragEnd":case"onDragEnter":case"onDragExit":case"onDragLeave":case"onDragOver":case"onDragStart":case"onDrop":case"onMouseDown":case"onMouseEnter":case"onMouseLeave":case"onMouseMove":case"onMouseOut":case"onMouseOver":case"onMouseUp":case"onSelect":case"onTouchCancel":case"onTouchEnd":case"onTouchMove":case"onTouchStart":case"onScroll":case"onWheel":d[e]=m(d[e],b[e]);break;default:void 0!==b[e]&&(d[e]=b[e])}return d}function m(a,b){return function(c){a&&a(c),b&&b(c)}}function n(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(c){(0===b.length||b.indexOf(c.keyCode)>=0)&&a(c)}}function o(a){var b=a.nativeEvent.explicitOriginalTarget;return a.relatedTarget||b||document.activeElement}function p(){return window.innerWidth}function q(b,c,d,e){if(a.EnvironmentSettings.IsTeamsIntegration){var f=$("<a></a>");return f.attr("href",b),c||(c="_blank"),f.attr("target",c),f[0].click(),f.remove(),null}return c||d||e?d||e?e?window.open(b,c,d,e):window.open(b,c,d):window.open(b,c):window.open(b)}function r(a){var b="hiddeon-open-iframe",c=document.getElementById(b);c&&c.parentNode.removeChild(c),c=document.createElement("iframe"),c.id=b,c.name=b,c.hidden=!0,document.body.appendChild(c),c.contentWindow.location.href=a}function s(a){var b=t(a);return u(b)}function t(a){var b=["b"],c=_.map(b,function(a){return"<"+a+">"}),d=_.map(b,function(a){return"</"+a+">"}),e=_.map(b,function(a){return"&lt;"+a+"&gt;"}),f=_.map(b,function(a){return"&lt;/"+a+"&gt;"}),g=_.escape(a);return b.forEach(function(a,b){g=g.replaceAll(e[b],c[b]).replaceAll(f[b],d[b])}),g}function u(a){var b=document.createElement("span");return b.innerHTML=a,a=b.innerHTML}b.combineAttributes=c,b.getQueries=d,b.getHashes=e,b.getAbsoluteUrl=g,b.getHostName=h,b.updateUrlParam=i,b.scrollToShowSubelement=j,b.encodeHTML=k,b.mergeReactProps=l,b.wrapReactEvent=m,b.onKeyboardEvent=n,b.getTargetElementOfFocusEvent=o,b.getWindowWidth=p,b.safeOpen=q,b.hiddenOpen=r,b.sanitize=s}(J=b.Html||(b.Html={}));var K;!function(a){function b(a){return k.test(a)&&l.test(a)}function c(){return e()}function d(a){var b=/[0-9a-fA-F]*/g,c=a.match(b),d="";return _.map(c,function(a){return d+=a}),!a||/^[0-]*$/.test(a)}function e(){var a=f();return h(a)}function f(){var a=[g()+g(),g(),g(),g(),g()+g()+g()];return a.join("-")}function g(){var a=Math.floor(65536*Math.random()).toString(16);return j(a,4,"0")}function h(a){var b=parseInt(a.charAt(19),16);b=3&b|8;var c=b.toString(16);return a=i(a,14,"4"),a=i(a,19,c)}function i(a,b,c){return a.substring(0,b)+c+a.substring(b+1)}function j(a,b,c){for(var d=a.length,e=c.length;b>d;d+=e)a=c+a;return a}var k=/^[0-9a-fA-F\-]*$/,l=/^[^\-]{8}(\-[^\-]{4}){4}[^\-]{8}$/;a.isValidGuid=b,a.newGuid=c,a.isNullOrEmpty=d}(K=b.Guid||(b.Guid={}));var L;!function(a){function b(a){var b=(a||"").trim().replace(/[,]/g,"");return $.isNumeric(b)}function c(a){var b=(a||"").trim().replace(/[,]/g,"");return $.isNumeric(b)?parseFloat(b).toString():""}function d(a){return Math.floor(a)===a}a.isFormatedAsFloat=b,a.formatAsFloat=c,a.isInteger=d}(L=b.NumberValidation||(b.NumberValidation={}));var M;!function(a){function b(a){return/^(https ?\:\/\/)?((www\.)?youtube\.com|youtu\.?be)\/.+$/.test(a)}a.isYouTubeUrl=b}(M=b.UrlValidation||(b.UrlValidation={}));var N;!function(a){var b=function(){function a(a,b){void 0===b&&(b=0),this.functionToCall=a,this.timeToWaitInMs=b}return a.prototype.callOnceLater=function(){var a=this;0!==this.timeToWaitInMs&&null!=this.handler&&this.clear(),null==this.handler&&(this.handler=setTimeout(function(){a.callImmediately()},this.timeToWaitInMs))},a.prototype.flush=function(){null!=this.handler&&(this.clear(),this.functionToCall())},a.prototype.callImmediately=function(){null!=this.handler&&this.clear(),this.functionToCall()},a.prototype.clear=function(){clearTimeout(this.handler),this.handler=void 0},a}();a.CallLater=b;var c=function(){function a(){this.callbacks=[]}return a.prototype.register=function(a){this.callbacks.push(a)},a.prototype.unregister=function(a){this.callbacks=_.without(this.callbacks,a)},a.prototype.trigger=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.callbacks.forEach(function(b){return b.apply(void 0,a)})},a.prototype.clear=function(){this.callbacks=[]},a}();a.CallbackManager=c;var d=function(){function a(){this.buffer=[]}return a.prototype.setFunctionToCall=function(a){var b=this;if(this.functionToCall!==a)if(this.functionToCall=a,a){var c=this.buffer;delete this.buffer,c&&c.length&&c.forEach(function(a){return b.functionToCall.apply(void 0,a)})}else this.buffer=this.buffer||[]},Object.defineProperty(a.prototype,"queue",{get:function(){return this.functionToCall?this.functionToCall:this.defaultQueue},enumerable:!0,configurable:!0}),a.prototype.defaultQueue=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.buffer.push(a)},a}();a.BufferForCall=d;var e=function(){function a(a){this.queue=[],this.jobCountLeft=a}return a.prototype.queueJob=function(a){a&&(this.queue.push(a),this.tryProcessQueuedJob())},a.prototype.stopProcessingNewJob=function(){this.jobCountLeft=-(1/0)},a.prototype.tryProcessQueuedJob=function(){for(var a=this;this.jobCountLeft>0&&this.queue.length;){--this.jobCountLeft;var b=this.queue.shift();b().always(function(){++a.jobCountLeft,a.tryProcessQueuedJob()})}},a}();a.Pool=e}(N=b.Process||(b.Process={}));var O;!function(a){function b(a){var b=$.Deferred();return b.reject(a).promise()}function c(a){var b=$.Deferred();return b.resolve(a).promise()}function d(a){return a?a.then(null,function(){return c()}):c()}a.getRejectedPromise=b,a.getResolvedPromise=c,a.always=d;var e=function(){function a(){}return Object.defineProperty(a,"Pending",{get:function(){return"pending"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Resolved",{get:function(){return"resolved"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Rejected",{get:function(){return"rejected"},enumerable:!0,configurable:!0}),a}();a.State=e}(O=b.Promise||(b.Promise={}));var P;!function(c){function d(){return _.pick(J.getQueries(),["d"])}function e(){return r("debug")}function f(){return r("d")}function g(){return f()&&!a.EnvironmentConfig.isProduction()}function h(){return r("msa")}function i(){return(r("oembedssotrial")&&a.EnvironmentConfig.isProduction()||r("oembedsso"))&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.OEmbedSSO)}function j(){return f()&&!a.EnvironmentConfig.isProduction()}function k(){return r("standalone")&&!a.EnvironmentConfig.isProduction()}function l(){return!1}function m(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormTemplateIntelligence)||a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormQuestionIntelligence)}function n(){if(r("pptcontentsso")){var c=b.Html.getQueries().hostplatform;if("PC"===c&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTWin32ContentAddinSSO))return!0;if("OfficeOnline"===c&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTContentAddinSSO))return!0}return!1}function o(){return r("pptintegration")}function p(){return r("runtimeautorefresh")}function q(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormsPro)}function r(a,b){void 0===b&&(b=!1);var c=J.getQueries()[a];return""===c?!0:c?(Array.isArray(c)&&(c=c[0]),b?"false"!==c.toLowerCase():"true"===c.toLowerCase()):b}c.getFlightQuery=d,c.isDebugMode=e,c.isDarkFunctionalitiesEnabled=f,c.isIvyChartEnabled=g,c.isMsaLoginEnabled=h,c.isOembedTrialSSOEnabled=i,c.isDebugOpenExcelInOneDrive=j,c.isStandalone=k,c.isProgressBarEnabled=l,c.isFormIntelligenceEnabled=m,c.isPPTContentAddinSSOEnabled=n,c.isPPTIntegration=o,c.isRuntimePageAutoRefreshEnabled=p,c.isFormsProEnabled=q}(P=b.Flight||(b.Flight={}));var Q;!function(a){function b(a){return"number"==typeof a}function c(a){return"string"==typeof a}a.isNumber=b,a.isString=c}(Q=b.Type||(b.Type={}));var R;!function(a){function c(){if(OfficeFormServerInfo.isOembedSPO&&$(".office-form.office-form-theme-shadow").height()&&$(".office-form-footer-container").height()){var b=$(".office-form.office-form-theme-shadow").height()+$(".office-form-footer-container").height()+j;b+=$(".office-form-new-bottom-bar").height()?$(".office-form-new-bottom-bar").height():0;var c="ResponsePage";a.nofityPageHeightToParentWindow(c,b)}}function d(){if(OfficeFormServerInfo.isOembedSPO&&$(".analysis-page-content").height()){var b=$(".analysis-page-content").height()+i,c="AnalysisPage";a.nofityPageHeightToParentWindow(c,b)}}function e(b){OfficeFormServerInfo.isOembedSPO&&a.nofityPageHeightToParentWindow("ResponsePage",b)}function f(a,c){var d=b.Html.getQueries().hostId;if(d)parent.postMessage("FormsPageHeight:"+d+":"+c.toString(),"*");else{var e=b.Html.getQueries().id;parent.postMessage(a+"Height:"+e+":"+c.toString(),"*")}}function g(a){if(OfficeFormServerInfo.isOembedSPO){var c=a.Model.Title?a.Model.Title:"",d=a.Model.Description?a.Model.Description:"",e=b.Html.getQueries().hostId;parent.postMessage("FormsInfo:"+e+":"+encodeURIComponent(c)+":"+encodeURIComponent(d),"*")}}function h(a){if(OfficeFormServerInfo.isOembedSPO){var c=a&&(a.innerCode||a.message||""),d=b.Html.getQueries().hostId;parent.postMessage("FormsError:"+d+":"+encodeURIComponent(c),"*")}}var i=50,j=80;a.notifyResponsePageHeightToParentWindow=c,a.notifyAnalysisPageHeightToParentWindow=d,a.notifyResponsePageFixedHeightToParentWindow=e,a.nofityPageHeightToParentWindow=f,a.notifyFormInfoToParentWindow=g,a.notifyFormErrorToParentWindow=h}(R=b.OEmbed||(b.OEmbed={})),b.assert=c,b.getNonEmbedQuery=d,b.isOEmbed=e,b.isOEmbedSPO=f,b.isOEmbedSPOPreview=g,b.enterSSO=h,b.applyTeamSSO=i,b.applyAssignmentsSSO=j,b.isWin10=k,b.isIE=l,b.isEdge=m,b.isFireFox=n,b.isMobile=o,b.isSmallScreen=p,b.isIOS=q,b.isSafari9=r,b.isAndroid=s,b.isTbsBrowser=t,b.isMicroMessenger=u,b.isHighContrastMode=v,b.deepClone=w,b.tryParseJson=x,b.getAllEnumValues=y,b.getAllEnumValueNames=z,b.some=A,b.setCookie=B,b.getCookie=C,b.clearCookie=D,b.hashCode=E,b.isRtl=F;var S;!function(a){a.mathSeparator="⁣"}(S=b.MathHelper||(b.MathHelper={}));var T;!function(a){a.waitingForExport="WaitingForExport"}(T=b.ExcelHelper||(b.ExcelHelper={})),b.regExpEscape=G}(b=a.Utilities||(a.Utilities={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.UnhandleException=0]="UnhandleException",a[a.UnexpectedLiveId=1]="UnexpectedLiveId",a[a.UnexpectedDetailQuestionIndex=2]="UnexpectedDetailQuestionIndex",a[a.UninitializeAverageResult=3]="UninitializeAverageResult",a[a.LoginIECrossZone=4]="LoginIECrossZone",a[a.AADAcquireTokenFailure=5]="AADAcquireTokenFailure",a[a.AADAcquireTokenMfaCheckFailure=6]="AADAcquireTokenMfaCheckFailure",a[a.NotificationFailure=7]="NotificationFailure",a[a.ShellServiceGetDataFailure=8]="ShellServiceGetDataFailure",a[a.DataSyncAppInitializationFailure=9]="DataSyncAppInitializationFailure",a[a.DataSyncFailure=10]="DataSyncFailure",a[a.DeleteImageNotFoundError=11]="DeleteImageNotFoundError",a[a.ModelError=12]="ModelError",a[a.QuestionNullTypeError=13]="QuestionNullTypeError",a[a.OneNoteAddinQueryFailure=14]="OneNoteAddinQueryFailure",a[a.OneNoteAddinPageCreateFailure=15]="OneNoteAddinPageCreateFailure",a[a.OneNoteAddinGetTokenFromUWPHostFailure=16]="OneNoteAddinGetTokenFromUWPHostFailure",a[a.OneNoteAddinPageInsertFailure=17]="OneNoteAddinPageInsertFailure",a[a.UnexpectedDateTimeFormat=18]="UnexpectedDateTimeFormat",a[a.ShortTextGradingBasisJsonParseFailure=19]="ShortTextGradingBasisJsonParseFailure",a[a.UserInfoGetFailure=20]="UserInfoGetFailure",a[a.TenentSettingsGetFailure=21]="TenentSettingsGetFailure",a[a.InvalidCdbImagePayload=22]="InvalidCdbImagePayload",a[a.ResposnesAggregateFailure=23]="ResposnesAggregateFailure",a[a.MissingUserName=24]="MissingUserName",a[a.RefreshUserInfoFailed=25]="RefreshUserInfoFailed",a[a.GroupInfoGetFailed=26]="GroupInfoGetFailed",a[a.TeamsTabLoginFailure=27]="TeamsTabLoginFailure",a[a.TeamsTabSsoLoginFailure=28]="TeamsTabSsoLoginFailure",a[a.InvalidServerAggregatePayload=29]="InvalidServerAggregatePayload",a[a.UpdatingQuestionId=30]="UpdatingQuestionId",a[a.DataSourceUpdatingQuestionId=31]="DataSourceUpdatingQuestionId",a[a.DataSourceUpdatingQuestionNullAllowMultipleValues=32]="DataSourceUpdatingQuestionNullAllowMultipleValues",a[a.DataSourceUpdatingChoiceNull=33]="DataSourceUpdatingChoiceNull",a[a.ChangedIdFromServerSide=34]="ChangedIdFromServerSide",a[a.PowerPointTaskpanePageInsertFailure=35]="PowerPointTaskpanePageInsertFailure",a[a.PowerPointTaskpaneAddinQueryFailure=36]="PowerPointTaskpaneAddinQueryFailure",a[a.PowerPointTaskpaneAddinPageCreateFailure=37]="PowerPointTaskpaneAddinPageCreateFailure",a[a.PowerPointTaskpaneAddinGetTokenFailure=38]="PowerPointTaskpaneAddinGetTokenFailure",a[a.PowerPointContentAddinPageRenderFailure=39]="PowerPointContentAddinPageRenderFailure",a[a.PowerPointContentAddinPageGetPPTViewFailure=40]="PowerPointContentAddinPageGetPPTViewFailure",a[a.PowerPointContentAddinPageSaveFileSettingsFailure=41]="PowerPointContentAddinPageSaveFileSettingsFailure",a[a.PowerPointContentAddinPageGetSettingFailure=42]="PowerPointContentAddinPageGetSettingFailure",a[a.PowerPointContentAddinGetTokenFailure=43]="PowerPointContentAddinGetTokenFailure",a[a.AssignmentsFrameSsoLoginFailure=44]="AssignmentsFrameSsoLoginFailure",a[a.EmailHrdUnexpectedNextScreen=45]="EmailHrdUnexpectedNextScreen",a[a.InvalidPrivacyStatement=46]="InvalidPrivacyStatement"}(c=b.ErrorType||(b.ErrorType={}));var d=function(){function b(){}return b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},b.logData=function(a){this.buffer.queue(a)},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.ErrorEvent=d}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.Success=0]="Success",a[a.Failure=1]="Failure",a[a.ExpectedFailure=2]="ExpectedFailure",a[a.Info=3]="Info",a[a.Warning=4]="Warning",a[a.Error=5]="Error"}(c=b.ResultType||(b.ResultType={}));var d;!function(a){a[a.Start=0]="Start",a[a.End=1]="End",a[a.Log=2]="Log"}(d=b.QosEventType||(b.QosEventType={}));var e=function(){function b(b){this.event={Name:b,Duration:0,CorrelationId:a.Utilities.Guid.newGuid(),Data:{}}}return b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},Object.defineProperty(b.prototype,"Name",{get:function(){return this.event.Name},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Duration",{get:function(){return this.event.Duration},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"CorrelationId",{get:function(){return this.event.CorrelationId},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Data",{get:function(){return this.event.Data},enumerable:!0,configurable:!0}),b.prototype.start=function(){this.startTime=a.Utilities.DateTime.getTimeStamp(),b.buffer.queue(this.event,d.Start)},b.prototype.end=function(a){var c=this.prepareEvent(a);b.buffer.queue(c,d.End)},b.prototype.log=function(a){var c=this.prepareEvent(a);b.buffer.queue(c,d.Log)},b.prototype.prepareEvent=function(b){var c=_.clone(this.event);return _.extend(c.Data,b),null!=this.startTime?c.Duration=a.Utilities.DateTime.getTimeStamp()-this.startTime:c.Duration=-1,c},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.QosEvent=e}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){}return a.AcquireToken="Auth.AcquireToken",a.DetectUserLoggedInAAD="Auth.DetectUserLoggedInAAD",a.GetToken="Auth.GetToken",a.RefreshToken="Auth.RefreshToken",a.DetectUserLoggedInMSA="Auth.DetectUserLoggedInMSA",a.SignOutInIframe="Auth.SignOutInIframe",a}();a.Auth=b}(b=a.Auth||(a.Auth={}));var c;!function(a){var b=function(){function a(){}return a.DataSync="AddinPage.SyncView.DataSync",a}();a.SyncView=b}(c=a.AddinPage||(a.AddinPage={}));var d;!function(a){var b=function(){function a(){}return a.InsertPoll="OutlookCreatePollPage.TaskPaneView.InsertPoll",a}();a.TaskPaneView=b}(d=a.OutlookCreatePollPage||(a.OutlookCreatePollPage={}));var e;!function(a){var b=function(){function a(){}return a.CreateExportFile="Action.CreateExportFile",a.CreateRespTable="Action.CreateRespTable",a.GetRespTable="Action.GetRespTable",a.OpenExcelInOneDrive="Action.OpenExcelInOneDrive",a.GetXlWorkbookId="Action.GetXlWorkbookId",a}();a.Action=b;var c=function(){function a(){}return a.ConnectToForms="Connection.ConnectToFormsSignalR",a.ConnectToCDB="Connection.ConnectToCDBSignalR",a.InvokeMethod="Connection.InvokeRemoteMethod",a}();a.Connection=c;var d=function(){function a(){}return a.BrowseImage="Decomposition.BrowseImage",a.SearchImage="Decomposition.SearchImage",a.GetCdbToken="Decomposition.GetCdbToken",a.GetOD4BToken="Decomposition.GetOD4BToken",a}();a.Decomposition=d;var e=function(){function a(){}return a.DuplicateFormForExcel="Excel.DuplicateFormForExcel",a}();a.Excel=e;var f=function(){function a(){}return a.GetGroups="Groups.Get",a.GetPhotoDefinition="Group.GetPhotoDefinition",a.GetPhotoValue="Group.GetPhotoValue",a.GetGroup="Group.Get",a.GetOwners="Group.GetOwners",a.GetMembers="Group.GetMembers",a.GetMemberPhotoDefinition="Group.GetMemberPhotoDefinition",a.GetMemberPhotoValue="Group.GetMemberPhotoValue",a}();a.Group=f;var g=function(){function a(){}return a.TurnOnFormSharing="FormDefinition.TurnOnFormSharing",a.TurnOffFormSharing="FormDefinition.TurnOffFormSharing",a.CreateForm="Form.Create",a.CreateImageFromUrl="FormImage.CreateFromUrl",a.DeleteForm="Form.Delete",a.GetForms="Forms.Get",a.SearchServerForms="Forms.SearchServer",a.SoftDeleted="Form.Updata.SoftDeleted",a.GetSharedWithMeForms="Forms.Get.SharedWithMe",a.GetDesignForm="DesignForm.Get",a.GetFormDefinition="FormDefinition.Get",a.GetRuntimeForm="ResponseForm.Get",a.GetAnalysisForm="AnalysisForm.Get",a.GetSharedForm="SharedForm.Get",a.SetFormDefinition="FormDefinition.Set",a.UpdateForm="Form.Update",a.CreateFormPermissionLink="FormDefinition.CreateFormPermissionLink",a.DeleteFormPermissionLink="FormDefinition.DeleteFormPermissionLink",a.GetFormPermissions="FormDefinition.GetFormPermissions",a.CreateFormPermissionToken="FormDefinition.CreateFormPermissionToken",a.DeleteFormPermissionToken="FormDefinition.DeleteFormPermissionToken",a.GetFormPermissionsToken="FormDefinition.GetFormPermissionsToken",a.CreateThemeImageFromUrl="ThemeImage.CreateFromUrl",a.GetIdentityProviderType="Form.GetIdentityProviderType",a.GetGroupId="Form.GetGroupId",a.GetTeamsInfo="Form.GetTeamsInfo",a.GetOrCreatePermissionToken="Form.GetOrCreatePermissionToken",a.GetInsights="Form.GetInsights",a.CreateOD4BSessionTempFolder="Form.CreateOD4BSessionTempFolder",a}();a.Form=g;var h=function(){function a(){}return a.GetFormId="Function.GetFormId",a.GetUserInfo="Function.GetUserInfo",a.GetShellServiceInfo="Function.GetShellServiceInfo",a.GetConsumerShellServiceInfo="Function.GetConsumerShellServiceInfo",a.GetYouTubeVideoInfo="Function.GetYouTubeVideoInfo",a.DownloadExcelFileApi="Function.DownloadExcelFileApi",a.GetFormsTenantSettings="Function.GetFormsTenantSettings",a.GetRecentForms="Function.GetRecentForms",a.RemoveRecentForm="Function.RemoveRecentForm",a.MoveForm="Function.MoveForm",a.GetFormCreatorPhotoDefinition="Function.GetFormCreatorPhotoDefinition",a.GetFormCreatorPhotoValue="Function.GetFormCreatorPhotoValue",a}();a.Function=h;var i=function(){function a(){}return a.DeleteImage="Image.Delete",a.UploadImage="Image.Upload",a}();a.Image=i;var j=function(){function a(){}return a.SendMail="MSGraph.SendMail",a}();a.MSGraph=j;var k=function(){function a(){}return a.CreateFormFromQti="Qti.CreateForm",a}();a.Qti=k;var l=function(){function a(){}return a.CreateImageFromUrl="QuestionImage.CreateFromUrl",a.CreateQuestion="Question.Create",a.DeleteQuestion="Question.Delete",a.GetQuestion="Question.Get",a.GetQuestionCount="QuestionCount.Get",a.GetQuestions="Questions.Get",a.UpdateQuestion="Question.Update",a.TextAnalysis="Question.TextAnalysis",a.MathCalculation="Question.MathCalculation",a.MathQuestionGeneration="Question.MathQuestionGeneration",a}();a.Question=l;var m=function(){function a(){}return a.CreateChoice="Choice.Create",a.GetChoice="Choice.Get",a.UpdateChoice="Choice.Update",a.DeleteChoice="Choice.Delete",a}();a.Choice=m;var n=function(){function a(){}return a.DeleteResp="Response.Delete",a.DeleteResps="Responses.Delete",a.GetRespCount="ResponseCount.Get",a.GetResps="Responses.Get",a.GetRuntimeResps="RuntimeResponses.Get",a.GetAnalysisTimeResponses="AnalysisTimeResponses.Get",a.GetRespFilter="Responses.Get.Filter",a.SubmitAnswer="Answer.Submit",a.SubmitResp="Response.Submit",a.AddComment="Comment.Add",a.SetReleaseDate="Response.Update",a}();a.Response=n;var o=function(){function a(){}return a.ReportAbuse="OnlineSafety.ReportAbuse",a}();a.OnlineSafety=o;var p=function(){function a(){}return a.AggregateSurveyData="Analysis.AggregateSurveyData",a.ResultSharingAggregateSurveyData="Analysis.ResultSharingAggregateSurveyData",a.AggregateQuizData="Analysis.AggregateQuizData",a.ResultSharingAggregateQuizData="Analysis.ResultSharingAggregateQuizData",a}();a.Analysis=p;var q=function(){function a(){}return a.MethodNameFormat="PageMethod.{0}",a}();a.PageMethod=q}(e=a.ServiceEndpoints||(a.ServiceEndpoints={}))}(b=a.QosEventNames||(a.QosEventNames={}))}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return Object.defineProperty(b,"EVENTNAME_SESSION_START",{get:function(){return"session_start"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IntelligenceStatistic",{get:function(){return"IntelligenceStatistic"},enumerable:!0,configurable:!0}),b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},b.logData=function(b,c){(null==c||a.Flighting.Flight.isEnabled(c))&&this.buffer.queue(b)},b.logSessionStartEvent=function(){b.logData({name:b.EVENTNAME_SESSION_START,extraData:{DbId:"",DeviceId:""}})},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.EngagementEvent=c}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){a.FilteredOutForms="PortalPage.FilteredOutForms";var b=function(){function a(){}return a.MyFormsButton="DesignPage.Form.MyFormsButton",a.CancelDelete="PortalPage.MyForms.CancelDeleteForm",a.ConfirmDelete="PortalPage.MyForms.ConfirmDeleteForm",a.Delete="PortalPage.MyForms.Delete",a.Duplicate="PortalPage.MyForms.Duplicate",a.CancelMoveToRecycleBin="PortalPage.MyForms.CancelMoveToRecycleBin",a.ConfirmMoveToRecycleBin="PortalPage.MyForms.ConfirmMoveToRecycleBin",a.MoveToRecycleBin="PortalPage.MyForms.MoveToRecycleBin",a.Load="PortalPage.MyForms.Load",a.Navigate="PortalPage.MyForms.Navigate",a.New="PortalPage.MyForms.New",a.OpenStoreButton="PortalPage.MyForms.OpenStoreButton",a.NewFormCopyAllDone="PortalPage.MyForms.NewFromCopy",a.NewFromCopyFailure="PortalPage.MyForms.NewFromCopy.Failure",a.AutoLoginSuccess="PortalPage.MyForms.AutoLoginSuccess",a.ReadyToCopyForm="PortalPage.MyForms.ReadyToCopyForm",a.NewFromCopyQuestionDone="PortalPage.MyForms.NewFromCopyQuestionDone",a.TryTemplate="PortalPage.MyForms.TryTemplate",a.CollapseTemplate="PortalPage.MyForms.CollapseTemplate",a.ExpandTemplate="PortalPage.MyForms.ExpandTemplate",a.NewForm="PortalPage.MyForms.NewForm",a.NewQuiz="PortalPage.MyForms.NewQuiz",a.FormCount="PortalPage.MyForms.FormCount",a.NewQuizFromLor="PortalPage.MyForms.NewQuizFromLor",a.Click="PortalPage.MyForms.Click",a.ExpandNewMenu="PortalPage.MyForms.ExpandNewMenu",a.ExceedFormQuota="PortalPage.MyForms.ExceedFormQuota",a}();a.MyForms=b;var c=function(){function a(){}return a.OtherFormsButton="DesignPage.Form.OtherFormsButton",a.Unpin="PortalPage.OtherForms.Unpin",a.Duplicate="PortalPage.OtherForms.Duplicate",a.FormCount="PortalPage.OtherForms.FormCount",a.Click="PortalPage.OtherForms.Click",a}();a.OtherForms=c;var d=function(){function a(){}return a.Click="PortalPage.SearchForms.Click",a.UseFormSearch="PortalPage.SearchForms.UseFormSearch",a}();a.SearchForms=d;var e=function(){function a(){}return a.Navigate="PortalPage.FormIntroductionDialog.Navigate",a.CreatNewForm="PortalPage.FormIntroductionDialog.CreatNewForm",a.Close="PortalPage.FormIntroductionDialog.Close",a}();a.FormIntroductionDialog=e;var f=function(){function a(){}return a.GroupFormsButton="DesignPage.Form.GroupFormsButton",a}();a.GroupFormsPortal=f}(c=b.PortalPage||(b.PortalPage={}));var d;!function(a){var b=function(){function a(){}return a.StartGetResponses="AnalysisPage.Responses.StartGetResponses",a.Navigate="AnalysisPage.Analysis.Navigate",a}();a.Analysis=b}(d=b.AnalysisPage||(b.AnalysisPage={}));var e;!function(a){var b=function(){function a(){}return a.AddImage_Logo="DesignPage.Form.Logo.AddImage",a.SharedFormByOwner="DesignPage.Form.SharedFormByOwner",a.SharedOwnershipByOwner="DesignPage.Form.SharedOwnershipByOwner",a.Navigate="DesignPage.Form.Navigate",a.SuggestFormAdd="DesignPage.Form.SuggestFormAdd",a.SuggestFormTrigger="DesignPage.Form.SuggestFormTrigger",a}();a.Form=b;var c=function(){function a(){}return a.AddOption="DesignPage.Questions.AddOption",a.AddOtherOption="DesignPage.Questions.AddOtherOption",a.AnswerRequired="DesignPage.Questions.AnswerRequired",a.Create="DesignPage.Questions.Create",a.Delete="DesignPage.Questions.Delete",a.Duplicate="DesignPage.Questions.Duplicate",a.LongAnswer="DesignPage.Questions.LongAnswer",a.MoveDown="DesignPage.Questions.MoveDown",a.MoveUp="DesignPage.Questions.MoveUp",a.MultipleAnswers="DesignPage.Questions.MultipleAnswers",a.Navigate="DesignPage.Questions.Navigate",a.AddRankingOption="DesignPage.Questions.AddRankingOption",a.DeleteRankingOption="DesignPage.Questions.DeleteRankingOption",a.SortableInitialization="DesignPage.Questions.SortableInitialization",a.AddImage="DesignPage.Questions.AddImage",a.ToggleCorrectChoice="DesignPage.Questions.ToggleCorrectChoice",a.ShortTextAnswerAdded="DesignPage.Questions.ShortTextAnswerAdded",a.ShortTextAnswerDeleted="DesignPage.Questions.ShortTextAnswerDeleted",a.FirstShortTextAnswerAdded="DesignPage.Questions.FirstShortTextAnswerAdded",a.LastRemainingShortTextAnswerDeleted="DesignPage.Questions.LastRemainingShortTextAnswerDeleted",a.AddLikertSubquestion="DesignPage.Questions.AddLikertSubquestion",a.DeleteLikertSubquestion="DesignPage.Questions.DeleteLikertSubquestion",a.AddLikertOption="DesignPage.Questions.AddLikertOption",a.DeleteLikertOption="DesignPage.Questions.DeleteLikertOption",a}();a.Questions=c;var d=function(){function a(){}return a.MathOption="DesignPage.QuestionMenu.MathOption",a.Navigate="DesignPage.QuestionMenu.Navigate",a.Quiz="DesignPage.QuestionMenu.Quiz",a.RatingLabel="DesignPage.QuestionMenu.RatingLabel",a.ShuffleOptions="DesignPage.QuestionMenu.ShuffleOptions",a.Subtitle="DesignPage.QuestionMenu.Subtitle",a.Validation="DesignPage.QuestionMenu.Validation",a.DropDown="DesignPage.QuestionMenu.DropDown",a}();a.QuestionMenu=d;var e=function(){function a(){}return a.AnswerHint="DesignPage.Quiz.AnswerHint",a.Point="DesignPage.Quiz.Point",a.SwitchTextToMathOption="DesignPage.Quiz.SwitchTextToMathOption",a.SwitchMathToTextOption="DesignPage.Quiz.SwitchMathToTextOption",a.SwitchTextToMathSubtitle="DesignPage.Quiz.SwitchTextToMathSubtitle",a.SwitchMathToTextSubtitle="DesignPage.Quiz.SwitchMathToTextSubtitle",a.EditMathFormula="DesignPage.Quiz.EditMathFormula",a}();a.Quiz=e;var f=function(){function a(){}return a.DeleteAllResponses="DesignPage.Responses.DeleteAllResponses",a.DeleteSingleResponse="DesignPage.Responses.DeleteSingleResponse",a.DetialDialogPaging="DesignPage.Responses.DetailDialogPaging",a.DetailDialogQuestionNavigate="DesignPage.Responses.DetailDialogQuestionNavigate",a.DownloadExcelFile="DesignPage.Responses.DownloadExcelFile",a.DownloadExcelFileDecreaseFileSize="DesignPage.Responses.DownloadExcelFileDecreaseFileSize",a.DownloadExcelFileFailed="DesignPage.Responses.DownloadExcelFileFailed",a.DownloadExcelFileStart="DesignPage.Responses.DownloadExcelFileStart",a.DownloadExcelFileSuccess="DesignPage.Responses.DownloadExcelFileSuccess",a.DownloadMultipleExcelFiles="DesignPage.Responses.DownloadMultipleExcelFiles",a.DownloadOnePagingExcelFile="DesignPage.Responses.DownloadOnePagingExcelFile",a.GradeResults="DesignPage.Responses.GradeResults",a.GradeQtiResults="DesignPage.Responses.GradeQtiResults",a.IndividualPaging="DesignPage.Responses.IndividualPageing",a.IndividualPrint="DesignPage.Responses.IndividualPrint",a.MeetLegacyChoiceAnswer="DesignPage.Responses.MeetLegacyChoiceAnswer",a.Navigate="DesignPage.Responses.Navigate",a.OpenExcelInOneDrive="DesignPage.Responses.OpenExcelInOneDrive",a.OpenInExcel="DesignPage.Responses.OpenInExcel",a.PostQtiGrade="DesignPage.Responses.PostQtiGrade",a.PrintAnalyzeView="DesignPage.Responses.PrintAnalyzeView",a.ReExportToExcel="DesignPage.Responses.ReExportToExcel",a.GetSummaryResult="DesignPage.Responses.GetSummaryResult",a.ReleaseResults="DesignPage.Responses.ReleaseResults",a.ShowResponsesDetail="DesignPage.Responses.ShowResponsesDetail",a.SwitchView="DesignPage.Responses.SwitchView",a.SwitchIvyChartType="DesignPage.Responses.SwitchIvyChartType",a.SwitchResponder="DesignPage.Responses.SwitchResponder",a.ViewResults="DesignPage.Responses.ViewResults",a.ExportToOneDriveWithBigData="DesignPage.Responses.ExportToOneDriveWithBigData",a.CopySummaryLink="DesignPage.Responses.CopySummaryLink",a.StartGetResponses="DesignPage.Responses.StartGetResponses",a.OpenFileFolder="DesignPage.Responses.OpenFileFolder",a.PopupReExportToExcelDialog="DesignPage.Responses.PopupReExportToExcelDialog",a.ShowInsightEntryPoint="DesignPage.Responses.ShowInsightEntryPoint",a.ClickInsightEntryPoint="DesignPage.Responses.ClickInsightEntryPoint",a.ClickInsightPreviousButton="DesignPage.Responses.ClickInsightPreviousButton",a.ClickInsightNextButton="DesignPage.Responses.ClickInsightNextButton",a.ReleaseInsightView="DesignPage.Responses.ReleaseInsightView",a}();a.Analysis=f;var g=function(){function a(){}return a.Navigate="DesignPage.PreView.Navigate",a}();a.Preview=g;var h=function(){function a(){}return a.Navigate="DesignPage.Theme.Navigate",a.SwitchTheme="DesignPage.Theme.SwitchTheme",a.AddImage="DesignPage.Theme.AddImage",a.DeleteImage="DesignPage.Theme.DeleteImage",a}();a.Theme=h;var i=function(){function a(){}return a.AddImage="DesignPage.ImagePicker.AddImage",a.AddVideo="DesignPage.MediaPicker.AddVideo",a.AddVideoFailure="DesignPage.MediaPicker.AddVideoFailure",a.Back="DesignPage.MediaPicker.Back",a.BingSearch="DesignPage.ImagePicker.UploadBingSearch",a.BingSearchLicense="DesignPage.ImagePicker.BingSearchLicense",a.ChooseImage="DesignPage.MediaPicker.ChooseImage",a.ChooseVideo="DesignPage.MediaPicker.ChooseVideo",a.Local="DesignPage.ImagePicker.UploadLocal",a.Navigate="DesignPage.ImagePicker.Navigate",a.OD4B="DesignPage.ImagePicker.UploadOD4B",a.Search="DesignPage.ImagePicker.Search",a.URL="DesignPage.ImagePicker.URL",a}();a.MediaPicker=i;var j=function(){function a(){}return a.ImageSize="DesignPage.ImageLayout.ImageSize",a}();a.ImageLayout=j;var k=function(){function a(){}return a.AltText="DesignPage.ImageEditPane.AltText",a.Delete="DesignPage.ImageEditPane.Delete",a.Edit="DesignPage.ImageEditPane.Edit",a.Style="DesignPage.ImageEditPane.Style",a.Zoom="DesignPage.ImageEditPane.Zoom",a.ZoomIn="DesignPage.ImageEditPane.ZoomIn",a.ZoomOut="DesignPage.ImageEditPane.ZoomOut",a}();a.ImageEditPane=k;var l=function(){function a(){}return a.Delete="DesignPage.VideoEditPane.Delete",a}();a.VideoEditPane=l;var m=function(){function a(){}return a.AcceptResponse="DesignPage.Setting.AcceptResponse",a.AllowAnonymous="DesignPage.Setting.AllowAnonymous",a.ApplyDeadline="DesignPage.Setting.ApplyDeadline",a.ApplyStartTime="DesignPage.Setting.ApplyStartTime",a.EditCloseMessage="DesignPage.Setting.EditCloseMessage",a.Navigate="DesignPage.Setting.Navigate",a.RecordIdentity="DesignPage.Setting.RecrodIdentity",a.RequireUniqueResponse="DesignPage.Setting.RequireUniqueResponse",
a.RespondInAppOnly="DesignPage.Setting.RespondInAppOnly",a.SetDeadline="DesignPage.Setting.SetDeadline",a.SetStartTime="DesignPage.Setting.SetStartTime",a.ShowGradedResults="DesignPage.Setting.ShowGradedResults",a.ShowGradedScores="DesignPage.Setting.ShowGradedScores",a.ShuffleOption="DesignPage.Setting.ShuffleOption",a.ShuffleQuestion="DesignPage.Setting.ShuffleQuestion",a.ShuffleAllQuestions="DesignPage.Setting.ShuffleAllQuestions",a.LockGivenQuestions="DesignPage.Setting.LockGivenQuestions",a.AutoReleaseGrade="DesignPage.Setting.AutoReleaseGrade",a.EmailNotification="DesignPage.Setting.EmailNotification",a.ThankYouMessage="DesignPage.Setting.ThankYouMessage",a}();a.Setting=m;var n=function(){function a(){}return a.Link="DesignPage.Send.Link",a.Email="DesignPage.Send.Email",a.Embed="DesignPage.Send.MoreOptions",a.Navigate="DesignPage.Send.Navigate",a.QRCode="DesignPage.Send.QRCode",a.Sharing="DesignPage.Send.Sharing",a.SocialShare="DesignPage.Send.Share",a.ActionFailed="DesignPage.Send.ActionFailed",a.ActionSuccess="DesignPage.Send.ActionSuccess",a.CopyEmbedCode="DesignPage.Send.CopyEmbedCode",a.CopyLink="DesignPage.Send.CopyLink",a.DownloadQRCode="DesignPage.Send.DownloadQRCode",a.SendEmails="DesignPage.Send.SendEmails",a.AllowCopyCheckBox="DesignPage.Send.AllowCopyCheckBox",a.ShareFormLink="DesignPage.Send.ShareFormLink",a.PhishingNotification="DesignPage.Send.PhishingNotification",a}();a.Send=n;var o=function(){function a(){}return a.CopyShareAsTemplateLink="DesignPage.Share.CopyShareAsTemplateLink",a.CreateShareAsTemplateLink="DesignPage.Share.CreateShareAsTemplateLink",a.DeleteShareAsTemplateLink="DesignPage.Share.DeleteShareAsTemplateLink",a.CopyCollaborationLink="DesignPage.Share.CopyCollaborationLink",a.CreateCollaborationLink="DesignPage.Share.CreateCollaborationLink",a.DeleteCollaborationLink="DesignPage.Share.DeleteCollaborationLink",a.SwitchCollaborationLink="DesignPage.Share.SwitchCollaborationLink",a.CopyAnalysisResultLink="DesignPage.Share.CopyAnalysisResultLink",a.CreateAnalysisResulttLink="DesignPage.Share.CreateAnalysisResulttLink",a.DeleteAnalysisResultLink="DesignPage.Share.DeleteAnalysisResultLink",a.ChooseAllowAnonymous="DesignPage.Share.ChooseAllowAnonymous",a}();a.Share=o;var p=function(){function a(){}return a.Navigate="DesignPage.Feedback.Navigate",a.Suggestion="DesignPage.Feedback.Suggestion",a.Insights="DesignPage.Feedback.Insights",a}();a.Feedback=p;var q=function(){function a(){}return a.Navigate="DesignPage.Help.Navigate",a}();a.Help=q;var r=function(){function a(){}return a.Navigate="DesignPage.Menu.Navigate",a.SignOut="DesignPage.Menu.SignOut",a.UserInfo="DesignPage.Menu.UserInfo",a.PrintForm="DesignPage.Menu.PrintForm",a}();a.Menu=r;var s=function(){function a(){}return a.BranchChanged="DesignPage.Branch.BranchChanged",a.BranchDesignViewNavigate="DesignPage.Branch.BranchDesignViewNavigate",a}();a.Branch=s;var t=function(){function a(){}return a.GetShellServiceInfo="DesignPage.AppLauncher.GetShellServiceInfo",a.GetConsumerShellServiceInfo="DesignPage.AppLauncher.GetConsumerShellServiceInfo",a.LoadShellData="DesignPage.AppLauncher.LoadShellData",a.Navigate="DesignPage.AppLauncher.Navigate",a.RenderShellData="DesignPage.AppLauncher.RenderShellData",a.LoadError="DesignPage.AppLauncher.LoadShellData",a}();a.AppLauncher=t;var u=function(){function a(){}return a.Clipboard="DesignPage.ShortCut.Clipboard",a.UndoRedo="DesignPage.ShortCut.UndoRedo",a}();a.ShortCut=u;var v=function(){function a(){}return a.Navigate="DesignPage.MathKeyboard.Navigate",a}();a.MathKeyboard=v;var w=function(){function a(){}return a.ConnectionStarted="DesignPage.Notification.ConnectionStarted",a}();a.Notification=w;var x=function(){function a(){}return a.Navigate="DesignPage.QRCodePlus.Navigate",a.Download="DesignPage.QRCodePlus.Download",a.CopyUrlSuccess="DesignPage.QRCodePlus.Success",a.CopyUrlFail="DesignPage.QRCodePlus.Fail",a}();a.QRCodePlus=x}(e=b.DesignPage||(b.DesignPage={}));var f=function(){function a(){}return a.Navigate="DesignPage.RecycleBin.Navigate",a.formDelete="RecycleBin.MyForm.Delete",a.formRestore="RecycleBin.MyForm.Restore",a.groupBarClick="RecycleBin.GroupFormsRecycle.GroupBar.Click",a.groupFormDelete="RecycleBin.GroupForm.Delete",a.groupFormRestore="RecycleBin.GroupForm.Restore",a}();b.RecycleBin=f;var g;!function(a){var b=function(){function a(){}return a.Navigate="ResponsePage.Form.Navigate",a.QRCode="ResponsePage.Form.QRCode",a.Submit="ResponsePage.Form.Submit",a.SubmitQtiResponse="ResponsePage.Form.SubmitQtiResponse",a.OpenInTakeATest="ResponsePage.Form.OpenInTakeATest",a.TextQuestionInfoOfSubmit="ResponsePage.Form.TextQuestionInfoOfSubmit",a}();a.Form=b;var c=function(){function a(){}return a.LearnMoreForTakeATest="ResponsePage.ThanksView.LearnMoreForTakeATest",a.Navigate="ResponsePage.ThanksView.Navigate",a.NavigateToPortal="ResponsePage.ThanksView.NavigateToPortal",a.SubmitAnother="ResponsePage.ThanksView.SubmitAnother",a}();a.ThanksView=c;var d=function(){function a(){}return a.Navigate="ResponsePage.PollResultView.Navigate",a.NavigateToPortal="ResponsePage.PollResultView.NavigateToPortal",a.SubmitAnother="ResponsePage.PollResultView.SubmitAnother",a}();a.PollResultView=d;var e=function(){function a(){}return a.IsEmbeddedSession="ResponsePage.EmbedView.IsEmbeddedSession",a.BlockEmbed="ResponsePage.EmbedView.BlockEmbed",a.Navigate="ResponsePage.EmbedView.Navigate",a.NeedAuth="ResponsePage.EmbedView.NeedAuth",a.OpenInBrowser="ResponsePage.EmbedView.OpenInBrowser",a}();a.EmbedView=e;var f=function(){function a(){}return a.Navigate="ResponsePage.StudentView.Navigate",a}();a.StudentView=f,a.ShowErrorPage="ResponsePage.ShowErrorPage";var g=function(){function a(){}return a.Failure="ResponsePage.LoadingScript.Failure",a.Start="ResponsePage.LoadingScript.Start",a.Success="ResponsePage.LoadingScript.Success",a}();a.LoadingScript=g}(g=b.ResponsePage||(b.ResponsePage={}));var h;!function(a){var b=function(){function a(){}return a.Navigate="ShareFormPage.Copy.Navigate",a.LoginToAutoCopy="ShareFormPage.Copy.LoginToAutoCopy",a.DuplicateButton="ShareFormPage.Copy.DuplicateButton",a}();a.Copy=b}(h=b.ShareFormPage||(b.ShareFormPage={}));var i;!function(a){var b=function(){function a(){}return a.GetStarted="DefaultPage.LandingView.GetStarted",a.GetStartedHeaderBar="DefaultPage.LandingView.GetStartedHeaderBar",a.GetStartedWithForm="DefaultPage.LandingView.GetStartedWithForm",a.GetStartedSignIn="DefaultPage.LandingView.GetStartedSignIn",a.SignIn="DefaultPage.LandingView.SignIn",a.MsaSignIn="DefaultPage.LandingView.MsaSignIn",a.AadSignIn="DefaultPage.LandingView.AadSignIn",a.Navigate="DefaultPage.LandingView.Navigate",a.SignUp="DefaultPage.LandingView.SignUp",a.MsaSignUp="DefaultPage.LandingView.MsaSignUp",a.AadSignUp="DefaultPage.LandingView.AadSignUp",a.CloseSignDialog="DefaultPage.LandingView.CloseSignDialog",a.EmailHrdFailure="DefaultPage.LandingView.EmailHrdFailure",a.AccountNotInWhiteList="DefaultPage.LandingView.AccountNotInWhiteList",a.AccountTypeUnknown="DefaultPage.LandingView.AccountTypeUnknown",a.AccountTypeBoth="DefaultPage.LandingView.AccountTypeBoth",a.Office365="DefaultPage.LandingView.Office365",a.PowerApps="DefaultPage.LandingView.PowerApps",a}();a.LandingView=b;var c=function(){function a(){}return a.Loaded="DefaultPage.EmailHrd.Loaded",a.NextScreen="DefaultPage.EmailHrd.NextScreen",a}();a.EmailHrd=c}(i=b.DefaultPage||(b.DefaultPage={}));var j;!function(a){var b=function(){function a(){}return a.Success="Image.CanvasOnLoad.Success",a.Failure="Image.CanvasOnLoad.Failure",a}();a.CanvasOnLoad=b;var c=function(){function a(){}return a.Success="Image.CanvasRender.Success",a.Failure="Image.CanvasRender.Failure",a}();a.CanvasRender=c;var d=function(){function a(){}return a.Success="Image.ImageOnLoad.Success",a.Failure="Image.ImageOnLoad.Failure",a}();a.ImageOnLoad=d}(j=b.Image||(b.Image={}));var k;!function(a){var b=function(){function a(){}return a.GotoRegisterPage="Error.ErrorPage.GotoRegisterPage",a.Error="Error.ErrorPage.Error",a.Information="Error.ErrorPage.Information",a.OriginErrorJudgementNotMatch="Error.ErrorPage.OriginErrorJudgementNotMatch",a.ErrorOutOfOrigin="Error.ErrorPage.ErrorOutOfOrigin",a.SignInWithOtherAccount="Error.ErrorPage.SignInWithOtherAccount",a.SignOutInIframeInProgress="Error.ErrorPage.SignOutInIframeInProgress",a}();a.ErrorPage=b;var c=function(){function a(){}return a.Hide="Error.ErrorMessageBar.Hide",a.Show="Error.ErrorMessageBar.Show",a}();a.ErrorMessageBar=c;var d=function(){function a(){}return a.ShowAtSubmitResponse="Error.InlineError.ShowAtSubmitResponse",a}();a.InlineError=d;var e=function(){function a(){}return a.FailedToLoadCss="Error.CssLoadingError.FailedToLoadCss",a}();a.CssLoadingError=e;var f=function(){function a(){}return a.KatexFallbackToMathJax="Error.MathRendering.KatexFallbackToMathJax",a}();a.MathRendering=f;var g=function(){function a(){}return a.UniversalHeaderAndFooterError="Error.UHF.UniversalHeaderAndFooterError",a}();a.UHF=g}(k=b.Error||(b.Error={}));var l;!function(a){var b=function(){function a(){}return a.AcquireTokenIdleTime="Auth.AcquireTokenIdleTime",a.DisabledByTenantAdmin="Auth.DisabledByTenantAdmin",a.LocalStorageNotSupported="Auth.LocalStorageNotSupported",a.NotOnboardedTenant="Auth.NotOnboardedTenant",a.ThirdPartyCookieSupport="Auth.ThirdPartyCookieSupport",a.UserNeedMultiFactorAuth="Auth.UserNeedMultiFactorAuth",a}();a.Auth=b}(l=b.Auth||(b.Auth={}));var m;!function(a){a.AllScriptsLoadDone="JsLoad.AllScriptsLoadDone",a.SomeScriptsLoadFailed="JsLoad.SomeScriptsLoadFailed",a.ScriptLoadDone="JsLoad.ScriptLoadDone",a.ScriptLoadFailed="JsLoad.ScriptLoadFailed"}(m=b.JsLoad||(b.JsLoad={}));var n;!function(a){var b=function(){function a(){}return a.Close="AddinPage.App.Close",a.Initial="AddinPage.App.Initial",a}();a.App=b;var c=function(){function a(){}return a.DataSync="AddinPage.SyncView.DataSync",a}();a.SyncView=c;var d=function(){function a(){}return a.GetAddinUserInfoSuccess="AddinPage.GetAddinUserInfo.Success",a.GetAddinUserInfoFailed="AddinPage.GetAddinUserInfo.Failed",a.GetFlightsSuccess="AddinPage.GetFlights.Success",a.GetFlightsFailed="AddinPage.GetFlights.Failed",a}();a.PageMethod=d}(n=b.AddinPage||(b.AddinPage={}));var o;!function(a){var b=function(){function a(){}return a.Close="OneNoteAddinPage.App.Close",a.Initial="OneNoteAddinPage.App.Initial",a}();a.App=b;var c=function(){function a(){}return a.Navigate="OneNoteAddinPage.AuthView.Navigate",a.Click="OneNoteAddinPage.AuthView.Click",a.Succeed="OneNoteAddinPage.AuthView.Succeed",a.NotLoggedIn="OneNoteAddinPage.AuthView.NotLoggedIn",a}();a.AuthView=c;var d=function(){function a(){}return a.Navigate="OneNoteAddinPage.SyncView.Navigate",a.IsNewUser="OneNoteAddinPage.SyncView.IsNewUser",a.InsertForm="OneNoteAddinPage.SyncView.InsertForm",a.InsertSuccess="OneNoteAddinPage.SyncView.InsertSuccess",a.CreateForm="OneNoteAddinPage.SyncView.CreateForm",a.CreateSuccess="OneNoteAddinPage.SyncView.CreateSuccess",a.EditForm="OneNoteAddinPage.SyncView.EditForm",a}();a.SyncView=d}(o=b.OneNoteAddinPage||(b.OneNoteAddinPage={}));var p;!function(a){var b=function(){function a(){}return a.GetToken="PowerPointTaskpaneAddinPage.Initialize.GetToken",a.GetTokenCompleted="PowerPointTaskpaneAddinPage.Initialize.GetTokenCompleted",a}();a.Initialize=b;var c=function(){function a(){}return a.Close="PowerPointTaskpaneAddinPage.App.Close",a.Initial="PowerPointTaskpaneAddinPage.App.Initial",a}();a.App=c;var d=function(){function a(){}return a.Navigate="PowerPointTaskpaneAddinPage.AuthView.Navigate",a.Click="PowerPointTaskpaneAddinPage.AuthView.Click",a.Succeed="PowerPointTaskpaneAddinPage.AuthView.Succeed",a.NotLoggedIn="PowerPointTaskpaneAddinPage.AuthView.NotLoggedIn",a}();a.AuthView=d;var e=function(){function a(){}return a.Navigate="PowerPointTaskpaneAddinPage.SyncView.Navigate",a.IsNewUser="PowerPointTaskpaneAddinPage.SyncView.IsNewUser",a.InsertForm="PowerPointTaskpaneAddinPage.SyncView.InsertForm",a.InsertSuccess="PowerPointTaskpaneAddinPage.SyncView.InsertSuccess",a.CreateForm="PowerPointTaskpaneAddinPage.SyncView.CreateForm",a.CreateSuccess="PowerPointTaskpaneAddinPage.SyncView.CreateSuccess",a.EditForm="PowerPointTaskpaneAddinPage.SyncView.EditForm",a.FetchFormList="PowerPointTaskpaneAddinPage.SyncView.FetchFormList",a.FetchFormListSuccess="PowerPointTaskpaneAddinPage.SyncView.FetchFormListSuccess",a}();a.SyncView=e}(p=b.PowerPointTaskpaneAddinPage||(b.PowerPointTaskpaneAddinPage={}));var q;!function(a){var b=function(){function a(){}return a.PrepareAddinContext="PowerPointContentAddinPage.Initialize.PrepareAddinContext",a.PrepareAddinContextCompleted="PowerPointContentAddinPage.Initialize.PrepareAddinContextCompleted",a.GetToken="PowerPointContentAddinPage.Initialize.GetToken",a.GetTokenCompleted="PowerPointContentAddinPage.Initialize.GetTokenCompleted",a.GetTokenThirdPartySSONotSupported="PowerPointContentAddinPage.Initialize.GetTokenThirdPartySSONotSupported",a}();a.Initialize=b;var c=function(){function a(){}return a.Click="PowerPointContentAddinPage.AuthView.Click",a.Succeed="PowerPointContentAddinPage.AuthView.Succeed",a.NotLoggedIn="PowerPointContentAddinPage.AuthView.NotLoggedIn",a}();a.AuthView=c;var d=function(){function a(){}return a.Render="PowerPointContentAddinPage.RenderView.Render",a.RenderFormPage="PowerPointContentAddinPage.RenderView.RenderFormPage",a.RenderSuccess="PowerPointContentAddinPage.RenderView.RenderSuccess",a.GetPPTView="PowerPointContentAddinPage.RenderView.GetPPTView",a.GetPPTViewSuccess="PowerPointContentAddinPage.RenderView.GetPPTViewSuccess",a.GetFormId="PowerPointContentAddinPage.RenderView.GetFormId",a.GetFormIdCompleted="PowerPointContentAddinPage.RenderView.GetFormIdCompleted",a.SaveFileSettings="PowerPointContentAddinPage.RenderView.SaveFileSettings",a.SaveFileSettingsCompleted="PowerPointContentAddinPage.RenderView.SaveFileSettingsCompleted",a.GetFormTitle="PowerPointContentAddinPage.RenderView.GetFormTitle",a.GetFormTitleCompleted="PowerPointContentAddinPage.RenderView.GetFormTitleCompleted",a.CheckAnonymous="PowerPointContentAddinPage.RenderView.CheckAnonymous",a.CheckAnonymousCompleted="PowerPointContentAddinPage.RenderView.CheckAnonymousCompleted",a.CookieBypass="PowerPointContentAddinPage.RenderView.CookieBypass",a.SSOBypass="PowerPointContentAddinPage.RenderView.SSOBypass",a}();a.RenderView=d;var e=function(){function a(){}return a.Click="PowerPointContentAddinPage.StartView.Click",a}();a.StartView=e}(q=b.PowerPointContentAddinPage||(b.PowerPointContentAddinPage={}));var r;!function(a){var b=function(){function a(){}return a.Navigate="AssignmentsFrame.Auth.Navigate",a.Success="AssignmentsFrame.Auth.Success",a.SsoSuccess="AssignmentsFrame.Auth.SsoSuccess",a}();a.Auth=b;var c=function(){function a(){}return a.Save="AssignmentsFrame.ConfigView.Save",a}();a.ConfigView=c}(r=b.AssignmentsFrame||(b.AssignmentsFrame={}));var s;!function(a){var b=function(){function a(){}return a.Navigate="TeamsTab.Auth.Navigate",a.Success="TeamsTab.Auth.Success",a.SsoSuccess="TeamsTab.Auth.SsoSuccess",a.RefreshInfoFailed="TeamsTab.Auth.RefreshInfoFailed",a}();a.Auth=b;var c=function(){function a(){}return a.Save="TeamsTab.ConfigView.Save",a}();a.ConfigView=c}(s=b.TeamsTab||(b.TeamsTab={}));var t;!function(a){var b=function(){function a(){}return a.Close="AgaveAddinPage.Agave.Close",a.Initial="AgaveAddinPage.Agave.Initial",a}();a.Agave=b}(t=b.AgaveAddinPage||(b.AgaveAddinPage={}));var u;!function(a){var b=function(){function a(){}return a.Close="OutlookCreatePollPage.App.Close",a.Initial="OutlookCreatePollPage.App.Initial",a}();a.App=b;var c=function(){function a(){}return a.Navigate="OutlookCreatePollPage.AuthView.Navigate",a.Click="OutlookCreatePollPage.AuthView.Click",a.Succeed="OutlookCreatePollPage.AuthView.Succeed",a.NotLoggedIn="OutlookCreatePollPage.AuthView.NotLoggedIn",a}();a.AuthView=c;var d=function(){function a(){}return a.Navigate="OutlookCreatePollPage.PollView.Navigate",a.Insert="OutlookCreatePollPage.PollView.Insert",a.OpenForms="OutlookCreatePollPage.PollView.OpenForms",a}();a.PollView=d;var e=function(){function a(){}return a.MultipleAnswers="OutlookCreatePollPage.Questions.MultipleAnswers",a}();a.Questions=e}(u=b.OutlookCreatePollPage||(b.OutlookCreatePollPage={}));var v=function(){function a(){}return a.Experiments="Experiment.Experiments",a}();b.Experiment=v;var w;!function(a){var b=function(){function a(){}return a.ConnectionDisconnected="DataProvider.RealtimeClient.Connection.Disconnected",a.ConnectionError="DataProvider.RealtimeClient.Connection.Error",a.ConnectionFailed="DataProvider.RealtimeClient.Connection.Failed",a.ConnectionReconnected="DataProvider.RealtimeClient.Connection.Reconnected",a.ConnectionReconnecting="DataProvider.RealtimeClient.Connection.Reconnecting",a.ConnectionSlow="DataProvider.RealtimeClient.Connection.Slow",a.ConnectionStarting="DataProvider.RealtimeClient.Connection.Starting",a.ConnectionSuccess="DataProvider.RealtimeClient.Connection.Success",a}();a.RealtimeClient=b}(w=b.DataProvider||(b.DataProvider={}));var x;!function(a){var b=function(){function a(){}return a.Navigate="QuickSubmitPage.QuickSubmit.Navigate",a.Submit="QuickSubmitPage.QuickSubmit.Submit",a}();a.QuickSubmit=b}(x=b.QuickSubmitPage||(b.QuickSubmitPage={}));var y;!function(a){var b=function(){function a(){}return a.Show="IntelligenceStatistic.ChoiceOptionSuggestion.Show",a.Choose="IntelligenceStatistic.ChoiceOptionSuggestion.Choose",a}();a.ChoiceOptionSuggestion=b;var c=function(){function a(){}return a.Show="IntelligenceStatistic.LikertOptionSuggestion.Show",a.Choose="IntelligenceStatistic.LikertOptionSuggestion.Choose",a}();a.LikertOptionSuggestion=c;var d=function(){function a(){}return a.Show="IntelligenceStatistic.QuestionSuggestion.Show",a}();a.QuestionSuggestion=d}(y=b.IntelligenceStatistic||(b.IntelligenceStatistic={}));var z;!function(a){var b=function(){function a(){}return a.Show="Intelligence.ChoiceOptionSuggestion.Show",a.Choose="Intelligence.ChoiceOptionSuggestion.Choose",a}();a.ChoiceOptionSuggestion=b;var c=function(){function a(){}return a.Show="Intelligence.LikertOptionSuggestion.Show",a.Choose="Intelligence.LikertOptionSuggestion.Choose",a}();a.LikertOptionSuggestion=c;var d=function(){function a(){}return a.Show="Intelligence.QuestionSuggestion.Show",a}();a.QuestionSuggestion=d}(z=b.Intelligence||(b.Intelligence={})),a.Exports.EngagementEventNames=b}(c=b.EngagementEventNames||(b.EngagementEventNames={}))}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(){}return Object.defineProperty(a,"DefaultStorage",{get:function(){return a.defaultStorage||(a.defaultStorage=a.LocalStorage,a.defaultStorage instanceof c&&(a.defaultStorage=a.SessionStorage)),a.defaultStorage},enumerable:!0,configurable:!0}),Object.defineProperty(a,"LocalStorage",{get:function(){return a.localStorage||(a.supportsLocalStorage()?a.localStorage=window.localStorage:a.localStorage=a.NoStorage),a.localStorage},enumerable:!0,configurable:!0}),Object.defineProperty(a,"SessionStorage",{get:function(){return a.sessionStorage||(a.supportsSessionStorage()?a.sessionStorage=window.sessionStorage:a.sessionStorage=a.NoStorage),a.sessionStorage},enumerable:!0,configurable:!0}),Object.defineProperty(a,"NoStorage",{get:function(){return a.noStorage||(a.noStorage=new c),a.noStorage},enumerable:!0,configurable:!0}),a.supportsLocalStorage=function(){if(null==a.localStorageSupported)try{var b="officeforms.__storage_test__";localStorage.setItem(b,b),localStorage.removeItem(b),a.localStorageSupported=!0}catch(c){a.localStorageSupported=!1}return a.localStorageSupported},a.supportsSessionStorage=function(){if(null==a.sessionStorageSupported)try{var b="officeforms.__storage_test__";sessionStorage.setItem(b,b),sessionStorage.removeItem(b),a.sessionStorageSupported=!0}catch(c){a.sessionStorageSupported=!1}return a.sessionStorageSupported},a.KeyPrefix_UseLegacyLoginDomain="officeforms.uselegacylogindomain",a}();a.SafeStorage=b;var c=function(){function a(){}return a.prototype.clear=function(){},a.prototype.getItem=function(a){},a.prototype.key=function(a){return null},a.prototype.removeItem=function(a){},a.prototype.setItem=function(a,b){},a}()}(OfficeForm||(OfficeForm={})),String.prototype.format||(String.prototype.format=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return this.replace(/{(\d+)}/g,function(b,c){return void 0!==a[c]?a[c]:b})}),String.prototype.trimEnd=function(a){for(var b=this,c=b.length;--c>=0&&!(a.indexOf(b.charAt(c))<0););return b.substr(0,c+1)},String.prototype.startsWith=function(a){if(null==a||0===a.length)return!0;var b=this;return null==b||b.length<a.length?!1:a===b.substr(0,a.length)},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(escapeRegExp(a),"g"),b)},"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/,b=a.exec(this.toString());return b&&b.length>1?b[1].trim():""}});var stringDelimiter=/('[^']*'|"[^"]*")/g,dateLabelsRegExp=/('[^']*'|"[^"]*"|d{1,2}|M{1,2}|y{2,4}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|t{2})/g;Date.prototype.toFormatString=function(a,b){var c=this;if(null==c||null==a||null==b)return null;var d=a.split(dateLabelsRegExp).map(function(a){switch(a){case"d":case"dd":return formatNumber(c.getDate(),a.length);case"ddd":return b.DateTimeFormat.AbbreviatedDayNames[c.getDay()];case"M":case"MM":return formatNumber(c.getMonth()+1,a.length);case"MMM":return b.DateTimeFormat.AbbreviatedMonthNames[c.getMonth()];case"yy":var d=c.getFullYear(),e=formatNumber(d,4);return d>b.Calendar.TwoDigitYearMax-100&&d<=b.Calendar.TwoDigitYearMax?e.slice(2):e;case"yyy":case"yyyy":case"yyyyy":return formatNumber(c.getFullYear(),a.length);case"H":case"HH":return formatNumber(c.getHours(),a.length);case"h":case"hh":return formatNumber((c.getHours()+11)%12+1,a.length);case"m":case"mm":return formatNumber(c.getMinutes(),a.length);case"s":case"ss":return formatNumber(c.getSeconds(),a.length);case"t":case"tt":var f=c.getHours()<12?b.DateTimeFormat.AMDesignator:b.DateTimeFormat.PMDesignator;return 1===a.length?f.charAt(0):f;default:return removeQuatos(a)}}).join("");return d},Date.prototype.toDateShortString=function(a){var b=this;return b.toFormatString(a.DateTimeFormat.ShortDatePattern,a)},Date.prototype.toTimeShortString=function(a){var b=this;return b.toFormatString(a.DateTimeFormat.ShortTimePattern,a)},Date.parseDate=function(a,b,c){var d=parseStringToDateLabels(a,b,c),e=parseInt(d.yyyy||d.yyy),f=parseInt(d.yy);if(isNaN(e)&&!isNaN(f))if(f>=100)e=f;else{var g=OfficeFormServerInfo.cultureInfo.Calendar.TwoDigitYearMax%100;e=g>=f?OfficeFormServerInfo.cultureInfo.Calendar.TwoDigitYearMax-g+f:OfficeFormServerInfo.cultureInfo.Calendar.TwoDigitYearMax-g-100+f}var h=parseInt(d.MM||d.M),i=d.MMM;isNaN(h)&&i&&(h=c.DateTimeFormat.AbbreviatedMonthNames.indexOf(i)+1);var j=parseInt(d.dd||d.d),k=getTime(d,c);if(!(isNaN(e)||isNaN(h)||isNaN(j)||isNaN(k))){var l=new Date(e,h-1,j,0,0,0,k);if(l.getFullYear()===e&&l.getMonth()+1===h&&l.getDate()===j)return l}return null},Date.parseTime=function(a,b,c){var d=parseStringToDateLabels(a,b,c);return d.time=!0,getTime(d,c)};var OfficeForm;!function(a){var b;!function(a){a[a.DevHost=0]="DevHost",a[a.Daily=1]="Daily",a[a.Weekly=2]="Weekly",a[a.Pilot=3]="Pilot",a[a.Trial=4]="Trial",a[a.Drill=5]="Drill",a[a.Hotfix=6]="Hotfix",a[a.Int=7]="Int",a[a.EDog=8]="EDog",a[a.WWProd=9]="WWProd",a[a.USGovProd=10]="USGovProd",a[a.USDoDProd=11]="USDoDProd",a[a.USGovGccProd=12]="USGovGccProd"}(b=a.EnvironmentType||(a.EnvironmentType={}));var c=function(){function c(){}return c.getEnvironmentType=function(){var a=this.getHostUrl(),c=OfficeFormServerInfo.deployment.toLocaleLowerCase();return c.indexOf("usgovdodproduction")>=0?b.USDoDProd:c.indexOf("usgovproduction")>=0?b.USGovProd:c.indexOf("usgovgccproduction")>=0?b.USGovGccProd:a.indexOf("forms.office.com")>=0||a.indexOf("forms.osi.office.net")>=0?b.WWProd:a.indexOf("forms.officeppe.com")>=0?b.EDog:a.indexOf("forms.office-int.com")>=0||a.indexOf("forms.osi.office-int.net")>=0?b.Int:a.indexOf("formweekly")>=0?b.Weekly:a.indexOf("formhotfix")>=0?b.Hotfix:a.indexOf("formdaily")>=0?b.Daily:a.indexOf("formpilot")>=0?b.Pilot:a.indexOf("formtrial")>=0?b.Trial:a.indexOf("formdrill")>=0?b.Drill:a.indexOf("localhost")>=0?b.DevHost:void 0},c.getPageType=function(){var a=window.location.pathname.toLowerCase();switch(a){case"/pages/designpage.aspx":case"/pages/teamsdesignpage.aspx":case"/pages/onenoteaddinpage.aspx":return"Design";case"/pages/responsepage.aspx":case"/pages/teamsresponsepage.aspx":return"Response";case"/pages/analysispage.aspx":return"Analyze";case"/pages/teamsconfigpage.aspx":return"TeamsConfig";default:return"Unknown"}},c.isProdAlternative=function(){var a=this.getHostUrl();return a.indexOf(".forms.osi.office.net")>0},c.isProduction=function(){var a=c.getEnvironmentType();return a===b.WWProd||a===b.USGovProd||a===b.USDoDProd||a===b.USGovGccProd},c.isSovereignProd=function(){var a=c.getEnvironmentType();return a===b.USGovProd||a===b.USDoDProd||a===b.USGovGccProd},c.isMsftProduction=function(){return"72f988bf-86f1-41af-91ab-2d7cd011db47"===OfficeFormServerInfo.userInfo.TenantId},c.isOsi=function(){switch(c.getEnvironmentType()){case b.Int:case b.EDog:case b.WWProd:case b.USGovProd:case b.USDoDProd:case b.USDoDProd:case b.USGovGccProd:return!0;default:return!1}},c.getAadInstance=function(){var b=a.SafeStorage.DefaultStorage.getItem(a.SafeStorage.KeyPrefix_UseLegacyLoginDomain);return c.isProduction()?b?"https://login.windows.net/":"https://login.microsoftonline.com/":"https://login.windows-ppe.net/"},c.getMSGraphAPIHost=function(){return c.isProduction()?"https://graph.microsoft.com/":"https://graph.microsoft-ppe.com"},c.getFormsProUIHost=function(){switch(c.getEnvironmentType()){case b.EDog:return"https://psuiwebappppe.azurewebsites.net";case b.WWProd:return"https://projectshimla.azurewebsites.net";default:return"https://psuiwebappint.azurewebsites.net"}},c.getAadClientId=function(){return c.getEnvironmentType()===b.USGovProd||c.getEnvironmentType()===b.USDoDProd?"032e56fd-dfe5-4a50-8017-89692bcbcb0e":"038ed4f5-da78-47bc-8176-9153c79e0edb"},c.getFormsResourceId=function(){return c.getEnvironmentType()===b.USGovProd||c.getEnvironmentType()===b.USDoDProd?"153a74ba-783f-4394-bc9a-a109ef69f5c2":"c9a559d2-7aab-4f13-a6ed-e7e9c52aec87"},c.getUserInfoUrl=function(){return"https://portal.{0}/account/#personalinfo".format(c.isProduction()?c.getOffice365Domain(c.getEnvironmentType(),!0):c.getOffice365Domain(b.EDog,!0))},c.getConsumerInfoUrl=function(){return"https://account.{0}".format(c.isProduction()?c.getOffice365ConsumerDomain(c.getEnvironmentType()):c.getOffice365ConsumerDomain(b.EDog))},c.getHrdV2Url=function(){var a=c.getExplictLocale();return"https://{0}/odc/v2.1/hrd?{1}Ver=16&app=111&p=6&hm=0&fpEnabled=1".format(c.getHrdV2Domain(),null!=a?"rs={0}&".format(a):"")},c.getHrdV2Domain=function(){return c.isProduction()?"odc.officeapps.live.com":"odc.edog.officeapps.live.com"},c.getCollabDBResourceId=function(d){return d||(d=c.getEnvironmentType(),d||(d=b.Int)),c.isOsi()&&d!==b.Int||a.Flighting.Flight.isEnabled(a.Flighting.Flights.ConnectToCdbInt)||OfficeFormServerInfo.userInfo.IsMsa||(d=b.EDog),"https://lists."+c.getOffice365Domain(d)},c.getLorPickerOrigin=function(){var a=c.getEnvironmentType();switch(a){case b.DevHost:return"https://educationresources-int.microsoft.com";case b.Trial:return"https://educationresources-int.microsoft.com";case b.Weekly:return"https://educationresources-int.microsoft.com";case b.Daily:return"https://educationresources-int.microsoft.com";case b.Int:return"https://educationresources-int.microsoft.com";case b.EDog:return"https://educationresources-ppe.microsoft.com";case b.WWProd:return"https://educationresources.microsoft.com";default:return"https://educationresources-int.microsoft.com"}},c.getLorPickerUrl=function(a){var b=c.getLorPickerOrigin(),d=c.getLorPickerHostParameter();return b+"/?supportedFormat=QTI&supportedResourceType=Assessment&host="+d+"&correlationId="+a},c.getMsftTenantId=function(){var a=c.getEnvironmentType();switch(a){case b.WWProd:return"72f988bf-86f1-41af-91ab-2d7cd011db47";default:return"f686d426-8d16-42db-81b7-ab578e110ccd"}},c.getMsaTenantId=function(){var a=c.getEnvironmentType();switch(a){case b.WWProd:case b.EDog:return"9188040d-6c67-4c5b-b112-36a304b66dad";default:return"4925308c-f164-4d2d-bc7e-0631132e9375"}},c.getExplictLocale=function(){return a.Utilities.Html.getQueries().lang||null},c.getOffice365Domain=function(a,d){switch(void 0===d&&(d=!1),null==a&&(a=c.getEnvironmentType()),a){case b.USDoDProd:return d?"apps.mil":"osi.apps.mil";case b.USGovProd:return d?"office365.us":"osi.office365.us";case b.USGovGccProd:return d?"office.com":"gcc.osi.office365.us";case b.WWProd:return"office.com";case b.EDog:case b.Trial:return"officeppe.com";default:return"office-int.com"}},c.getOffice365ConsumerDomain=function(a){switch(null==a&&(a=c.getEnvironmentType()),a){case b.WWProd:return"microsoft.com";case b.EDog:case b.Trial:return"microsoft-ppe.com";default:return"microsoft-int.com"}},c.getHostUrl=function(){var a=window.location.host;return a.toLocaleLowerCase()},c.getLorPickerHostParameter=function(){var a=c.getEnvironmentType();switch(a){case b.DevHost:return"msforms-dev";case b.Trial:return"msforms-trial";case b.Weekly:return"msforms-weekly";case b.Daily:return"msforms-daily";case b.Int:return"msforms-int";case b.EDog:return"msforms-ppe";case b.WWProd:return"msforms";default:return"msforms-trial"}},c}();a.EnvironmentConfig=c,a.Exports.EnvironmentConfig=c}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.Flighting=b;var c={},d={},e=function(){function b(){}return b.refreshFlights=function(){b.flights=OfficeFormServerInfo.flights&&OfficeFormServerInfo.flights.split(";")||b.flights},b.isEnabled=function(a){if(d[a]&&!d[a].every(b.isEnabled))return!1;var e=-1!==b.flightsOverride.indexOf("!"+g[a].toUpperCase());if(e)return!1;var f=-1!==b.flightsOverride.indexOf(g[a].toUpperCase());if(f)return!0;var h=-1!==b.flights.indexOf("!"+a)||-1!==b.flights.indexOf("!"+g[a]);if(h)return!1;var i=-1!==b.flights.indexOf(""+a)||-1!==b.flights.indexOf(g[a]);return i?!0:c[a]&&c[a].OnInCurrentEnvironment},b.foQuery=a.EnvironmentConfig.isProduction()&&!a.EnvironmentConfig.isProdAlternative()?"":a.Utilities.Html.getQueries().fo,b.flightsOverride=b.foQuery&&b.foQuery.split(";").map(function(a){return a.toUpperCase()})||[],b.flights=OfficeFormServerInfo.flights&&OfficeFormServerInfo.flights.split(";")||[],b}();b.Flight=e;var f;!function(a){a[a.OnDevBox=0]="OnDevBox",a[a.OnDevBoxAndDaily=1]="OnDevBoxAndDaily",a[a.AllOnNonOSI=2]="AllOnNonOSI",a[a.AllOnButEDogProd=3]="AllOnButEDogProd",a[a.AllOn=4]="AllOn",a[a.AllOff=5]="AllOff"}(f||(f={}));var g,h=function(){function b(a,b,c,d,e,g,h){if(null!=a)switch(a){case f.OnDevBox:this._onInDevhost=!0,this._onInDaily=!1,this._onInWeekly=!1,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1;break;case f.OnDevBoxAndDaily:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!1,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1;break;case f.AllOnNonOSI:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!0,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1;break;case f.AllOnButEDogProd:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!0,this._onInInt=!0,this._onInEDog=!1,this._onInProd=!1;break;case f.AllOn:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!0,this._onInInt=!0,this._onInEDog=!0,this._onInProd=!0;break;case f.AllOff:this._onInDevhost=!1,this._onInDaily=!1,this._onInWeekly=!1,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1}else this._onInDevhost=!!b,this._onInDaily=!!c,this._onInWeekly=!!d,this._onInInt=!!e,this._onInEDog=!!g,this._onInProd=!!h}return Object.defineProperty(b.prototype,"OnInCurrentEnvironment",{get:function(){var b=a.EnvironmentConfig.getEnvironmentType();switch(b){case a.EnvironmentType.DevHost:
return this._onInDevhost;case a.EnvironmentType.Daily:case a.EnvironmentType.Drill:case a.EnvironmentType.Pilot:case a.EnvironmentType.Trial:return this._onInDaily;case a.EnvironmentType.Weekly:case a.EnvironmentType.Hotfix:return this._onInWeekly;case a.EnvironmentType.Int:return this._onInInt;case a.EnvironmentType.EDog:return this._onInEDog;case a.EnvironmentType.WWProd:case a.EnvironmentType.USGovProd:case a.EnvironmentType.USDoDProd:case a.EnvironmentType.USGovGccProd:return this._onInProd}return!1},enumerable:!0,configurable:!0}),b}();!function(a){a[a.ResponseInApp=0]="ResponseInApp",a[a.LogAllQoSEvent=1]="LogAllQoSEvent",a[a.ReExportToExcelButton=2]="ReExportToExcelButton",a[a.ConnectToCdbInt=3]="ConnectToCdbInt",a[a.Likert=4]="Likert",a[a.LikertQuiz=5]="LikertQuiz",a[a.OEmbedSSO=6]="OEmbedSSO",a[a.SuggestionForm=7]="SuggestionForm",a[a.PhishingAutoDetection=8]="PhishingAutoDetection",a[a.AutoCloseForm=9]="AutoCloseForm",a[a.O365ConsumerWaffle=10]="O365ConsumerWaffle",a[a.EnableOnlineExcelForMSA=11]="EnableOnlineExcelForMSA",a[a.QRCodePlus=12]="QRCodePlus",a[a.ShareQuickSubmitPage=13]="ShareQuickSubmitPage",a[a.PageInitializationVerboseLogs=14]="PageInitializationVerboseLogs",a[a.DefaultPageHeaderAndFooter=15]="DefaultPageHeaderAndFooter",a[a.LogDownloadExcelErrorMessage=16]="LogDownloadExcelErrorMessage",a[a.MaxChoiceCount=17]="MaxChoiceCount",a[a.FormTemplateIntelligence=18]="FormTemplateIntelligence",a[a.FileUpload=19]="FileUpload",a[a.FormInsight=20]="FormInsight",a[a.AdminSetting=21]="AdminSetting",a[a.PartialPut=22]="PartialPut",a[a.FileUploadOnlyLargeFileAPI=23]="FileUploadOnlyLargeFileAPI",a[a.FormQuestionIntelligence=24]="FormQuestionIntelligence",a[a.DropDown=25]="DropDown",a[a.CopyPasteForChoice=26]="CopyPasteForChoice",a[a.DisableOpenRedirection=27]="DisableOpenRedirection",a[a.PPTContentAddinSSO=28]="PPTContentAddinSSO",a[a.TeamSSO=29]="TeamSSO",a[a.RecycleBin=30]="RecycleBin",a[a.RestrictIosForDownload=31]="RestrictIosForDownload",a[a.ExcelService=32]="ExcelService",a[a.PreviewInfoBar=33]="PreviewInfoBar",a[a.RefreshServerInfoInFrame=34]="RefreshServerInfoInFrame",a[a.Reexport2XlAlert=35]="Reexport2XlAlert",a[a.PreFetchIntelligenceSuggestion=36]="PreFetchIntelligenceSuggestion",a[a.LikertIntelligenceSuggestion=37]="LikertIntelligenceSuggestion",a[a.FileUploadTempFolder=38]="FileUploadTempFolder",a[a.AnalysisPageLightAPI=39]="AnalysisPageLightAPI",a[a.DecreasePagingSizeForDownloadExcel=40]="DecreasePagingSizeForDownloadExcel",a[a.EmailHrdHostedUX=41]="EmailHrdHostedUX",a[a.MsaPreviewLabel=42]="MsaPreviewLabel",a[a.EnableIntelligenceStatisticLog=43]="EnableIntelligenceStatisticLog",a[a.EnableOptionSuggestsOption=44]="EnableOptionSuggestsOption",a[a.RecycleBinButton=45]="RecycleBinButton",a[a.FormsBranding=46]="FormsBranding",a[a.EnableExperimentationClient=47]="EnableExperimentationClient",a[a.MsaSilentSignin=48]="MsaSilentSignin",a[a.MsaSSO=49]="MsaSSO",a[a.PPTTaskpaneAddinSSO=50]="PPTTaskpaneAddinSSO",a[a.FormLogoBrand=51]="FormLogoBrand",a[a.PPTWin32ContentAddinSSO=52]="PPTWin32ContentAddinSSO",a[a.CoGrading=53]="CoGrading",a[a.CoGradingPowertool=54]="CoGradingPowertool",a[a.QtiFormCreationTimeout=55]="QtiFormCreationTimeout",a[a.EnableLorForAllLocales=56]="EnableLorForAllLocales",a[a.PrintForm=57]="PrintForm",a[a.MathIncorrectAnswerSuggestions=58]="MathIncorrectAnswerSuggestions",a[a.MathQuestionGeneration=59]="MathQuestionGeneration",a[a.FormsPro=60]="FormsPro",a[a.CookieAuth=61]="CookieAuth",a[a.UseExternalCdn=62]="UseExternalCdn",a[a.CheckScriptLoading=63]="CheckScriptLoading",a[a.Nps=64]="Nps",a[a.MsaLogin=65]="MsaLogin",a[a.EnableTransferForm=66]="EnableTransferForm",a[a.ThankYou=67]="ThankYou",a[a.Privacy=68]="Privacy",a[a.SubmitTimeDistributionInsight=69]="SubmitTimeDistributionInsight",a[a.EnableNPSKeywordsInsight=70]="EnableNPSKeywordsInsight",a[a.EnablePartialOrderInsight=71]="EnablePartialOrderInsight"}(g=b.Flights||(b.Flights={})),c[g.CoGrading]=new h(f.OnDevBoxAndDaily),c[g.CoGradingPowertool]=new h(f.AllOff),c[g.QtiFormCreationTimeout]=new h(f.AllOn),c[g.EnableLorForAllLocales]=new h(f.AllOn),c[g.ResponseInApp]=new h(f.AllOnButEDogProd),c[g.MathIncorrectAnswerSuggestions]=new h(f.OnDevBoxAndDaily),c[g.MathQuestionGeneration]=new h(f.OnDevBoxAndDaily),c[g.FormsPro]=new h(f.AllOff),c[g.OEmbedSSO]=new h(f.AllOff),c[g.LogAllQoSEvent]=new h(f.AllOnButEDogProd),c[g.ReExportToExcelButton]=new h(f.AllOnButEDogProd),c[g.SuggestionForm]=new h(f.OnDevBoxAndDaily),c[g.PhishingAutoDetection]=new h(f.AllOnButEDogProd),c[g.ConnectToCdbInt]=new h(f.AllOnButEDogProd),c[g.Likert]=new h(f.AllOn),c[g.LikertQuiz]=new h(f.AllOn),c[g.O365ConsumerWaffle]=new h(f.OnDevBox),c[g.AutoCloseForm]=new h(f.AllOnButEDogProd),c[g.EnableOnlineExcelForMSA]=new h(f.AllOff),c[g.QRCodePlus]=new h(f.AllOnButEDogProd),c[g.ShareQuickSubmitPage]=new h(f.AllOnButEDogProd),c[g.PageInitializationVerboseLogs]=new h(f.AllOnButEDogProd),c[g.DefaultPageHeaderAndFooter]=new h(f.AllOn),c[g.LogDownloadExcelErrorMessage]=new h(f.AllOn),c[g.MaxChoiceCount]=new h(f.OnDevBoxAndDaily),c[g.FormTemplateIntelligence]=new h(f.AllOnButEDogProd),c[g.FileUpload]=new h(f.AllOnButEDogProd),c[g.FormInsight]=new h(f.AllOnButEDogProd),c[g.AdminSetting]=new h(f.OnDevBox),c[g.PartialPut]=new h(f.OnDevBox),c[g.RestrictIosForDownload]=new h(f.AllOnButEDogProd),c[g.FileUploadOnlyLargeFileAPI]=new h(f.AllOnButEDogProd),c[g.FormQuestionIntelligence]=new h(f.AllOnButEDogProd),c[g.DropDown]=new h(f.AllOnButEDogProd),c[g.CopyPasteForChoice]=new h(f.AllOnButEDogProd),c[g.DisableOpenRedirection]=new h(f.AllOnButEDogProd),c[g.PPTContentAddinSSO]=new h(f.AllOnButEDogProd),c[g.PPTWin32ContentAddinSSO]=new h(f.AllOnButEDogProd),c[g.PPTTaskpaneAddinSSO]=new h(f.AllOnButEDogProd),c[g.FormLogoBrand]=new h(f.AllOnButEDogProd),c[g.TeamSSO]=new h(f.AllOnButEDogProd),c[g.RecycleBin]=new h(f.AllOnButEDogProd),c[g.ExcelService]=new h(f.AllOnButEDogProd),c[g.PreviewInfoBar]=new h(f.AllOnButEDogProd),c[g.RefreshServerInfoInFrame]=new h(f.AllOnButEDogProd),c[g.Reexport2XlAlert]=new h(f.AllOnButEDogProd),c[g.PreFetchIntelligenceSuggestion]=new h(f.AllOnButEDogProd),c[g.LikertIntelligenceSuggestion]=new h(f.AllOnButEDogProd),c[g.FileUploadTempFolder]=new h(f.AllOff),c[g.AnalysisPageLightAPI]=new h(f.AllOff),c[g.DecreasePagingSizeForDownloadExcel]=new h(f.AllOnButEDogProd),c[g.EmailHrdHostedUX]=new h(f.AllOnButEDogProd),c[g.MsaLogin]=new h(f.AllOnButEDogProd),c[g.MsaPreviewLabel]=new h(f.AllOn),c[g.EnableIntelligenceStatisticLog]=new h(f.AllOnButEDogProd),c[g.EnableOptionSuggestsOption]=new h(f.AllOff),c[g.Privacy]=new h(f.AllOnButEDogProd),c[g.ThankYou]=new h(f.AllOnButEDogProd),c[g.PrintForm]=new h(f.OnDevBox),c[g.MsaSilentSignin]=new h(f.AllOnButEDogProd),c[g.RecycleBinButton]=new h(f.AllOnButEDogProd),c[g.FormsBranding]=new h(f.OnDevBoxAndDaily),c[g.MsaSSO]=new h(f.AllOnButEDogProd),c[g.EnableExperimentationClient]=new h(f.AllOff),d[g.CoGradingPowertool]=[g.CoGrading],d[g.EmailHrdHostedUX]=[g.MsaLogin],d[g.RecycleBinButton]=[g.RecycleBin]}(b=a.Flighting||(a.Flighting={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(Error);a.AuthError=b;var c=function(b){function c(c){var d=b.call(this,c)||this;return d.name=a.Form.ClientErrorNames.AuthNoStorageError,d}return __extends(c,b),c}(b);a.AuthErrorNoStorage=c;var d=function(){function b(){}return Object.defineProperty(b,"AuthContext",{get:function(){return b.authContext},enumerable:!0,configurable:!0}),b.getProtocol=function(){return a.EnvironmentConfig.getEnvironmentType()===a.EnvironmentType.DevHost?b.httpProtocol:b.httpsProtocol},b.redirectToDesignPage=function(){var a=b.getProtocol()+window.location.host+b.designPagePath+window.location.search+window.location.hash;b.redirectToUrl(a,"Assign")},b.redirectToRegisterPage=function(){b.AuthContext.clearCache();var a=b.getProtocol()+window.location.host+b.registerPagePath+"?"+encodeURIComponent(OfficeFormServerInfo.userInfo.GivenName);b.redirectToUrl(a,"Assign")},b.hasUserLoggedIn=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?a.DataProvider.AuthTokenHelper.getInstance().isUserLoggedIn():!!b.AuthContext.getCachedUser()},b.isTokenValid=function(){return!!b.AuthContext.getCachedToken(a.EnvironmentConfig.getAadClientId())},b.handleAuthForDefaultPage=function(){return b.deferredHandleAuth||(b.deferredHandleAuth=$.Deferred(),a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?b.handleDetectUserLoggedInAADCallback()||b.deferredHandleAuth.resolve():b.handleAuth(function(c){if(c)b.redirectToDesignPage();else{var d=a.SafeStorage.DefaultStorage;b.detectUserLoggedInAAD(function(){d.setItem(b.KeyPrefix_DefaultPageDetectAadLogin,"Success"),b.redirectToDesignPage()},function(){d.setItem(b.KeyPrefix_DefaultPageDetectAadLogin,"Failure"),b.deferredHandleAuth.resolve()})}},function(a){var c=window.parent!==window&&window.parent.AuthenticationContext();c||a||b.redirectToDesignPage(),b.deferredHandleAuth.reject()})),b.deferredHandleAuth.promise()},Object.defineProperty(b,"DetectAADInProgress",{get:function(){return a.Utilities.BrowserStorage.getItem(b.detectAADInProgressKey)},set:function(c){a.Utilities.BrowserStorage.setItem(b.detectAADInProgressKey,c,b.detectAADTimeOut)},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DetectAADResult",{get:function(){return a.Utilities.BrowserStorage.getItem(b.detectAADResultKey)},set:function(c){a.Utilities.BrowserStorage.setItem(b.detectAADResultKey,c)},enumerable:!0,configurable:!0}),b.detectUserLoggedInAAD=function(c,d){if(a.Utilities.BrowserStorage.isSupported()){var e=!b.DetectAADInProgress;e&&b.initDetectUserLoggedInAAD();var f=setInterval(function(){b.DetectAADInProgress||(clearInterval(f),b.DetectAADResult?e?c():setTimeout(function(){location.reload(!0)},b.refreshWaitingTime):d())},b.detectAADPollingFrequency)}else d()},b.initDetectUserLoggedInAAD=function(){b.DetectAADInProgress=!0,b.DetectAADResult=void 0;var c;c=a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?b.stateCookieAuthPrefix+a.Utilities.Guid.newGuid():b.statePrefix+a.Utilities.Guid.newGuid();var d={client_id:a.EnvironmentConfig.getAadClientId(),msafed:0,prompt:"none",redirect_uri:b.getProtocol()+window.location.host,resource:a.EnvironmentConfig.getFormsResourceId(),response_mode:"form_post",response_type:"token",state:c};a.SafeStorage.DefaultStorage.setItem(b.stateKey,c);var e=new a.Event.QosEvent(a.Event.QosEventNames.Auth.Auth.DetectUserLoggedInAAD);e.start(),window.formDetectUserLoggedInAADCallback=function(c){e.end({resultType:c?a.Event.ResultType.ExpectedFailure:a.Event.ResultType.Success}),b.DetectAADInProgress=void 0,b.DetectAADResult=!c};var f=a.EnvironmentConfig.getAadInstance()+"common/oauth2/authorize?"+jQuery.param(d);$("body").append('<iframe id="detectAADAuthFrame" style="display:none;" src='+f+"><iframe>")},b.detectThirdPartyCookieSupport=function(a){var b=function(c){"TPC:NotSupported"===c.data?(a(!1),window.removeEventListener("message",b)):"TPC:Supported"===c.data&&(a(!0),window.removeEventListener("message",b))};window.addEventListener("message",b,!1);var c="https://controls.officeppe.com/thirdpartycookie/check.html";$("body").append('<iframe id="detectThirdPartyCookieFrame" style="display:none;" src='+c+"><iframe>")},b.handleAuthForContentPage=function(c){return b.deferredHandleAuth||(b.deferredHandleAuth=$.Deferred(),a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?b.deferredHandleAuth.resolve():b.handleAuth(function(){if(c){if(b.AuthContext.login(),!b.loginWithRedirectPromise)throw Error("Authenticator.redirectForAuthContextLogin not called.");b.loginWithRedirectPromise.done(function(){return b.deferredHandleAuth.resolve()}).fail(function(){return b.deferredHandleAuth.reject()})}else b.hasUserLoggedIn()&&b.populateUserInfo(),b.deferredHandleAuth.resolve()},function(a){a?b.deferredHandleAuth.reject():(b.populateUserInfo(),b.deferredHandleAuth.resolve())},function(a){b.deferredHandleAuth.reject(a)})),b.deferredHandleAuth.promise()},b.handleAuthForAddinPage=function(){return b.deferredHandleAuth||(b.deferredHandleAuth=$.Deferred(),a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?b.deferredHandleAuth.resolve():b.handleAuth(function(){b.deferredHandleAuth.reject()},function(){b.populateUserInfo(),b.deferredHandleAuth.resolve()})),b.deferredHandleAuth.promise()},b.registerSignInHandler=function(a,c){void 0===c&&(c=null),b.loginHandler=a,b.authUpn=c},b.signIn=function(){return b.loginHandler?b.loginHandler(b.authUpn):(b.redirectToLogin(),$.Deferred().promise())},b.signInThenRefresh=function(){b.signIn().then(function(){return window.location.reload(!0)})},b.redirectToLogin=function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?a.DataProvider.AuthTokenHelper.getInstance().redirectToSignIn():a.Authenticator.AuthContext.login()},b.redirectToUrl=function(b,c){a.Telemetry.flushLogs().always(function(){switch(c){case"Assign":window.location.href=b;break;case"Replace":window.location.replace(b)}})},b.handleAuth=function(d,e,f){if(b.AuthContext)throw Error("The handleAuth should be called once at the very beginning.");if(!b.handleDetectUserLoggedInAADCallback()){var g=b.getProtocol()+window.location.host,h=a.SafeStorage.supportsLocalStorage(),i=a.SafeStorage.supportsSessionStorage();if(h||a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Auth.Auth.LocalStorageNotSupported,extraData:{supportsSessionStorage:i}}),!h&&!i)return void(f&&f(new c("local storage or session storage can't be used")));var j=a.Utilities.BrowserStorage.getItem(b.userAccountNameKey),k="response_mode=form_post&msafed=0";k=j?k+"&username="+j:k;var l={cacheLocation:h?"localStorage":"sessionStorage",clientId:a.EnvironmentConfig.getAadClientId(),displayCall:b.redirectForAuthContextLogin,extraQueryParameter:k,instance:a.EnvironmentConfig.getAadInstance(),postLogoutRedirectUri:g,redirectUri:g,tenant:""},m=new AuthenticationContext(l),n=m.isCallback(window.location.hash);m.handleWindowCallback(),n||(b.authContext=m,a.Authenticator.hasUserLoggedIn()?a.Authenticator.AuthContext.acquireToken(a.EnvironmentConfig.getAadClientId(),function(b,c){var f=!(b||!c);if(f){var g=a.Authenticator.AuthContext.getCachedUser();"live.com"===g.profile.idp&&(a.Authenticator.AuthContext.clearCache(),f=!1,a.Event.ErrorEvent.logData({type:a.Event.ErrorType.UnexpectedLiveId}))}else a.Authenticator.AuthContext.clearCache();!f&&d?d(!0):f&&e&&e(n)}):d&&d(!1))}},b.handleDetectUserLoggedInAADCallback=function(){var a=b.isDetectUserLoggedInAADCallback(window.location.hash);if(a){var c=b.isDetectUserLoggedInAADCallbackError(window.location.hash);return window.parent&&window.parent.formDetectUserLoggedInAADCallback&&window.parent.formDetectUserLoggedInAADCallback(c),!0}return!1},b.isDetectUserLoggedInAADCallback=function(a){return-1!==a.indexOf("state="+b.statePrefix)},b.isDetectUserLoggedInAADCallbackError=function(c){var d=!1,e=a.Utilities.Html.getQueries(c.substring(1).trim());return e.state&&a.SafeStorage.DefaultStorage.getItem(b.stateKey)===e.state&&(d=!0),!d||-1!==c.indexOf("error_description=")},b.populateUserInfo=function(){var a=b.AuthContext.getCachedUser(),c=a.profile.oid;OfficeFormServerInfo.userInfo={DisplayName:a.profile.name,GivenName:a.profile.given_name||a.profile.name&&a.profile.name.split(" ")[0],Email:a.profile.unique_name,UserId:c,TenantId:a.profile.tid,PUID:c.replace(/-/g,"").substring(16),IsMsa:!1}},b.redirectForAuthContextLogin=function(a){if(b.loginWithRedirectPromise)throw Error("login in progress.");b.redirectToUrl(a,"Replace");var c=$.Deferred();b.loginWithRedirectPromise=c.promise(),setTimeout(function(){return c.reject()},3e3)},b.KeyPrefix_DefaultPageDetectAadLogin="officeforms.defaultpage.detectaadlogin",b.httpProtocol="http://",b.httpsProtocol="https://",b.designPagePath="/Pages/DesignPage.aspx",b.registerPagePath="/Pages/RegisterPage.aspx",b.stateKey="officeforms.auth.state",b.statePrefix="form.detectUserLoggedInAAD.",b.stateCookieAuthPrefix=b.statePrefix+"cookieAuth.",b.detectAADInProgressKey="officeforms.auth.detectAADInProgress",b.detectAADResultKey="officeforms.auth.detectAADResult",b.detectAADTimeOut=5e3,b.detectAADPollingFrequency=100,b.refreshWaitingTime=2e3,b.userAccountNameKey="officeforms.userAccountNameKey",b}();a.Authenticator=d,a.Exports.Authenticator=d}(OfficeForm||(OfficeForm={})),function(a){var b;!function(b){var c=function(){function b(){}return b.isSupported=function(){return a.SafeStorage.supportsLocalStorage()||a.SafeStorage.supportsSessionStorage()},b.getItem=function(a){var c=a+b.timeStampSuffix,d=b.doGetItem(c);return d&&Date.now()>d&&(b.doSetItem(c,void 0),b.doSetItem(a,void 0)),b.doGetItem(a)},b.setItem=function(a,c,d){void 0===d&&(d=void 0);var e=a+b.timeStampSuffix;if(b.isEmptyValue(c))b.doSetItem(e,void 0),b.doSetItem(a,void 0);else{if(d){var f=Date.now()+d;b.doSetItem(e,f)}b.doSetItem(a,c)}},b.isEmptyValue=function(a){return null==a||""===a},b.doGetItem=function(c){var d=a.SafeStorage.DefaultStorage.getItem(c);return b.isEmptyValue(d)?d:JSON.parse(d)},b.doSetItem=function(c,d){b.isEmptyValue(d)?a.SafeStorage.DefaultStorage.removeItem(c):a.SafeStorage.DefaultStorage.setItem(c,JSON.stringify(d))},b.timeStampSuffix=".TimeStamp",b}();b.BrowserStorage=c}(b=a.Utilities||(a.Utilities={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b=function(){function a(){}return a.AADAcquireTokenError="AADAcquireTokenError",a.AADAcquireTokenMfaCheckError="AADAcquireTokenMfaCheckError",a.LoginIECrossZoneError="LoginIECrossZoneError",a.ThirdPartyCookieBlockedError="ThirdPartyCookieBlockedError",a.AuthNoStorageError="AuthNoStorageError",a.TeamSiteNoGroupError="TeamSiteNoGroupError",a}();a.ClientErrorNames=b}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;if(function(a){var b;!function(b){function c(){return{R:255,G:255,B:255}}function d(){return{R:0,G:0,B:0}}function e(a){var b=[a.R,a.G,a.B].map(function(a){return a/=255,.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});return.2126*b[0]+.7152*b[1]+.0722*b[2]}function f(a){return(e(c())+.05)/(e(a)+.05)>q}function g(a){for(var b=r;!f(a)&&b>=s;){var c=k(a);c.V=.01*b,a=l(c),b--}return a}function h(a){return f(a)?c():d()}function i(a){var b=a.toString(16);return 1===b.length?"0"+b:b}function j(a){return"#"+i(a.R)+i(a.G)+i(a.B)}function k(a){var b,c=a.R,d=a.G,e=a.B,f=Math.max(c,d,e),g=Math.min(c,d,e),h=f-g,i=0===f?0:h/f,j=f/255;switch(f){case g:b=0;break;case c:b=d-e+h*(e>d?6:0),b/=6*h;break;case d:b=e-c+2*h,b/=6*h;break;case e:b=c-d+4*h,b/=6*h}return{H:b,S:i,V:j}}function l(a){var b,c,d,e,f,g,h,i,j=a.H,k=a.S,l=a.V;switch(e=Math.floor(6*j),f=6*j-e,g=l*(1-k),h=l*(1-f*k),i=l*(1-(1-f)*k),e%6){case 0:b=l,c=i,d=g;break;case 1:b=h,c=l,d=g;break;case 2:b=g,c=l,d=i;break;case 3:b=g,c=h,d=l;break;case 4:b=i,c=g,d=l;break;case 5:b=l,c=g,d=h}return{R:Math.round(255*b),G:Math.round(255*c),B:Math.round(255*d)}}function m(a){a.startsWith("#")&&(a=a.substring(1));var b=parseInt(a,16);return{R:b>>16&255,G:b>>8&255,B:255&b}}function n(a){var b=m(a),c=k(b);return e(b)>186&&(c.V=.45,b=l(c)),j(b)}function o(a){var b=k(m(a)),c=l({H:b.H,S:b.S,V:b.V-.1});return j(c)}function p(a){var b,c=k(m(a));return b=c.S>.05?.05:0,j(l({H:c.H,S:b,V:.95}))}a.Exports.ColorHelper=b;var q=4.5,r=46,s=25;b.isValidColorContrast=f,b.adjustPrimaryThemeColor=g,b.contrastingColor=h,b.colorToHex=j,b.rGBToHSV=k,b.hSVToRGB=l,b.hexToRGB=m,b.normalizePrimaryColor=n,b.primaryHexToSecondaryHex=o,b.primaryHexToBackgroundHex=p}(b=a.ColorHelper||(a.ColorHelper={}))}(OfficeForm||(OfficeForm={})),!window.atob||!window.btoa){window.atob=window.atob||decode,window.btoa=window.btoa||encode;var PADCHAR_1="=",ALPHA_1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}var OfficeForm;!function(a){var b;!function(b){function c(a){return h[a]||(h[a]=d(a)),h[a]}function d(b){var c=$.Deferred(),d=g[f[b]];if(!d)throw Error("No path for "+f[b]);var e=document.getElementsByTagName("head")[0];if(!e)return c.reject(Error("No head element found!")).promise();var h=document.createElement("link");return h.rel="stylesheet",h.href=d,h.onload=function(){return c.resolve()},h.onerror=function(){e.removeChild(h),c.reject(Error("Failed to load css file: "+d)),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Error.CssLoadingError.FailedToLoadCss,extraData:{name:f[b],url:d}})},e.appendChild(h),c.promise()}function e(){var b="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.0/katex.min.css",c="../scripts/vendors/katex/katex.min.css";return a.EnvironmentConfig.isOsi()?c:b}var f;!function(a){a[a.Katex=0]="Katex"}(f=b.CssLibraries||(b.CssLibraries={})),b.loadCss=c;var g={Katex:e()},h=[]}(b=a.CssLoader||(a.CssLoader={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){a[a.Default=1]="Default",a[a.OfficeAPI=2]="OfficeAPI",a[a.TeamsAPI=3]="TeamsAPI"}(b=a.PopupNotifyType||(a.PopupNotifyType={}));var c;!function(a){a[a.Default=0]="Default",a[a.OrgId=1]="OrgId",a[a.WindowsLiveId=2]="WindowsLiveId"}(c=a.AuthProvider||(a.AuthProvider={}));var d;!function(a){a.DefaultPage="../Default.aspx",a.AnalysisPage="../Pages/AnalysisPage.aspx",a.PopupLoginPage="../Pages/PopupLoginPage.aspx",a.TeamsResponsePage="../Pages/TeamsResponsePage.aspx",a.TeamsConfigPage="../Pages/TeamsConfigPage.aspx",a.TeamsDesignPage="../Pages/TeamsDesignPage.aspx",a.AssignmentsDesignPage="../Pages/AssignmentsDesignPage.aspx",a.AssignmentsResponsePage="../Pages/AssignmentsResponsePage.aspx"}(d=a.AspxPages||(a.AspxPages={}));var e;!function(a){a[a.OneNote=1]="OneNote",a[a.OneNoteUwp=2]="OneNoteUwp",a[a.Outlook=3]="Outlook",a[a.Teams=4]="Teams",a[a.Excel=5]="Excel",a[a.OneDrive=6]="OneDrive",a[a.Excel_Win32=7]="Excel_Win32",a[a.PowerPoint=8]="PowerPoint",a[a.Assignments=9]="Assignments",a[a.ProjectShimla=10]="ProjectShimla"}(e=a.HostApps||(a.HostApps={}));var f=function(){function b(){}return Object.defineProperty(b,"Host",{get:function(){return b._host||e[b.GetHostString()]},set:function(a){b._host=a},enumerable:!0,configurable:!0}),b.GetHostString=function(){return b._host&&e[b._host]||a.Utilities.Html.getQueries()[b.HostParam]||a.Utilities.Html.getHashes()[b.HostParam]},Object.defineProperty(b,"GroupId",{get:function(){return b._groupId||a.Utilities.Html.getQueries()[b.GroupParam]||a.Utilities.Html.getHashes()[b.GroupParam]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"TenantId",{get:function(){return b._tenantId||a.Utilities.Html.getQueries()[b.TenantParam]||a.Utilities.Html.getHashes()[b.TenantParam]},enumerable:!0,configurable:!0}),b.setGroupInfo=function(a,c,d){void 0===a&&(a=!1),b._showGroupFormOnly=a,b._tenantId=c,b._groupId=d},Object.defineProperty(b,"IsIntegration",{get:function(){var a=b.GetHostString();return a&&e[a]?!0:OfficeFormServerInfo.isOembedSPO?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsTeamsIntegration",{get:function(){return b.Host===e.Teams&&"undefined"!=typeof microsoftTeams},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsTeamsLandingPage",{get:function(){return!!a.Utilities.Html.getQueries()[b.TeamsLandingParam]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsMiniLandingView",{get:function(){return!!a.Utilities.Html.getQueries()[b.MiniLandingViewParam]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsAssignmentsIntegration",{get:function(){return b.Host===e.Assignments},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsExternalIntegration",{get:function(){return this.IsTeamsIntegration||this.IsAssignmentsIntegration},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsPPTIntegration",{get:function(){return b.Host===e.PowerPoint},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsProjectShimlaIntegration",{get:function(){return b.Host===e.ProjectShimla},enumerable:!0,configurable:!0}),b.setEnvironmentHostAppWithName=function(a){if(!(a in e))throw Error("hostAppName "+a+" doesn't exist.");b.Host=e[a]},b.PopupNotifyTypeParam="popupNotifyType",b.AuthProviderParam="auth_pvr",b.AuthUpnParam="auth_upn",b.HostParam="Host",b.TeamsLandingParam="TeamsLanding",b.MiniLandingViewParam="MiniLandingView",b.GroupParam="groupId",b.TenantParam="tid",b}();a.EnvironmentSettings=f,a.Exports.EnvironmentSettings=f}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a,b,d,e){var f={};return f[s]=e?u:t,c(a,b,d,f)}function c(a,b,c,d){var e=g(a),i=g(b);d&&0!==Object.keys(d).length&&Object.keys(d).forEach(function(a){c+=r+a+"="+d[a]});var j=p-(n+o+c.length)%p;j=p>j?j:0,c=f(c,c.length+j,q);var k=h(c),l=e.concat(i,k),m=window.btoa(String.fromCharCode.apply(String,l));return m.replace(/\//g,"_").replace(/\+/g,"-")}function d(a){var b=e(a),c=!1;return b.MoreInfo&&b.MoreInfo[s]===u&&(c=!0),{OrgId:b.OrgId,OwnerId:b.OwnerId,TableId:b.TableId,IsGroupOwner:c}}function e(a){try{a=a.replace(/_/g,"/").replace(/-/g,"+");var b=i(a),c=b.slice(0,n),d=j(c),e=b.slice(n,n+o),f=j(e),g=b.slice(n+o),h=m(k(g),q),l={},p=h.split(r);if(p.length>1){h=p[0];for(var s=1;s<p.length;s++){var t=p[s].split("=");t&&2===t.length&&(l[t[0]]=t[1])}}return{OrgId:d,OwnerId:f,TableId:h,MoreInfo:l}}catch(u){return{OrgId:null,OwnerId:null,TableId:null,MoreInfo:null}}}function f(a,b,c){return a+Array(b-a.length+1).join(c||" ")}function g(a){var b=[];return a.split("-").forEach(function(a,c){var d=a.match(/.{2}/g);3>c&&(d=d.reverse()),d.forEach(function(a){b.push(parseInt(a,16))})}),b}function h(a){return a.split("").map(function(a){return a.charCodeAt(0)})}function i(a){return h(window.atob(a.replace(/ /g,"")))}function j(a){if(16!==a.length)return null;var b=[].concat(a.slice(0,4).reverse(),a.slice(4,6).reverse(),a.slice(6,8).reverse(),a.slice(8)),c=l(b);return c=c.slice(0,8)+"-"+c.slice(8,12)+"-"+c.slice(12,16)+"-"+c.slice(16,20)+"-"+c.slice(20)}function k(a){for(var b="",c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function l(a){for(var b="",c="",d=0;d<a.length;d++)c=a[d].toString(16),c=1===c.length?"0"+c:c,b+=c;return b}function m(a,b){if(null===a||void 0===a||0===a.length)return a;for(var c=a.length;--c>=0&&!(b.indexOf(a.charAt(c))<0););return a.substr(0,c+1)}var n=16,o=16,p=3,q=".",r="$%@#",s="t",t="u",u="g";a.encodeFormId=b,a.decodeFormId=d}(b=a.FormId||(a.FormId={}))}(b=a.Utilities||(a.Utilities={}))}(OfficeForm||(OfficeForm={}));var Forms;!function(a){var b;!function(a){var b;!function(a){}(b=a.FormManager||(a.FormManager={}))}(b=a.Models||(a.Models={}));var c;!function(a){var b;!function(a){}(b=a.Utilities||(a.Utilities={}));var c;!function(a){}(c=a.Controls||(a.Controls={}));var d;!function(a){}(d=a.Analysis||(a.Analysis={}));var e;!function(a){}(e=a.FileUpload||(a.FileUpload={}));var f;!function(a){}(f=a.Intelligence||(a.Intelligence={}));var g;!function(a){}(g=a.RecycleBin||(a.RecycleBin={}));var h;!function(a){}(h=a.Renderer||(a.Renderer={}));var i;!function(a){}(i=a.Designer||(a.Designer={}));var j;!function(a){}(j=a.FlexPane||(a.FlexPane={}));var k;!function(a){}(k=a.FormDesignView||(a.FormDesignView={}))}(c=a.UX||(a.UX={})),function(a){var b;!function(a){}(b=a.FileUpload||(a.FileUpload={}))}(c=a.UX||(a.UX={}));var d;!function(a){}(d=a.Mru||(a.Mru={}));var e;!function(a){}(e=a.FileUploadProcess||(a.FileUploadProcess={}));var f;!function(a){}(f=a.Grading||(a.Grading={}));var g;!function(a){}(g=a.PrintTemplate||(a.PrintTemplate={}));var h;!function(a){}(h=a.Common||(a.Common={}));var i;!function(a){}(i=a.DataProvider||(a.DataProvider={}));var j;!function(a){}(j=a.Experiment||(a.Experiment={}))}(Forms||(Forms={}));var FormsPro;!function(a){var b;!function(a){}(b=a.UX||(a.UX={}))}(FormsPro||(FormsPro={}));var OfficeForm;!function(a){var b;!function(b){function c(b){return $.when.apply($,b.map(d)).done(function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.JsLoad.AllScriptsLoadDone,extraData:{scripts:b}},a.Flighting.Flights.PageInitializationVerboseLogs)}).fail(function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.JsLoad.SomeScriptsLoadFailed,extraData:{scripts:b}},a.Flighting.Flights.PageInitializationVerboseLogs)})}function d(a){return l[a]||(l[a]=c(k[a]||[]).then(function(){return e(a)}),"undefined"!=typeof Forms&&Forms.PerformanceAnalysis&&Forms.PerformanceAnalysis.requestWithPromise("script:"+a,l[a])),l[a]}function e(b){var c=$.Deferred(),d=j[b];if(!d)throw Error("No script path for "+b);var e=document.getElementsByTagName("head")[0];if(!e)return c.reject(Error("No head element found!")).promise();var f=document.createElement("script");return f.type="text/javascript",f.async=!0,f.src=d,f.onload=function(){c.resolve(),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.JsLoad.ScriptLoadFailed,extraData:{name:b}},a.Flighting.Flights.PageInitializationVerboseLogs)},f.onerror=function(g){e.removeChild(f),c.reject(Error("Failed to load javascript file: "+d)),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.JsLoad.ScriptLoadFailed,extraData:{name:b,url:d,message:g&&g.message}},a.Flighting.Flights.PageInitializationVerboseLogs)},e.appendChild(f),c.promise()}function f(){var b="//cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS_HTML",c="../scripts/vendors/mathjax/MathJax.js?config=TeX-AMS_HTML";return a.EnvironmentConfig.isOsi()?c:b}function g(){var b="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.0/katex.min.js",c="../scripts/vendors/katex/katex.min.js";return a.EnvironmentConfig.isOsi()?c:b}function h(a,b){k[a]=b}a.Exports.JavaScriptLoader=b,b.loadJavaScripts=c,b.loadJavaScript=d;var i=OfficeFormServerInfo.scriptSuffix,j=("?v="+OfficeFormServerInfo.version,{"combined-design":"../Scripts/Vendors/combined/design_d8b9941.js","combined-response":"../Scripts/Vendors/combined/response_8cd7edb.js",BootStrap:a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseExternalCdn)?"//ajax.aspnetcdn.com/ajax/bootstrap/3.3.5/bootstrap.min.js":"../Scripts/Vendors/bootstrap/3.3.5/bootstrap.min.js",DataTables:"../Scripts/Vendors/DataTables."+i,Chart:"../Scripts/Vendors/Chart-2.6."+i,Clipboard:"../Scripts/Vendors/clipboard-1.7.1.min.js",ColorThief:"../Scripts/Vendors/color-thief/color-thief.min.js",Cropper_Modified:"../Scripts/Vendors/cropper/cropper.modified."+i,D3:"../Scripts/Vendors/d3/d3."+i,FileSave:"../Scripts/Vendors/FileSaver.min.js",HighCharts:"../Scripts/Vendors/highcharts/highcharts.js",HighCharts_More:"../Scripts/Vendors/highcharts/highcharts-more.js",Ivy:"//edera.cloudapp.net/javascripts/api/ivy.js",JQuery_RateIt:"../Scripts/Vendors/rating-1.0.22/jquery.rateit."+i,JQuery_Picker:"../Scripts/Vendors/pickadate-3.5.6/picker."+i,JQuery_Picker_Date:"../Scripts/Vendors/pickadate-3.5.6/picker.date."+i,JQuery_Picker_Time:"../Scripts/Vendors/pickadate-3.5.6/picker.time."+i,JQuery_QRCode:"../Scripts/Vendors/jquery.qrcode.min.js",Katex:g(),Linkify:"../Scripts/Vendors/linkify/linkify.min.js",Linkify_JQuery:"../Scripts/Vendors/linkify/linkify-jquery.min.js",MathJax:f(),MathQuill:"../Scripts/Vendors/mathquill/mathquill."+i,Mark:"../Scripts/Vendors/markjs-8.9.0/mark."+i,SignalR:"../Scripts/Vendors/SignalR/jquery.signalR-2.2.0.min.js",Sortable:"../Scripts/Vendors/sortablejs-1.5.1/Sortable.modified."+i,WordCloud:"../Scripts/Vendors/highcharts/wordcloud.js",Xlsx:"../Scripts/Vendors/xlsx.core.min.js"}),k={};h("JQuery_Picker_Date",["JQuery_Picker"]),h("JQuery_Picker_Time",["JQuery_Picker"]),h("Linkify_JQuery",["Linkify"]),h("WordCloud",["HighCharts"]),h("HighCharts_More",["HighCharts"]);var l={}}(b=a.JavaScriptLoader||(a.JavaScriptLoader={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(b){this.margin=10,this.containerWidth=b,this.maxImageRatio=b/a.miniHight,this.miniImageRatio=b/a.maxHight}return Object.defineProperty(a.prototype,"Margin",{get:function(){return this.margin},set:function(a){this.margin=a},enumerable:!0,configurable:!0}),a.prototype.layoutContent=function(a){for(var b=[],c=a,d=0,e=c.length,f=[];e>d;d++){var g=this.groupItems([].concat(f,c[d])),h=g.length;
0>=h||(e-1>d&&this.getSumRatio(g[h-1])<this.miniImageRatio?(f=g[h-1],g.length=h-1):f=[],b=b.concat.apply(b,g))}return b},a.prototype.groupItems=function(a){for(var b=this.groupItemsByNodeType(a),c=0;c<b.length;c++){var d=this.getRowHeight(b[c]);1===b[c].length&&b[c][0].NaturalRatio>this.maxImageRatio?(b[c][0].Height=d,b[c][0].Width=this.containerWidth-this.margin):b[c].forEach(function(a){a.Height=d,a.Width=d*a.NaturalRatio})}return b},a.prototype.groupItemsByNodeType=function(a){var b=a.filter(function(a){return a.Type===e.Folder}),c=a.filter(function(a){return a.Type===e.Image});if(b.length<=0)return this.selectAndGroupItems(c);var d=this.selectAndGroupItems(b),f=d[d.length-1],g=this.getSumRatio(f);if(g<this.miniImageRatio)for(var h=0;h<c.length&&5>h;h++){var i=c[h].NaturalRatio;if(g+i<this.miniImageRatio)g+=i,f.push(c[h]),c.splice(h--,1);else if(g+i<this.maxImageRatio){f.push(c[h]),c.splice(h,1);break}}return d.concat(this.selectAndGroupItems(c))},a.prototype.selectAndGroupItems=function(a){for(var b=[],c=[],d=0;d<a.length;d++){c.push([d]);for(var e=c.length-1,f=0;e>f;f++){var g=a[d].NaturalRatio;g+=c[f].map(function(b){return a[b].NaturalRatio}).reduce(function(a,b){return a+b},0);var h=c[f].slice(0);if(h.push(d),g<this.miniImageRatio)c.push(h);else if(g>=this.miniImageRatio&&g<=this.maxImageRatio){b.push(h.map(function(b){return a[b]}));for(var i=c.length-1;i>=0;i--)c[i].some(function(a){return h.indexOf(a)>=0})&&c.splice(i,1);break}}}for(var j=c.filter(function(a){return 1===a.length}).map(function(b){return a[b[0]]}),k=[],d=0;d<j.length;d++)k.push(j[d]),this.getSumRatio(k)>this.maxImageRatio&&(b.push(k),k=[]);return k.length>0&&b.push(k),b},a.prototype.getRowHeight=function(b){var c=this.getSumRatio(b);if(c>this.maxImageRatio&&1===b.length)return a.miniHight;if(c<this.miniImageRatio)return a.maxHight;var d=this.containerWidth-b.length*this.margin;return d/c},a.prototype.getSumRatio=function(a){return a.map(function(a){return a.NaturalRatio}).reduce(function(a,b){return a+b})},a.maxHight=200,a.miniHight=140,a}();a.LiquidLayout=b;var c=function(){function a(){}return Object.defineProperty(a.prototype,"Type",{get:function(){return e.Image},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Width",{get:function(){return this.width},set:function(a){this.width=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Height",{get:function(){return this.height},set:function(a){this.height=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalWidth",{get:function(){return this.naturalWidth},set:function(a){this.naturalWidth=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalHeight",{get:function(){return this.naturalHeight},set:function(a){this.naturalHeight=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalRatio",{get:function(){return this.naturalWidth&&this.naturalHeight?this.naturalWidth/this.naturalHeight:1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Src",{get:function(){return this.src},set:function(a){this.src=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ThumbnailSrc",{get:function(){return this.thumbnailSrc},set:function(a){this.thumbnailSrc=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Title",{get:function(){return this.title},set:function(a){this.title=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Size",{get:function(){return this.size},set:function(a){this.size=a},enumerable:!0,configurable:!0}),a}();a.ImageLayoutNode=c;var d=function(){function a(){}return Object.defineProperty(a.prototype,"Type",{get:function(){return e.Folder},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalHeight",{get:function(){return 175},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalWidth",{get:function(){return 265},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalRatio",{get:function(){return this.NaturalWidth/this.NaturalHeight},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Height",{get:function(){return this.height},set:function(a){this.height=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Width",{get:function(){return this.width},set:function(a){this.width=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Title",{get:function(){return this.title},set:function(a){this.title=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"AlbumCount",{get:function(){return this.albumCount},set:function(a){this.albumCount=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ResourceId",{get:function(){return this.resourceId},set:function(a){this.resourceId=a},enumerable:!0,configurable:!0}),a}();a.FolderLayoutNode=d;var e;!function(a){a[a.Image=0]="Image",a[a.Folder=1]="Folder"}(e=a.NodeType||(a.NodeType={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(a){this.setItems(a||[])}return a.prototype.toArray=function(){for(var a=[],b=this.head.Next;b!==this.head;b=b.Next)a.push(b.Data);return a},a.prototype.getCount=function(){return this.count},a.prototype.getById=function(a){var b=this.map[a];return b&&b.Data},a.prototype.append=function(a){this.insertBefore(a)},a.prototype.update=function(a){var b=this.getIdFromData(a),c=this.map[b];if(!c)throw Error("No matched data to update.");c.Data=a},a.prototype.getNext=function(a){var b=this.map[a];return b?b.Next.Data:void 0},a.prototype.getPrevious=function(a){var b=this.map[a];return b?b.Previous.Data:void 0},a.prototype.insertBefore=function(a,b){var c=this.getIdFromData(a);if(this.map[c])throw Error("Data with duplicate id: "+c);this.insertItemBefore({Data:a},this.map[b])},a.prototype.insertAfter=function(a,b){var c=this.getIdFromData(a);if(this.map[c])throw Error("Data with duplicate id: "+c);this.insertItemAfter({Data:a},this.map[b])},a.prototype.moveBefore=function(a,b){if(a!==b){var c=this.removeItemById(a);c&&this.insertItemBefore(c,this.map[b])}},a.prototype.moveAfter=function(a,b){if(a!==b){var c=this.removeItemById(a);c&&this.insertItemAfter(c,this.map[b])}},a.prototype.removeById=function(a){var b=this.removeItemById(a);return b&&b.Data},a.prototype.setItems=function(a){var b=this;this.count=0,this.map={},this.head={},this.head.Next=this.head.Previous=this.head,a.forEach(function(a){return b.insertItemBefore({Data:a},b.head)})},a.prototype.getIdFromData=function(a){throw Error("to be overridden.")},a.prototype.insertItemBefore=function(a,b){b=b||this.head,a.Next=b,a.Previous=b.Previous,b.Previous.Next=a,b.Previous=a,this.map[this.getIdFromData(a.Data)]=a,++this.count},a.prototype.insertItemAfter=function(a,b){b=b||this.head,a.Previous=b,a.Next=b.Next,b.Next.Previous=a,b.Next=a,this.map[this.getIdFromData(a.Data)]=a,++this.count},a.prototype.removeItemById=function(a){var b=this.map[a];return b?(b.Next.Previous=b.Previous,b.Previous.Next=b.Next,delete this.map[a],--this.count,b):void 0},a}();a.MappingList=b}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return Object.defineProperty(b,"LocalizedStrings",{get:function(){return b.localizedStrings},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UniversalHeaderAndFooter",{get:function(){return b.universalHeaderAndFooter},enumerable:!0,configurable:!0}),b.loadLocalizedStrings=function(){return b.deferredLocalizedStrings||(b.deferredLocalizedStrings=$.Deferred(),a.PageMethods.getResourceStrings(function(a){b.localizedStrings=a,b.deferredLocalizedStrings.resolve(a)},function(a){return b.deferredLocalizedStrings.reject(a)})),b.deferredLocalizedStrings.promise()},b.loadLanguageStrings=function(c){if(!c)return b.loadLocalizedStrings();var d=b.languageStrings[c];if(!d){var e=$.Deferred();d=e.then(function(a){return b.localizedStrings=a,a}),b.languageStrings[c]=d,a.PageMethods.getLocalizedResourceStrings(c,function(a){return e.resolve(a)},function(a){b.loadLocalizedStrings().done(function(a){return e.resolve(a)})})}return d},b.loadUniversalHeaderAndFooter=function(){var c=this;return b.deferredUniversalHeaderAndFooter||(b.deferredUniversalHeaderAndFooter=$.Deferred(),a.PageMethods.getUniversalHeaderAndFooter("headerId=OfficeFormsHeader&footerid=OfficeFormsFooter",function(a){c.universalHeaderAndFooter=a,b.deferredUniversalHeaderAndFooter.resolve(a)},function(a){return b.deferredUniversalHeaderAndFooter.reject(a)})),b.deferredUniversalHeaderAndFooter.promise()},b.languageStrings={},b}();b.Resources=c,a.Exports.Resources=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a,b){l("TryAcquireToken",void 0,void 0,a,b)}function d(a,b,c){var d="GetResourceStrings",e=void 0;a&&(e="lang="+a),l(d,e,void 0,b,c)}function e(b,c){var e=a.EnvironmentConfig.getExplictLocale();return d(e,b,c)}function f(a,b){l("GetRefreshedAntiForgeryToken",void 0,void 0,function(b){OfficeFormServerInfo.antiForgeryToken=b,a&&a()},b)}function g(a,b){l("GetUserInfo",void 0,void 0,function(b){OfficeFormServerInfo.userInfo=b,a&&a()},b)}function h(a){return k("GetUserInfo",void 0,void 0,j(a)).then(function(a){a&&(OfficeFormServerInfo.userInfo=a)})}function i(a){return k("GetFlights",void 0,void 0,j(a)).then(function(a){a&&(OfficeFormServerInfo.flights=a)})}function j(a){return{Accept:"application/json",Authorization:a?"Bearer "+a:""}}function k(b,c,d,e){var f;f="/"===window.location.pathname?"/Default.aspx/"+b:window.location.pathname+"/"+b,c&&(f+="?"+c);var g=new a.Event.QosEvent(a.Event.QosEventNames.ServiceEndpoints.PageMethod.MethodNameFormat.format(b));return g.start(),$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:f,data:d||"{}",dataType:"json",headers:e}).then(function(b){return g.end({resultType:a.Event.ResultType.Success}),b.d},function(c,d,e){return g.end({resultType:a.Event.ResultType.Failure,extraData:{url:f,message:e}}),{message:e,name:"PageMethod CallWebMethod Failure: "+b}})}function l(a,b,c,d,e){k(a,b,c,void 0).done(d).fail(e)}function m(b,c,d){var e=a.EnvironmentConfig.getExplictLocale()||navigator.language,f="https://uhf.microsoft.com/"+e+"/shell/xml/OfficeForms";b&&(f+="?"+b),$.ajax({type:"GET",url:f,dataType:"xml",success:function(a){c&&c(a)},error:function(b){d&&d(b),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Error.UHF.UniversalHeaderAndFooterError,extraData:{error:b}})}})}b.tryAcquireToken=c,b.getLocalizedResourceStrings=d,b.getResourceStrings=e,b.refreshAntiForgeryToken=f,b.refreshUserInfo=g,b.refreshUserInfoWithToken=h,b.refreshFlightsWithToken=i,b.getUniversalHeaderAndFooter=m}(b=a.PageMethods||(a.PageMethods={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){function b(a,b,c){c&&c.stack&&console.log(c.stack);try{if(window.onerror){var d=ReactDOM.findDOMNode(a),e=d&&d.getAttribute("data-reactId")||"",f="Exception in "+a.constructor.name+"["+e+"]:"+b+".";c.message&&(f+=" Message: "+c.message),window.onerror(f,"",0,0,c)}}catch(c){}}function c(a){e.forEach(function(c){var d=a[c];d&&(a[c]=function(){try{return d.apply(a,arguments)}catch(e){return b(a,c,e),null}})})}var d=function(a){function b(b){var d=a.call(this,b)||this;return d.state={},c(d),d}return __extends(b,a),b}(React.Component);a.ReactComponent=d;var e=["componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount","render"]}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(){}return a.getId=function(b){return a.currentIds[b]||(a.currentIds[b]=1),b+a.currentIds[b]++},a.getLabelId=function(){return a.getId("l")},a.getDropdownId=function(){return a.getId("Dropdown")},a.currentIds={},a}();a.UniqueIdentifier=b}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){function b(){return c||new d}var c;a.getUserRepository=b;var d=function(){function b(){this.users={}}return b.prototype.usersStateChange=function(a){this.usersStateChangeCallback=a},b.prototype.getUser=function(a){return _.clone(this.users[a])},b.prototype.getAllUsers=function(){return _.values(a.Utilities.deepClone(this.users))},b.prototype.getUserCount=function(){return _.keys(this.users).length},b.prototype.addOrUpdateUser=function(a){if(b.isValidUser(a)){var c=this.users[a.userId];if(null!=c){if(b.isValidUser(c))return;_.extend(c,a)}else this.users[a.userId]=a;this.usersStateChangeCallback()}},b.prototype.removeUser=function(a){delete this.users[a.userId]&&this.usersStateChangeCallback()},b.prototype.removeAllUsers=function(){this.getUserCount()>0&&(this.users={},this.usersStateChangeCallback())},b.isValidUser=function(a){return a&&a.userId&&a.displayName&&a.firstName&&a.lastName&&a.email&&a.imageUri?!0:!1},b}();a.UserRepository=d}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(f,__assign({},a))}function d(a){var b;b=_.clone(a)||{},b.children=a.Text;var d=b.HTMLAttributes&&b.HTMLAttributes.title;return!d&&a.Text&&(b.HTMLAttributes=_.clone(b.HTMLAttributes)||{},b.HTMLAttributes.title=a.Text),c(b)}var e;!function(a){a[a.None=0]="None",a[a.LightBackground=1]="LightBackground",a[a.DarkBackGround=2]="DarkBackGround"}(e=b.ButtonStyle||(b.ButtonStyle={})),b.createButton=c;var f=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=_.extend({},this.props.HTMLAttributes);switch(b.className=a.Utilities.Html.combineAttributes(b.className,"button-control"),b["aria-pressed"]=this.props.ToggleActive,this.props.ToggleActive&&(b.className=a.Utilities.Html.combineAttributes(b.className,"active")),this.props.ButtonStyle){case e.LightBackground:case"LightBackground":b.className=a.Utilities.Html.combineAttributes(b.className,"light-background-button");break;case e.DarkBackGround:case"DarkBackGround":b.className=a.Utilities.Html.combineAttributes(b.className,"dark-background-button");break;case e.None:case"None":}return React.createElement("button",__assign({},b),React.createElement("div",{className:"button-content"},this.props.children))},c.prototype.focus=function(){var a=ReactDOM.findDOMNode(this);a.focus()},c}(a.ReactComponent);b.Button=f,b.createTextButton=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}var d;!function(a){a[a.Bar=0]="Bar",a[a.Pie=1]="Pie"}(d=b.ChartType||(b.ChartType={})),b.createChartControl=c;var e=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;return a.backgroundColors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a.highlightColors=[],a}return __extends(e,c),e.prototype.render=function(){return this.isValidChart()?React.createElement("div",{"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_GroupContainer,className:"chart-control-container",tabIndex:-1},this.createChartLegend(),this.createChartCanvas()):null},e.prototype.componentDidMount=function(){this.updateChartDataView()},e.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},e.prototype.componentDidUpdate=function(){this.updateChartDataView()},e.prototype.componentWillUnmount=function(){this.destroyChart()},e.prototype.isValidChart=function(){return this.props.Labels&&this.props.Data&&this.props.Labels.length===this.props.Data.data.length&&this.props.Labels.length>0},e.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},e.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");switch(this.generateColors(),this.props.Type){case d.Bar:this.createBarChart(b),this.setChartLegend();break;case d.Pie:this.createPieChart(b),this.setChartLegend()}}}},e.prototype.getChartCanvasLabels=function(){return this.props.Labels?this.props.Labels.map(function(c,d){return null!=c.labelName?b.RichTextUtil.stripSupportedTagsButLeaveDangerousOnes(c.labelName):a.Form.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(d+1)}):void 0},e.prototype.createBarChart=function(a){var b="'wf_segoe-ui_light', 'Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma, Arial, sans-serif",c={responsive:!1,layout:{padding:{left:10}},animation:{duration:1e3},scales:{yAxes:[{ticks:{fontSize:10,min:0,fontFamily:b,fontColor:"#000000",callback:function(a){return a%1===0?a:void 0}}}],xAxes:[{ticks:{fontSize:10,fontFamily:b,fontColor:"#000000",callback:function(){return""}}}]},legend:{display:!1}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"bar",data:this.generateChartData(),options:c})},e.prototype.generateColors=function(){var a=this;this.usingColors=this.props.Data.data.map(function(b,c){var d=a.backgroundColors[c%a.backgroundColors.length];return a.highlightColors.push(a.lightenDarkenColor(d,10)),d})},e.prototype.generateChartData=function(){var a={labels:this.getChartCanvasLabels(),datasets:[{backgroundColor:this.usingColors,data:this.props.Data.data,hoverBackgroundColor:this.highlightColors}]};return a},e.prototype.createPieChart=function(a){var b={responsive:!1,animation:{duration:1e3},cutoutPercentage:0,tooltips:{callbacks:{label:function(a,b){return b.labels[a.index]+": "+b.datasets[a.datasetIndex].data[a.index]+" ("+Math.round(this._active[0]._view.circumference/6.283*100)+"%)"}}},legend:{display:!1}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"pie",data:this.generateChartData(),options:b})},e.prototype.lightenDarkenColor=function(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)},e.prototype.setChartLegend=function(){var a=this;if(this.props.HasLegend){var b=ReactDOM.findDOMNode(this.refs["legend-table"]),c=ReactDOM.findDOMNode(this.refs["legend-table-tbody"]),d=c.childNodes;d&&d.length>0&&(_.each(d,function(b,c){Chart.helpers.addEvent(b,"mouseover",function(){a.handleEvent("mouseover",c)});var d=b.getElementsByClassName("chart-control-legend-canvas-color");if(d){var e=d[0].getContext("2d");e.fillStyle=a.chartInstance.data.datasets[0].backgroundColor[c],e.beginPath(),e.arc(7.5,7.5,7.5,0,2*Math.PI,!0),e.closePath(),e.fill()}}),Chart.helpers.addEvent(b,"mouseout",function(){a.handleEvent("mouseout",0)}))}},e.prototype.handleEvent=function(a,b){this.chartInstance.active="mouseout"===a?[]:[this.chartInstance.getDatasetMeta(0).data[b]],this.chartInstance.lastActive=this.chartInstance.lastActive||[],this.chartInstance.lastActive.length&&this.chartInstance.updateHoverStyle(this.chartInstance.lastActive,this.chartInstance.options.hover.mode,!1),this.chartInstance.active.length&&this.chartInstance.updateHoverStyle(this.chartInstance.active,this.chartInstance.options.hover.mode,!0);var c=!Chart.helpers.arrayEquals(this.chartInstance.active,this.chartInstance.lastActive);if(c){this.chartInstance.lastActive=this.chartInstance.active;var d=this.chartInstance.tooltip;d._active=this.chartInstance.active,d._lastActive=d._lastActive||[],d.update(!0),d.pivot();var e=this.chartInstance._bufferedRequest;e?this.chartInstance.render(e.duration,e.lazy):c&&!this.chartInstance.animating&&(this.chartInstance.stop(),this.chartInstance.render(this.chartInstance.options.hover.animationDuration,!0)),this.chartInstance._bufferedRender=!1,this.chartInstance._bufferedRequest=null}},e.prototype.createChartLegend=function(){var c=this;return this.props.HasLegend?React.createElement("div",{"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_LegendGroup,className:"chart-control-legend",tabIndex:-1},React.createElement("table",{className:"chart-control-legend-table",ref:"legend-table"},React.createElement("tbody",{ref:"legend-table-tbody"},this.props.Labels.map(function(a,d){return React.createElement("tr",{className:"chart-control-legend-table-row",key:d},React.createElement("td",{role:"presentation"},React.createElement("canvas",{role:"presentation",className:"chart-control-legend-canvas-color",width:"15px",height:"15px"})),React.createElement("td",{role:"presentation",className:"chart-control-legend-label"},null!=a.displayElement?a.displayElement:React.createElement(b.UserTextRenderer,{Text:a.labelName,RenderMode:b.UserTextRenderMode.RichText})),React.createElement("td",{role:"presentation",className:"chart-control-legend-value"},c.props.Data.data[d]),c.getLegendCorrectTag(a.labelName))})))):void 0},e.prototype.createChartCanvas=function(){var b,c={className:"chart-control",tabIndex:-1,"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_ChartGroup},e=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),f=e?187:250,g=e?300:400;return b=this.props.Type===d.Bar?{role:"presentation",className:"chart-control-canvas",width:g,height:f,ref:"canvas"}:{role:"presentation",className:"",width:300,height:150,ref:"canvas"},React.createElement("div",__assign({},c),React.createElement("canvas",__assign({},b)))},e.prototype.getLegendCorrectTag=function(c){var d,e={role:"presentation",className:"chart-control-legend-table-correct",title:this.props.TagLabels[c]?a.Form.Resources.LocalizedStrings.Quiz_CorrectAnswer:void 0};return this.props.TagLabels[c]&&(d=React.createElement(b.FontIconControl,{IconName:"CheckMark",HTMLAttributes:{className:"forms-icon-size14x14"}})),React.createElement("td",__assign({},e),d)},e}(a.ReactComponent);b.ChartControl=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=_.extend({},this.props.HTMLAttributes);return this.props.ValidationStyle&&(b.className=a.Utilities.Html.combineAttributes(b.className,this.props.ValidationStyle)),this.props.Hidden&&(b.style=b.style||{},b.style.display="none"),(c=React.DOM).div.apply(c,[b].concat(this.createReactNodes()));var c},c.prototype.createReactNodes=function(){throw Error("to be overridden.")},c}(a.ReactComponent);b.ControlBase=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createCheckBox=c;var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.name=void 0,a}return __extends(d,c),d.prototype.componentWillMount=function(){this.props.RadioCheckbox&&(this.name=a.Utilities.Guid.newGuid())},d.prototype.createReactNodes=function(){var c=this.props,d=c.RadioCheckbox?"radio":"checkbox",e=c.Options,f=a.Utilities.Html.combineAttributes(d,e&&e.classNameForInnerDiv),g=e&&e.classNameForInnerLabel,h=c.Disabled,i=c.HelpText||void 0,j=a.Utilities.Html.mergeReactProps(e&&e.HTMLPropsForInnerElement,{checked:c.Value,disabled:h,name:this.name,type:d,onChange:this.onChange.bind(this),className:this.props.ClassName,ref:this.props.CheckboxRef,autoFocus:c.CheckboxAutoFocus}),k=([].concat(c.children),React.DOM.label({className:g,disabled:h},React.DOM.input(j),React.DOM.span({className:this.props.SpanClassName},c.Description),c.ShowRequiredStar?React.createElement(b.RequiredStar):void 0));return[React.DOM.div({className:f,id:c.Id,disabled:h,title:i},k,c.children)]},d.prototype.onChange=function(a){this.props.onValueChange(a.nativeEvent.target.checked)},d}(b.ControlBase)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function a(){}return Object.defineProperty(a,"None",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Success",{get:function(){return"has-success"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Warning",{get:function(){return"has-warning"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Error",{get:function(){return"has-error"},enumerable:!0,configurable:!0}),a}();b.ValidationStyles=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.render=function(){return React.DOM.span({className:"required-star"})},b}(a.ReactComponent);b.RequiredStar=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.Control=b}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}var d;!function(a){a[a.DatePicker=0]="DatePicker",a[a.TimePicker=1]="TimePicker",a[a.DateTimePicker=2]="DateTimePicker"}(d=b.PickerType||(b.PickerType={})),b.createDateTimePicker=c;var e=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}return __extends(e,c),e.prototype.createReactNodes=function(){var a=this.props,b=a.Options,c=b&&b.classNameForInnerDiv,d=b&&b.classNameForInnerLabel,e=a.Disabled;return[a.Label?React.DOM.span({className:d,disabled:e},a.Label):void 0,React.DOM.div({className:c,disabled:e},this.hasDatePicker()?this.createDatePicker():void 0,this.hasTimePicker()?this.createTimePicker():void 0,a.children)]},e.prototype.componentWillMount=function(){void 0===e.timeFormat&&this.hasTimePicker()&&(e.timeFormat=OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern,e.timeFormat=e.timeFormat.replace(/mm/g,"i").replace(/tt/g,"A").replace(/s/g,"0"),(e.timeFormat.indexOf("m")>=0||e.timeFormat.indexOf("t")>=0)&&(e.timeFormat=null))},e.prototype.componentDidMount=function(){var b=this,c=a.Form.Resources.LocalizedStrings;if(this.hasDatePicker()){var d=ReactDOM.findDOMNode(this.refs.date_picker),f=$(d).pickadate({monthsShort:OfficeFormServerInfo.cultureInfo.DateTimeFormat.AbbreviatedMonthNames,weekdaysShort:OfficeFormServerInfo.cultureInfo.DateTimeFormat.AbbreviatedDayNames,firstDay:OfficeFormServerInfo.cultureInfo.DateTimeFormat.FirstDayOfWeek,today:c.DateTimePicker_Button_Today||void 0,clear:this.props.ShowClearButton?c.DateTimePicker_Button_Clear||void 0:"",close:c.DateTimePicker_Button_Close||void 0,labelMonthNext:c.DateTimePicker_Label_NextMonth||void 0,labelMonthPrev:c.DateTimePicker_Label_PrevMonth||void 0,labelMonthSelect:c.DateTimePicker_Label_SelectMonth||void 0,labelYearSelect:c.DateTimePicker_Label_SelectYear||void 0,closeOnClear:!1,editable:!0,selectYears:200,selectMonths:!1,showMonthsShort:!0,onSet:function(c){if(void 0!==c.clear)return void b.setDate(void 0);if(null!=c.select){var d;d=a.Utilities.Type.isNumber(c.select)?new Date(c.select):c.select.obj,b.setDate(d)}}});this.datePicker=f.pickadate("picker")}if(this.hasTimePicker()){var g=ReactDOM.findDOMNode(this.refs.time_picker),h=$(g).pickatime({clear:"",format:e.timeFormat,editable:!0,interval:30,select:this.getTimeNumber(),onSet:function(c){if(null!=c.select){var d;if(b.hasDatePicker()){var e,f,g=new Date(b.props.Value);a.Utilities.Type.isNumber(c.select)?(e=c.select%60,f=(c.select-e)/60):(f=c.select.hour,e=c.select.mins),g.setHours(f,e,0,0),d=g.toJSON()}else d=c.select.toString();b.props.Value!==d&&(b.props.onValueChange(d),b.forceUpdate())}}});this.timePicker=h.pickatime("picker")}this.updateDateTimePickers()},e.prototype.componentDidUpdate=function(){this.updateDateTimePickers()},e.prototype.createDatePicker=function(){var c=this,d=this.props,e=d.Options&&d.Options.HTMLPropsForInnerElement;return React.DOM.div({className:"office-form-date-time-picker office-form-theme-focus-border"},React.DOM.input(a.Utilities.Html.mergeReactProps(e,{className:"form-control border-no-radius datepicker",disabled:d.Disabled,placeholder:d.Placeholder||OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern,ref:"date_input",onFocus:function(){d.onValueValidation&&d.onValueValidation(!0,!0)},onBlur:function(){var a=ReactDOM.findDOMNode(c.refs.date_input),b=a.value,d=c.props;if(""===b&&null!=d.Value&&d.ShowClearButton)c.datePicker.clear(),c.setDate(void 0);else if(b&&b!==c.getDateString()){var e=Date.parseDate(b,OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern,OfficeFormServerInfo.cultureInfo);null==e?d.onValueValidation&&d.onValueValidation(!1,!0):c.setDate(e)}},onClick:function(){d.Disabled||c.datePicker.open()},onKeyUp:a.Utilities.Html.onKeyboardEvent(function(a){return a.stopPropagation()},a.KeyCode.Esc)})),b.createGlyphButton({ButtonStyle:b.ButtonStyle.LightBackground,GlyphButtonStyle:b.GlyphButtonStyle.GlyphOnly,Icon:"Calendar",IconClassName:"dateIcon forms-icon-size20x20",HTMLAttributes:{disabled:d.Disabled,tabIndex:-1,onClick:function(){d.Disabled||c.datePicker.open()},title:d.DateTitle,"aria-label":d.DateTitle}}),React.DOM.input({ref:"date_picker",style:{display:"none"}}))},e.prototype.createTimePicker=function(){var c=this,d=this.props;return React.DOM.div({className:"office-form-date-time-picker office-form-theme-focus-border"},React.DOM.input({className:"form-control border-no-radius datepicker",disabled:d.Disabled,placeholder:OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern,readOnly:!0,tabIndex:-1,ref:"time_picker",onFocus:function(){d.onValueValidation&&d.onValueValidation(!0,!1)},onBlur:function(){var a=ReactDOM.findDOMNode(c.refs.time_picker),b=a.value;if(b&&b!==c.getTimeString()){var d=c.props,e=void 0;e=c.hasDatePicker()?new Date(d.Value):new Date;var f=Date.parseTime(b,OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern,OfficeFormServerInfo.cultureInfo);if(isNaN(f))d.onValueValidation&&d.onValueValidation(!1,!1);else{var g=Math.floor(f/1e3/60/60),h=f/1e3/60%60,i=f/1e3%60;e.setHours(g,h,i),c.setDate(e,!0)}}},onKeyUp:a.Utilities.Html.onKeyboardEvent(function(a){return a.stopPropagation()},a.KeyCode.Esc)}),b.createGlyphButton({ButtonStyle:b.ButtonStyle.LightBackground,GlyphButtonStyle:b.GlyphButtonStyle.GlyphOnly,Icon:"ChevronDown",IconClassName:"dateCaretDown forms-icon-size16x16",HTMLAttributes:a.Utilities.Html.mergeReactProps(d.Options&&d.Options.HTMLPropsForInnerElement,{disabled:d.Disabled,onClick:function(){d.Disabled||c.timePicker.open()},title:d.TimeTitle,"aria-label":d.TimeTitle})}))},e.prototype.hasDatePicker=function(){return this.props.Type!==d.TimePicker},e.prototype.hasTimePicker=function(){return this.props.Type!==d.DatePicker},e.prototype.isValueInvalid=function(){var a=this.props.Value;return this.hasDatePicker()?isNaN(Date.parse(a)):isNaN(Number(a))},e.prototype.getDateNumber=function(){if(!this.hasDatePicker()||this.isValueInvalid())return void 0;if(this.props.IsLocaleInvariant){var a=e.parseLocaleInvariantString(this.props.Value);return a.valueOf()}return Date.parse(this.props.Value)},e.prototype.getDateString=function(){if(!this.hasDatePicker())return void 0;if(this.isValueInvalid())return"";var a=this.props.IsLocaleInvariant?Date.parseDate(this.props.Value,"yyyy-MM-dd",OfficeFormServerInfo.cultureInfo):new Date(this.props.Value);return a.toDateShortString(OfficeFormServerInfo.cultureInfo)},e.prototype.getTimeNumber=function(){if(!this.hasTimePicker()||this.isValueInvalid())return void 0;if(this.hasDatePicker()){var a=new Date(this.props.Value);return 60*a.getHours()+a.getMinutes()}return parseInt(this.props.Value)},e.prototype.getTimeString=function(){if(!this.hasTimePicker())return void 0;if(this.isValueInvalid())return"";var a=new Date(this.props.Value);return a.toLocaleTimeString(OfficeFormServerInfo.cultureInfo.Name)},e.prototype.setDate=function(a,b){var c=this.props,d=void 0;if(null!=a){var f=new Date(c.Value);f.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),b&&f.setHours(a.getHours(),a.getMinutes(),a.getSeconds()),d=c.IsLocaleInvariant?e.formatLocaleInvariantString(f,!this.hasTimePicker()):f.toJSON()}c.Value!==d&&(c.onValueChange(d),this.forceUpdate())},e.prototype.updateDateTimePickers=function(){var b=this.props,c=new Date(b.Value),d={
Start:void 0,End:void 0},e=!1,f=!1;if(b.AllowedDateTime&&(b.AllowedDateTime.Start&&(d.Start=new Date(b.AllowedDateTime.Start.toJSON()),d.Start.setMinutes(60,0,0),e=a.Utilities.DateTime.isLocalDateEqual(d.Start,c),a.Utilities.DateTime.compareLocalTime(d.Start,c)>0&&d.Start.setDate(d.Start.getDate()+1)),b.AllowedDateTime.End&&(d.End=new Date(b.AllowedDateTime.End.toJSON()),d.End.setMinutes(0,0,0),f=a.Utilities.DateTime.isLocalDateEqual(d.End,c),a.Utilities.DateTime.compareLocalTime(d.End,c)<0&&d.End.setDate(d.End.getDate()-1))),this.hasDatePicker()){this.datePicker.set({min:void 0!==d.Start&&d.Start,max:void 0!==d.End&&d.End,select:this.getDateNumber()});var g=ReactDOM.findDOMNode(this.refs.date_input);g.value=this.getDateString()}this.hasTimePicker()&&this.timePicker.set({min:e&&d.Start,max:f&&d.End,select:this.getTimeNumber()})},e.formatLocaleInvariantString=function(a,b){var c=new Date;c.setUTCFullYear(a.getFullYear(),a.getMonth(),a.getDate()),c.setUTCHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());var d=c.toISOString();return d.slice(0,d.indexOf(b?"T":"Z"))},e.parseLocaleInvariantString=function(a){var b=new Date(a);return b.setFullYear(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()),b.setHours(b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),b.getUTCMilliseconds()),b},e.parseJSONArray=function(a){try{var b=JSON.parse(a);if(Array.isArray(b))return b}catch(c){}return void 0},e}(b.ControlBase)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createFontIconControl=c;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=_.clone(this.props.HTMLAttributes)||{};return b.className=a.Utilities.Html.combineAttributes("ms-Icon",this.props.IconName?"ms-Icon--"+this.props.IconName:"",b.className),this.props.Accessible||(b.role="presentation",b["aria-hidden"]="true"),React.createElement("i",__assign({},b))},c}(a.ReactComponent);b.FontIconControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){function b(b){return a.createMathjaxFormulaRenderer(b)}a.createFormulaRenderer=b}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createMathjaxFormulaRenderer=c;var d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.mounted=!0,a}return __extends(c,b),c.prototype.componentWillMount=function(){var b=this;a.JavaScriptLoader.loadJavaScript("MathJax").done(function(){b.mounted&&b.setState({MathJaxLoaded:!0})})},c.prototype.componentDidMount=function(){this.state.MathJaxLoaded&&this.props.Formula&&this.renderFormula()},c.prototype.componentDidUpdate=function(){this.state.MathJaxLoaded&&this.props.Formula&&this.renderFormula()},c.prototype.componentWillUnmount=function(){this.mounted=!1},c.prototype.shouldComponentUpdate=function(a,b){return a.Formula!==this.props.Formula||b.MathJaxLoaded!==this.state.MathJaxLoaded},c.prototype.render=function(){if(this.props.Formula){var a="formula-renderer-container unselectable-text";return c.isSafari9&&(a+=" formula-renderer-container-safari9"),React.createElement("div",{className:a,"aria-hidden":"true",onContextMenu:function(){return!1}},React.createElement("div",{className:"formula-loading",ref:"formulaLoading"},React.createElement("div",{className:"spinner-tile-animation"})),React.createElement("span",{className:"NotVisible",ref:"formulaElement"},this.props.Formula?"$"+this.props.Formula+"$":""))}return React.createElement("div",{className:"formula-renderer-container"})},c.prototype.renderFormula=function(){var b=this,c=function(c){var d=ReactDOM.findDOMNode(b.refs.formulaElement);if(!d)return void(c&&c());var f=b.props.Formula,g=e.get(f);return g?(b.hideSpinnerAndShowFormula(d),d.innerHTML=g.dom,b.props.onRenderComplete&&b.props.onRenderComplete(g.originalText,g.mathML),void(c&&c())):(MathJax.Hub.Queue(["Typeset",MathJax.Hub,d]),void MathJax.Hub.Queue(function(){if(b.mounted){b.hideSpinnerAndShowFormula(d);var g=MathJax.Hub.getAllJax(d),h=null,i=null;if(g.length>0)try{h=g[0].root.toMathML(""),i=g[0].originalText}catch(j){a.Utilities.assert(!1,"Failed to get mathML:"+f)}e.set(f,{dom:d.innerHTML,originalText:i,mathML:h}),b.props.onRenderComplete&&b.props.onRenderComplete(i,h)}c&&c()}))};e.get(this.props.Formula)?c(null):f.enqueue(this.props.Formula,c)},c.prototype.hideSpinnerAndShowFormula=function(a){var b=ReactDOM.findDOMNode(this.refs.formulaLoading);b&&(b.className="dn"),a.className=""},c.isSafari9=a.Utilities.isSafari9(),c}(a.ReactComponent);b.MathjaxFormulaRenderer=d;var e=function(){function a(){}return a.set=function(b,c){if(b&&!a.cache[b]&&(a.order.push(b),a.cache[b]=c,a.order.length>a.cacheLimit)){var d=a.order.shift();delete a.cache[d]}},a.get=function(b){return b?a.cache[b]:null},a.cacheLimit=200,a.cache={},a.order=[],a}(),f=function(){function b(){}return b.enqueue=function(a,c){b.priorityMap[a]?(b.priorityMap[a].count++,b.internalEnqueue({key:a,priority:b.priorityMap[a].priority,task:c})):(b.currentPriority++,b.priorityMap[a]={priority:b.currentPriority,count:1},b.internalEnqueue({key:a,priority:b.currentPriority,task:c}))},b.internalEnqueue=function(a){b.queue.push(a),b.bubbleUp(b.queue.length-1),b.isProcessing||b.process()},b.process=function(){b.isProcessing=!0,b.queue[0].task(b.onRenderComplete)},b.onRenderComplete=function(){var c=b.queue.shift().key;b.priorityMap[c].count--,0===b.priorityMap[c].count&&delete b.priorityMap[c],b.queue.length>0?b.process():(a.Utilities.assert(_.isEqual(b.priorityMap,{}),"FormulaRenderQueue: priority map should be empty"),b.isProcessing=!1,b.currentPriority=0)},b.bubbleUp=function(a){for(var c=b.getParent(a);c>=0&&b.queue[c].priority>b.queue[a].priority;)b.swap(c,a),a=c,c=b.getParent(a)},b.swap=function(a,c){var d=b.queue[a];b.queue[a]=b.queue[c],b.queue[c]=d},b.getParent=function(a){return Math.floor((a-1)/2)},b.queue=[],b.priorityMap={},b.currentPriority=0,b.isProcessing=!1,b}()}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(c){var f=_.clone(c)||{};switch(f.HTMLAttributes=_.clone(f.HTMLAttributes)||{},c.GlyphButtonStyle){case d.Vertical:case"Vertical":f.HTMLAttributes.className=a.Utilities.Html.combineAttributes(f.HTMLAttributes.className,"glyph-button-control-vertical");break;case d.GlyphOnly:case"GlyphOnly":case d.Horizontal:case"Horizontal":default:f.HTMLAttributes.className=a.Utilities.Html.combineAttributes(f.HTMLAttributes.className,"glyph-button-control-horizontal")}!f.HTMLAttributes.title&&c.Text&&(f.HTMLAttributes.title=c.Text),!f.HTMLAttributes["aria-label"]&&c.Text&&(f.HTMLAttributes["aria-label"]=c.Text);var g;if(c.Icon){var h={HTMLAttributes:{className:c.IconClassName},IconName:c.Icon,key:"icon"};g=React.createElement(b.FontIconControl,__assign({},h))}f.ButtonStyle=c.ButtonStyle;var i;switch("GlyphOnly"!==c.GlyphButtonStyle&&c.GlyphButtonStyle!==d.GlyphOnly&&(i=React.DOM.span({className:c.TextClassName,key:"text"},c.Text)),c.GlyphLocation){case e.Right:f.children=[i,c.children,g];break;case e.Left:default:f.children=[g,i,c.children]}return b.createButton(f)}var d;!function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.GlyphOnly=2]="GlyphOnly"}(d=b.GlyphButtonStyle||(b.GlyphButtonStyle={}));var e;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"}(e=b.GlyphLocation||(b.GlyphLocation={})),b.createGlyphButton=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.Bar=0]="Bar",a[a.Pie=1]="Pie",a[a.PieMainOthers=2]="PieMainOthers"}(c=b.InsightChartType||(b.InsightChartType={}));var d=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;return a.backgroundColors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a.highlightColors=[],a}return __extends(d,b),d.prototype.render=function(){if(this.isValidChart()){var a={className:"insight-chart-control-container",tabIndex:-1};return React.createElement("div",__assign({},a),this.createChartCanvas())}return null},d.prototype.componentDidMount=function(){this.updateChartDataView()},d.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},d.prototype.componentDidUpdate=function(){this.updateChartDataView()},d.prototype.componentWillUnmount=function(){this.destroyChart()},d.prototype.isValidChart=function(){return this.props.Labels&&this.props.DataSets&&this.props.Labels.length>0},d.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},d.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");switch(this.props.Type){case c.Bar:this.generateBarColors(),this.createBarChart(b);break;case c.PieMainOthers:case c.Pie:this.generatePieColors(),this.createPieChart(b)}}}},d.prototype.createBarChart=function(a){var b="'wf_segoe-ui_light', 'Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma, Arial, sans-serif",c={responsive:!1,layout:{padding:{left:10}},animation:{duration:1e3},scales:{yAxes:[{ticks:{fontSize:10,min:0,fontFamily:b,fontColor:"#000000"}}],xAxes:[{ticks:{fontSize:10,fontFamily:b,fontColor:"#000000"}}]},legend:{display:!0}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"bar",data:this.generateBarChartData(),options:c})},d.prototype.generateBarColors=function(){var a=this;this.usingColors=this.props.DataSets.map(function(b,c){var d=a.backgroundColors[c%a.backgroundColors.length];return a.highlightColors.push(a.lightenDarkenColor(d,10)),d})},d.prototype.generatePieColors=function(){var a=this;this.props.Type===c.PieMainOthers?(this.usingColors=["#FFC000","#CFCFCF"],this.highlightColors=this.usingColors.map(function(b){return a.lightenDarkenColor(b,10)})):this.usingColors=this.props.Labels.map(function(b,c){var d=a.backgroundColors[c%a.backgroundColors.length];return a.highlightColors.push(a.lightenDarkenColor(d,10)),d})},d.prototype.generateBarChartData=function(){var a=this,b={labels:this.props.Labels,datasets:this.props.DataSets.map(function(b,c){return{label:b.Label,data:b.Data,backgroundColor:a.usingColors[c],hoverBackgroundColor:a.highlightColors[c]}})};return b},d.prototype.generatePieChartData=function(){var a=this,b={labels:this.props.Labels,datasets:this.props.DataSets.map(function(b){return{backgroundColor:a.usingColors,data:b.Data,hoverBackgroundColor:a.highlightColors}})};return b},d.prototype.createPieChart=function(a){var b={responsive:!1,animation:{duration:1e3},cutoutPercentage:0,tooltips:{callbacks:{label:function(a,b){return b.labels[a.index]+": "+b.datasets[a.datasetIndex].data[a.index]+" ("+Math.round(this._active[0]._view.circumference/6.283*100)+"%)"}}},legend:{display:!0,position:"bottom",labels:{boxWidth:15}}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"pie",data:this.generatePieChartData(),options:b})},d.prototype.lightenDarkenColor=function(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)},d.prototype.createChartCanvas=function(){var b={className:"insight-chart-control",tabIndex:-1},c=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),d=c?187:250,e=c?300:400,f={className:"insight-chart-control-canvas",width:e,height:d,ref:"canvas"};return React.createElement("div",__assign({},b),React.createElement("canvas",__assign({},f)))},d}(a.ReactComponent);b.InsightChartControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){var b=d(a);return e(b)}function c(a){return f.openingTags.forEach(function(b){a=a.replaceAll(b,"")}),f.closingTags.forEach(function(b){a=a.replaceAll(b,"")}),a}function d(a){var b=_.escape(a);return f.tagNames.forEach(function(a,c){b=b.replaceAll(f.encodedOpeningTags[c],f.openingTags[c]).replaceAll(f.encodedClosingTags[c],f.closingTags[c])}),b}function e(a){var b=document.createElement("span");return b.innerHTML=a,a=b.innerHTML}var f=function(){function a(){}return a.tagNames=["strong","em","u","sup","sub"],a.openingTags=_.map(a.tagNames,function(a){return"<"+a+">"}),a.closingTags=_.map(a.tagNames,function(a){return"</"+a+">"}),a.encodedOpeningTags=_.map(a.tagNames,function(a){return"&lt;"+a+"&gt;"}),a.encodedClosingTags=_.map(a.tagNames,function(a){return"&lt;/"+a+"&gt;"}),a}();a.SupportedTags=f,a.keepOnlyRichTextHtml=b,a.stripSupportedTagsButLeaveDangerousOnes=c,a.escapeHtmlWhilePreservingSupportedTags=d}(b=a.RichTextUtil||(a.RichTextUtil={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createRichTextControl=c;var d=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.render=function(){var a=this.props,c=b.RichTextUtil.keepOnlyRichTextHtml(a.Html);return React.createElement("span",{dangerouslySetInnerHTML:{__html:c}})},c}(a.ReactComponent);b.RichTextControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}var d;!function(a){a[a.PlainText=0]="PlainText",a[a.RichText=1]="RichText"}(d=b.UserTextRenderMode||(b.UserTextRenderMode={})),b.createUserTextRenderer=c;var e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.render=function(){var a=this.props.RenderMode||d.PlainText;return a===d.RichText?React.createElement(b.RichTextControl,{Html:this.props.Text}):React.createElement("span",null,this.props.Text)},c}(a.ReactComponent);b.UserTextRenderer=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){function b(a){return React.createElement(c,a)}a.createLabel=b;var c=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.alerting=!1,a}return __extends(c,b),c.prototype.componentDidMount=function(){var a=this;this.alerting||window.setTimeout(function(){a.alerting=!0,a.forceUpdate()})},c.prototype.createReactNodes=function(){var b=this.props,c=b.QuestionSuffix?React.DOM.span({className:"question-suffix"},b.QuestionSuffix):void 0,d=b.ShowRequiredStar?React.createElement(a.RequiredStar):void 0;if(!b.Alert||this.alerting)var e=a.createUserTextRenderer({Text:b.Label,RenderMode:a.UserTextRenderMode.RichText});return b.Bold?[React.DOM.b(void 0,e,d),b.children]:[e,c,d,b.children]},c}(a.ControlBase);a.Label=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createLikertChartControl=c;var d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.backgroundColors=["#FF7F0E","#FF993E","#FFB26E","#FFCC9F","#FFE5CF","#E5E5E5","#D2E4F0","#A5C9E1","#79ADD2","#4C92C3","#1F77B4"],a}return __extends(c,b),c.prototype.render=function(){if(this.isValidChart()){var b={className:"chart-control-container chart-likert-control-container",tabIndex:-1};return b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_GroupContainer,React.createElement("div",__assign({},b),this.createDetailLegend(),React.createElement("div",{className:"chart-likert-body-control-container"},this.createChartLegend(),this.createChartCanvas()))}return null},c.prototype.componentWillMount=function(){this.initializeChartData()},c.prototype.componentDidMount=function(){this.updateChartDataView()},c.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},c.prototype.componentDidUpdate=function(){this.updateChartDataView()},c.prototype.componentWillUnmount=function(){this.destroyChart()},c.prototype.isValidChart=function(){return this.props.Labels&&this.props.Labels.length>0&&this.props.Data&&this.props.Data.length>0},c.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},c.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");this.createStackedBarChart(b),this.setChartLegend()}}},c.prototype.generateChartOption=function(){var a=this,b="'wf_segoe-ui_light', 'Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma, Arial, sans-serif",c={responsive:!1,scales:{xAxes:[{gridLines:{display:!0,drawTicks:!1,drawBorder:!0,zeroLineColor:"#ECECEC",zeroLineWidth:1,zeroLineBorderDash:[5]},ticks:{display:!0,beginAtZero:!0,fontFamily:b,fontSize:12,min:-100,max:100,maxTicksLimit:3,callback:function(a,b,c){return Math.abs(a)+"%"}},stacked:!0}],yAxes:[{barPercentage:.67,categoryPercentage:1,gridLines:{display:!1,drawTicks:!1,drawBorder:!1},ticks:{display:!1},stacked:!0}]},tooltips:{enabled:!1,mode:"nearest",intersect:!0,bodyFontSize:12,bodyFontFamily:b,custom:function(b){var c=a.chartInstance.canvas.parentNode,d=c.getElementsByClassName("chart-custom-tooltip")[0];if(d||(d=document.createElement("div"),d.className="chart-custom-tooltip",d.innerHTML="<table></table>",c.appendChild(d)),0===b.opacity)return void(d.style.opacity="0");if(b.body){var e=b.body.map(function(a){return a.lines});if(e.length>1){var f=e.length/2;a.isOdd&&(e.splice(f,1),b.labelColors.splice(f,1));var g=e.splice(0,f).reverse();g=g.concat(e);var h=b.labelColors.splice(0,f).reverse();h=h.concat(b.labelColors),e=[];var i=[];g.forEach(function(a,b){/\:\s0%$/g.test(a[0])||(e.push(a),i.push(h[b]))}),b.labelColors=i}var j="";e.forEach(function(a,c){var d=b.labelColors[c],e="background:"+d.backgroundColor;e+="; border-color:"+d.borderColor,e+="; border-width: 2px";var f='<span class="chart-custom-tooltip-box" style="'+e+'"></span>';j+="<tr><td>"+f+a+"</td></tr>"}),j+="</tbody>";var k=d.querySelector("table");k.innerHTML=j}var l=a.chartInstance.canvas.offsetTop,m=a.chartInstance.canvas.offsetLeft;d.style.opacity="1",d.style.left=m+b.caretX+"px",d.style.top=l+b.caretY+"px",d.style.fontFamily=b._bodyFontFamily,d.style.fontSize=b._bodyFontSize,d.style.fontStyle=b._fontStyle,d.style.padding=b.yPadding+"px "+b.xPadding+"px"},callbacks:{label:function(b,c){var d=c.datasets[b.datasetIndex].label+": ",e=b.xLabel;return a.isOdd&&(0===b.datasetIndex||c.datasets.length/2===b.datasetIndex)&&(e*=2),d+Math.abs(e)+"%"}}},legend:{display:!1}};return c},c.prototype.createStackedBarChart=function(a){var b=Math.floor(this.chartData.length/2);if(this.chartData.length%2===0){this.isOdd=!1;var c=this.chartData.splice(0,b);c.reverse().forEach(function(a,b){a.data=a.data.map(function(a){return-a})}),(g=this.chartData).splice.apply(g,[0,0].concat(c))}else{this.isOdd=!0;var c=this.chartData.splice(0,b+1);c.reverse(),c[0].data=c[0].data.map(function(a){return a/2});var d=_.clone(c[0]);c.forEach(function(a){a.data=a.data.map(function(a){return-a})}),c.push(d),(h=this.chartData).splice.apply(h,[0,0].concat(c))}var e={labels:this.props.Labels,datasets:this.chartData},f=this.generateChartOption();this.destroyChart(),this.chartInstance=new Chart(a,{type:"horizontalBar",data:e,options:f});var g,h},c.prototype.initializeChartData=function(){for(var a=this,b=[],c=function(a){b.push(d.props.Data.reduce(function(b,c){return b+c.data[a]},0))},d=this,e=0;e<this.props.Data[0].data.length;e++)c(e);var f=[[0],[0,10],[0,5,10],[0,2,8,10],[0,2,5,8,10],[0,2,4,6,8,10],[0,2,4,5,6,8,10],[0,2,3,4,6,7,8,10],[0,2,3,4,5,6,7,8,10],[0,1,2,3,4,6,7,8,9,10]],g=f[this.props.Data.length-1];this.usingColors=g.map(function(b){return a.backgroundColors[b]}),this.chartData=this.props.Data.map(function(c,d){return{label:c.label,backgroundColor:c.backgroundColor?c.backgroundColor:a.usingColors[d],hoverBackgroundColor:c.backgroundColor?a.lightenDarkenColor(c.backgroundColor,10):a.lightenDarkenColor(a.usingColors[d],10),data:c.data.map(function(a,c){return b[c]?Math.round(1e3*a/b[c])/10:0})}})},c.prototype.lightenDarkenColor=function(a,b){function c(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)}return _.isArray(a)?a.map(function(a){return c(a,b)}):c(a,b)},c.prototype.setChartLegend=function(){var a=this;if(this.props.HasLegend){var b=ReactDOM.findDOMNode(this.refs["legend-contaner"]),c=b.childNodes;c&&c.length>0&&(_.each(c,function(b,c){Chart.helpers.addEvent(b,"mouseover",function(){a.handleEvent("mouseover",c)})}),Chart.helpers.addEvent(b,"mouseout",function(){a.handleEvent("mouseout",0)}));var d=ReactDOM.findDOMNode(this.refs["stacked-detail-container"]),e=d.getElementsByClassName("chart-control-detail-canvas");e&&e.length>0&&_.each(e,function(b,c){var d=b.getContext("2d");d.fillStyle=a.props.Data[c].backgroundColor?a.props.Data[c].backgroundColor:a.usingColors[c],d.beginPath(),d.fillRect(0,0,8,8),d.closePath(),d.fill()})}},c.prototype.handleEvent=function(a,b){var c=this;"mouseout"===a?this.chartInstance.active=[]:this.chartInstance.active=this.chartInstance.data.datasets.map(function(a,d){return c.chartInstance.getDatasetMeta(d).data[b]}),this.chartInstance.lastActive=this.chartInstance.lastActive||[],this.chartInstance.lastActive.length&&this.chartInstance.updateHoverStyle(this.chartInstance.lastActive,this.chartInstance.options.hover.mode,!1),this.chartInstance.active.length&&this.chartInstance.updateHoverStyle(this.chartInstance.active,this.chartInstance.options.hover.mode,!0);var d=!Chart.helpers.arrayEquals(this.chartInstance.active,this.chartInstance.lastActive);if(d){this.chartInstance.lastActive=this.chartInstance.active;var e=this.chartInstance.tooltip;e._active=this.chartInstance.active,e._lastActive=e._lastActive||[],e.update(!0),e.pivot();var f=this.chartInstance._bufferedRequest;f?this.chartInstance.render(f.duration,f.lazy):d&&!this.chartInstance.animating&&(this.chartInstance.stop(),this.chartInstance.render(this.chartInstance.options.hover.animationDuration,!0)),this.chartInstance._bufferedRender=!1,this.chartInstance._bufferedRequest=null}},c.prototype.createChartLegend=function(){if(this.props.HasLegend){var b={className:"chart-likert-control-legend",tabIndex:-1,ref:"legend-contaner"};b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_LegendGroup;var c=this.props.Labels.map(function(a,b){return React.createElement("div",{className:"chart-likert-control-legend-row",key:b},React.createElement("span",{className:"chart-likert-control-legend-label",title:a.toString()},a))});return React.createElement("div",__assign({},b),c)}},c.prototype.createChartCanvas=function(){var b={className:"chart-likert-control",tabIndex:-1};b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_ChartGroup;var c=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),d=c?300:432,e=18+48*this.props.Labels.length;e=c?300*e/350:e;var f={role:"presentation",className:"chart-control-canvas",width:d,height:e,ref:"canvas"};return React.createElement("div",__assign({},b),React.createElement("canvas",__assign({},f)))},c.prototype.createDetailLegend=function(){var a="chart-likert-control-detail-container",b="chart-likert-control-detail-item";return React.createElement("div",{className:a,ref:"stacked-detail-container"},this.props.Data.map(function(a){return React.createElement("div",{className:b,title:a.label},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"8",height:"8"}),React.createElement("span",null,a.label))}))},c}(a.ReactComponent);b.LikertChartControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}var d;!function(a){a[a.None=0]="None",a[a.CheckMark=1]="CheckMark"}(d=b.ItemStyle||(b.ItemStyle={})),b.createList=c;var e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.render=function(){return React.DOM.div({className:"list-control-contanier"},this.createList())},c.prototype.createList=function(){var a=this,b=this.props.ListItems,c=b.map(function(b,c){return React.DOM.li({key:c},a.createListItem(b))});return React.DOM.ul({className:"list-control-ul",role:"listbox"},c)},c.prototype.createListItem=function(a){var c=null;switch(this.props.ItemStyle){case d.CheckMark:c=b.createFontIconControl({HTMLAttributes:{className:"list-control-icon"},IconName:"CheckMark"})}return React.DOM.div({className:"list-control-item",title:a.Tooltip},c,React.DOM.span({className:"list-control-item-text"},a.DisplayName))},c}(a.ReactComponent);b.List=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=this.props.Ignorable?a.Utilities.Html.combineAttributes(this.props.ClassName,"optional-cell"):this.props.ClassName;return React.createElement("div",{className:b},React.createElement("div",{className:"loading-spinner-animation"}),this.createLoadingDescription())},c.prototype.createLoadingDescription=function(){return this.props.LoadingDescription?React.createElement("div",{className:"loading-control-description",role:"status"},this.props.LoadingDescription):void 0},c}(a.ReactComponent);b.LoadingControl=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}var d;!function(a){a[a.Normal=0]="Normal",a[a.CheckBox=1]="CheckBox",a[a.RadioButton=2]="RadioButton"}(d=b.MenuItemType||(b.MenuItemType={})),b.createMenuControl=c;var e=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;return a.wasMenuExpanded=!1,a.controlId=_.uniqueId("menu"),a.state={FocusedOnMenuButton:!1,FocusedOnMenuItem:!1,MenuExpanded:!1},a}return __extends(e,c),e.prototype.componentWillReceiveProps=function(a){a.Reset&&(this.setState({FocusedOnMenuButton:!0,MenuExpanded:!1}),a.onMenuReset&&a.onMenuReset())},e.prototype.componentDidUpdate=function(){var a=this;this.menuItemsRefs&&(this.activeMenuItems=[],this.activeMenuItems=this.menuItemsRefs.map(function(b){return ReactDOM.findDOMNode(a.refs[b])})),this.updateFocusOnTriggerButton(),!this.wasMenuExpanded&&this.state.MenuExpanded&&this.state.FocusedOnMenuItem&&this.setFocusOnMenuItem(0),!this.wasMenuExpanded&&this.state.MenuExpanded&&this.props.onMenuExpand&&this.props.onMenuExpand(),this.wasMenuExpanded&&!this.state.MenuExpanded&&this.props.onMenuCollapse&&this.props.onMenuCollapse(),this.wasMenuExpanded=this.state.MenuExpanded},e.prototype.render=function(){var b=this.props.ClassNameForContainer;return this.state.MenuExpanded&&(b=a.Utilities.Html.combineAttributes(b,"menu-control-dropup")),React.createElement("div",{className:b},this.createMenuTriggerButton(),this.createMenuTable())},e.prototype.updateFocusOnTriggerButton=function(){if(this.state.FocusedOnMenuButton){var a=ReactDOM.findDOMNode(this.refs.menuButton);a&&a.focus()}},e.prototype.switchMenuExpandedState=function(a){void 0===a&&(a=!1),this.setState({FocusedOnMenuButton:this.state.MenuExpanded,FocusedOnMenuItem:!this.state.MenuExpanded&&a,MenuExpanded:!this.state.MenuExpanded})},e.prototype.createMenuTriggerButton=function(){var a=this,c=this.props.MenuTriggerButton,d={"aria-label":c.Description,"aria-expanded":this.state.MenuExpanded,"aria-haspopup":!0,"aria-controls":this.controlId,autoFocus:this.props.AutoFocused,className:c.ClassName,disabled:this.props.Disabled,title:c.Tooltip||c.Description,onClick:function(){return a.switchMenuExpandedState()},onFocus:this.props.onButtonFocus,onKeyDown:function(b){return a.onKeyDownForMenuTriggerButton(b)},onBlur:function(b){a.setState({FocusedOnMenuButton:!1}),a.onMenuBlur(b)}};return b.createButton({HTMLAttributes:d,ButtonStyle:c.ButtonStyle,children:c.ChildrenContent,ref:"menuButton"})},e.prototype.getNextActiveIndex=function(a){return this.activeMenuItems&&this.activeMenuItems.length&&a>=0&&a<this.activeMenuItems.length?(a+1)%this.activeMenuItems.length:-1},e.prototype.getPreviousActiveIndex=function(a){return this.activeMenuItems&&this.activeMenuItems.length&&a>=0&&a<this.activeMenuItems.length?(a+this.activeMenuItems.length-1)%this.activeMenuItems.length:-1},e.prototype.collapseMenu=function(){this.setState({FocusedOnMenuButton:!0,FocusedOnMenuItem:!1,MenuExpanded:!1})},e.prototype.getMenuItemRole=function(a){switch(a){case d.Normal:return"menuitem";case d.RadioButton:return"menuitemradio";case d.CheckBox:default:return"menuitemcheckbox"}},e.prototype.onMenuBlur=function(b){if(this.state.MenuExpanded){var c=a.Utilities.Html.getTargetElementOfFocusEvent(b),d=ReactDOM.findDOMNode(this.refs.menuTable),e=ReactDOM.findDOMNode(this.refs.menuButton);d&&!d.contains(c)&&e&&!e.contains(c)&&this.setState({FocusedOnMenuButton:!1,FocusedOnMenuItem:!1,MenuExpanded:!1})}},e.prototype.createUnorderedListMenuItem=function(c,e){var f=this,g=!!c.IsDisabled,h=function(){g||c.onExecute()},i={className:a.Utilities.Html.combineAttributes("separator",c.Checked?"checked":""),key:c.Key,title:c.Title},j={"aria-disabled":g,className:a.Utilities.Html.combineAttributes("menu-control-a",g?"menu-control-a-disabled":void 0),ref:e.toString(),role:this.getMenuItemRole(c.MenuItemType),tabIndex:-1,onClick:function(){h(),f.switchMenuExpandedState()},onBlur:function(a){return f.onMenuBlur(a)},onKeyDown:function(a){return f.onKeyDownForMenuItem(a,h,d.CheckBox)},href:"javascript:;"},k={HTMLAttributes:{className:"forms-icon-size18x18 question-menu-check-icon"},IconName:"CheckMark"},l=c.Checked?React.createElement(b.FontIconControl,__assign({},k)):void 0;return React.createElement("li",__assign({},i),React.createElement("a",__assign({},j),l,c.Description))},e.prototype.createUnorderListMenu=function(){var b=this;this.menuItemsRefs=[];var c=[],d=this.props.UnorderListMenuItems,e=!1;d&&d.filter(function(a){return!!a}).forEach(function(a,d){c.push(b.createUnorderedListMenuItem(a,d)),b.menuItemsRefs.push(d.toString()),e=e||a.Checked});var f={id:this.controlId,className:a.Utilities.Html.combineAttributes("dropdown-menu-control","menu-control","border-no-radius",e?"checked":""),ref:"menuTable",role:"menu"};return React.createElement("ul",__assign({},f),c)},e.prototype.createCustomizedMenu=function(){var a=this;this.menuItemsRefs=[];var b=[],c=this.props.CustomizedMenuItems;c&&(b=c.filter(function(a){return!!a.MenuItem}).map(function(b,c){if(b.Active){var d={className:"menu-control-item",key:c.toString(),ref:c.toString(),role:"menuitem",tabIndex:-1,onClick:function(c){c.stopPropagation(),c.preventDefault(),b.OnExecute&&b.OnExecute(),a.switchMenuExpandedState()},onKeyDown:function(c){return a.onKeyDownForMenuItem(c,b.OnExecute)},onBlur:function(b){return a.onMenuBlur(b)}};return a.menuItemsRefs.push(c.toString()),React.createElement("div",__assign({},d),b.MenuItem)}return React.createElement("div",{key:c.toString()},b.MenuItem)}));var d={className:this.props.ClassName,ref:"menuTable",role:"menu"};return React.createElement("div",{id:this.controlId,className:this.props.ShowBox?"menu-option-container":null},this.props.ShowBox&&React.createElement("div",{className:"menu-box"}),React.createElement("div",__assign({},d),b))},e.prototype.createMenuTable=function(){if(this.state.MenuExpanded){if(this.props.UnorderListMenuItems)return this.createUnorderListMenu();if(this.props.CustomizedMenuItems)return this.createCustomizedMenu();
}return null},e.prototype.setFocusOnMenuItem=function(a){if(a>=0&&this.activeMenuItems&&this.activeMenuItems.length>a){var b=this.activeMenuItems[a];b&&(b.focus(),this.activeIndex=a)}},e.prototype.onKeyDownForMenuTriggerButton=function(b){if(b.keyCode!==a.KeyCode.Tab)switch(b.preventDefault(),b.stopPropagation(),b.keyCode){case a.KeyCode.ArrowUp:if(this.state.MenuExpanded){this.setFocusOnMenuItem(this.getPreviousActiveIndex(0));break}case a.KeyCode.ArrowDown:if(this.state.MenuExpanded){this.setFocusOnMenuItem(0);break}case a.KeyCode.Enter:this.switchMenuExpandedState(!0);break;case a.KeyCode.Esc:this.collapseMenu()}},e.prototype.onKeyDownForMenuItem=function(b,c,e){switch(b.stopPropagation(),b.preventDefault(),b.keyCode){case a.KeyCode.Space:c&&c(),e!==d.CheckBox&&this.switchMenuExpandedState();break;case a.KeyCode.Enter:c&&c(),this.switchMenuExpandedState();break;case a.KeyCode.Home:this.setFocusOnMenuItem(0);break;case a.KeyCode.End:this.setFocusOnMenuItem(this.getPreviousActiveIndex(0));break;case a.KeyCode.ArrowUp:this.setFocusOnMenuItem(this.getPreviousActiveIndex(this.activeIndex));break;case a.KeyCode.ArrowDown:this.setFocusOnMenuItem(this.getNextActiveIndex(this.activeIndex));break;case a.KeyCode.ArrowLeft:this.collapseMenu();break;case a.KeyCode.ArrowRight:break;case a.KeyCode.Esc:this.collapseMenu();break;case a.KeyCode.Tab:this.collapseMenu()}},e}(a.ReactComponent);b.MenuControl=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createNumberRating=c;var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.ariaLabelId=_.uniqueId("ratingAccessibilityLabel."),a}return __extends(d,c),d.prototype.createReactNodes=function(){var c=this.props,d=null!=c.Value&&""!==c.Value;if(!d&&c.ToRenderIfNoRatingAlreadyGiven)return[c.ToRenderIfNoRatingAlreadyGiven];var e,f=10,g=c.MinRating;return null==g&&(g=1),e=c.ShowRatingLabel?b.RatingUtilities.createRatingContainer(b.RatingUtilities.RatingType.Number,c.LeftDescription,c.RightDescription,g.toString(),c.Length.toString(),this.createRatingTable(),c.Length,f):[React.createElement("div",{className:"office-form-question-rating-container"},this.createRatingTable())],c.ShouldAccessibleTextReadSelectedValue?[React.createElement("div",{"aria-labelledby":this.ariaLabelId},React.createElement("div",{id:this.ariaLabelId,className:"screenReaderVisible"},a.Form.Resources.LocalizedStrings.GradingView_RatingAnswer_LabelFormat.format(this.getSelectedValue(),c.Length)),React.createElement("div",{"aria-hidden":"true",role:"presentation"},e))]:e},d.prototype.createRatingTable=function(){var a=this,b=this.props.MinRating;null==b&&(b=1);var c=_.range(b,this.props.Length+1),d=this.getSelectedValue();return React.createElement("div",{className:"office-form-question-rating-table"},React.createElement("div",{className:"office-form-question-rating-tr"},c.map(function(a){return React.createElement("div",{className:"office-form-question-rating-title-td",key:a},a)})),React.createElement("div",{className:"office-form-question-rating-tr"},c.map(function(b){var e=d===b;return React.createElement("div",{className:"office-form-question-rating-td",key:b},React.createElement("input",{"aria-checked":e,"aria-label":""+b,"aria-posinset":b,"aria-setsize":c.length,type:"radio",disabled:a.props.Disabled,checked:e,onClick:function(){return a.props.onValueChange(b)}}))})))},d.prototype.getSelectedValue=function(){return parseInt(this.props.Value)},d}(b.ControlBase);b.NumberRating=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}var d;!function(a){a[a.QuizRanking=0]="QuizRanking",a[a.SurveyRanking=1]="SurveyRanking",a[a.Likert=2]="Likert"}(d=b.StackedBarType||(b.StackedBarType={})),b.createRankingChartControl=c;var e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.backgroundColors=["#FF7F0E","#FF993E","#FFB26E","#FFCC9F","#FFE5CF","#E5E5E5","#D2E4F0","#A5C9E1","#79ADD2","#4C92C3","#1F77B4"],a}return __extends(c,b),c.prototype.render=function(){if(this.isValidChart()){var b={className:"chart-control-container chart-stacked-control-container",tabIndex:-1};return b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_GroupContainer,React.createElement("div",__assign({},b),this.createChartLegend(),this.createChartCanvas())}return null},c.prototype.componentWillMount=function(){this.initializeChartData()},c.prototype.componentDidMount=function(){this.updateChartDataView()},c.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},c.prototype.componentDidUpdate=function(){this.updateChartDataView()},c.prototype.componentWillUnmount=function(){this.destroyChart()},c.prototype.isValidChart=function(){return this.props.Labels&&this.props.Labels.length>0&&this.props.Data&&this.props.Data.length>0},c.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},c.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");this.createStackedBarChart(b),this.setChartLegend()}}},c.prototype.generateChartOption=function(){var a={responsive:!1,scales:{xAxes:[{gridLines:{display:!1,drawTicks:!0,drawBorder:!0},ticks:{display:!1,min:0,max:100},stacked:!0}],yAxes:[{gridLines:{display:!1,drawTicks:!1,drawBorder:!0},ticks:{display:!1},stacked:!0}]},tooltips:{enabled:!0,filter:function(a){return 0!==a.xLabel},callbacks:{title:function(a){return a.length?a[0].yLabel:""},label:function(a,b){return b.datasets[a.datasetIndex].label+": "+a.xLabel+"%"}}},legend:{display:!1}};return a},c.prototype.createStackedBarChart=function(a){var b={labels:this.props.Labels,datasets:this.chartData},c=this.generateChartOption();this.destroyChart(),this.chartInstance=new Chart(a,{type:"horizontalBar",data:b,options:c})},c.prototype.initializeChartData=function(){for(var a=this,b=[],c=function(a){b.push(d.props.Data.reduce(function(b,c){return b+c.data[a]},0))},d=this,e=0;e<this.props.Data[0].data.length;e++)c(e);var f=[[0],[0,10],[0,5,10],[0,2,8,10],[0,2,5,8,10],[0,2,4,6,8,10],[0,2,4,5,6,8,10],[0,2,3,4,6,7,8,10],[0,2,3,4,5,6,7,8,10],[0,1,2,3,4,6,7,8,9,10]],g=f[this.props.Data.length-1];this.usingColors=g.map(function(b){return a.backgroundColors[b]}),this.chartData=this.props.Data.map(function(c,d){return{label:c.label,borderWidth:1,borderColor:"#FFFFFF",backgroundColor:c.backgroundColor?c.backgroundColor:a.usingColors[d],hoverBackgroundColor:c.backgroundColor?a.lightenDarkenColor(c.backgroundColor,10):a.lightenDarkenColor(a.usingColors[d],10),data:c.data.map(function(a,c){return b[c]?Math.round(1e3*a/b[c])/10:0})}})},c.prototype.lightenDarkenColor=function(a,b){function c(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)}return _.isArray(a)?a.map(function(a){return c(a,b)}):c(a,b)},c.prototype.setChartLegend=function(){var a=this;if(this.props.HasLegend){var b=ReactDOM.findDOMNode(this.refs["legend-table"]),c=ReactDOM.findDOMNode(this.refs["legend-table-tbody"]),d=c.childNodes;d&&d.length>0&&(_.each(d,function(b,c){Chart.helpers.addEvent(b,"mouseover",function(){a.handleEvent("mouseover",c)})}),Chart.helpers.addEvent(b,"mouseout",function(){a.handleEvent("mouseout",0)}));var e=ReactDOM.findDOMNode(this.refs["stacked-detail-container"]),f=e.getElementsByClassName("chart-control-detail-canvas");f&&f.length>0&&_.each(f,function(b,c){var d=b.getContext("2d");d.fillStyle=a.props.Data[c].backgroundColor?a.props.Data[c].backgroundColor:a.usingColors[c],d.beginPath(),d.fillRect(0,0,10,10),d.closePath(),d.fill()})}},c.prototype.handleEvent=function(a,b){var c=this;"mouseout"===a?this.chartInstance.active=[]:this.chartInstance.active=this.chartInstance.data.datasets.map(function(a,d){return c.chartInstance.getDatasetMeta(d).data[b]}),this.chartInstance.lastActive=this.chartInstance.lastActive||[],this.chartInstance.lastActive.length&&this.chartInstance.updateHoverStyle(this.chartInstance.lastActive,this.chartInstance.options.hover.mode,!1),this.chartInstance.active.length&&this.chartInstance.updateHoverStyle(this.chartInstance.active,this.chartInstance.options.hover.mode,!0);var d=!Chart.helpers.arrayEquals(this.chartInstance.active,this.chartInstance.lastActive);if(d){this.chartInstance.lastActive=this.chartInstance.active;var e=this.chartInstance.tooltip;e._active=this.chartInstance.active,e._lastActive=e._lastActive||[],e.update(!0),e.pivot();var f=this.chartInstance._bufferedRequest;f?this.chartInstance.render(f.duration,f.lazy):d&&!this.chartInstance.animating&&(this.chartInstance.stop(),this.chartInstance.render(this.chartInstance.options.hover.animationDuration,!0)),this.chartInstance._bufferedRender=!1,this.chartInstance._bufferedRequest=null}},c.prototype.createChartLegend=function(){var b=this;if(this.props.HasLegend){var c={className:"chart-control-legend",tabIndex:-1};c["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_LegendGroup;var e=void 0,f=void 0;return this.props.Type===d.QuizRanking?(e=React.createElement("tr",{className:"chart-control-legend-table-title"},React.createElement("th",{className:"chart-control-legend-label"}," "),React.createElement("th",{className:"chart-control-legend-value"}," ")),f=this.props.Labels.map(function(a,c){return React.createElement("tr",{className:"chart-control-legend-table-row",key:c},React.createElement("td",{role:"presentation",className:"chart-control-legend-label",title:a.toString()},a),React.createElement("td",{role:"presentation",className:"chart-control-legend-value"},b.chartData[0].data[c]+"%"))})):(e=React.createElement("tr",{className:"chart-control-legend-table-title"},React.createElement("th",{role:"presentation",className:"chart-control-legend-value"},a.Form.Resources.LocalizedStrings.AnalyzeView_Chart_Rank),React.createElement("th",{role:"presentation",className:"chart-control-legend-label"},a.Form.Resources.LocalizedStrings.AnalyzeView_Chart_Options)),f=this.props.Labels.map(function(a,c){return React.createElement("tr",{className:"chart-control-legend-table-row",key:c},React.createElement("td",{role:"presentation",className:"chart-control-legend-value"},b.props.yLabels[c]),React.createElement("td",{role:"presentation",className:"chart-control-legend-label",title:a.toString()},a))})),React.createElement("div",__assign({},c),React.createElement("table",{className:"chart-control-legend-table",ref:"legend-table"},React.createElement("thead",null,e),React.createElement("tbody",{ref:"legend-table-tbody"},f)))}},c.prototype.createChartCanvas=function(){var b={"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_ChartGroup,className:"chart-control chart-control-stacked",tabIndex:-1},c=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),d=c?300:350,e=10+31*this.props.Labels.length;e=c?300*e/350:e;var f={role:"presentation",className:"chart-control-canvas",width:d,height:e,ref:"canvas"};return React.createElement("div",__assign({},b),this.createDetailLegend(),React.createElement("canvas",__assign({},f)))},c.prototype.createDetailLegend=function(){var b=this;if(this.props.Type===d.SurveyRanking){var c=a.Form.Resources.LocalizedStrings.AnalyzeView_Chart_Pick;return React.createElement("div",{className:"chart-control-stacked-detail-container",ref:"stacked-detail-container"},this.props.Labels.map(function(d,e){return 0===e?React.createElement("div",{className:"chart-control-stacked-detail-item"},React.createElement("span",null,c.format(a.Form.Resources.LocalizedStrings.Ordinal_Numera_First)),React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"})):e===b.props.Labels.length-1?React.createElement("div",{className:"chart-control-stacked-detail-item"},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"}),React.createElement("span",null,c.format(a.Form.Resources.LocalizedStrings.Ordinal_Numera_Last))):React.createElement("div",{className:"chart-control-stacked-detail-item"},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"}))}))}return React.createElement("div",{className:"chart-control-stacked-detail-container",ref:"stacked-detail-container"},this.props.Data.map(function(a){return React.createElement("div",{className:"chart-control-stacked-detail-item",title:a.label},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"}),React.createElement("span",null,a.label))}))},c}(a.ReactComponent);b.RankingChartControl=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createRating=c;var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.createReactNodes=function(){var a=this.props,c={className:"rateit margin-left","data-rateit-max":a.Length,"data-rateit-starwidth":28,"data-rateit-starheight":28,"data-rateit-value":a.Value,"data-rateit-step":1,"data-rateit-resetable":!1,"data-rateit-ispreset":!0,ref:"rateit",key:"rateit"},d=10,e=React.DOM.div(c);return a.ShowRatingLabel?b.RatingUtilities.createRatingContainer(b.RatingUtilities.RatingType.Star,a.LeftDescription,a.RightDescription,a.LeftDescriptionTitle,a.RightDescriptionTitle,e,a.Length,d,this.ratingDescriptionId):[React.DOM.div({className:"office-form-question-rating-container",key:"container"},e)]},d.prototype.componentWillMount=function(){this.ratingDescriptionId=a.UniqueIdentifier.getLabelId()},d.prototype.componentDidMount=function(){var b=this,c=this.props,d=$(ReactDOM.findDOMNode(this.refs.rateit));d.rateit(),d.on("rated",function(){return c.onValueChange(d.rateit("value"))}),d.on("over",function(a,c){return b.updateTooltip(c)});var e=d.find(".rateit-range");if(e&&c.Options&&c.Options.HTMLPropsForInnerElement){e.removeAttr("aria-label");for(var f in c.Options.HTMLPropsForInnerElement)e.attr(f,c.Options.HTMLPropsForInnerElement[f])}if(e){var g=e.attr("aria-labelledby");g=a.Utilities.Html.combineAttributes(g,this.ratingDescriptionId),e.attr("aria-labelledby",g)}this.updateRatingAttributes()},d.prototype.componentDidUpdate=function(){this.updateRatingAttributes()},d.prototype.updateRatingAttributes=function(){var a=$(ReactDOM.findDOMNode(this.refs.rateit));if(a.rateit("readonly",this.props.Disabled),this.props.Disabled){var b=a.find(".rateit-range");b&&b.removeAttr("tabindex")}a.rateit("value",this.props.Value),this.updateTooltip()},d.prototype.updateTooltip=function(b){b=b||this.props.Value||0;var c=$(ReactDOM.findDOMNode(this.refs.rateit)),d=a.Form.Resources.LocalizedStrings.Renderer_RatingControlText.format(b);c.attr("title",d)},d}(b.ControlBase);b.Rating=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(b,c,e,f,g,h,i,j,k){var l;l=b===d.Star?"star":"number";var m={className:"office-form-rating-container-"+l+" container-margin-right"},n={className:"office-form-rating-container-"+l+" container-margin-left"};""===c&&(m.className=a.Utilities.Html.combineAttributes(m.className,"container-empty")),i===j&&(m.className=a.Utilities.Html.combineAttributes(m.className,"container-"+l+"-max-width"),n.className=a.Utilities.Html.combineAttributes(n.className,"container-"+l+"-max-width"));var o=React.DOM.div(m,React.DOM.div({className:"office-form-question-rating-description-"+l},c)),p=React.DOM.div(n,React.DOM.div({className:"office-form-question-rating-description-"+l},e));if(c||e){var q=React.DOM.div({className:"office-form-response-rating-description"},React.DOM.div({className:"office-form-rating-description-label"},f),React.DOM.div({className:"rating-option-description"},a.Form.Resources.LocalizedStrings.Colon.format(c))),r=React.DOM.div({className:"office-form-response-rating-description"},React.DOM.div({className:"office-form-rating-description-label"},g),React.DOM.div({className:"rating-option-description"},a.Form.Resources.LocalizedStrings.Colon.format(e))),s=React.DOM.div({className:"office-form-rating-description-container",id:k},q,r);return[s,React.DOM.div({className:"office-form-question-rating-container",key:"container"},o,h,p)]}return[React.DOM.div({className:"office-form-question-rating-container",key:"container"},o,h,p)]}var d;!function(a){a[a.Star=0]="Star",a[a.Number=1]="Number"}(d=b.RatingType||(b.RatingType={})),b.createRatingContainer=c}(c=b.RatingUtilities||(b.RatingUtilities={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createRenderNewlines=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.renderLine=function(a){return React.createElement("span",null,a,React.createElement("br",null))},b.prototype.splitContentIntoLines=function(){var a=this.props.content;return(_.isUndefined(this.props.trim)||this.props.trim)&&(a=a.trim()),a.split("\n")},b.prototype.render=function(){var a=this.splitContentIntoLines();return React.createElement("span",null,a.map(function(b,c){var d=c!==a.length-1,e=d?React.createElement("br",null):void 0;return React.createElement("span",null,b,e)}))},b}(a.ReactComponent);b.RenderNewlines=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createSelect=c;var d=function(c){function d(){var b=null!==c&&c.apply(this,arguments)||this;return b.controlId=a.UniqueIdentifier.getDropdownId(),b.placeholderId=b.controlId+"_placeholder",b}return __extends(d,c),d.prototype.componentDidUpdate=function(){if(this.scrollToSelectedOption(),this.state.Expanded){this.adjustOptionPanelLayout();var a=this.selectedOption&&this.selectedOption.Key;if(a){var b=ReactDOM.findDOMNode(this.refs[a]);b&&b.focus()}}},d.prototype.adjustOptionPanelLayout=function(){var a=document.getElementById(this.controlId),b=window.getComputedStyle(a),c=a.offsetWidth,d=ReactDOM.findDOMNode(this.refs.menu);(this.props.AllowWrap||d.offsetWidth<c)&&(d.style.width=c+"px"),d.style.top=a.offsetHeight-parseInt(b.borderTopWidth)+"px",d.style.left="-"+b.borderLeftWidth},d.prototype.render=function(){var b=this;if(!this.selectedOption||this.selectedOption.Value!==this.props.Value){var c=this.props.SelectOptions.filter(function(a){return a.Value===b.props.Value})[0];this.selectedOption=_.clone(c)}var d=_.extend({},this.props.HTMLAttributes);return d.id=this.controlId,d.className=a.Utilities.Html.combineAttributes(d.className,"select-control"),d.onKeyDown=function(a){return b.onKeyDown(a)},d.onClick=function(a){return d.disabled?{}:b.onClick()},d.tabIndex=d.disabled?-1:0,d.onBlur=function(c){var d=ReactDOM.findDOMNode(b),e=a.Utilities.Html.getTargetElementOfFocusEvent(c);d.contains(e)||b.setState({Expanded:!1})},d.role="combobox",d["aria-label"]=d["aria-label"]||this.props.Label||this.props.Placeholder,d["aria-expanded"]=this.state.Expanded,d["aria-describedby"]=this.placeholderId,React.createElement("div",__assign({},d),this.createPlaceholder(),this.createOptions())},d.prototype.createPlaceholder=function(){var a=this.selectedOption&&(this.selectedOption.DisplayContent||this.selectedOption.DisplayName)||this.props.Placeholder||"",b=this.selectedOption?"select-placeholder-text":"select-placeholder-text default";return React.createElement("div",{className:"select-placeholder"},React.createElement("span",{id:this.placeholderId,className:b,role:"textbox"},a),this.createArrow())},d.prototype.createArrow=function(){var a={HTMLAttributes:{className:"select-placeholder-arrow forms-icon-size14x14"},IconName:this.state.Expanded?"ChevronUp":"ChevronDown"};return React.createElement(b.FontIconControl,__assign({},a))},d.prototype.createOptions=function(){var a=this;if(this.state.Expanded){var b={className:"select-option-menu-container",ref:"menu",onWheel:function(b){b.preventDefault();var c=b.deltaY,d=ReactDOM.findDOMNode(a.refs.menu),e=d.scrollTop+c;if(c>=0){var f=d.scrollHeight-d.clientHeight;d.scrollTop=Math.min(e,f)}else d.scrollTop=Math.max(e,0)},role:"listbox"};return React.createElement("ul",__assign({},b),this.props.SelectOptions.map(function(b){return a.createOption(b)}))}},d.prototype.createOption=function(c){var d=this,e=this.selectedOption&&this.selectedOption.Key,f=c.Key===e,g={"aria-selected":f,className:this.props.AllowWrap?"select-option-nocheck":"select-option",tabIndex:f?0:-1,key:c.Key,ref:c.Key&&c.Key.toString(),role:"option"};c.Disabled?g.className=a.Utilities.Html.combineAttributes(g.className,"disabled"):g.onClick=function(a){var b=ReactDOM.findDOMNode(d);b.focus(),d.selectedOption&&d.selectedOption.Value===c.Value||d.props.onValueChange(c.Value),d.setState({Expanded:!1}),a.stopPropagation()};var h;this.props.AllowWrap||(h=React.createElement(b.FontIconControl,{HTMLAttributes:{className:"select-option-state forms-icon-size14x14"},IconName:"CheckMark"})),f&&(g.className=a.Utilities.Html.combineAttributes(g.className,"selected"));var i=c.DisplayContent;return i||(i=React.createElement("span",null,c.DisplayName)),React.createElement("li",__assign({},g),React.createElement("div",{className:"select-option-content"},h,i))},d.prototype.onKeyDown=function(b){switch(b.stopPropagation(),b.keyCode){case a.KeyCode.Space:this.setState({Expanded:!0}),b.preventDefault();break;case a.KeyCode.Enter:this.onClick(!0),b.preventDefault();break;case a.KeyCode.Tab:this.state.Expanded&&(this.setState({Expanded:!1}),b.preventDefault());break;case a.KeyCode.Esc:this.state.Expanded&&this.setState({Expanded:!1}),b.preventDefault();break;case a.KeyCode.ArrowLeft:case a.KeyCode.ArrowRight:this.state.Expanded||(b.keyCode===a.KeyCode.ArrowLeft?this.selectPreviousOption():this.selectNextOption()),b.preventDefault();break;case a.KeyCode.ArrowUp:case a.KeyCode.ArrowDown:b.altKey?this.setState({Expanded:!this.state.Expanded}):b.keyCode===a.KeyCode.ArrowUp?this.selectPreviousOption():this.selectNextOption(),b.preventDefault()}},d.prototype.selectPreviousOption=function(){for(var a=this.selectedOption&&this.selectedOption.Key,b=_.findIndex(this.props.SelectOptions,function(b){return b.Key===a});b>0;){var c=this.props.SelectOptions[b-1];if(!c.Disabled){this.props.onValueChange(c.Value);break}b--}},d.prototype.selectNextOption=function(){for(var a=this.selectedOption&&this.selectedOption.Key,b=_.findIndex(this.props.SelectOptions,function(b){return b.Key===a});b<this.props.SelectOptions.length-1;){var c=this.props.SelectOptions[b+1];if(!c.Disabled){this.props.onValueChange(c.Value);break}b++}},d.prototype.onClick=function(a){if(this.state.Expanded){var b=ReactDOM.findDOMNode(this);b.focus()}else a&&void 0===this.selectedOption&&this.props.SelectOptions[0]&&this.props.onValueChange(this.props.SelectOptions[0].Value);this.setState({Expanded:!this.state.Expanded})},d.prototype.scrollToSelectedOption=function(){if(this.state.Expanded){var b=$(ReactDOM.findDOMNode(this.refs.menu)),c=b.find(".select-option.selected");a.Utilities.Html.scrollToShowSubelement(c,b)}},d}(a.ReactComponent);b.Select=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createSimpleDialog=c;var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.componentDidMount=function(){Forms.UX.Utilities.trapFocusInsideElement(ReactDOM.findDOMNode(this))},d.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)},d.prototype.render=function(){var b=this;if(this.props.ShowDialog){var c={className:this.props.ClassName||"simple-dialog-container",key:"dialogContainer",ref:"dialogContainer",tabIndex:-1,onBlur:function(c){var d=a.Utilities.Html.getTargetElementOfFocusEvent(c),e=ReactDOM.findDOMNode(b.refs.dialogContainer);e.contains(d)||b.props.onBlur&&b.props.onBlur()},onKeyDown:function(a){return b.onKeyDown(a)},onMouseLeave:this.props.onMouseLeave,onMouseOver:this.props.onMouseOver};return React.createElement("div",__assign({},c),this.createDescription(),this.createButtons())}return null},d.prototype.createDescription=function(){if(this.props.Description){var b=a.Utilities.Html.combineAttributes("description-container",this.props.TextClassName);return React.createElement("div",{className:b,key:"descriptionContainer"},this.props.Description)}return null},d.createButtonWithProps=function(c,d){return b.createGlyphButton({ButtonStyle:c.ButtonStyle,GlyphButtonStyle:c.GlyphButtonStyle,HTMLAttributes:{autoFocus:0===d,className:c.ClassName,title:c.Title,onClick:function(a){a.preventDefault(),a.stopPropagation(),c.onClick&&c.onClick(a)}},Icon:c.IconClass,IconClassName:a.Utilities.Html.combineAttributes(c.IconClassName,"forms-icon-size32x32"),key:c.Key,Text:c.Text,TextClassName:c.TextClassName})},d.prototype.createButtons=function(){var a=this.props.ButtonsProps||[],b="buttons-container";return React.createElement("div",{className:b,key:"buttonsContainer"},a.filter(function(a){return!!a}).map(d.createButtonWithProps))},d.prototype.onKeyDown=function(b){b.keyCode===a.KeyCode.Esc&&(b.stopPropagation(),b.preventDefault(),this.props.onDismiss&&this.props.onDismiss())},d}(a.ReactComponent);b.SimpleDialog=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(f,a)}function d(a){return React.createElement(g,a)}var e;!function(a){a[a.SingleLine=0]="SingleLine",a[a.FixHeightMultiline=1]="FixHeightMultiline",a[a.AutoHeightMultiline=2]="AutoHeightMultiline"}(e=b.TextFieldType||(b.TextFieldType={})),b.createTextField=c;var f=function(c){function f(){return null!==c&&c.apply(this,arguments)||this}return __extends(f,c),f.prototype.createReactNodes=function(){return[this.createLabel(),this.createValueContainer()]},f.prototype.componentDidMount=function(){if(this.props.HasFocus){var a=ReactDOM.findDOMNode(this),b=$(a).find(".office-form-textfield-input")[0];b&&b.focus()}},f.prototype.createLabel=function(){var a=this.props,c=a.Options;return a.Label||a.ShowRequiredStar?React.DOM.div(null,React.DOM.span({className:c&&c.classNameForInnerLabel},a.Label),a.ShowRequiredStar?React.createElement(b.RequiredStar):void 0):void 0},f.prototype.createValueContainer=function(){var b,c,g,h=this,i=this.props,j=i.Options,k=a.Utilities.Html.mergeReactProps(j&&j.HTMLPropsForInnerElement,{value:i.Value,className:"office-form-textfield-input form-control border-no-radius",placeholder:i.Placeholder,ref:"textField",style:{height:i.MinimalHeight+"px",overflowY:i.TextFieldType===e.FixHeightMultiline?"auto":void 0},disabled:i.Disabled,onChange:this.onChange.bind(this),maxLength:i.MaxLength?i.MaxLength:a.Form.FormLimitation.DefaultTextLength,onFocus:i.AutoSelection?function(){var a=ReactDOM.findDOMNode(h.refs.textField);a&&a.select()}:void 0,onKeyDown:a.Utilities.Html.onKeyboardEvent(function(b){if(b.ctrlKey){var c=new Date,d=String.fromCharCode(b.keyCode),e="Ctrl+"+d;switch(d){case"C":case"X":h.duration(f.prevTimeKeyDown,c.getTime())>f.minDuration&&h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,e),f.prevTimeKeyDown=c.getTime();break;case"V":h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,e);break;case"Y":case"Z":h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.UndoRedo,e)}}}),onCopy:function(b){var c=new Date;h.duration(f.prevTimeOnCopy,c.getTime())>f.minDuration&&h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,"onCopy"),f.prevTimeOnCopy=c.getTime()},onPaste:function(b){h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,"onPaste")},onCut:function(b){var c=new Date;h.duration(f.prevTimeOnCut,c.getTime())>f.minDuration&&h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,"onCut"),f.prevTimeOnCut=c.getTime()}});switch(i.TextFieldType){case e.AutoHeightMultiline:var l=80,m=k,n=null==i.MinimalHeight?l:i.MinimalHeight>0?i.MinimalHeight:0;m.MinHeight=n.toString()+"px",b=d(m);break;case e.FixHeightMultiline:c=React.DOM.textarea(k);break;case e.SingleLine:default:g=React.DOM.input(k)}var o;if(i.ShowCharCounter){var p=!i.Value||k.maxLength>i.Value.length?"office-form-textfield-counter":"office-form-textfield-counter textfield-counter-warning";o=React.DOM.label({className:p},this.getCounterString(i.Value,k.maxLength))}var q=a.Utilities.Html.combineAttributes("office-form-textfield",i.Options&&i.Options.classNameForInnerDiv);return React.DOM.div({className:q},b,c,g,o)},f.prototype.onChange=function(a){var b=a.target,c=b.value;if(c&&c.length>b.maxLength&&(c=c.slice(0,b.maxLength)),this.props.onValueChange(c),this.props.ShowCharCounter){var d=ReactDOM.findDOMNode(b).nextSibling;d&&(d.innerText=this.getCounterString(c,b.maxLength))}},f.prototype.getCounterString=function(a,b){return(a||"").length.toString()+" / "+b.toString()},f.prototype.logEngagementEvent=function(b,c,d){var e;this.props.HTMLAttributes&&(e=this.props.HTMLAttributes.className),a.Event.EngagementEvent.logData({name:c,extraData:{targetClassName:e,operation:d}})},f.prototype.duration=function(a,b){return b-a},f.prevTimeKeyDown=0,f.prevTimeOnCopy=0,f.prevTimeOnCut=0,f.minDuration=500,f}(b.ControlBase);b.TextField=f;var g=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.componentDidMount=function(){this.updateHeight(),this.windowResizeCallback=this.updateHeight.bind(this),window.addEventListener("resize",this.windowResizeCallback)},b.prototype.componentDidUpdate=function(){this.updateHeight()},b.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.windowResizeCallback)},b.prototype.render=function(){var a=_.clone(this.props);return delete a.MinHeight,React.DOM.textarea(a)},b.prototype.updateHeight=function(){var a=ReactDOM.findDOMNode(this),b=this.props,c=a.parentElement,d=c.style.height;c.style.height=window.getComputedStyle(c).height,a.style.height=b.MinHeight;var e=a.offsetHeight-a.clientHeight;a.style.height=a.scrollHeight+e+"px",c.style.height=d,a.style.minHeight=b.MinHeight},b}(a.ReactComponent)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createToggleButton=c;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.createReactNodes=function(){var a=[this.createToggleElement(),this.createLabel()];return a.concat(this.props.children)},c.prototype.createLabel=function(){var b=this.props.Options,c=b&&b.classNameForInnerLabel;return this.props.Disabled&&(c=a.Utilities.Html.combineAttributes(c,"disabled")),this.props.Label?React.DOM.span({className:c},this.props.Label):void 0},c.prototype.createToggleElement=function(){var b=this.props,c=b.Options,d=a.Utilities.Html.combineAttributes(c&&c.classNameForInnerDiv,b.Disabled?"toggle-button disabled":"toggle-button",b.Value?"office-form-theme-toggle active":void 0);return React.DOM.div({className:d,tabIndex:b.Disabled?-1:0,role:"button","aria-label":b.Label,"aria-pressed":b.Value,onClick:b.Disabled?function(){}:function(){b.onValueChange(!b.Value)},onKeyDown:function(c){(c.keyCode===a.KeyCode.Enter||c.keyCode===a.KeyCode.Space)&&b.onValueChange(!b.Value)}})},c}(b.ControlBase)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));
var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a.editorAndKeysContainerId="virtualkeyboard",a.algebraKeysContainerClass="vk-keys-algebrakeys",a.editorAndKeysContainerClass="vk-container",a.editorContainerClass="vk-editor-container",a.editorInputClass="vk-editor-input",a.keyClass="vk-keys-row-key",a.keysContainerClass="vk-keys-container",a.keysRowClass="vk-keys-row",a.keyCategoryAttribute="mq-category",a.keyCommandAttribute="mq-command",a.keyValueAttribute="mq-value",a.keyCategoryAlgebra="algebra",a.keyCategoryBasic="basic",a.keyCategoryCalculating="calculating",a.keyCategoryEmpty="empty",a.keyCategoryFunction="function",a.keyCommandWrite="write",a.keyCommandCmd="cmd",a.keyCommandStroke="keystroke",a.keyCommandSubmit="submit",a.keyTypeString="string",a.keyTypeSymbol="symbol",a.idNameJoiner="_";var b;!function(a){a[a.KeyEmpty=-1]="KeyEmpty",a[a.KeyZero=0]="KeyZero",a[a.KeyOne=1]="KeyOne",a[a.KeyTwo=2]="KeyTwo",a[a.KeyThree=3]="KeyThree",a[a.KeyFour=4]="KeyFour",a[a.KeyFive=5]="KeyFive",a[a.KeySix=6]="KeySix",a[a.KeySeven=7]="KeySeven",a[a.KeyEight=8]="KeyEight",a[a.KeyNine=9]="KeyNine",a[a.KeyEqual=10]="KeyEqual",a[a.KeyDot=11]="KeyDot",a[a.KeyComma=12]="KeyComma",a[a.KeyBackSpace=13]="KeyBackSpace",a[a.KeyLeftArrow=14]="KeyLeftArrow",a[a.KeyRightArrow=15]="KeyRightArrow",a[a.KeyAdd=16]="KeyAdd",a[a.KeyMinus=17]="KeyMinus",a[a.KeyMultiple=18]="KeyMultiple",a[a.KeyDivision=19]="KeyDivision",a[a.KeyGreaterOrEqual=20]="KeyGreaterOrEqual",a[a.KeyLessOrEqual=21]="KeyLessOrEqual",a[a.KeyParenthesis=22]="KeyParenthesis",a[a.KeyBracket=23]="KeyBracket",a[a.KeyAbs=24]="KeyAbs",a[a.KeyDenominator=25]="KeyDenominator",a[a.KeySquareRoot=26]="KeySquareRoot",a[a.KeyNthRoot=27]="KeyNthRoot",a[a.KeyX=28]="KeyX",a[a.KeyY=29]="KeyY",a[a.KeySquare=30]="KeySquare",a[a.KeyCaret=31]="KeyCaret",a[a.KeySubscript=32]="KeySubscript",a[a.KeyPi=33]="KeyPi",a[a.KeyAlpha=34]="KeyAlpha",a[a.KeyBeta=35]="KeyBeta",a[a.KeyDelta=36]="KeyDelta",a[a.KeyTheta=37]="KeyTheta",a[a.KeyGamma=38]="KeyGamma",a[a.KeySigma=39]="KeySigma",a[a.KeyLambda=40]="KeyLambda",a[a.KeyVarepsilon=41]="KeyVarepsilon",a[a.KeyCapitalSigma=42]="KeyCapitalSigma",a[a.KeyPhi=43]="KeyPhi",a[a.KeyCapitalDelta=44]="KeyCapitalDelta",a[a.KeyLog=45]="KeyLog",a[a.KeyLn=46]="KeyLn",a[a.KeyFactorial=47]="KeyFactorial",a[a.KeyInfinity=48]="KeyInfinity",a[a.KeyGreater=49]="KeyGreater",a[a.KeyLess=50]="KeyLess",a[a.KeyNotEqual=51]="KeyNotEqual",a[a.KeyMod=52]="KeyMod",a[a.KeyFloor=53]="KeyFloor",a[a.KeyCeil=54]="KeyCeil",a[a.KeySum=55]="KeySum",a[a.KeyProd=56]="KeyProd",a[a.KeyEnter=57]="KeyEnter",a[a.KeySin=58]="KeySin",a[a.KeyCos=59]="KeyCos",a[a.KeyTan=60]="KeyTan",a[a.KeyCot=61]="KeyCot",a[a.KeyDegree=62]="KeyDegree"}(b=a.KeyIdEnum||(a.KeyIdEnum={}));var c;!function(a){a[a.AlgebraKeyboard=0]="AlgebraKeyboard",a[a.BasicKeyboard=1]="BasicKeyboard"}(c=a.KeyboardTypeEnum||(a.KeyboardTypeEnum={})),a.cursorResetKeyIds=[b.KeyLog,b.KeyFactorial,b.KeyCeil,b.KeyFloor]}(b=a.KeyboardConstants||(a.KeyboardConstants={}))}(b=a.VirtualKeyboard||(a.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(){this.keyStorage=[{id:b.KeyboardConstants.KeyIdEnum.KeyEmpty,command:null,type:null,value:null,displayValue:null,category:b.KeyboardConstants.keyCategoryEmpty,title:null},{id:b.KeyboardConstants.KeyIdEnum.KeyZero,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"0",displayValue:"0",category:b.KeyboardConstants.keyCategoryBasic,title:"0"},{id:b.KeyboardConstants.KeyIdEnum.KeyOne,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"1",displayValue:"1",category:b.KeyboardConstants.keyCategoryBasic,title:"1"},{id:b.KeyboardConstants.KeyIdEnum.KeyTwo,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"2",displayValue:"2",category:b.KeyboardConstants.keyCategoryBasic,title:"2"},{id:b.KeyboardConstants.KeyIdEnum.KeyThree,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"3",displayValue:"3",category:b.KeyboardConstants.keyCategoryBasic,title:"3"},{id:b.KeyboardConstants.KeyIdEnum.KeyFour,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"4",displayValue:"4",category:b.KeyboardConstants.keyCategoryBasic,title:"4"},{id:b.KeyboardConstants.KeyIdEnum.KeyFive,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"5",displayValue:"5",category:b.KeyboardConstants.keyCategoryBasic,title:"5"},{id:b.KeyboardConstants.KeyIdEnum.KeySix,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"6",displayValue:"6",category:b.KeyboardConstants.keyCategoryBasic,title:"6"},{id:b.KeyboardConstants.KeyIdEnum.KeySeven,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"7",displayValue:"7",category:b.KeyboardConstants.keyCategoryBasic,title:"7"},{id:b.KeyboardConstants.KeyIdEnum.KeyEight,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"8",displayValue:"8",category:b.KeyboardConstants.keyCategoryBasic,title:"8"},{id:b.KeyboardConstants.KeyIdEnum.KeyNine,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"9",displayValue:"9",category:b.KeyboardConstants.keyCategoryBasic,title:"9"},{id:b.KeyboardConstants.KeyIdEnum.KeyEqual,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"=",displayValue:"=",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Equal},{id:b.KeyboardConstants.KeyIdEnum.KeyDot,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:".",displayValue:".",category:b.KeyboardConstants.keyCategoryBasic,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Dot},{id:b.KeyboardConstants.KeyIdEnum.KeyComma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:",",displayValue:",",category:b.KeyboardConstants.keyCategoryBasic,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Comma},{id:b.KeyboardConstants.KeyIdEnum.KeyBackSpace,command:b.KeyboardConstants.keyCommandStroke,type:b.KeyboardConstants.keyTypeString,value:"Backspace",displayValue:"CE",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Backspace},{id:b.KeyboardConstants.KeyIdEnum.KeyLeftArrow,command:b.KeyboardConstants.keyCommandStroke,type:b.KeyboardConstants.keyTypeString,value:"Left",displayValue:"←",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Leftarrow},{id:b.KeyboardConstants.KeyIdEnum.KeyRightArrow,command:b.KeyboardConstants.keyCommandStroke,type:b.KeyboardConstants.keyTypeString,value:"Right",displayValue:"→",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Rightarrow},{id:b.KeyboardConstants.KeyIdEnum.KeyAdd,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"+",displayValue:"+",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Add},{id:b.KeyboardConstants.KeyIdEnum.KeyMinus,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"-",displayValue:"-",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Minus},{id:b.KeyboardConstants.KeyIdEnum.KeyMultiple,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\times",displayValue:"×",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Multiply},{id:b.KeyboardConstants.KeyIdEnum.KeyDivision,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\div",displayValue:"÷",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Division},{id:b.KeyboardConstants.KeyIdEnum.KeyGreaterOrEqual,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\ge",displayValue:"≥",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_GreaterOrEqual},{id:b.KeyboardConstants.KeyIdEnum.KeyLessOrEqual,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\le",displayValue:"≤",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_LessOrEqual},{id:b.KeyboardConstants.KeyIdEnum.KeyParenthesis,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"(",displayValue:"( )",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Parenthesis},{id:b.KeyboardConstants.KeyIdEnum.KeyBracket,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"[",displayValue:"[ ]",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Bracket},{id:b.KeyboardConstants.KeyIdEnum.KeyAbs,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"|",displayValue:"|x|",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Absolute},{id:b.KeyboardConstants.KeyIdEnum.KeyDenominator,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"/",displayValue:"\\frac{x}{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Fraction},{id:b.KeyboardConstants.KeyIdEnum.KeySquareRoot,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"\\sqrt",displayValue:"\\sqrt{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_SquareRoot},{id:b.KeyboardConstants.KeyIdEnum.KeyNthRoot,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"\\nthroot",displayValue:"\\sqrt[]{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_NthRoot},{id:b.KeyboardConstants.KeyIdEnum.KeyX,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"x",displayValue:"x",category:b.KeyboardConstants.keyCategoryAlgebra,title:"x"},{id:b.KeyboardConstants.KeyIdEnum.KeyY,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"y",displayValue:"y",category:b.KeyboardConstants.keyCategoryAlgebra,title:"y"},{id:b.KeyboardConstants.KeyIdEnum.KeySquare,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeSymbol,value:"^2",displayValue:"x^2",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Square},{id:b.KeyboardConstants.KeyIdEnum.KeyCaret,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"^",displayValue:"x^{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeySubscript,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"_",displayValue:"x_{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Subscript},{id:b.KeyboardConstants.KeyIdEnum.KeyPi,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\pi",displayValue:"π",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Pi},{id:b.KeyboardConstants.KeyIdEnum.KeyAlpha,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\alpha",displayValue:"α",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Alpha},{id:b.KeyboardConstants.KeyIdEnum.KeyBeta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\beta",displayValue:"β",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Beta},{id:b.KeyboardConstants.KeyIdEnum.KeyDelta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\delta",displayValue:"δ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Delta},{id:b.KeyboardConstants.KeyIdEnum.KeyTheta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\theta",displayValue:"θ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Theta},{id:b.KeyboardConstants.KeyIdEnum.KeyGamma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\gamma",displayValue:"γ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Gamma},{id:b.KeyboardConstants.KeyIdEnum.KeySigma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\sigma",displayValue:"σ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Sigma},{id:b.KeyboardConstants.KeyIdEnum.KeyLambda,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\lambda",displayValue:"λ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Lambda},{id:b.KeyboardConstants.KeyIdEnum.KeyVarepsilon,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\varepsilon",displayValue:"ε",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Varepsilon},{id:b.KeyboardConstants.KeyIdEnum.KeyCapitalSigma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\Sigma",displayValue:"Σ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_CapitalSigma},{id:b.KeyboardConstants.KeyIdEnum.KeyPhi,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\phi",displayValue:"ϕ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Phi},{id:b.KeyboardConstants.KeyIdEnum.KeyCapitalDelta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\Delta",displayValue:"Δ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_CapitalDelta},{id:b.KeyboardConstants.KeyIdEnum.KeyLog,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeSymbol,value:"\\log_{}",displayValue:"\\log_{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Log},{id:b.KeyboardConstants.KeyIdEnum.KeyLn,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\ln",displayValue:"ln",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Ln},{id:b.KeyboardConstants.KeyIdEnum.KeyFactorial,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"!",displayValue:"x!",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Factorial},{id:b.KeyboardConstants.KeyIdEnum.KeyInfinity,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\infty",displayValue:"∞",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Infinity},{id:b.KeyboardConstants.KeyIdEnum.KeyGreater,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:">",displayValue:">",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Greater},{id:b.KeyboardConstants.KeyIdEnum.KeyLess,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"<",displayValue:"<",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Less},{id:b.KeyboardConstants.KeyIdEnum.KeyNotEqual,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\neq",displayValue:"≠",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_NotEqual},{id:b.KeyboardConstants.KeyIdEnum.KeyMod,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\mod",displayValue:"mod",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Mod},{id:b.KeyboardConstants.KeyIdEnum.KeyFloor,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\lfloor{}\\rfloor",displayValue:"⌊x⌋",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Floor},{id:b.KeyboardConstants.KeyIdEnum.KeyCeil,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\lceil{}\\rceil",displayValue:"⌈x⌉",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Ceil},{id:b.KeyboardConstants.KeyIdEnum.KeySum,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\sum",displayValue:"∑",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Sum},{id:b.KeyboardConstants.KeyIdEnum.KeyProd,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\prod",displayValue:"∏",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Prod},{id:b.KeyboardConstants.KeyIdEnum.KeyEnter,command:b.KeyboardConstants.keyCommandSubmit,type:b.KeyboardConstants.keyTypeString,value:"Enter",displayValue:"OK",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Enter},{id:b.KeyboardConstants.KeyIdEnum.KeySin,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\sin",displayValue:"sin",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Sin},{id:b.KeyboardConstants.KeyIdEnum.KeyCos,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\cos",displayValue:"cos",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Cos},{id:b.KeyboardConstants.KeyIdEnum.KeyTan,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\tan",displayValue:"tan",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Tan},{id:b.KeyboardConstants.KeyIdEnum.KeyCot,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\cot",displayValue:"cot",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Cot},{id:b.KeyboardConstants.KeyIdEnum.KeyDegree,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeSymbol,value:"^\\circ",displayValue:"^\\circ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Degree}]}return c.prototype.getDefinition=function(a){var b=this.keyStorage.filter(function(b){return b.id===a});return b[0]},c}();b.KeyStrokeManager=c}(c=b.VirtualKeyboard||(b.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(){this.clickUsage={},this.keydownUsage={},this.keyCategory=[{id:b.KeyboardConstants.KeyIdEnum.KeyDot,category:d.Decimal},{id:b.KeyboardConstants.KeyIdEnum.KeyX,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeyY,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeySubscript,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeyDenominator,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeyPi,category:d.Constant},{id:b.KeyboardConstants.KeyIdEnum.KeyInfinity,category:d.Constant},{id:b.KeyboardConstants.KeyIdEnum.KeyBracket,category:d.Group},{id:b.KeyboardConstants.KeyIdEnum.KeyParenthesis,category:d.Group},{id:b.KeyboardConstants.KeyIdEnum.KeyGreater,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyGreaterOrEqual,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyLess,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyLessOrEqual,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyNotEqual,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyNthRoot,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeySquareRoot,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeySquare,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeyCaret,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeyLog,category:d.Logarithm},{id:b.KeyboardConstants.KeyIdEnum.KeyLn,category:d.Logarithm},{id:b.KeyboardConstants.KeyIdEnum.KeyFactorial,category:d.Sequence},{id:b.KeyboardConstants.KeyIdEnum.KeySum,category:d.Sequence},{id:b.KeyboardConstants.KeyIdEnum.KeyProd,category:d.Sequence},{id:b.KeyboardConstants.KeyIdEnum.KeyCeil,category:d.Approximate},{id:b.KeyboardConstants.KeyIdEnum.KeyFloor,category:d.Approximate},{id:b.KeyboardConstants.KeyIdEnum.KeyAbs,category:d.Absolute},{id:b.KeyboardConstants.KeyIdEnum.KeyDegree,category:d.Degree}];for(var c=a.Utilities.getAllEnumValueNames(d),e=0;e<c.length;e++)this.clickUsage[c[e]]=0,this.keydownUsage[c[e]]=0}return c.prototype.setClickUsage=function(a){var b=this.getCategoryByKeyId(a);b>=0&&this.clickUsage[d[b]]++},c.prototype.setKeyDownUsage=function(a){var b=this.getCategoryByKeyId(a);b>=0&&this.keydownUsage[d[b]]++},c.prototype.getClickUsage=function(){return this.clickUsage},c.prototype.getKeyDownUsage=function(){return this.keydownUsage},c.prototype.getCategoryByKeyId=function(a){var b=this.keyCategory.filter(function(b){return b.id===a});return b&&b[0]?b[0].category:-1},c}();b.KeyUsageManager=c;var d;!function(a){a[a.Decimal=0]="Decimal",a[a.Variable=1]="Variable",a[a.Constant=2]="Constant",a[a.Group=3]="Group",a[a.Comparison=4]="Comparison",a[a.Exponent=5]="Exponent",a[a.Logarithm=6]="Logarithm",a[a.Sequence=7]="Sequence",a[a.Approximate=8]="Approximate",a[a.Absolute=9]="Absolute",a[a.Degree=10]="Degree"}(d||(d={}))}(c=b.VirtualKeyboard||(b.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(c,d){this.controlId=null,this.isTabable=!0,this.isVisible=!1,this.isMouseDown=!1,this.onMathEditorInsertion=new a.Utilities.Process.CallbackManager,this.onInputCompleted=new a.Utilities.Process.CallbackManager,this.onExitEditingMath=new a.Utilities.Process.CallbackManager,this.mathEditor=null,this.editorAndKeysContainer=null,this.editorContainer=null,this.editorInput=null,this.keysContainer=null,this.keyMap=[],this.keyLayoutRowCount=null,this.keyLayoutColumnCount=null,this.keyStrokeManager=new b.KeyStrokeManager,this.keyUsageManager=new b.KeyUsageManager,this.outsiderContainerSelector="#body-scrollable-content",d?this.controlId=d:this.controlId=a.Utilities.Guid.newGuid(),this.createLayout(c),this.activateKeyboard()}return c.prototype.show=function(){this.isVisible||(this.editorAndKeysContainer.show(),this.mathEditor.focus(),this.isVisible=!0)},c.prototype.close=function(){var b=this.keyUsageManager.getClickUsage(),c=this.keyUsageManager.getKeyDownUsage();a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DesignPage.MathKeyboard.Navigate,extraData:{clickCount:b,keydownCount:c}}),$(this.outsiderContainerSelector).off("click",this.onBodyClick),this.isVisible&&(this.editorAndKeysContainer.hide(),this.isVisible=!1)},c.prototype.attachEvent=function(a,c){if(c)switch(a){case b.KeyboardEventName.onMathEditorInsertion:this.onMathEditorInsertion.register(c);break;case b.KeyboardEventName.onInputCompleted:this.onInputCompleted.register(c);break;case b.KeyboardEventName.onExitEditingMath:this.onExitEditingMath.register(c)}},c.prototype.detachEvent=function(a,c){switch(a){case b.KeyboardEventName.onMathEditorInsertion:this.onMathEditorInsertion.unregister(c);break;case b.KeyboardEventName.onInputCompleted:this.onInputCompleted.unregister(c);break;case b.KeyboardEventName.onExitEditingMath:this.onExitEditingMath.unregister(c)}},c.prototype.setValue=function(a){this.mathEditor.select(),this.mathEditor.write(a),this.mathEditor.focus()},c.prototype.getValue=function(){return this.mathEditor.latex()},c.prototype.reset=function(){this.mathEditor.select(),this.mathEditor.keystroke("Backspace"),this.mathEditor.focus()},c.prototype.getElementId=function(a){return[this.controlId,a].join(b.KeyboardConstants.idNameJoiner)},c.prototype.parseKeyId=function(a){var c=a.split(b.KeyboardConstants.idNameJoiner);return c.length>=2?Number(c[1]):null},c.prototype.createLayout=function(a){this.editorAndKeysContainer=$("<div/>",{id:this.getElementId(b.KeyboardConstants.editorAndKeysContainerId),dir:"ltr"}).addClass(b.KeyboardConstants.editorAndKeysContainerClass).appendTo(a),this.createEditorLayout(),this.createKeysLayout()},c.prototype.activateKeyboard=function(){var a=this;this.onBodyClick=function(b){a.editorAndKeysContainer&&!a.editorAndKeysContainer.is(b.target)&&0===a.editorAndKeysContainer.has(b.target).length&&(a.isMouseDown?(b.preventDefault(),b.stopPropagation(),a.isMouseDown=!1):a.onInputCompleted.trigger(b))},$(this.outsiderContainerSelector).click(this.onBodyClick),this.editorInput.mousedown(function(b){b.preventDefault(),b.stopPropagation(),a.isMouseDown=!0}),this.editorInput.mouseup(function(b){a.isMouseDown=!1}),this.activateEditor(),this.activateKeys()},c.prototype.createEditorLayout=function(){this.editorContainer=$("<div/>").addClass(b.KeyboardConstants.editorContainerClass).attr({"aria-live":"polite"}).appendTo(this.editorAndKeysContainer),this.editorInput=$("<span/>").addClass(b.KeyboardConstants.editorInputClass).appendTo(this.editorContainer)},c.prototype.createKeysLayout=function(){this.keysContainer=$("<div/>").addClass(b.KeyboardConstants.keysContainerClass).appendTo(this.editorAndKeysContainer);var a=$("<div/>").addClass(b.KeyboardConstants.algebraKeysContainerClass).attr({role:"grid"}).appendTo(this.keysContainer);this.createSubKeysLayout(a)},c.prototype.createSubKeysLayout=function(c){var d=this,e=c.attr("class"),f=[];if(e!==b.KeyboardConstants.algebraKeysContainerClass)throw Error("className is not found.");f=b.KeysLayoutManager.getAlgebraLayout(),f.forEach(function(e){var f=$("<div/>").addClass(b.KeyboardConstants.keysRowClass).attr({role:"row"}).appendTo(c);e.forEach(function(c){var e=d.keyStrokeManager.getDefinition(c);if(e){var g={"class":a.Utilities.Html.combineAttributes("office-form-theme-primary-foreground",b.KeyboardConstants.keyClass),id:d.getElementId(e.id.toString()),tabindex:-1,title:e.title,role:"gridcell","aria-label":e.title};g[b.KeyboardConstants.keyCommandAttribute]=e.command,g[b.KeyboardConstants.keyValueAttribute]=e.value,g[b.KeyboardConstants.keyCategoryAttribute]=e.category;var h=e.id===b.KeyboardConstants.KeyIdEnum.KeyEmpty?$("<div/>"):$("<button/>");h.attr(g).appendTo(f);$("<span/>").addClass([b.KeyboardConstants.keyClass,e.type].join("-")).text(e.displayValue).attr({"aria-hidden":!0}).appendTo(h);d.isTabable&&(h.removeAttr("tabindex"),d.isTabable=!1),e.command===b.KeyboardConstants.keyCommandSubmit&&(h.addClass("office-form-theme-button"),h.removeAttr(b.KeyboardConstants.keyCategoryAttribute)),e.id===b.KeyboardConstants.KeyIdEnum.KeyEmpty&&h.removeAttr("id")}})})},c.prototype.activateEditor=function(){var c=this;if(!(this.editorInput&&this.editorInput.length>0))throw Error("Can not render mathField, editorInput is undefined.");var d=MathQuill.getInterface(2).MathField(this.editorInput[0]);this.mathEditor=d,this.editorInput.on("mousedown",".mq-text-mode",function(a){a.preventDefault(),a.stopPropagation()}),this.editorInput.on("keypress",function(a){var d=a.charCode||a.which,e=String.fromCharCode(d);e&&e.match(/^[(0-9.=+*\-)]$/)&&("*"===e&&(a.preventDefault(),a.stopPropagation(),e=c.keyStrokeManager.getDefinition(b.KeyboardConstants.KeyIdEnum.KeyMultiple).value,c.mathEditor.write(e),e="\\"+e),c.keyAnimation(e))}),this.editorInput.on("keydown",function(b){var d=b.keyCode||b.which,e=null;switch(d){case a.KeyCode.ArrowLeft:e="Left";break;case a.KeyCode.ArrowRight:e="Right";break;case a.KeyCode.BackSpace:e="Backspace"}c.keyAnimation(e),d===a.KeyCode.Enter?(b.preventDefault(),b.stopPropagation(),c.onInputCompleted.trigger(b)):d===a.KeyCode.PlaceHolder?b.key&&b.key.match(/^[a-zA-Z]$|^Unidentified$/)&&(b.preventDefault(),b.stopPropagation()):b.shiftKey&&d===a.KeyCode.Tab?c.onInputCompleted.trigger(b):d===a.KeyCode.Esc&&c.onExitEditingMath.trigger(b)})},c.prototype.activateKeys=function(){var c=this,d=this.keysContainer.find("."+[b.KeyboardConstants.keyClass,b.KeyboardConstants.keyTypeSymbol].join("-")),e=b.KeysLayoutManager.getAlgebraLayout();this.keyMap=b.KeysLayoutManager.getKeyMap(e),this.keyLayoutColumnCount=b.KeysLayoutManager.getLayoutColumnCount(e);for(var f=0;f<d.length;f++)MathQuill.getInterface(2).StaticMath(d[f]);this.keysContainer.on("mousedown",function(a){a.preventDefault(),a.stopPropagation(),c.mathEditor.focus()}),this.keysContainer.find("."+b.KeyboardConstants.keyClass).on("mousedown",function(a){if(!c.mathEditor)throw Error("mathEditor undefined.");a.preventDefault(),a.stopPropagation();var b=$(a.currentTarget);c.keyUsageManager.setClickUsage(c.getKeyId(b)),c.sendMathCommand(b),c.mathEditor.focus()}),this.keysContainer.find(".mq-root-block").on("mousedown",function(a){a.preventDefault(),a.stopPropagation();var d=$(a.currentTarget).closest("."+b.KeyboardConstants.keyClass);c.sendMathCommand(d)}),this.keysContainer.find("."+b.KeyboardConstants.keyClass).on("keydown",function(b){var d=b.which||b.keyCode,e=b.shiftKey;if(!e){var f=$(b.currentTarget);switch(d){case a.KeyCode.ArrowDown:case a.KeyCode.ArrowUp:case a.KeyCode.ArrowLeft:case a.KeyCode.ArrowRight:b.preventDefault(),b.stopPropagation();var g=c.getNextKeyId(f,d);if(g>=0){var h=c.getElementId(g.toString());$("#"+h).focus()}break;case a.KeyCode.Enter:case a.KeyCode.Space:b.preventDefault(),b.stopPropagation(),c.keyUsageManager.setKeyDownUsage(c.getKeyId(f)),c.sendMathCommand(f),f.focus();break;case a.KeyCode.BackSpace:b.preventDefault(),b.stopPropagation(),c.mathEditor.keystroke("Backspace");break;case a.KeyCode.Esc:c.onExitEditingMath.trigger(b)}}}),this.keysContainer.find("."+b.KeyboardConstants.keyClass).on("keypress",function(a){a.charCode>0&&c.mathEditor.typedText(String.fromCharCode(a.charCode))})},c.prototype.sendMathCommand=function(a){var c=a.attr(b.KeyboardConstants.keyCommandAttribute),d=a.attr(b.KeyboardConstants.keyValueAttribute);switch(c){case b.KeyboardConstants.keyCommandCmd:this.mathEditor.cmd(d);break;case b.KeyboardConstants.keyCommandWrite:this.mathEditor.write(d);break;case b.KeyboardConstants.keyCommandStroke:this.mathEditor.keystroke(d);break;case b.KeyboardConstants.keyCommandSubmit:this.onInputCompleted.trigger();
}var e=this.parseKeyId(a.attr("id"));this.adjustCursor(e)},c.prototype.getNextKeyId=function(c,d){var e=this.parseKeyId(c.attr("id")),f=this.keyMap.indexOf(e);if(f>=0){var g=[-1,-1*this.keyLayoutColumnCount,1,this.keyLayoutColumnCount],h=f+g[d-a.KeyCode.ArrowLeft];if(h>=this.keyMap.length||-1>=h)return e;for(;this.keyMap[h]===b.KeyboardConstants.KeyIdEnum.KeyEmpty;)h+=d===a.KeyCode.ArrowRight?1:-1;return this.keyMap[h]}},c.prototype.keyAnimation=function(a){if(a){var c=this.keysContainer.find("["+b.KeyboardConstants.keyValueAttribute+"='"+a+"']");c&&(c.css("background-color","#D2D2D2"),setTimeout(function(){c.css("background-color","")},200))}},c.prototype.getKeyId=function(a){var b=a.attr("id");if(b)return this.parseKeyId(b)},c.prototype.adjustCursor=function(a){-1!==b.KeyboardConstants.cursorResetKeyIds.indexOf(a)&&this.mathEditor.keystroke("Left")},c}();b.VirtualKeyboard=c}(c=b.VirtualKeyboard||(b.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a.onMathEditorInsertion="onMathInsertion",a.onInputCompleted="onInputCompleted",a.onExitEditingMath="onExitEditingMath"}(b=a.KeyboardEventName||(a.KeyboardEventName={}))}(b=a.VirtualKeyboard||(a.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(){}return b.getAlgebraLayout=function(){return b.algebraLayoutArray},b.getLayoutRowCount=function(a){return a?0:a.length},b.getLayoutColumnCount=function(a){return a&&a.length>0?a[0].length:0},b.getKeyMap=function(a){var c=[];if(!a)return c;for(var d=a.length,e=b.getLayoutColumnCount(a),f=0,g=0;d>g;g++)for(var h=0;e>h;h++)c[f]=a[g][h],f++;return c},b.algebraLayoutArray=[[a.KeyboardConstants.KeyIdEnum.KeyX,a.KeyboardConstants.KeyIdEnum.KeyY,a.KeyboardConstants.KeyIdEnum.KeySubscript,a.KeyboardConstants.KeyIdEnum.KeyDenominator,a.KeyboardConstants.KeyIdEnum.KeyBracket,a.KeyboardConstants.KeyIdEnum.KeyParenthesis,a.KeyboardConstants.KeyIdEnum.KeySeven,a.KeyboardConstants.KeyIdEnum.KeyEight,a.KeyboardConstants.KeyIdEnum.KeyNine,a.KeyboardConstants.KeyIdEnum.KeyDivision],[a.KeyboardConstants.KeyIdEnum.KeyGreater,a.KeyboardConstants.KeyIdEnum.KeyLess,a.KeyboardConstants.KeyIdEnum.KeyGreaterOrEqual,a.KeyboardConstants.KeyIdEnum.KeyLessOrEqual,a.KeyboardConstants.KeyIdEnum.KeyNotEqual,a.KeyboardConstants.KeyIdEnum.KeyAbs,a.KeyboardConstants.KeyIdEnum.KeyFour,a.KeyboardConstants.KeyIdEnum.KeyFive,a.KeyboardConstants.KeyIdEnum.KeySix,a.KeyboardConstants.KeyIdEnum.KeyMultiple],[a.KeyboardConstants.KeyIdEnum.KeySquareRoot,a.KeyboardConstants.KeyIdEnum.KeyNthRoot,a.KeyboardConstants.KeyIdEnum.KeySquare,a.KeyboardConstants.KeyIdEnum.KeyCaret,a.KeyboardConstants.KeyIdEnum.KeyLog,a.KeyboardConstants.KeyIdEnum.KeyLn,a.KeyboardConstants.KeyIdEnum.KeyOne,a.KeyboardConstants.KeyIdEnum.KeyTwo,a.KeyboardConstants.KeyIdEnum.KeyThree,a.KeyboardConstants.KeyIdEnum.KeyMinus],[a.KeyboardConstants.KeyIdEnum.KeyPi,a.KeyboardConstants.KeyIdEnum.KeyFactorial,a.KeyboardConstants.KeyIdEnum.KeySum,a.KeyboardConstants.KeyIdEnum.KeyProd,a.KeyboardConstants.KeyIdEnum.KeyFloor,a.KeyboardConstants.KeyIdEnum.KeyCeil,a.KeyboardConstants.KeyIdEnum.KeyZero,a.KeyboardConstants.KeyIdEnum.KeyDot,a.KeyboardConstants.KeyIdEnum.KeyEqual,a.KeyboardConstants.KeyIdEnum.KeyAdd],[a.KeyboardConstants.KeyIdEnum.KeyInfinity,a.KeyboardConstants.KeyIdEnum.KeyDegree,a.KeyboardConstants.KeyIdEnum.KeyEmpty,a.KeyboardConstants.KeyIdEnum.KeyEmpty,a.KeyboardConstants.KeyIdEnum.KeyEmpty,a.KeyboardConstants.KeyIdEnum.KeyEmpty,a.KeyboardConstants.KeyIdEnum.KeyBackSpace,a.KeyboardConstants.KeyIdEnum.KeyLeftArrow,a.KeyboardConstants.KeyIdEnum.KeyRightArrow,a.KeyboardConstants.KeyIdEnum.KeyEnter]],b}();a.KeysLayoutManager=b}(b=a.VirtualKeyboard||(a.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(c){function d(){var b=null!==c&&c.apply(this,arguments)||this;return b.state={MathQuillLoaded:!1},b.onBlur=function(c){var d=a.Utilities.Html.getTargetElementOfFocusEvent(c),e=ReactDOM.findDOMNode(b);e.contains(d)||b.props.onExit&&b.props.onExit()},b}return __extends(d,c),d.prototype.render=function(){return React.createElement("div",{onBlur:this.onBlur,ref:"VirtualKeyboard"})},d.prototype.componentWillMount=function(){var b=this;a.JavaScriptLoader.loadJavaScript("MathQuill").done(function(){b.setState({MathQuillLoaded:!0})})},d.prototype.componentDidMount=function(){this.renderVirtualKeyboard()},d.prototype.componentDidUpdate=function(){this.renderVirtualKeyboard()},d.prototype.componentWillUnmount=function(){this.keyborad&&(this.props.onValueChange(this.keyborad.getValue()),this.keyborad.close(),this.keyborad.detachEvent(b.VirtualKeyboard.KeyboardEventName.onInputCompleted,this.onValueChange),this.keyborad.detachEvent(b.VirtualKeyboard.KeyboardEventName.onExitEditingMath,this.onExitEdit))},d.prototype.renderVirtualKeyboard=function(){var a=this;if(this.state.MathQuillLoaded&&!this.keyborad){var c=$(ReactDOM.findDOMNode(this.refs.VirtualKeyboard));this.keyborad=new b.VirtualKeyboard.VirtualKeyboard(c,this.props.QuestionId),this.keyborad.show(),this.keyborad.setValue(this.props.Value),this.onExitEdit=function(b){a.props.onExit&&a.props.onExit(!0)},this.onValueChange=function(b,c){a.props.onValueChange(a.keyborad.getValue()),a.onExitEdit(b)},this.keyborad.attachEvent(b.VirtualKeyboard.KeyboardEventName.onInputCompleted,this.onValueChange),this.keyborad.attachEvent(b.VirtualKeyboard.KeyboardEventName.onExitEditingMath,this.onExitEdit)}},d}(a.ReactComponent);b.VirtualKeyboardControl=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){this.lastAcquireTokenSuccessTime=null,this.waitHostAccessTokenRetryCount=0}return b.prototype.getToken=function(){var c=this;return a.Utilities.Flight.isOembedTrialSSOEnabled()||a.Utilities.Flight.isPPTContentAddinSSOEnabled()?(b.getAccessTokenFromHostHandler||(b.getAccessTokenFromHostHandler=$.Deferred()),b.AccessTokenFromHost&&b.AccessTokenFromHost.isAccessTokenFromHostValid()?(b.getAccessTokenFromHostHandler.resolve(b.AccessTokenFromHost.AccessToken),b.getAccessTokenFromHostHandler.promise()):(("resolved"===b.getAccessTokenFromHostHandler.state()||"rejected"===b.getAccessTokenFromHostHandler.state())&&(b.getAccessTokenFromHostHandler=$.Deferred()),b.getAccessTokenFromHost(),this.waitForAccessToken(),b.getAccessTokenFromHostHandler.promise())):a.Utilities.enterSSO()?a.Form.AddinAuth.getAddinAccessToken().then(function(a){return a},function(a){return c.getTokenInternal()}):this.getTokenInternal()},b.getAccessTokenFromHost=function(){b.AccessTokenFromHost=null,window.addEventListener("message",b.receiveAccessToken,!1),window.parent.postMessage("GetAccessTokenFromHost","*")},b.receiveAccessToken=function(a){if(a.data.startsWith("FormsAccessTokenFromHost:"))try{var c="FormsAccessTokenFromHost:Bearer ",e=a.data.indexOf(c);if(-1!=e){var f=a.data.substring(e+c.length);b.AccessTokenFromHost=new d(f)}}finally{window.removeEventListener("message",b.receiveAccessToken,!1)}},b.prototype.getTokenInternal=function(){var b=this,c=$.Deferred();return a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?(c.resolve(null),c.promise()):(a.Authenticator.hasUserLoggedIn()?a.Authenticator.AuthContext.acquireToken(a.EnvironmentConfig.getFormsResourceId(),function(d,e){if(d||!e)if(a.Authenticator.isTokenValid()){a.Authenticator.AuthContext.clearCache();var f=new Error;if(d.match("^AADSTS50058:"))if(a.Utilities.isIE()||a.Utilities.isEdge()){var g=a.SafeStorage.DefaultStorage,h=g.getItem(a.SafeStorage.KeyPrefix_UseLegacyLoginDomain);if(a.Event.ErrorEvent.logData({type:a.Event.ErrorType.LoginIECrossZone,errorInfo:{useLegacyLoginDomain:!!h}}),h)g.removeItem(a.SafeStorage.KeyPrefix_UseLegacyLoginDomain),a.Authenticator.detectThirdPartyCookieSupport(function(b){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Auth.Auth.ThirdPartyCookieSupport,extraData:{allow:b}}),b?(f.name=a.Form.ClientErrorNames.LoginIECrossZoneError,f.message=d):(f.name=a.Form.ClientErrorNames.ThirdPartyCookieBlockedError,f.message=d),c.reject(f)});else if(g.setItem(a.SafeStorage.KeyPrefix_UseLegacyLoginDomain,"1"),h=g.getItem(a.SafeStorage.KeyPrefix_UseLegacyLoginDomain))return void window.location.reload()}else a.Event.ErrorEvent.logData({type:a.Event.ErrorType.AADAcquireTokenFailure,errorInfo:d}),a.Authenticator.detectThirdPartyCookieSupport(function(b){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Auth.Auth.ThirdPartyCookieSupport,extraData:{allow:b}}),b?(f.name=a.Form.ClientErrorNames.AADAcquireTokenError,f.message=d):(f.name=a.Form.ClientErrorNames.ThirdPartyCookieBlockedError,f.message=d),c.reject(f)});else d.match("^AADSTS50079:")?(a.Event.ErrorEvent.logData({type:a.Event.ErrorType.AADAcquireTokenMfaCheckFailure,errorInfo:d}),f.name=a.Form.ClientErrorNames.AADAcquireTokenMfaCheckError,f.message=d,c.reject(f)):(a.Event.ErrorEvent.logData({type:a.Event.ErrorType.AADAcquireTokenFailure,errorInfo:d}),f.name=a.Form.ClientErrorNames.AADAcquireTokenError,f.message=d,c.reject(f))}else{if(b.lastAcquireTokenSuccessTime){var i=+new Date-+b.lastAcquireTokenSuccessTime;a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Auth.Auth.AcquireTokenIdleTime,extraData:{error:d,idleTimeInMinutes:i/6e4}})}a.Authenticator.AuthContext.clearCache(),window.location.reload()}else b.lastAcquireTokenSuccessTime=new Date,c.resolve(e)}):c.resolve(null),c.promise())},b.prototype.waitForAccessToken=function(){var a=this;return null!=b.AccessTokenFromHost?b.getAccessTokenFromHostHandler.resolve(b.AccessTokenFromHost.AccessToken):this.waitHostAccessTokenRetryCount<10?(this.waitHostAccessTokenRetryCount++,setTimeout(function(){return a.waitForAccessToken()},1e3)):(this.waitHostAccessTokenRetryCount=0,b.getAccessTokenFromHostHandler.resolve(null)),b.getAccessTokenFromHostHandler.promise()},b.AccessTokenFromHost=null,b}();b.AuthContext=c;var d=function(){function a(a){this.accessToken=a;var b=33e5;this.tokenExpireTime=(new Date).getTime()+b}return Object.defineProperty(a.prototype,"AccessToken",{get:function(){return this.accessToken},enumerable:!0,configurable:!0}),a.prototype.isAccessTokenFromHostValid=function(){return!!this.accessToken&&(new Date).getTime()<this.tokenExpireTime},a}()}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.DataProvider=b}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.OFFICE_FORMS_PLAN_2=0]="OFFICE_FORMS_PLAN_2",a[a.OFFICE_FORMS_PLAN_3=1]="OFFICE_FORMS_PLAN_3"}(c=b.EduLicenseName||(b.EduLicenseName={}));var d;!function(a){a[a.FORMS_PLAN_E1=0]="FORMS_PLAN_E1",a[a.FORMS_PLAN_E3=1]="FORMS_PLAN_E3",a[a.FORMS_PLAN_E5=2]="FORMS_PLAN_E5",a[a.FORMS_PLAN_K=3]="FORMS_PLAN_K"}(d=b.BusinessLicenseName||(b.BusinessLicenseName={}));var e=function(){function e(){}return e.isEduUser=function(){return e.getUserInfo().then(function(){return e.userHasEduLicense})},e.isBusinessUser=function(){return e.getUserInfo().then(function(){return e.userHasBusinessLicense})},e.isMsaFreeUser=function(){return e.getUserInfo().then(function(){return e.isMsaUser()&&!e.userHasMsaPaidLicense})},e.isMsaPaidUser=function(){return e.getUserInfo().then(function(){return e.isMsaUser()&&e.userHasMsaPaidLicense})},e.isMsaUser=function(){var b=OfficeFormServerInfo.userInfo.TenantId;return!(!b||b.toLowerCase()!==a.EnvironmentConfig.getMsaTenantId())},e.isMsftUser=function(){var b=OfficeFormServerInfo.userInfo.TenantId;return!(!b||b.toLowerCase()!==a.EnvironmentConfig.getMsftTenantId())},e.getUserType=function(){return e.getUserInfo().then(function(){var a=b.Models.UserType.Unknown;return e.userHasEduLicense&&(a=b.Models.UserType.Edu),e.userHasBusinessLicense&&(a|=b.Models.UserType.Biz),e.isMsftUser()&&(a|=b.Models.UserType.MSIT),e.isMsaUser()&&(a|=e.userHasMsaPaidLicense?b.Models.UserType.MsaPaid:b.Models.UserType.MsaFree),a},function(){return b.Models.UserType.Unknown})},e.setUserEduLicenseState=function(a){for(var b in c)if(a.hasOwnProperty(c[b])){var d=a[c[b]];if(d&&d.length>0)return void(e.userHasEduLicense=!0)}e.userHasEduLicense=!1},e.setUserBusinessLicenseState=function(a){for(var b in d)if(a.hasOwnProperty(d[b])){var c=a[d[b]];if(c&&c.length>0)return void(e.userHasBusinessLicense=!0)}e.userHasBusinessLicense=!1},e.setUserMsaLicenseState=function(a){return e.isMsaUser()&&a?void(e.userHasMsaPaidLicense=!0):void(e.userHasMsaPaidLicense=!1)},e.getUserInfo=function(){return e.licenseReady||(e.licenseReady=$.Deferred(),$(document).ready(function(){if(OfficeFormServerInfo.userInfo.UserId){var b=a.DataProvider.ProviderManager.getInstance().createDataProvider();try{b.getUserInfo().then(function(a){var b=_.object(a.licenses.map(function(a){var b=a.licenseName,c=a.skus;return[b,JSON.parse(c)]}));e.setUserEduLicenseState(b),e.setUserBusinessLicenseState(b),e.setUserMsaLicenseState(a.isPaidUser),e.licenseReady.resolve(b)},function(a){return e.licenseReady.reject(a)})}catch(c){e.licenseReady.reject(c)}}else e.licenseReady.resolve({});e.licenseReady.fail(function(b){a.Event.ErrorEvent.logData({type:a.Event.ErrorType.UserInfoGetFailure,errorInfo:b})})})),e.licenseReady.promise()},e}();b.FeaturePlanProvider=e}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c,d=b.ErrorCode.InnerCode;!function(c){function e(){var b="ms-formweb";if(a.EnvironmentSettings.IsIntegration){var c=a.EnvironmentSettings.GetHostString();c&&a.HostApps[c]&&(b="ms-"+c.toLowerCase()),OfficeFormServerInfo.isOembedSPO&&(b="forms-webpart")}return b}function f(){var c="business";return a.EnvironmentConfig.getEnvironmentType()===a.EnvironmentType.USGovGccProd?c="gcc":b.FeaturePlanProvider.isMsaUser()||Forms.Common.isOwnerMsaUser()?c="msa":(b.FeaturePlanProvider.isMsftUser()||Forms.Common.isOwnerMsftUser())&&(c="msft"),c}function g(b,c,d){void 0===d&&(d=!1);var g,j=$.Deferred();(!c||a.Flighting.Flight.isEnabled(a.Flighting.Flights.LogAllQoSEvent))&&(g=new a.Event.QosEvent(b.qosEventName),_.extend(g.Data,{extraData:_.clone(b.qosExtraData)}),g.start(),b.headers["X-CorrelationId"]=g.CorrelationId),b.headers["x-ms-form-request-source"]=e(),b.headers["x-ms-form-request-ring"]=f();var k=-1,m=function(){k++,i(b,function(a){j.resolve(a)},function(c){if(k>=5)return void j.reject(c);var d,e=h(b,c),f=parseInt(e.statusCode),i=e.innerCode;if(0===f||502===f||503===f)d="Forms_Http_"+f.toString();else if(500===f&&6503===i)d="CDB_Http_"+i.toString();else{if(624!==i)return void j.reject(c);d="CDB_Http_"+i.toString()}g&&g.log({resultCode:d,resultType:a.Event.ResultType.Error,extraData:{RetryCount:k,ServiceError:c}}),m()},d)};return m(),g?j.promise().done(function(b){var c={};if(c.resultCode=b&&b.response?b.response.statusCode:"",c.resultType=a.Event.ResultType.Success,g.Name===a.Event.QosEventNames.ServiceEndpoints.Form.CreateForm){var d=l.parseResponseData(b,!0);c.extraData={FormId:d.value.id,XLWorkbookId:d.value.xlWorkbookId||void 0,Origin:a.Telemetry.getOrigin()||void 0,RetryCount:k||void 0}}g.end(c)}).fail(function(c){var d=h(b,c),e=parseInt(d.statusCode);g.end({resultCode:c&&c.response?c.response.statusCode:"",resultType:""===d.statusCode||e>=500?a.Event.ResultType.Failure:a.Event.ResultType.ExpectedFailure,extraData:{ServiceError:d,RetryCount:k||void 0}})}):j.promise()}function h(a,b){var c=l.parseResponseData(b,!1),d={statusCode:b&&b.response?b.response.statusCode:"",sourceUrl:a.requestUri.toString(),correlationId:b&&b.response?b.response.headers["X-CorrelationId"]:"",statusText:b&&b.response?b.response.statusText:"",innerCode:c&&c.error?c.error.innerCode:-1,innerMessage:c&&c.error?c.error.innerMessage:"",failureReason:b&&b.response?b.response.headers["X-FailureReason"]:""};return d}function i(c,d,e,f){function g(f){b.AuthTokenHelper.getInstance().isAuthTokenExpiredFailure(f)?b.AuthTokenHelper.getInstance().refreshAuthToken(function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.RefreshServerInfoInFrame)?c.blobResponseType?j(c,d,e):odatajs.oData.request(c,d,e):(a.PageMethods.refreshAntiForgeryToken(function(){c.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken,odatajs.oData.request(c,d,e)},function(){return location.reload()}),OfficeFormServerInfo.userInfo.UserId||a.PageMethods.refreshUserInfo(void 0,void 0))},function(){a.Authenticator.signInThenRefresh()}):b.AuthTokenHelper.getInstance().isAntiForgeryTokenValidationFailure(f)?location.reload():e(f)}void 0===f&&(f=!1),c.blobResponseType?j(c,d,f?e:g):odatajs.oData.request(c,d,f?e:g)}function j(a,b,c){var d=new XMLHttpRequest,e=a.requestUri;if(d.onreadystatechange=function(){if(null!=d&&4===d.readyState){var f=d.status,g=d.statusText;1223===f&&(f=204,g="No Content");var h=d.response;if(f>=200&&299>=f)d=null,b(h);else{var i=k(d);d=null,c({message:"HTTP request failed",request:a,response:{requestUri:e,statusCode:f,statusText:g,headers:i,body:h}})}}},d.open(a.method||"GET",e,!0),d.responseType="blob",a.headers)for(var f in a.headers)d.setRequestHeader(f,a.headers[f]);d.send(a.body)}function k(a){for(var b={},c=0,d=a.getAllResponseHeaders().split(/\r?\n/);c<d.length;c++){var e=d[c];if(e){var f=e.split(": ");b[f[0]]=f[1]}}return b}var l=function(){function c(){}return c.parseAndTryHandleError=function(e){var f=$.Deferred(),g=c.parseResponseData(e,!1),h=g&&g.error;if(h)if(h.statusCode!==b.ErrorCode.HttpStatusCode.Unauthorized)f.reject(h);else if(a.EnvironmentSettings.Host===a.HostApps.PowerPoint)f.reject(h);else{if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth))return c.handleAuthErrorWithCookieAuth(h);a.Authenticator.hasUserLoggedIn()&&a.Authenticator.isTokenValid()?(c.logNonRecoverableError(h),f.reject(h)):a.Utilities.Html.getQueries().embed?(h.innerCode=d.EmbedFormNeedAuth,f.reject(h)):this.doesCurrentBrowserSupportLoginPage()?a.Authenticator.signInThenRefresh():(h.innerCode=d.LoginNotSupportInCurrentBrowser,f.reject(h))}else f.reject(g);return f.promise()},c.doesCurrentBrowserSupportLoginPage=function(){return!(a.Utilities.isTbsBrowser()&&a.Utilities.isMicroMessenger()&&a.Utilities.isAndroid())},c.handleAuthErrorWithCookieAuth=function(b){var e=$.Deferred();return c.logNonRecoverableError(b),a.Utilities.Html.getQueries().embed?(b.innerCode=d.EmbedFormNeedAuth,e.reject(b)):b.innerCode===d.NoPermission||b.innerCode===d.RequireLogin?this.doesCurrentBrowserSupportLoginPage()?a.Authenticator.signInThenRefresh():(b.innerCode=d.LoginNotSupportInCurrentBrowser,e.reject(b)):e.reject(b),e.promise()},c.logNonRecoverableError=function(b){if(b){var c;switch(b.innerCode){case d.UserNotAllowed:c=a.Event.EngagementEventNames.Auth.Auth.NotOnboardedTenant;break;case d.DisabledByTenantAdmin:c=a.Event.EngagementEventNames.Auth.Auth.DisabledByTenantAdmin;break;case d.UserNeedMultiFactorAuth:c=a.Event.EngagementEventNames.Auth.Auth.UserNeedMultiFactorAuth;break;default:c="Undefined auth error in ResponseHandler"}a.Event.EngagementEvent.logData({name:c,extraData:{tenantId:OfficeFormServerInfo.userInfo.TenantId}})}},c.parseResponseData=function(c,e){var f={status:e?b.AsyncResultStatus.Succeeded:b.AsyncResultStatus.Failed};if(e){if(c){var g=c["@odata.count"]&&parseInt(c["@odata.count"]);isNaN(g)||(f.count=g),f.value=a.Utilities.tryParseJson(void 0===c.value?c:c.value)}}else{var h={statusCode:c&&c.response&&c.response.statusCode,statusText:c&&c.response&&c.response.statusText,headers:c&&c.response&&c.response.headers,correlationId:c&&c.response&&c.response.headers["X-CorrelationId"]},i=c&&c.response&&a.Utilities.tryParseJson(c.response.body),j=i.error&&parseInt(i.error.code);isNaN(j)?h.innerCode=0===h.statusCode?d.NetworkIssue:void 0:h.innerCode=j,h.innerMessage=i.error&&i.error.message,f.error=h}return f},c}();c.ResponseHandler=l,c.getExtendedSource=e,c.getRequestTargetRing=f,c.send=g}(c=b.OData||(b.OData={})),a.Exports.DataProvider.OData=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){a[a.Taskpane=1]="Taskpane",a[a.Content=2]="Content"}(b=a.AddinType||(a.AddinType={}));var c=function(){function a(){}return Object.defineProperty(a,"AddinType",{get:function(){return a._addinType},set:function(b){a._addinType=b},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsTaskpane",{get:function(){return a.AddinType===b.Taskpane},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsContentAgave",{get:function(){return a.AddinType===b.Content},enumerable:!0,configurable:!0}),Object.defineProperty(a,"HostPlatform",{get:function(){return Office.context.platform},enumerable:!0,configurable:!0}),a}();a.AddinSettings=c}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){a._instance=this}return a.getInstance=function(){return a._instance?a._instance:new a},Object.defineProperty(a.prototype,"HostEnvironment",{get:function(){return this.hostEnvironment},set:function(a){this.hostEnvironment=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HostPlatform",{get:function(){return this.hostPlatform},set:function(a){this.hostPlatform=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HostLocale",{get:function(){return this.hostLocale},set:function(a){this.hostLocale=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"AccessToken",{get:function(){return this.accessToken},set:function(a){this.accessToken=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsSSOAllowed",{get:function(){return this.isSSOAllowed},set:function(a){this.isSSOAllowed=a},enumerable:!0,configurable:!0}),a}();a.PowerPointContentAddinContext=b}(b=a.PowerPointContentAddin||(a.PowerPointContentAddin={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return Object.defineProperty(b,"DeferredHandler",{get:function(){return b.deferredHandler||(b.deferredHandler=$.Deferred())},enumerable:!0,configurable:!0}),b.getPopupUrl=function(b,c,d){void 0===c&&(c=a.AuthProvider.Default),void 0===d&&(d=null);var e=a.Utilities.Html.getAbsoluteUrl("/Pages/PopupLoginPage.aspx?"+a.EnvironmentSettings.PopupNotifyTypeParam+"="+a.PopupNotifyType[b]);return null!=c&&c!==a.AuthProvider.Default&&(e+="&"+a.EnvironmentSettings.AuthProviderParam+"="+a.AuthProvider[c]),d&&(e+="&"+a.EnvironmentSettings.AuthUpnParam+"="+encodeURIComponent(d)),e},b.setDialogSignInSize=function(a,c){b.popupLoginPageWidth=a,b.popupLoginPageHeight=c},b.officeDialogSignIn=function(c){return Office.context.ui.displayDialogAsync(b.getPopupUrl(a.PopupNotifyType.OfficeAPI,a.AuthProvider.OrgId,c),{width:b.popupLoginPageWidth,height:b.popupLoginPageHeight,hideTitle:!0,promptBeforeOpen:!1},function(c){var d=c.value;null!=d&&d.addEventHandler(Office.EventType.DialogMessageReceived,function(c){if(d.close(),c&&c.message){var e=JSON.parse(c.message);OfficeFormServerInfo=e||OfficeFormServerInfo,a.Flighting.Flight.refreshFlights()}b.DeferredHandler.resolve()})}),b.DeferredHandler.promise()},b.getAddinAccessToken=function(){if(a.Utilities.applyAssignmentsSSO())return this.assignmentsSsoHandler();if(a.Utilities.applyTeamSSO())return this.teamSsoHandler();if(a.EnvironmentSettings.IsPPTIntegration){if(a.AddinSettings.IsTaskpane&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTTaskpaneAddinSSO))return this.pptFirstPartySsoHandler();if(a.AddinSettings.IsContentAgave){if(a.AddinSettings.HostPlatform===Office.PlatformType.PC&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTWin32ContentAddinSSO))return this.pptFirstPartySsoHandler();if(a.AddinSettings.HostPlatform===Office.PlatformType.OfficeOnline&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTContentAddinSSO))return this.pptThirdPartySsoHandler()}}return $.Deferred().reject("GetAddinAccessTokenFailed").promise()},b.teamSsoHandler=function(){var b=this,c=$.Deferred(),d={successCallback:function(d){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.SsoSuccess}),b.refreshInfo(d).always(function(){return c.resolve(d)})},failureCallback:function(b){a.Event.ErrorEvent.logData({type:a.Event.ErrorType.TeamsTabSsoLoginFailure,errorInfo:b}),c.reject(b)},resources:["https://forms.office.com"]};return microsoftTeams.authentication.getAuthToken(d),c.promise()},b.assignmentsSsoHandler=function(){var a=this,b=$.Deferred(),c=function(d){if(d.data&&d.data.startsWith("GetAccessTokenFromAssignments:"))try{var e="GetAccessTokenFromAssignments:Bearer ",f=d.data.indexOf(e);if(-1!==f){var g=d.data.substring(f+e.length);a.refreshInfo(g).always(function(){return b.resolve(g)})}}finally{window.removeEventListener("message",c,!1)}};return window.addEventListener("message",c,!1),window.parent.postMessage("GetAccessTokenFromAssignments","*"),b.promise()},b.pptFirstPartySsoHandler=function(){var b=this,c=$.Deferred();a.Event.EngagementEvent.logData({name:a.AddinSettings.IsTaskpane?a.Event.EngagementEventNames.PowerPointTaskpaneAddinPage.Initialize.GetToken:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetToken,extraData:{hostPlatform:a.AddinSettings.HostPlatform,isFirstParty:!0}});var d=new OfficeCore.RequestContext,e=d.firstParty.authentication.getAccessToken({resource:"https://forms.office.com"});return d.sync().then(function(){a.Event.EngagementEvent.logData({name:a.AddinSettings.IsTaskpane?a.Event.EngagementEventNames.PowerPointTaskpaneAddinPage.Initialize.GetTokenCompleted:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetTokenCompleted,extraData:{hostPlatform:a.AddinSettings.HostPlatform,isFirstParty:!0,isGetAccessTokenSucceeded:!0}});var d=e.value.accessToken;b.refreshInfo(d).always(function(){return c.resolve(d)})})["catch"](function(b){a.Event.ErrorEvent.logData({type:a.AddinSettings.IsTaskpane?a.Event.ErrorType.PowerPointTaskpaneAddinGetTokenFailure:a.Event.ErrorType.PowerPointContentAddinGetTokenFailure,errorInfo:b}),c.reject(b)}),c.promise()},b.pptThirdPartySsoHandler=function(){var b=this,c=$.Deferred();if(a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetToken,extraData:{isFirstParty:!1}}),Office.context.auth.getAccessTokenAsync)Office.context.auth.getAccessTokenAsync({forceConsent:!1,forceAddAccount:!1},function(d){if(d.status===Office.AsyncResultStatus.Succeeded){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetTokenCompleted,extraData:{isFirstParty:!1}});var e=d.value;b.refreshInfo(e).always(function(){return c.resolve(e)})}else a.Event.ErrorEvent.logData({type:a.Event.ErrorType.PowerPointContentAddinGetTokenFailure,errorInfo:d.error}),c.reject(d.error)});else{var d=a.Form.PowerPointContentAddin.PowerPointContentAddinContext.getInstance();a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetTokenThirdPartySSONotSupported,extraData:{hostEnvironment:d.HostEnvironment,hostPlatform:d.HostPlatform}}),c.reject("Third party SSO API is not supported.")}return c.promise()},b.teamsPopupSignIn=function(){return a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.Navigate}),microsoftTeams.authentication.authenticate({url:b.getPopupUrl(a.PopupNotifyType.TeamsAPI,a.AuthProvider.OrgId),width:b.popupLoginPageWidth,height:b.popupLoginPageHeight,successCallback:function(c){if(c){var d=JSON.parse(c);OfficeFormServerInfo=d||OfficeFormServerInfo,a.Flighting.Flight.refreshFlights()}a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.Success}),b.DeferredHandler.resolve()},failureCallback:function(c){a.Event.ErrorEvent.logData({type:a.Event.ErrorType.TeamsTabLoginFailure,errorInfo:c}),b.DeferredHandler.reject(c)}}),b.DeferredHandler.promise()},b.refreshInfo=function(b){try{return $.when(this.refreshUserInfo(b),this.refreshFlights(b))}catch(c){return a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.RefreshInfoFailed}),$.Deferred().resolve().promise()}},b.refreshUserInfo=function(c){return b.userInfoPromise&&b.userInfoPromise.state()!==a.Utilities.Promise.State.Rejected||(b.userInfoPromise=a.PageMethods.refreshUserInfoWithToken(c).then(function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetAddinUserInfoSuccess})},function(b){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetAddinUserInfoFailed,extraData:{error:b}})})),b.userInfoPromise},b.refreshFlights=function(c){return b.flightPromise&&b.flightPromise.state()!==a.Utilities.Promise.State.Rejected||(b.flightPromise=a.PageMethods.refreshFlightsWithToken(c).then(function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetFlightsSuccess}),a.Flighting.Flight.refreshFlights()},function(b){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetFlightsFailed,extraData:{error:b}})})),b.flightPromise},b.popupLoginPageHeight=485,b.popupLoginPageWidth=770,b}();b.AddinAuth=c,a.Exports.AddinAuth=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(c,d){this.aadLauncherSesstionStorageKey="aadFormLauncher",this.msaLauncherSesstionStorageKey="msaFormLauncher",this.isAccessTokenFromHostReceived=!1,this.authContext=new b.AuthContext,this.serviceUrl=c,this.ownerServiceUrl=d,this.partialUpdateHttpMethod=a.Flighting.Flight.isEnabled(a.Flighting.Flights.PartialPut)?"PUT":"PATCH"}return Object.defineProperty(c,"AnalysisFormEntityCollectionName",{get:function(){return"analysisForms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FormEntityCollectionName",{get:function(){return"forms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RuntimeFormEntityCollectionName",{get:function(){return"runtimeForms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"SearchFormFunctionName",{get:function(){return"SearchForms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"QuestionEntityCollectionName",{get:function(){return"questions"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ChoiceEntityCollectionName",{get:function(){return"choices"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ResponseEntityCollectionName",{get:function(){return"responses"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RuntimeResponseEntityCollectionName",{get:function(){return"runtimeresponses"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"CommentEntityCollectionName",{get:function(){return"comments"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetSharedForm",{get:function(){return"GetSharedForm"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PermissionEntityCollectionName",{get:function(){return"permissions"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PermissionTokenEntityCollectionName",{get:function(){return"permissionTokens"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"SharedWithMeFormEntityCollectionName",{get:function(){return"sharedWithMeForms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetAggregateQuizDataFunctionName",{get:function(){return"GetAggregateQuizData"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetAggregateSurveyDataFunctionName",{get:function(){return"GetAggregateSurveyData"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetOrCreatePermissionTokenFunctionName",{get:function(){return"Microsoft.FormServices.GetOrCreatePermissionToken"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RemoveRecentFormFunctionName",{
get:function(){return"RemoveFromRecent"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"CreateOneDriveSessionTempFolderFunctionName",{get:function(){return"Microsoft.FormServices.CreateOneDriveSessionTempFolder"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"MoveFormFunctionName",{get:function(){return"MoveForm"},enumerable:!0,configurable:!0}),c.prototype.getForms=function(b){var d=this.getSurveyWebOwnerServiceUrl()+"light/";return d+=c.FormEntityCollectionName+c.getQueryParameters("?",b),this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetForms})},c.prototype.searchForms=function(b,d,e,f){var g="";return b&&(b=encodeURIComponent(b),g=a.Utilities.Html.updateUrlParam(g,"titlefilter",b)),d&&(g=a.Utilities.Html.updateUrlParam(g,"startOnly","true")),e>0&&(g=a.Utilities.Html.updateUrlParam(g,"skip",String(e))),null!=f&&f>=0&&(g=a.Utilities.Html.updateUrlParam(g,"top",String(f))),this.sendRequestWithCount({requestUri:this.getSurveyWebOwnerServiceUrl()+c.SearchFormFunctionName+g,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.SearchServerForms})},c.prototype.getFormsSharedWithCurrentUser=function(){var b=this.getSurveyWebOwnerServiceUrl()+c.SharedWithMeFormEntityCollectionName;return this.sendRequest({requestUri:b,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetSharedWithMeForms})},c.prototype.getFormId=function(b,c,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"GetFormId(tenantid='{0}',userid='{1}',tableid='{2}')".format(b,c,d),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormId})},c.prototype.getDesignForm=function(b,d){var e=this.getSurveyWebOwnerServiceUrl()+"light/";return e+=c.FormEntityCollectionName+"('"+b+"')",e+=c.getQueryParameters("?",d),this.sendRequest({requestUri:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetDesignForm})},c.prototype.getRuntimeForm=function(b,d){var e=this.getSurveyWebOwnerServiceUrl()+"light/"+c.RuntimeFormEntityCollectionName+"('"+b+"')";return e+=c.getQueryParameters("?",d),this.sendRequest({requestUri:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetRuntimeForm})},c.prototype.getAnalysisTimeForm=function(b){var d="$expand="+c.QuestionEntityCollectionName+"($expand="+c.ChoiceEntityCollectionName+")",e=this.getSurveyWebOwnerServiceUrl()+"light/"+c.AnalysisFormEntityCollectionName+"('"+b+"')?"+d;return this.sendRequest({requestUri:e,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetAnalysisForm})},c.prototype.getSharedForm=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.GetSharedForm+"(formid='"+b+"',token='"+a.Utilities.Html.getQueries().sharetoken+"')",method:"GET",headers:{"Content-Type":"application/json;odata.metadata=minimal"},body:'{"value" : "'+a.Utilities.Html.getQueries().sharetoken+'"}',qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetSharedForm})},c.prototype.createOD4BSessionTempFolder=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.RuntimeFormEntityCollectionName+"('"+b+"')/"+c.CreateOneDriveSessionTempFolderFunctionName,method:"POST",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateOD4BSessionTempFolder}).then(function(a){return a?a.itemId:$.Deferred().reject(new Error("Failed to create OneDriveForBusiness session temp folder.")).promise()})},c.prototype.changeSharingStatus=function(b,c){var d=c?"On":"Off";return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"/forms('"+b+"')/Microsoft.FormServices.Turn"+d+"AllowCopySetting",method:"POST",qosEventName:c?a.Event.QosEventNames.ServiceEndpoints.Form.TurnOnFormSharing:a.Event.QosEventNames.ServiceEndpoints.Form.TurnOffFormSharing})},c.prototype.createPermissionLink=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateFormPermissionLink})},c.prototype.deletePermissionLink=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionEntityCollectionName+"('"+d+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.DeleteFormPermissionLink})},c.prototype.getFormPermissions=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionEntityCollectionName,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetFormPermissions})},c.prototype.createPermissionToken=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionTokenEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateFormPermissionToken})},c.prototype.getOrCreateFormPermissionToken=function(b,d,e){var f={};return a.EnvironmentSettings.IsTeamsIntegration&&(f["x-ms-form-request-source"]="ms-teams"),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.GetOrCreatePermissionTokenFunctionName,method:"POST",headers:f,data:{type:d,name:e},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetOrCreatePermissionToken})},c.prototype.deletePermissionToken=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionTokenEntityCollectionName+"('"+d+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.DeleteFormPermissionToken})},c.prototype.getFormPermissionsTokens=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionTokenEntityCollectionName,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetFormPermissionsToken})},c.prototype.getIdentityProviderType=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"authinfo/idptype?username="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetIdentityProviderType}).then(function(a){return a.ProviderType})},c.prototype.createForm=function(b){var d={__TimezoneOffset:(new Date).getTimezoneOffset().toString()};return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName,method:"POST",data:b,headers:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateForm,qosExtraData:{FormType:this.getFormType(b)}})},c.prototype.updateForm=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')",method:this.partialUpdateHttpMethod,data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.UpdateForm,qosExtraData:{SoftDeleted:d.softDeleted}})},c.prototype.createFormImageFromUrl=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+d,method:"POST",data:e,qosEventName:"logo"===d?a.Event.QosEventNames.ServiceEndpoints.Form.CreateImageFromUrl:a.Event.QosEventNames.ServiceEndpoints.Form.CreateThemeImageFromUrl,qosExtraData:{FormProperty:d}})},c.prototype.deleteForm=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.DeleteForm})},c.prototype.dupFormForExcel=function(b,d){var e={id:b,xlWorkbookId:d};return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName,method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Excel.DuplicateFormForExcel})},c.prototype.moveForm=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"light/"+c.FormEntityCollectionName+"('"+b+"')/"+c.MoveFormFunctionName,method:"POST",data:{newOwnerId:d,isNewOwnerGroup:e},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.MoveForm})},c.prototype.getRecentForms=function(b,c,d){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetRecentForms(pinnedState='{0}',extension='{1}',knowledge='{2}',count=250)".format(b,c,d),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetRecentForms})},c.prototype.removeRecentForm=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.RemoveRecentFormFunctionName,method:"POST",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.RemoveRecentForm})},c.prototype.getFormsTenantSettings=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetFormsTenantSettings",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormsTenantSettings})},c.prototype.getFormCreatorPhotoDefinition=function(b){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+("light/GetFormCreatorDefinition('"+b+"','')"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormCreatorPhotoDefinition})},c.prototype.getFormCreatorPhotoValue=function(b){return this.sendRequestWithToken({blobResponseType:!0,requestUri:this.getSurveyWebServiceUrl()+("light/GetFormCreatorPhotoValue('"+b+"','')/$value"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormCreatorPhotoValue})},c.prototype.getFormQuestion=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')";return e&&(f=f+"?$select="+e.toString()),this.sendRequest({requestUri:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.GetQuestion})},c.prototype.getFormQuestionCount=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"/$count",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.GetQuestionCount})},c.prototype.createFormQuestion=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.CreateQuestion,qosExtraData:{QuestionId:d.id,QuestionType:d.type}})},c.prototype.createQuestionImageFromUrl=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/image",method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.CreateImageFromUrl,qosExtraData:{QuestionId:d}})},c.prototype.updateFormQuestion=function(b,d,e,f){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')",method:this.partialUpdateHttpMethod,data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.UpdateQuestion,qosExtraData:{QuestionType:e}},!0)},c.prototype.deleteFormQuestion=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.DeleteQuestion,qosExtraData:{QuestionType:e}})},c.prototype.createQuestionChoice=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName;return this.sendRequest({requestUri:f,method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.CreateChoice})},c.prototype.getQuestionChoice=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName+"("+e+")";return this.sendRequest({requestUri:f,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.GetChoice})},c.prototype.updateQuestionChoice=function(b,d,e,f){var g=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName+"("+e+")";return this.sendRequest({requestUri:g,method:this.partialUpdateHttpMethod,data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.UpdateChoice})},c.prototype.deleteQuestionChoice=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName+"("+e+")";return this.sendRequest({requestUri:f,method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.DeleteChoice})},c.prototype.getFormResponses=function(b,d,e,f){var g=["$expand="+c.CommentEntityCollectionName];d&&g.push("$filter={0}+{1}+{2}".format(d.name,d.operator,d.value)),e>=0&&f>=0&&g.push("$top={0}&$skip={1}".format(e,f));var h=g.filter(function(a){return!!a}).join("&");h=h&&"?"+h;var i=this.getSurveyWebOwnerServiceUrl()+"light/";return this.sendRequest({requestUri:i+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+h,qosEventName:_.any(g,function(a){return-1===a.indexOf("$filter")})?a.Event.QosEventNames.ServiceEndpoints.Response.GetResps:a.Event.QosEventNames.ServiceEndpoints.Response.GetRespFilter})},c.prototype.getRuntimeResponses=function(b,d){var e="?$expand="+c.CommentEntityCollectionName,f=d?"&$filter=responder+eq+'"+encodeURIComponent(d.replace(/\'/g,"''"))+"'":"",g=this.getSurveyWebOwnerServiceUrl();return this.sendRequest({requestUri:g+c.FormEntityCollectionName+"('"+b+"')/"+c.RuntimeResponseEntityCollectionName+e+f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.GetRuntimeResps})},c.prototype.getAnalysisTimeResponses=function(b,d,e){var f="?$expand="+c.CommentEntityCollectionName,g=this.getSurveyWebOwnerServiceUrl()+c.AnalysisFormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+f;return d>=0&&e>=0&&(g+="&$top={0}&$skip={1}".format(d,e)),this.sendRequest({requestUri:g,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.GetAnalysisTimeResponses})},c.prototype.getFormsResponseCount=function(){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+"light/GetRespCounts()",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormCreatorPhotoDefinition})},c.prototype.getFormResponseCount=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"/$count",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.GetRespCount},!0)},c.prototype.submitFormResponse=function(b,d){var e=a.Utilities.FormId.decodeFormId(b),f="AAD";return null==e.OrgId?f="Unknown":e.OrgId.toLowerCase()===a.EnvironmentConfig.getMsaTenantId()&&(f="MSA"),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.SubmitResp,qosExtraData:{OwnerSource:f}})},c.prototype.deleteFormResponses=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName,method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.DeleteResps})},c.prototype.deleteFormResponse=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"("+d+")/",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.DeleteResp})},c.prototype.addFormResponseComment=function(b,d,e){var f={feedback:e.feedback,score:e.score,questionId:e.questionId};return e.id&&(f.id=e.id),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"("+d+")/"+c.CommentEntityCollectionName,method:"POST",data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.AddComment})},c.prototype.setResponseReleaseDate=function(b,d,e){var f={releaseDate:e};return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"("+d+")",method:this.partialUpdateHttpMethod,data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.SetReleaseDate})},c.prototype.createExportFile=function(a){var b=this;return this.getToken().then(function(d){var e,f="cdb-export-iframe",g=b.createHiddenIFrame(f);if(e=document.createElement("form"),e.style.display="none",e.method="POST",e.action=b.getSurveyWebServiceUrl()+c.FormEntityCollectionName+"('"+a+"')/Microsoft.FormServices.CreateExportFile",e.target=f,null!==d){var h=document.createElement("input");h.type="hidden",h.name="Authorization",h.value="Bearer "+d,e.appendChild(h)}if(null!==OfficeFormServerInfo.antiForgeryToken){var i=document.createElement("input");i.type="hidden",i.name="__RequestVerificationToken",i.value=OfficeFormServerInfo.antiForgeryToken,e.appendChild(i)}document.body.appendChild(g),$(g).ready(function(){g.contentDocument.body.appendChild(e)}),e.submit()})},c.prototype.downloadExcelFile=function(c,d,e){var f=this;return this.getToken().then(function(g){var h=new a.Event.QosEvent(a.Event.QosEventNames.ServiceEndpoints.Function.DownloadExcelFileApi);h.start();var i=$.Deferred(),j="download-excel-iframe",k=f.createHiddenIFrame(j);return document.body.appendChild(k),$(k).ready(function(){var j="downloadCookie"+(new Date).getTime(),l=f.getDownloadExcelRequestUrlParameters(c,d,e,j,g),m=f.getDownloadExcelRequestUrl(l),n={sourceUrl:m,innerCode:b.ErrorCode.InnerCode.DownloadExcelFileFailed,innerMessage:void 0},o=24,p=o,q=5e3,r=function(){var c=a.Utilities.getCookie(j);if("success"===c)return h.end({resultType:a.Event.ResultType.Success}),window.clearInterval(s),a.Utilities.clearCookie(j),void i.resolve();if(p--<0){k.onload=null,window.clearInterval(s);var d=_.clone(n);if(!a.EnvironmentConfig.isOsi())return h.end({resultType:a.Event.ResultType.Success}),void i.resolve();d.innerMessage="TimeOut",d.innerCode=b.ErrorCode.InnerCode.DownloadExcelFileTimeout,h.end({resultType:a.Event.ResultType.Failure,extraData:{ServiceError:d}}),i.reject({innerCode:b.ErrorCode.InnerCode.DownloadExcelFileTimeout,innerMessage:d.innerMessage})}},s=window.setInterval(r,q),t=3,u=function(){p=o,s=window.setInterval(r,q),k.contentWindow.location.href=m};$(k).on("load",function(){var c="";if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.LogDownloadExcelErrorMessage))try{c=k.contentDocument.body.innerText}catch(d){c="Cross-origin so doesn't get the error message."}if(window.clearInterval(s),t>0)t--,f.downloadExcelCheckAndHandleAuthFailure(c,u);else{var e=_.clone(n);e.innerMessage="Error",h.end({resultType:a.Event.ResultType.Failure,extraData:{ServiceError:e,errorMessage:c}}),i.reject({innerCode:b.ErrorCode.InnerCode.DownloadExcelFileFailed,innerMessage:e.innerMessage})}}),k.contentWindow.location.href=m}),i.promise()})},c.prototype.getShellServiceInfo=function(b){var c=this,d=null,e=a.SafeStorage.SessionStorage;if(d=e.getItem(this.aadLauncherSesstionStorageKey),a.Utilities.BrowserStorage.isEmptyValue(d))return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetShellServiceInfo(culture='{0}')".format(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetShellServiceInfo}).then(function(a){return e.setItem(c.aadLauncherSesstionStorageKey,JSON.stringify(a)),a});var f=$.Deferred();return f.resolve(JSON.parse(d)).promise()},c.prototype.getConsumerShellServiceInfo=function(b){var c=this,d=null,e=a.SafeStorage.SessionStorage;if(d=e.getItem(this.msaLauncherSesstionStorageKey),a.Utilities.BrowserStorage.isEmptyValue(d))return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetConsumerShellServiceInfo(culture='{0}')".format(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetConsumerShellServiceInfo}).then(function(a){return window.sessionStorage.setItem(c.msaLauncherSesstionStorageKey,JSON.stringify(a)),a});var f=$.Deferred();return f.resolve(JSON.parse(d)).promise()},c.prototype.getOrNewExcelInOneDrive=function(b,c){var d;return d=a.Flighting.Flight.isEnabled(a.Flighting.Flights.ExcelService)?this.getExcelServiceBaseUrl()+"excel/api/excel/file?formid="+b+"&forcereexport="+c:this.getSurveyWebOwnerServiceUrl()+"GetOrNewExcelInOneDrive(formid='"+b+"',forcereexport='"+c+"')",this.sendRequest({requestUri:d,method:"GET",headers:{__TimezoneOffset:(new Date).getTimezoneOffset().toString()},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Action.OpenExcelInOneDrive})},c.prototype.getYoutubeVideoInfo=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"embed?youtubeurl="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetYouTubeVideoInfo})},c.prototype.getUserInfo=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"userInfo",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetUserInfo})},c.prototype.getXlWorkbookId=function(b){var c;return c=a.Flighting.Flight.isEnabled(a.Flighting.Flights.ExcelService)?this.getExcelServiceBaseUrl()+"excel/api/excel/xlworkbookid?formid="+b:this.getSurveyWebServiceUrl()+"GetXlWorkbookId(formid='"+b+"')",this.sendRequest({requestUri:c,method:"GET",headers:{__TimezoneOffset:(new Date).getTimezoneOffset().toString()},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Action.GetXlWorkbookId})},c.prototype.mathCalculation=function(b){if(!b||!b.Mathml){var c={Aria:"",Responses:[]};return $.Deferred().resolve(c).promise()}var d={mode:1,inputFormat:"MathML",locale:navigator.language,outputFormat:"latex",context:b.Context,formulas:[b.Mathml],RequiredIncorrectAnswerCount:0};return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"math/calculation?formId="+b.FormId+"&questionId="+b.QuestionId,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.MathCalculation})},c.prototype.browseImage=function(b,c,d){var e={resourceId:b,itemCount:c,skipToken:d};return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/browseimage",method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.BrowseImage})},c.prototype.getToken=function(){return this.authContext.getToken()},c.prototype.searchImage=function(b,c,d,e,f){var g={query:b,itemCount:d,lcid:OfficeFormServerInfo.cultureInfo.Name.toLowerCase(),parameters:{license:c},skipToken:e.toString(),url:f};return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/searchimage",method:"POST",data:g,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.SearchImage})},c.prototype.getCdbToken=function(){var b=$.Deferred();return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/getTokenForResource?resourceType=CollabDB",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.GetCdbToken}).then(function(a){a?b.resolve(a):b.reject(new Error("Failed to get CDB token via GetTokenForResource"))},function(a){b.reject(a)}),b.promise()},c.prototype.getOD4BToken=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/getTokenForResource?resourceType=MSGraph",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.GetOD4BToken}).then(function(a){return a?"Bearer "+a:$.Deferred().reject(new Error("Failed to get OneDriveForBusiness token via GetTokenForResource")).promise()})},c.prototype.reportAbuse=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"contentvalidation/report",method:"POST",data:b,qosEventName:a.Event.QosEventNames.ServiceEndpoints.OnlineSafety.ReportAbuse})},c.prototype.getGroups=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"groups",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetGroups})},c.prototype.getGroupId=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"groupinfo/getgroupid?onedriveweburl="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetGroupId})},c.prototype.getGroup=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetGroup})},c.prototype.getGroupOwners=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/owners"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetOwners})},c.prototype.getGroupMembers=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/members"),qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetMembers})},c.prototype.getGroupPhotoDefinition=function(b){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/photo"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetPhotoDefinition})},c.prototype.getGroupPhotoValue=function(b){return this.sendRequestWithToken({blobResponseType:!0,requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/photo/$value"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetPhotoValue})},c.prototype.getGroupMemberPhotoDefinition=function(b,c){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/members('"+c+"')/photo"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetMemberPhotoDefinition})},c.prototype.getGroupMemberPhotoValue=function(b,c){return this.sendRequestWithToken({blobResponseType:!0,requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/members('"+c+"')/photo/$value"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetMemberPhotoValue})},c.prototype.getAnalysisSurveyData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.GetAggregateSurveyDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.AggregateSurveyData},!1)},c.prototype.getAnalysisQuizData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.GetAggregateQuizDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.AggregateQuizData},!1)},c.prototype.getResultSharingAnalysisSurveyData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.AnalysisFormEntityCollectionName+"('"+b+"')/"+c.GetAggregateSurveyDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.ResultSharingAggregateSurveyData},!1)},c.prototype.getResultSharingAnalysisQuizData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.AnalysisFormEntityCollectionName+"('"+b+"')/"+c.GetAggregateQuizDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.ResultSharingAggregateQuizData},!1)},c.prototype.getInsights=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"insights/getinsights?formId="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetInsights})},c.prototype.getFormsWithToken=function(b,d,e){void 0===b&&(b=!1);var f=this.getSurveyWebServiceUrl()+c.FormEntityCollectionName+c.getQueryParameters("?",d);return this.sendRequestWithToken({requestUri:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetForms},!1,e)},c.prototype.createFormWithToken=function(b,d){var e={__TimezoneOffset:(new Date).getTimezoneOffset().toString()};return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+c.FormEntityCollectionName,method:"POST",data:b,headers:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateForm,qosExtraData:{FormType:this.getFormType(b)}},!1,d)},c.prototype.checkAnonymousAccess=function(a){var d=this.getSurveyWebOwnerServiceUrl()+"light/"+c.RuntimeFormEntityCollectionName+"('"+a+"')";return b.OData.send({requestUri:d,headers:[]},!0,!0).then(function(){return!0},function(a){var c=b.OData.ResponseHandler.parseResponseData(a,!1),d=c&&c.error;return d.statusCode===b.ErrorCode.HttpStatusCode.Unauthorized?$.Deferred().resolve(!1).promise():d})},c.prototype.experimentationActivate=function(a,b){var c=this.getSurveyWebServiceUrl()+"decomposition/experimentation/activate?optimizelyId="+a+"&experimentKey="+b;return this.sendRequest({requestUri:c,method:"GET"})},c.prototype.experimentationTrack=function(a,b){var c=this.getSurveyWebServiceUrl()+"decomposition/experimentation/track?optimizelyId="+a+"&eventKey="+b;return this.sendRequest({requestUri:c,method:"GET"})},c.getQueryParameters=function(a,b){if(!b)return a+"$expand="+c.QuestionEntityCollectionName;b=_.union(["id"],b);var d="$select="+b.join(","),e={permissions:"permissions"};e[c.QuestionEntityCollectionName]=c.QuestionEntityCollectionName+"($expand="+c.ChoiceEntityCollectionName+")",e[c.PermissionTokenEntityCollectionName]="permissionTokens";var f=b.map(function(a){return e[a]}).filter(function(a){return a});return f.length&&(d+="&$expand="+f.join(",")),d&&a+d},c.prototype.sendRequestWithToken=function(a,c,d){var e=this;return d?(a.headers=$.extend(!0,a.headers,this.getCommonHeaders(d)),b.OData.send(a,c).then(function(a){var c=b.OData.ResponseHandler.parseResponseData(a,!0);return c&&c.value},function(a){return b.OData.ResponseHandler.parseAndTryHandleError(a)})):this.getToken().then(function(d){return a.headers=$.extend(!0,a.headers,e.getCommonHeaders(d)),b.OData.send(a,c).then(function(a){var c=b.OData.ResponseHandler.parseResponseData(a,!0);return c&&c.value},function(a){return b.OData.ResponseHandler.parseAndTryHandleError(a)})})},c.prototype.getDownloadExcelRequestUrlParameters=function(b,c,d,e,f){var g=(new Date).getTimezoneOffset().toString(),h={formid:b,timezoneOffset:g,downloadCookie:e,minResponseId:c,maxResponseId:d,"X-CorrelationId":a.Utilities.Guid.newGuid()};return a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)||(h.Authorization=f),h},c.prototype.getDownloadExcelRequestUrl=function(b){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.ExcelService)?this.getExcelServiceBaseUrl()+"excel/DownloadExcelFile.ashx?"+$.param(b):this.getExcelServiceBaseUrl()+"formapi/DownloadExcelFile.ashx?"+$.param(b)},c.prototype.downloadExcelCheckAndHandleAuthFailure=function(c,d){var e=a.Utilities.tryParseJson(c),f=e&&(e.error&&parseInt(e.error.code)||parseInt(e.ErrorCode));f===b.ErrorCode.InnerCode.TokenExpired||f===b.ErrorCode.InnerCode.RequireLogin?b.AuthTokenHelper.getInstance().refreshAuthToken(function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.RefreshServerInfoInFrame)?d():a.PageMethods.refreshAntiForgeryToken(d,function(){return location.reload()})},function(){a.Authenticator.signInThenRefresh()}):d()},c.prototype.sendRequestInner=function(a,c,d){var e=this;return this.getToken().then(function(f){return c.headers=$.extend(!0,c.headers,e.getCommonHeaders(f)),b.OData.send(c,d).then(function(c){var d=b.OData.ResponseHandler.parseResponseData(c,!0);return a(d)},function(a){return b.OData.ResponseHandler.parseAndTryHandleError(a)})})},c.prototype.sendRequest=function(a,b){return this.sendRequestInner(function(a){return a&&a.value},a,b)},c.prototype.sendRequestWithCount=function(a,b){var c=function(a){return{count:a.count,forms:a.value}};return this.sendRequestInner(c,a,b)},c.prototype.createHiddenIFrame=function(a){var b=document.getElementById(a);return b&&b.parentNode.removeChild(b),
b=document.createElement("iframe"),b.id=a,b.name=a,b.hidden=!0,b},c.prototype.getCommonHeaders=function(b){return{Accept:"application/json",Authorization:b?"Bearer "+b:"",__RequestVerificationToken:OfficeFormServerInfo.antiForgeryToken,ShareInvitationKey:a.Utilities.Html.getHashes().Token,AnalyzerToken:a.Utilities.Html.getQueries().AnalyzerToken,ValidationToken:a.Utilities.Html.getQueries().vt}},c.prototype.getSurveyWebServiceUrl=function(){return this.serviceUrl},c.prototype.getSurveyWebOwnerServiceUrl=function(){return this.ownerServiceUrl},c.prototype.getExcelServiceBaseUrl=function(){return this.serviceUrl.slice(0,-12)},c.prototype.getFormType=function(a){var b=null;if(a&&a.settings){var c=null;try{c=JSON.parse(a.settings)}catch(d){}a.category&&a.category.split(" ").indexOf("Poll")>=0?b="Poll":c&&void 0!==c.IsQuizMode&&(b=c.IsQuizMode?"Quiz":"Form")}return b||void 0},c}();b.FormApi=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b,c=a.ErrorCode.InnerCode;!function(a){function b(a){var b=new FileReader;b.readAsDataURL(a);var c=$.Deferred();return b.onload=function(){c.resolve(b.result).promise()},c.promise()}function d(a){var b=$.Deferred();try{for(var d=a.split(","),e=(d[0].match(/:(.*?);/)[1],window.atob(d[1])),f=e.length,g=new Uint8Array(f);f--;)g[f]=e.charCodeAt(f);b.resolve(new Blob([g]))}catch(h){b.reject({correlationId:null,statusCode:0,innerCode:c.ImageTypeConvertFailed,innerMessage:"Image Type Convert Error",statusText:"Image Converting from Base64 to Blob Error"})}return b.promise()}a.convertImageBlobToBase64=b,a.convertImageDataURLToBlob=d}(b=a.ImageProcessing||(a.ImageProcessing={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=b.ErrorCode.InnerCode,d=function(){function d(a){for(this.serviceUrl=a.trim();"/"===this.serviceUrl.charAt(this.serviceUrl.length-1);)this.serviceUrl=this.serviceUrl.substr(0,this.serviceUrl.length-1)}return d.prototype.deleteQuestionImage=function(a,b,c){var e=this,f=this.getToken();return f.then(function(f){return d.deleteImageInternal(f,e.getAbsoluteUrl(d.getQuestionImageUrl(a,b,c)))})},d.prototype.uploadQuestionImage=function(a,b,c,e){var f=this,g=this.getToken();return g.then(function(g){return d.uploadImageInternal(g,f.getAbsoluteUrl(d.getQuestionImageUrl(a,b,c)),c,e)})},d.prototype.deleteFormImage=function(a,b){var c=this,e=this.getToken();return e.then(function(e){return d.deleteImageInternal(e,c.getAbsoluteUrl(d.getFormImageUrl(a,b)))})},d.prototype.uploadFormImage=function(a,b,c){var e=this,f=this.getToken();return f.then(function(f){return d.uploadImageInternal(f,e.getAbsoluteUrl(d.getFormImageUrl(a,b)),b,c)})},d.getFormImageUrl=function(a,b){return d.formImageUrlPattern.format(a,b)},d.getQuestionImageUrl=function(a,b,c){return d.questionImageUrlPattern.format(a,b,c)},d.deleteImageInternal=function(c,d){var e=new a.Event.QosEvent(a.Event.QosEventNames.ServiceEndpoints.Image.DeleteImage);e.start();var f={type:"DELETE",url:d,headers:{Authorization:c?"Bearer "+c:"","X-CorrelationId":e.CorrelationId}};a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)&&(f.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken);var g=$.ajax(f),h=function(){return e.end({resultType:a.Event.ResultType.Success})},i=function(b){var c={correlationId:e.CorrelationId,innerCode:b.responseJSON&&b.responseJSON.error&&b.responseJSON.error.code,statusCode:b.status,innerMessage:b.responseJSON&&b.responseJSON.error&&b.responseJSON.error.message,statusText:b.statusText};return e.end({resultType:a.Event.ResultType.Failure,extraData:{imageUrl:d,error:c}}),c};return g.then(h,function(c){if(b.AuthTokenHelper.getInstance().isAuthTokenExpiredFailure(c))b.AuthTokenHelper.getInstance().refreshAuthToken(function(){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.RefreshServerInfoInFrame)){f.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken;var b=$.ajax(f);return b.then(h,i)}a.PageMethods.refreshAntiForgeryToken(function(){f.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken;var a=$.ajax(f);return a.then(h,i)},function(){return location.reload()})},function(){a.Authenticator.signInThenRefresh()});else{if(!b.AuthTokenHelper.getInstance().isAntiForgeryTokenValidationFailure(c))return i(c);location.reload()}})},d.uploadImageInternal=function(d,e,f,g){var h=new a.Event.QosEvent(a.Event.QosEventNames.ServiceEndpoints.Image.UploadImage);h.start();var i={type:"PUT",url:e,headers:{Authorization:d?"Bearer "+d:"","Content-Type":g.ImageType,"Content-Disposition":"attachment; name={0}; filename={1}".format(a.Utilities.Guid.newGuid(),g.ImageName),"X-CorrelationId":h.CorrelationId},processData:!1,data:g.ImageBlob};a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)&&(i.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken);var j=$.ajax(i),k=function(b){if(!b||!b.resourceId){var d={correlationId:h.CorrelationId,innerCode:c.ImageUploadFailed,statusCode:0,innerMessage:"Upload image return bad response",statusText:"CollabDb bad response"};return h.end({resultType:a.Event.ResultType.Failure,extraData:{imageUrl:e,error:d,imageType:f}}),$.Deferred().reject(d).promise()}h.end({resultType:a.Event.ResultType.Success,extraData:{imageType:f}});var g={};return g.altText=b.altText,g.contentType=b.contentType,g.fileIdentifier=b.fileIdentifier,g.originalFileName=b.originalFileName,g.resourceId=b.resourceId,g.resourceUrl=b.resourceUrl,g.height=b.height,g.width=b.width,g},l=function(b){var c={correlationId:h.CorrelationId,innerCode:b.responseJSON&&b.responseJSON.error&&b.responseJSON.error.code,statusCode:b.status,innerMessage:b.responseJSON&&b.responseJSON.error&&b.responseJSON.error.message,statusText:b.statusText};return h.end({resultType:a.Event.ResultType.Failure,extraData:{imageUrl:e,error:c}}),c};return j.then(k,function(c){if(b.AuthTokenHelper.getInstance().isAuthTokenExpiredFailure(c))b.AuthTokenHelper.getInstance().refreshAuthToken(function(){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.RefreshServerInfoInFrame)){i.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken;var b=$.ajax(i);return b.then(k,l)}a.PageMethods.refreshAntiForgeryToken(function(){i.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken;var a=$.ajax(i);return a.then(k,l)},function(){return location.reload()})},function(){a.Authenticator.signInThenRefresh()});else{if(!b.AuthTokenHelper.getInstance().isAntiForgeryTokenValidationFailure(c))return l(c);location.reload()}})},d.prototype.getToken=function(){var b=$.Deferred();if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth))return b.resolve(null),b.promise();var d=new a.Event.QosEvent(a.Event.QosEventNames.Auth.Auth.AcquireToken);return d.start(),a.Authenticator.AuthContext.acquireToken(a.EnvironmentConfig.getFormsResourceId(),function(e,f){if(e||!f){var g={correlationId:d.CorrelationId,innerCode:c.ImageProviderGetCDBTokenFailed,statusCode:0,statusText:"acquire collabDb token failed",innerMessage:e};d.end({extraData:g,resultType:a.Event.ResultType.Failure}),b.reject(g)}else d.end({resultType:a.Event.ResultType.Success}),b.resolve(f)}),b.promise()},d.prototype.getAbsoluteUrl=function(a){return this.serviceUrl+"/"+a},d.formImageUrlPattern="forms('{0}')/{1}",d.questionImageUrlPattern="forms('{0}')/questions('{1}')/{2}",d}();b.ImageProvider=d}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a[a.None=0]="None",a[a.SpellChecker=1]="SpellChecker",a[a.AutoSuggest=2]="AutoSuggest",a[a.KeyPhrase=4]="KeyPhrase",a[a.ChoiceQuestionTypeSuggest=256]="ChoiceQuestionTypeSuggest",a[a.SuggestionForm=512]="SuggestionForm",a[a.AntiPhishing=1024]="AntiPhishing",a[a.SuggestionQuestion=2048]="SuggestionQuestion",a[a.OptionsSuggest=4096]="OptionsSuggest",a[a.LikertQuestionTypeSuggest=8192]="LikertQuestionTypeSuggest"}(b=a.TextAnalyzerFeatures||(a.TextAnalyzerFeatures={}));var c;!function(a){a[a.None=0]="None",a[a.SimilarMathQuestionSuggestions=1]="SimilarMathQuestionSuggestions"}(c=a.MathAnalyzerFeatures||(a.MathAnalyzerFeatures={}));var d;!function(a){a[a.Unknown=0]="Unknown",a[a.Edu=1]="Edu",a[a.Biz=2]="Biz",a[a.MsaFree=4]="MsaFree",a[a.MSIT=8]="MSIT",a[a.MsaPaid=16]="MsaPaid"}(d=a.UserType||(a.UserType={}))}(b=a.Models||(a.Models={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(b,d){return c._instance?c._instance:(c._instance=this,this._serviceUrl=b,this._tokenRetriever=d,a.Utilities.assert(this._serviceUrl,"math service url is null"),void 0)}return c.getInstance=function(a,b){return new c(a,b)},c.prototype.mathFormulaCalculation=function(b){if(!b||!b.Mathml){var c={Aria:"",Responses:[]};return $.Deferred().resolve(c).promise()}var d={mode:1,inputFormat:"MathML",locale:navigator.language,outputFormat:"latex",context:b.Context,formulas:[b.Mathml],RequiredIncorrectAnswerCount:0};return this.sendRequest({requestUri:this._serviceUrl+"mathapi/calculation?formId="+b.FormId+"&questionId="+b.QuestionId,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.MathCalculation})},c.prototype.mathQuestionGeneration=function(b,c){if(!c){var d={Features:0,Results:[]};return $.Deferred().resolve(d).promise()}var e={Features:b,Locale:navigator.language,InputFormat:"MathML",OutputFormat:"latex",Input:c};return this.sendRequest({requestUri:this._serviceUrl+"mathapi/questions",method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.MathQuestionGeneration})},c.prototype.textAnalyze=function(a){var c=b.Models.TextAnalyzerFeatures.ChoiceQuestionTypeSuggest;return this.textAnalyzeWithFeatures(c,a)},c.prototype.textAnalyzeWithFeatures=function(b,c){if(!c){var d={Features:0,Results:[]};return $.Deferred().resolve(d).promise()}var e={Features:b,Text:c};return this.sendRequest({requestUri:this._serviceUrl+"textanalysis2",method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.TextAnalysis})},c.prototype.sendRequest=function(c){return this._tokenRetriever.getToken().then(function(d){return c.headers=$.extend(!0,c.headers,{Accept:"application/json",Authorization:d?"Bearer "+d:"",__RequestVerificationToken:OfficeFormServerInfo.antiForgeryToken}),b.OData.send(c).then(function(c){a.Utilities.assert(c,"math calculation result is null");var d=b.OData.ResponseHandler.parseResponseData(c,!0);return a.Utilities.assert(d,"math calculation result parse failure"),d&&d.value},function(a){return b.OData.ResponseHandler.parseAndTryHandleError(a)})})},c}();b.MathProvider=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(){return f.getInstance().createDataProvider()}function d(a){return f.getInstance().createDataProvider(e.Group,OfficeFormServerInfo.userInfo.TenantId,a)}var e;!function(a){a[a.Default=0]="Default",a[a.Personal=1]="Personal",a[a.Group=2]="Group",a[a.Me=3]="Me"}(e=b.DataProviderType||(b.DataProviderType={}));var f=function(){function c(){return c.instance?c.instance:(c.instance=this,void(this.environment=a.EnvironmentConfig.getEnvironmentType()))}return c.getInstance=function(){return new c},c.prototype.getOwnerServiceUrl=function(a,b,c){return a===e.Default?this.FormApiServiceUrl:a===e.Me?this.FormApiServiceUrl+"me/":b&&c?this.FormApiServiceUrl+b+(a===e.Group?"/groups/":"/users/")+c+"/":null},c.prototype.createDataProvider=function(a,c,d){if(void 0===a&&(a=e.Default),void 0===c&&(c=null),void 0===d&&(d=null),a===e.Default)return this.defaultDataProvider||(this.defaultDataProvider=new b.FormApi(this.FormApiServiceUrl,this.FormApiServiceUrl)),this.defaultDataProvider;var f=this.getOwnerServiceUrl(a,c,d);return f&&new b.FormApi(this.FormApiServiceUrl,f)},c.prototype.createImageProvider=function(a,c,d){if(void 0===a&&(a=e.Default),void 0===c&&(c=null),void 0===d&&(d=null),a===e.Default)return this.currentImageProvider||(this.currentImageProvider=new b.ImageProvider(this.FormApiServiceUrl)),this.currentImageProvider;var f=this.getOwnerServiceUrl(a,c,d);return f&&new b.ImageProvider(f)},c.prototype.createIntelligenceProvider=function(a,b,c){return new Forms.DataProvider.IntelligenceProvider(this.BaseServiceUrl,this.createDataProvider(),b,c,a===e.Group?"groups":"users")},Object.defineProperty(c.prototype,"CurrentNotificationProvider",{get:function(){return this.currentNotificationProvider||(this.currentNotificationProvider=new b.PushNotificationProvider),this.currentNotificationProvider},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CurrentMathProvider",{get:function(){return this.currentMathProvider||(this.currentMathProvider=b.MathProvider.getInstance(this.FormMathServiceUrl,this.createDataProvider())),this.currentMathProvider},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CurrentQtiProvider",{get:function(){return this.currentQtiProvider||(this.currentQtiProvider=b.QtiProvider.getInstance(this.QtiApiServiceUrl,this.createDataProvider())),this.currentQtiProvider},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormApiServiceUrl",{get:function(){return this.GetServiceUrl(c.formApiEndpointPostfix)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QtiApiServiceUrl",{get:function(){return this.GetServiceUrl(c.qtiApiEndpointPostfix)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormMathServiceUrl",{get:function(){return this.GetServiceUrl(c.formMathApiEndpointPostfix)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CollabDBServiceUrl",{get:function(){var b;if(a.EnvironmentConfig.isOsi())b=a.EnvironmentConfig.getCollabDBResourceId(a.EnvironmentConfig.getEnvironmentType());else{var c=a.Utilities.Html.getQueries().dataprovider;switch(c){case"edog":b=a.EnvironmentConfig.getCollabDBResourceId(a.EnvironmentType.EDog);break;case"int":default:b=a.EnvironmentConfig.getCollabDBResourceId(a.EnvironmentType.Int)}}return b},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"BaseServiceUrl",{get:function(){var b,d=a.Utilities.Html.getQueries().dataprovider;switch(this.environment){case a.EnvironmentType.USDoDProd:b=c.apiEndpointUSDoDProd;break;case a.EnvironmentType.USGovProd:b=c.apiEndpointUSGovProd;break;case a.EnvironmentType.USGovGccProd:b=c.apiEndpointProd;break;case a.EnvironmentType.WWProd:b=c.apiEndpointProd;break;case a.EnvironmentType.EDog:b=c.apiEndpointEDog;break;case a.EnvironmentType.Int:b="edog"===d?c.apiEndpointEDog:"https://"+window.location.host+"/";break;default:switch(d){case"edog":b=c.apiEndpointEDog;break;case"int":b=c.apiEndpointInt;break;default:b=this.environment===a.EnvironmentType.Trial?c.apiEndpointEDog:c.apiEndpointInt}}return b},enumerable:!0,configurable:!0}),c.prototype.GetServiceUrl=function(a){return this.BaseServiceUrl+a},c.apiEndpointUSDoDProd="https://forms.osi.apps.mil/",c.apiEndpointUSGovProd="https://forms.osi.office365.us/",c.apiEndpointProd="https://forms.office.com/",c.apiEndpointEDog="https://forms.officeppe.com/",c.apiEndpointInt="https://forms.office-int.com/",c.formApiEndpointPostfix="formapi/api/",c.formMathApiEndpointPostfix="formmath/api/",c.qtiApiEndpointPostfix="eduqti/api/",c}();b.ProviderManager=f,b.createDataProvider=c,b.createGroupDataProvider=d,a.Exports.DataProvider=b}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function a(){this.clients={}}return a.prototype.close=function(a){this.clients[a]&&(this.clients[a].close(),delete this.clients[a])},a.prototype.open=function(a,c,d){if(this.close(a),null==d)throw new Error("PushNotificationProvider.open method: cdbTable should not be null.");return this.clients[a]=new e(b.ProviderManager.getInstance().CollabDBServiceUrl,d.OwnerTenantId,d.OwnerId,d.TableId,d.IsGroupTable),this.clients[a].open(c)},a}();b.PushNotificationProvider=c;var d=function(){function b(b){this.clientId=a.Utilities.Guid.newGuid(),this.clientName=b}return Object.defineProperty(b.prototype,"ClientId",{get:function(){return this.clientId},enumerable:!0,configurable:!0}),b.prototype.log=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];if(a.Utilities.Flight.isDebugMode()||!a.EnvironmentConfig.isOsi()){var e=new Date;console.log("[%s] %s[%s]: %s",e.toTimeString(),this.clientName,this.clientId,b.format.apply(b,c))}},b}(),e=function(c){function d(a,b,d,e,g){var h=c.call(this,"CdbSignalR")||this;return h.disposed=!0,h.hubConnection=null,h.reconnectingCount=0,h.remainingRetryCount=f.MaxRetryCount,h.rtcUrl=(g?f.CDBUrlForGroupsFormat:f.CDBUrlForUsersFormat).format(a.trimEnd("/"),b,d,e),h}return __extends(d,c),d.prototype.close=function(){var a=this;this.log("Closing connection"),this.disposed=!0;var b=function(){4!==a.hubConnection.state&&a.invokeHubMethod(f.UserHubName,f.Leave).always(function(){a.hubConnection.stop(!0,!0),a.log("Connection closed")})};null!=this.hubConnection&&(0===this.hubConnection.state||2===this.hubConnection.state?this.hubConnection.stateChanged(b):b())},d.prototype.open=function(c){var d=this;this.log("Creating connection"),this.createHubConnection(this.rtcUrl),this.log("Initializing connection"),c=_.clone(c),c.onFormUpdated&&this.onHubEvent(f.TableDefinitionHubName,f.TableUpdated,function(a,b){c.onFormUpdated(g.toFormUpdatePayload(b),g.toUserPayload(b._modifiedBy))}),c.onQuestionAdded&&this.onHubEvent(f.TableDefinitionHubName,f.ColumnAdded,function(a,b){"Comments"!==a.propertyName&&"ReleaseDate"!==a.propertyName&&"FormsProData"!==a.propertyName&&c.onQuestionAdded(g.toQuestionPayload(b),g.toUserPayload(b._modifiedBy))}),c.onQuestionDeleted&&this.onHubEvent(f.TableDefinitionHubName,f.ColumnDeleted,function(a,b){c.onQuestionDeleted(a.propertyName,g.toUserPayload(b._modifiedBy))}),c.onQuestionUpdated&&this.onHubEvent(f.TableDefinitionHubName,f.ColumnUpdated,function(a,b){c.onQuestionUpdated(a.propertyName,g.toQuestionUpdatePayload(b),g.toUserPayload(b._modifiedBy))}),c.onChoiceAdded&&this.onHubEvent(f.TableDefinitionHubName,f.ChoiceAdded,function(a,b){c.onChoiceAdded(a.propertyName,g.toChoicePayload(a,b),g.toUserPayload(b._modifiedBy))}),c.onChoiceDeleted&&this.onHubEvent(f.TableDefinitionHubName,f.ChoiceDeleted,function(a,b){c.onChoiceDeleted(a.propertyName,a.choiceId,g.toUserPayload(b._modifiedBy))}),c.onChoiceUpdated&&this.onHubEvent(f.TableDefinitionHubName,f.ChoiceUpdated,function(a,b){c.onChoiceUpdated(a.propertyName,a.choiceId,g.toChoicePayload(a,b),g.toUserPayload(b._modifiedBy))}),c.onResponseAdded&&this.onHubEvent(f.TableDataHubName,f.RowAdded,function(a,b){c.onResponseAdded(g.toResponsePayload(b))}),c.onResponseDeleted&&this.onHubEvent(f.TableDataHubName,f.RowDeleted,function(a,b){c.onResponseDeleted(Number(a._id),{modifiedBy:g.toUserPayload(b._modifiedBy),modifiedDateTime:new Date(b._modifiedBy.ModifiedDateTime)})}),c.onResponsesAllDeleted&&this.onHubEvent(f.TableDataHubName,f.RowsAllDeleted,function(a,b){c.onResponsesAllDeleted({modifiedBy:g.toUserPayload(b._modifiedBy),modifiedDateTime:new Date(b._modifiedBy.ModifiedDateTime)})}),c.onResponseUpdated&&this.onHubEvent(f.TableDataHubName,f.RowUpdated,function(a,b){c.onResponseUpdated(Number(a._id),g.toResponseUpdatePayload(b))}),c.onCommentAdded&&this.onHubEvent(f.TableDataHubName,f.RelatedRecordAdded,function(a,b,d){g.isCommentPayload(a)&&c.onCommentAdded(Number(a.rowId),g.toCommentPayload(d),{modifiedBy:g.toUserPayload(b.modifiedBy),modifiedDateTime:new Date(b.modifiedDateTime)})}),c.onCommentDeleted&&this.onHubEvent(f.TableDataHubName,f.RelatedRecordDeleted,function(a,b,d){g.isCommentPayload(a)&&c.onCommentDeleted(Number(a.rowId),Number(a.id),{modifiedBy:g.toUserPayload(b.modifiedBy),modifiedDateTime:new Date(b.modifiedDateTime)})}),c.onUserConnected&&this.onHubEvent(f.UserHubName,f.UserConnected,function(a,b){c.onUserConnected(g.toUserPayload(a))}),c.onUserDisconnected&&this.onHubEvent(f.UserHubName,f.UserDisconnected,function(a,b){c.onUserDisconnected(g.toUserPayload(a))});var e=void 0;return this.hubConnection.starting(function(){d.log("connection starting"),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionStarting,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}})}),this.hubConnection.connectionSlow(function(){d.log("connection slow"),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionSlow,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}}),c.onConnectionSlow&&c.onConnectionSlow()}),this.hubConnection.error(function(b){d.log("connection error: {0}",JSON.stringify(b)),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionError,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB,error:b}}),e={errorCause:f.ConnectionType_CDB,errorObject:b},c.onConnectionError&&c.onConnectionError(b)}),this.hubConnection.reconnecting(function(){d.log("connection reconnecting"),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionReconnecting,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}}),c.onConnectionReconnecting&&c.onConnectionReconnecting()}),this.hubConnection.reconnected(function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionReconnected,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}}),d.log("connection reconnected"),c.onConnectionReconnected&&c.onConnectionReconnected(void 0)}),this.hubConnection.disconnected(function(){if(d.log("connection disconnected"),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionDisconnected,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,type:e&&e.errorCause,remainingRetryCount:d.remainingRetryCount,lastError:e&&e.errorObject}}),d.remainingRetryCount-->0){d.reconnectingCount++;var g={reconnectingCause:e&&e.errorCause,reconnectingCount:d.reconnectingCount,refreshToken:e&&e.errorObject&&e.errorObject.context&&e.errorObject.context.status===b.ErrorCode.HttpStatusCode.Unauthorized,retryCount:f.MaxRetryCount-d.remainingRetryCount,onSuccess:c.onConnectionReconnected,onError:c.onConnectionFailed};d.startConnection(g).done(function(){e=void 0}).fail(function(a){})}else a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionFailed,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,errorCause:e&&e.errorCause,lastError:e&&e.errorObject}}),c.onConnectionDisconnected&&c.onConnectionDisconnected()}),(a.Utilities.Flight.isDebugMode()||!a.EnvironmentConfig.isOsi())&&(this.hubConnection.logging=!0,this.hubConnection.received(function(a){d.log("Received message: {0}",JSON.stringify(a))})),this.disposed=!1,this.startConnection({onSuccess:c.onConnectionStarted,onError:c.onConnectionFailed})},d.prototype.createHubConnection=function(a){this.hubConnection=$.hubConnection(a,{useDefaultPath:!1}),this.hubConnection.createHubProxy(f.TableDefinitionHubName),this.hubConnection.createHubProxy(f.TableDataHubName),this.hubConnection.createHubProxy(f.UserHubName)},d.prototype.getHubProxy=function(a){if(null==this.hubConnection)throw Error("Realtime connection has not been created yet.");var b=this.hubConnection.proxies[a.toLocaleLowerCase()];if(null==b)throw Error("Cannot find hub proxy {0}".format(a));return b},d.prototype.handleAuth=function(a){var c=this;return b.ProviderManager.getInstance().createDataProvider().getCdbToken().then(function(a){c.hubConnection.qs={Authorization:a}})},d.prototype.invokeHubMethod=function(b,c){for(var d=this,e=[],f=2;f<arguments.length;f++)e[f-2]=arguments[f];if(this.isHubConnected()){var g=new a.Event.QosEvent(a.Event.QosEventNames.ServiceEndpoints.Connection.InvokeMethod);return g.start(),(h=this.getHubProxy(b)).invoke.apply(h,[c].concat(e)).then(function(b){return g.end({resultType:a.Event.ResultType.Success,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,methodName:c}}),b},function(b){return g.end({resultType:d.isHubConnected()?a.Event.ResultType.Failure:a.Event.ResultType.ExpectedFailure,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,methodName:c,error:JSON.stringify(b,["message","description","source","context","data"])}}),b})}return a.Utilities.Promise.getRejectedPromise(Error("Realtime connection has not been established yet."));var h},d.prototype.isHubConnected=function(){return null!=this.hubConnection&&1===this.hubConnection.state},d.prototype.onHubEvent=function(a,b,c){c&&this.getHubProxy(a).on(b,c)},d.prototype.startConnection=function(b){var c=this;if(this.disposed)return a.Utilities.Promise.getRejectedPromise("Connection disposed");var d=$.Deferred();b.onSuccess&&d.done(function(a){return b.onSuccess(a)}),b.onError&&d.fail(function(a){return b.onError(a)});var e=new a.Event.QosEvent(a.Event.QosEventNames.ServiceEndpoints.Connection.ConnectToCDB),g=function(){e.end({resultType:a.Event.ResultType.Success,extraData:{clientId:c.ClientId,connectionId:c.hubConnection.id,connectionType:f.ConnectionType_CDB,reconnectingCause:b.reconnectingCause,reconnectingCount:b.reconnectingCount,retryCount:b.retryCount}}),c.log("Realtime connection started"),c.remainingRetryCount=f.MaxRetryCount,c.invokeHubMethod(f.UserHubName,f.Join),c.invokeHubMethod(f.UserHubName,f.GetActiveUsers).then(function(a){d.resolve(a)},function(a){d.reject(a)})},h=function(g){e.end({resultType:a.Event.ResultType.Failure,extraData:{clientId:c.ClientId,connectionId:c.hubConnection.id,connectionType:f.ConnectionType_CDB,reconnectingCause:b.reconnectingCause,reconnectingCount:b.reconnectingCount,retryCount:b.retryCount,connectionError:g.source?JSON.stringify(g,["message","description","source","context","transport"]):void 0,serviceError:g.source?void 0:JSON.stringify(g,["message","statusCode","statusText","innerCode"])}}),d.reject(g)};return e.start(),this.handleAuth(b.refreshToken).then(function(){return c.hubConnection.start().then(g,h)},function(b){h(b),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionFailed,extraData:{clientId:c.ClientId,connectionId:c.hubConnection.id,errorCause:f.ConnectionType_Client,lastError:b}})}),d.promise()},d}(d),f=function(){function a(){}return a.TableDefinitionHubName="TableDefinitionChangeHub",a.TableDataHubName="TableChangeHub",a.UserHubName="TableActivityHub",a.TableUpdated="tableDefinitionUpdated",a.ColumnAdded="columnDefinitionAdded",a.ColumnDeleted="columnDefinitionDeleted",a.ColumnUpdated="columnDefinitionUpdated",a.ChoiceAdded="choiceAdded",a.ChoiceUpdated="choiceUpdated",a.ChoiceDeleted="choiceDeleted",a.RowAdded="rowAdded",a.RowDeleted="rowDeleted",a.RowsAllDeleted="rowsAllDeleted",a.RowUpdated="rowUpdated",a.RelatedRecordAdded="relatedRecordAdded",a.RelatedRecordDeleted="relatedRecordDeleted",a.RelatedRecordUpdated="relatedRecordUpdated",a.UserConnected="userConnected",a.UserDisconnected="userDisconnected",a.GetActiveUsers="GetActiveUsers",a.Join="Join",a.Leave="Leave",a.MaxRetryCount=5,a.ConnectionType_Client="client",a.ConnectionType_Server="server",a.ConnectionType_CDB="CDB",a.FormsUrlFormat="{0}/forms/{1}/$notifications",a.CDBUrlForUsersFormat="{0}/realtime/beta/{1}/users/{2}/tables/{3}/$notifications",a.CDBUrlForGroupsFormat="{0}/realtime/beta/{1}/groups/{2}/tables/{3}/$notifications",a}(),g=function(){function b(){}return b.toFormUpdatePayload=function(a){return a&&b.normalize({id:void 0,tableId:a.id,title:a.displayName,createdBy:a.createBy,modifiedDate:a.dateTimeLastUpdated,description:a.description,settings:a.formSettings,otherInfo:a.otherInfo,questions:void 0,header:b.toImagePayload(a.header),logo:b.toImagePayload(a.logo),background:b.toImagePayload(a.background),thankYouMessage:a.thankYouMessage,version:a.version,xlWorkbookId:a.xlWorkbookId,xlExportingTag:a.xlExportingTag,xlFileUnSynced:a.xlFileUnSynced,permissionTokens:b.toPermissionTokenPayload(a.permissionTokens)})},b.toQuestionPayload=function(a){return a&&{id:a.propertyName,title:a.description||a.title||a.displayName,defaultValue:a.defaultValue,subtitle:a.subtitle,required:a.required,type:a.questionType,questionInfo:a.questionInfo,order:a.order,version:void 0,modifiedDate:a.questionModifiedDate,status:a.status,image:b.toImagePayload(a.image),isQuiz:a.isQuiz,titleHasPhishingKeywords:a.titleHasPhishingKeywords,subtitleHasPhishingKeywords:a.subtitleHasPhishingKeywords,choices:a.choices,groupId:a.columnGroupName,fileUploadFolderId:a.fileUploadFolderId}},b.toChoicePayload=function(a,c){return c&&b.normalize({id:a.choiceId,customProperties:c.customProperties,description:c.description,displayText:c.displayText,key:c.key,order:c.order})},b.toQuestionUpdatePayload=function(a){return b.normalize(b.toQuestionPayload(a))},b.toUserPayload=function(a){return{userId:a.Id||a.userId,displayName:a.DisplayName||a.displayName,firstName:a.FirstName||a.firstName,lastName:a.LastName||a.lastName,email:a.Email||a.email,imageUri:a.ImageUri||a.imageUri}},b.toImagePayload=function(b){return b?null!=b.ResourceId&&null==b.ResourceUrl?void a.Event.ErrorEvent.logData({type:a.Event.ErrorType.InvalidCdbImagePayload}):{altText:b.AltText,contentType:b.ContentType,fileIdentifier:b.FileIdentifier,originalFileName:b.OriginalFileName,resourceId:b.ResourceId,resourceUrl:b.ResourceUrl}:b},b.toPermissionTokenPayload=function(a){if(a){var b=JSON.parse(a);return b.map(function(a){return{principalId:a.PrincipalId,name:a.Name,type:a.Type}})}return a},b.toResponsePayload=function(a){if(null==a)return a;var c=null==a._id?void 0:Number(a._id);return{id:c,startDate:a.StartDate,submitDate:a.SubmitDate,responder:a.Responder,responderName:a.ResponderName,answers:b.toAnswers(a),quizResult:void 0,releaseDate:a.ReleaseDate}},b.toAnswers=function(a){var b=["SubmitDate","ResponderName","Responder","StartDate","Comments_comments","Comments","ReleaseDate"],c=_.difference(Object.keys(a).filter(function(a){return"_"!==a[0]}),b);return JSON.stringify(c.map(function(b){return{questionId:b,answer1:a[b]}}))},b.toResponseUpdatePayload=function(a){var c=b.normalize(b.toResponsePayload(a));return delete c.answers,c},b.isCommentPayload=function(a){return a&&"Comments_comments"===a.propertyName},b.toCommentPayload=function(a){return a&&{id:a.id,feedback:a.text,score:a.number,questionId:a.columnReference,createdDateTime:a.createdDateTime,createdBy:b.toUserPayload(a.createdBy)}},b.normalize=function(a){var b=a;for(var c in b)void 0===b[c]&&delete b[c];return b},b}()}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(b,d){return c.instance?c.instance:(c.instance=this,this.qtiServiceUrl=b,this.tokenRetriever=d,a.Utilities.assert(this.qtiServiceUrl,"qti service url is null"),void 0)}return Object.defineProperty(c.prototype,"QtiServiceUrl",{get:function(){return this.qtiServiceUrl},enumerable:!0,configurable:!0}),c.getInstance=function(a,b){return new c(a,b)},c.prototype.generateFormFromQtiFile=function(b){return this.sendRequest({requestUri:this.QtiServiceUrl+"qti",method:"POST",data:b,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Qti.CreateFormFromQti,qosExtraData:{LorCorrelationId:a.SafeStorage.SessionStorage.getItem("LorCorrelationId")}})},c.getCommonHeaders=function(b){return{Accept:"application/json",Authorization:b?"Bearer "+b:"",__RequestVerificationToken:OfficeFormServerInfo.antiForgeryToken,ShareInvitationKey:a.Utilities.Html.getHashes().Token}},c.prototype.sendRequest=function(a,d){
return this.tokenRetriever.getToken().then(function(e){return a.headers=$.extend(!0,a.headers,c.getCommonHeaders(e)),b.OData.send(a,d).then(function(a){var c=b.OData.ResponseHandler.parseResponseData(a,!0);return c&&c.value},function(a){return b.OData.ResponseHandler.parseAndTryHandleError(a)})})},c}();b.QtiProvider=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return b.getUserInfoInItem=function(b){return b?a.SafeStorage.DefaultStorage.getItem(b):null},b.setUserInfo=function(b,c){b&&a.SafeStorage.DefaultStorage.setItem(b,c)},b}();b.UserProfileProvider=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){Object.defineProperty(a,"convertToArray",{configurable:!1,enumerable:!0,value:Nerve.convertToArray})}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function a(){}return Object.defineProperty(a,"FormNumber",{get:function(){return 200},enumerable:!0,configurable:!0}),Object.defineProperty(a,"FormTitleLength",{get:function(){return 90},enumerable:!0,configurable:!0}),Object.defineProperty(a,"FormSubtitleLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"QuestionNumber",{get:function(){return 100},enumerable:!0,configurable:!0}),Object.defineProperty(a,"QuestionTitleLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"QuestionSubtitleLength",{get:function(){return 2e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"QuestionOptionLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImageAltTextLength",{get:function(){return 128},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OtherOptionLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AnswerHintLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AnswerTextfieldLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"OpenTypeLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ResponseNumber",{get:function(){return 5e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DefaultTextLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImagePickerQueryCount",{get:function(){return 50},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImageMaxWidth",{get:function(){return 800},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImageMaxHeight",{get:function(){return 600},enumerable:!0,configurable:!0}),Object.defineProperty(a,"QuestionCarMaxWidth",{get:function(){return 719},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImagePlaceHolderWidth",{get:function(){return 320},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImagePlaceHolderHeight",{get:function(){return 240},enumerable:!0,configurable:!0}),Object.defineProperty(a,"LogoImagePlaceHolder",{get:function(){return 120},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImageMaxSize",{get:function(){return 5242880},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImageCompressRate",{get:function(){return.6},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ClientSideErrorDefaultInnerCode",{get:function(){return-1},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DefaultVideoHeight",{get:function(){return 422},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ImageSupportMimeType",{get:function(){return["image/bmp","image/gif","image/jpeg","image/png"]},enumerable:!0,configurable:!0}),Object.defineProperty(a,"MaxRankingItemNumber",{get:function(){return 10},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DefaultQuestionStartOrder",{get:function(){return"1"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DefaultMiddleScreenSize",{get:function(){return 375},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DefaultSmallScreenSize",{get:function(){return 300},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AnalysisTokenName",{get:function(){return"AnalyzerToken"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"LikertColumnMaxSize",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(a,"LikertRowMaxSize",{get:function(){return 10},enumerable:!0,configurable:!0}),Object.defineProperty(a,"FileUploadSmallFileBytes",{get:function(){return 4194304},enumerable:!0,configurable:!0}),Object.defineProperty(a,"FileUploadMaxChunkBytes",{get:function(){return 5242880},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DateQuestionAnswerFormat",{get:function(){return"yyyy-MM-dd"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"CustomizedThankYouMessageMaxLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),a}();b.FormLimitation=c,a.Exports.FormLimitation=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}var c,d=Nerve.Spec,e={TargetQuestionId:d.string(),ToTheEnd:d["boolean"](),IsQuestionBranchingValid:d["boolean"]({IsLocalField:!0})};!function(a){a[a.End=0]="End",a[a.Next=1]="Next",a[a.Pending=2]="Pending",a[a.Specified=3]="Specified"}(c=a.BranchingType||(a.BranchingType={})),a.getBranchInfoMaster=b;var f=function(b){function d(a){var c=b.call(this,a)||this;return c.observedQuestionChangeCallback=function(a){return c.onObservedQuestionChange()},a.MasterTreeReady.done(function(){c.Question;c.Deleted||(d.normalize(c,{}),c.observeTargetQuestion(),c.addRule({Name:"normalize",onChange:function(a){return d.normalize(c,a.OldValues)}}),c.observe(function(a){c.Deleted||c.observeTargetQuestion()}))}),c}return __extends(d,b),Object.defineProperty(d.prototype,"Question",{get:function(){var b=this.Parent;do if(b instanceof a.QuestionMaster)return b;while(b=b.Parent);return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"TargetQuestionMaster",{get:function(){if(this.Deleted)return null;var a=this.Question.Form.getQuestionById(this.Model.TargetQuestionId);return a&&a.Deleted?null:a},enumerable:!0,configurable:!0}),d.prototype.resetToDefault=function(){var a=this;this.bulkEdit(function(){a.Model.ToTheEnd=null,a.Model.TargetQuestionId=null})},d.prototype.isDefault=function(){return!this.Model.ToTheEnd&&!this.Model.TargetQuestionId},d.prototype.getBranchingResult=function(){var a=this.Model;return a.IsQuestionBranchingValid?a.ToTheEnd?{Type:c.End}:{Type:c.Specified,TargetQuestion:this.TargetQuestionMaster}:{Type:c.Next}},d.normalize=function(a,b){var c=a.Model;c.ToTheEnd?b.ToTheEnd&&c.TargetQuestionId||(c.TargetQuestionId=null):c.ToTheEnd=null,c.IsQuestionBranchingValid=!(!c.ToTheEnd&&!a.TargetQuestionMaster)},d.prototype.observeTargetQuestion=function(){var a=this.TargetQuestionMaster;a!==this.observedQuestion&&(this.observedQuestion&&this.observedQuestion.unobserve(this.observedQuestionChangeCallback),this.observedQuestion=a,a&&a.observe(this.observedQuestionChangeCallback))},d.prototype.onObservedQuestionChange=function(){this.observedQuestion.Deleted&&(this.Model.TargetQuestionId=null)},d}(Nerve.createObjectMasterClass("BranchInfoMaster",e));a.BranchInfoMaster=f}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return Nerve.getObjectMasterFromModel(a)}function d(b){if(b.BeingDeleted&&b.Master.Synchronizer.Model.UpdateScheduled)try{throw Error("DeletingComment")}catch(c){a.Event.ErrorEvent.logData({type:a.Event.ErrorType.ModelError,errorInfo:c.stack})}}var e=Nerve.Spec,f={QuestionId:e.string({IsKeyField:!0,SourceFieldName:"questionId"}),Id:e.number({SourceFieldName:"id"}),Feedback:e.string({SourceFieldName:"feedback"}),Score:e.number({SourceFieldName:"score"}),SavingState:e.enumeration(function(){return b.SavingState},{IsLocalField:!0})};b.getCommentMaster=c;var g=function(a,c){return new b.CommentDataSource(a,c)},h=function(a){function c(c){var e=a.call(this,c,{Scheduler:new b.Scheduler})||this;return b.keepSavingStateUpdated(e),e.observe(d),e}return __extends(c,a),Object.defineProperty(c.prototype,"Response",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Response.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ResponseId",{get:function(){return this.Response.ResponseId},enumerable:!0,configurable:!0}),c}(Nerve.createObjectMasterClass("Comment",f,g));b.CommentMaster=h}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a,c){this.choice=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.choice.Form)}return Object.defineProperty(c.prototype,"FormId",{get:function(){return this.choice.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionId",{get:function(){return this.choice.QuestionId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ChoiceId",{get:function(){return this.choice.Model.Id},enumerable:!0,configurable:!0}),c.prototype.add=function(a){return this.choice.Form.SyncContext===b.FormSyncContext.DesignTimeForm?this.dataProvider.createQuestionChoice(this.FormId,this.QuestionId,a):void Nerve.Debugger.throwError("Trying to create a choice out of design time.")},c.prototype["delete"]=function(a){return this.choice.Form.SyncContext===b.FormSyncContext.DesignTimeForm?this.dataProvider.deleteQuestionChoice(this.FormId,this.QuestionId,this.ChoiceId):void Nerve.Debugger.throwError("Trying to delete a choice out of design time.")},c.prototype.query=function(a){return this.dataProvider.getQuestionChoice(this.FormId,this.QuestionId,this.ChoiceId)},c.prototype.update=function(c,d){if(this.choice.Form.SyncContext===b.FormSyncContext.DesignTimeForm){if(c)return this.dataProvider.updateQuestionChoice(this.FormId,this.QuestionId,this.ChoiceId,c);try{throw Error("patch choice body null error")}catch(e){a.Event.ErrorEvent.logData({type:a.Event.ErrorType.DataSourceUpdatingChoiceNull,errorInfo:{stack:e.stack}})}return $.Deferred().resolve().promise()}Nerve.Debugger.throwError("Trying to update a choice out of design time.")},c}();b.ChoiceDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a,c){this.comment=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.comment.Response.Form)}return Object.defineProperty(c.prototype,"FormId",{get:function(){return this.comment.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ResponseId",{get:function(){return this.comment.ResponseId},enumerable:!0,configurable:!0}),c.prototype.add=function(a,b,c){return this.addOrUpdate(!c),this.dataProvider.addFormResponseComment(this.FormId,this.ResponseId,b.Snapshot)},c.prototype["delete"]=function(a){return $.Deferred().promise()},c.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},c.prototype.update=function(a,c){this.addOrUpdate(!1);var d=this.comment.Response.Form.SyncContext;return d!==b.FormSyncContext.DesignTimeForm&&d!==b.FormSyncContext.AnalysisTimeForm?$.Deferred().promise():this.add(a,c,!0)},c.prototype.addOrUpdate=function(a){a&&this.logCommentCreateEventForQti()},c.prototype.isQtiForm=function(a){return null!=a&&a.startsWith("qti_")?!0:!1},c.prototype.logCommentCreateEventForQti=function(){var c=this.comment.Response.Form;if(c.isFieldReady(b.FormMaster.Schema.TrackingId)){var d=c.Model.TrackingId;this.isQtiForm(d)&&a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.GradeQtiResults,extraData:{FormId:c.Model.Id,LorId:c.Model.TrackingId}})}},c}();b.CommentDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a,d){if(this.form=a,this.receiver=d,this.dataProvider=c.getDataProviderByFormMaster(a),this.dataProvider){var e=this.dataProvider.getDesignForm;switch(this.form.SyncContext){case b.FormSyncContext.SharedTimeForm:e=this.dataProvider.getSharedForm;break;case b.FormSyncContext.ResponseTimeForm:e=this.dataProvider.getRuntimeForm;break;case b.FormSyncContext.AnalysisTimeForm:e=this.dataProvider.getAnalysisTimeForm}this.getForm=e.bind(this.dataProvider)}}return c.getAllForms=function(d,e,f,g){void 0===e&&(e=a.DataProvider.DataProviderType.Me),void 0===f&&(f=null),void 0===g&&(g=null);var h=c.getSourceFieldNames(d);h.push("status");var i=Nerve.getFieldSchemaInfo(b.FormMaster.Schema.Version).Attributes.SourceFieldName;h.indexOf(i)&&h.push(i);var j=a.DataProvider.ProviderManager.getInstance().createDataProvider(e,f,g),k=j.getForms(h);return k.then(function(c){var d=[],e=0,f=[];return c.forEach(function(a){if("Deleted"===a.status)++e,j.deleteForm(a.id);else if(a.version){var c=Nerve.convertFromSourceData(a,b.FormMaster.Schema);f.push(c)}else d.push(a.id)}),(d.length||e)&&a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.PortalPage.FilteredOutForms,extraData:{deletedFormCount:e,oldVersionForms:d}}),f})},c.getAllFormsResponseCount=function(){var b=a.DataProvider.ProviderManager.getInstance().createDataProvider();return b.getFormsResponseCount()},c.getAllSharedWithMeForms=function(){var c=a.DataProvider.ProviderManager.getInstance().createDataProvider(a.DataProvider.DataProviderType.Me),d=c.getFormsSharedWithCurrentUser();return d.then(function(a){return a.map(function(a){return Nerve.convertFromSourceData(a,b.FormMaster.Schema)})})},c.getDataProviderByFormMaster=function(c){if(!c.isFieldReady(b.FormMaster.Schema.OwnerTenantId)||!c.isFieldReady(b.FormMaster.Schema.OwnerId))return a.DataProvider.ProviderManager.getInstance().createDataProvider();var d=a.DataProvider.DataProviderType.Default;if(c.IsGroupForm)d=a.DataProvider.DataProviderType.Group;else{if(!c.Model.OwnerTenantId||!c.Model.OwnerId)return null;d=a.DataProvider.DataProviderType.Personal}return a.DataProvider.ProviderManager.getInstance().createDataProvider(d,c.Model.OwnerTenantId,c.Model.OwnerId)},c.getDataProviderByFormId=function(b){var c=a.Utilities.FormId.decodeFormId(b),d=a.DataProvider.DataProviderType.Default;return c.IsGroupOwner?d=a.DataProvider.DataProviderType.Group:c.OrgId&&c.OwnerId&&(d=a.DataProvider.DataProviderType.Personal),a.DataProvider.ProviderManager.getInstance().createDataProvider(d,c.OrgId,c.OwnerId)},c.createExportFile=function(a){var b=c.getDataProviderByFormMaster(a);return b.createExportFile(a.Model.Id)},c.downloadExcelFile=function(a,b,d){var e=c.getDataProviderByFormMaster(a);return e.downloadExcelFile(a.Model.Id,b,d)},c.getResponseCount=function(a){var b=c.getDataProviderByFormMaster(a);return b.getFormResponseCount(a.Model.Id)},c.duplicateExcelForm=function(c,d){var e=a.DataProvider.ProviderManager.getInstance().createDataProvider(),f=e.dupFormForExcel(c,d);return f.then(function(a){return Nerve.convertFromSourceData(a,b.FormMaster.Schema)})},c.getAggregateSurveyData=function(a){var b=c.getDataProviderByFormId(a);return b.getAnalysisSurveyData(a)},c.getAggregateQuizData=function(a){var b=c.getDataProviderByFormId(a);return b.getAnalysisQuizData(a)},c.getResultSharingAnalysisSurveyData=function(a){var b=c.getDataProviderByFormId(a);return b.getResultSharingAnalysisSurveyData(a)},c.getResultSharingAnalysisQuizData=function(a){var b=c.getDataProviderByFormId(a);return b.getResultSharingAnalysisQuizData(a)},c.getFormInsights=function(a){var b=c.getDataProviderByFormId(a);return b.getInsights(a)},c.prototype.add=function(a){return this.form.SyncContext===b.FormSyncContext.LocalForm?$.Deferred().promise():this.form.SyncContext===b.FormSyncContext.DesignTimeForm?this.dataProvider.createForm(a):void Nerve.Debugger.throwError("Trying to create a form without design type.")},c.prototype["delete"]=function(a){return this.form.SyncContext===b.FormSyncContext.DesignTimeForm?(this.removeFromMRU(),this.dataProvider.deleteForm(this.form.Model.Id)):void Nerve.Debugger.throwError("Trying to delete a form without design type.")},c.prototype.query=function(b){if(!this.getForm){var c={innerCode:a.DataProvider.ErrorCode.InnerCode.InvalidFormId};return $.Deferred().reject(c).promise()}return this.getForm(this.form.Model.Id,b)},c.prototype.update=function(a){if(this.form.SyncContext===b.FormSyncContext.LocalForm)return $.Deferred().promise();if(this.form.SyncContext!==b.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();var c=Nerve.getFieldSchemaInfo(b.FormMaster.Schema.SoftDeleted).Attributes.SourceFieldName;return c in a&&a[c]===b.FormDeletedState.SoftDeleted&&this.removeFromMRU(),this.dataProvider.updateForm(this.form.Model.Id,a)},c.getSourceFieldNames=function(a){return b.FormMaster.getSourceFields(a||Nerve.getSubFieldSchemas(b.FormMaster.Schema)).map(function(a){var b=Nerve.getFieldSchemaInfo(a);return b.Attributes.IsLocalField?void 0:b.Attributes.SourceFieldName||b.Name}).filter(function(a){return a})},c.prototype.removeFromMRU=function(){var a=this;return this.dataProvider.removeRecentForm(this.form.Model.Id).then(function(){var b=Forms.Mru.MruDocumentManager.getInstance();b&&b.removeDocument(a.form.Model.Id)})},c}();b.FormDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(c,d){this.image=c,this.receiver=d;var e,f=this.image.Parent;if(f instanceof b.FormMaster)e=f;else{if(!(f instanceof b.QuestionMaster))throw"Wrong parent type of ImageInfoMaster.";e=f.Form}var g=e.IsGroupForm?a.DataProvider.DataProviderType.Group:a.DataProvider.DataProviderType.Personal;this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(e),this.imageProvider=a.DataProvider.ProviderManager.getInstance().createImageProvider(g,e.Model.OwnerTenantId,e.Model.OwnerId);var h=Nerve.getFieldSchemaInfo(c.Membership.FieldSchema);this.propertyName=h.Attributes.SourceFieldName||h.Name}return c.prototype.add=function(a){return $.Deferred().resolve().promise()},c.prototype["delete"]=function(a){return Nerve.Debugger.throwError("not supported")},c.prototype.query=function(a){return Nerve.Debugger.throwError("not supported")},c.prototype.update=function(a){var b=a.uploadParameters;if(!b)return this.uploadAsComplexType();var c;return b.Delete?c=this.deleteImage():b.ImageFile?c=this.uploadFromImageFile(b.ImageFile):b.Url&&(c=this.createImageFromUrl(b.Url,b.Size)),c?c.then(function(a){var b=_.clone(a);return b.uploadParameters=null,b}):void 0},c.prototype.uploadAsComplexType=function(){var a=this,c=Nerve.convertToSourceData(this.image.getSnapshot(),b.ImageInfoMaster.Schema);delete c.uploadParameters;var d={};d[this.propertyName]=c;var e,f=this.image.Parent;if(f instanceof b.FormMaster)e=this.dataProvider.updateForm(f.Model.Id,d);else{if(!(f instanceof b.QuestionMaster))return Nerve.Debugger.throwError("not supported");e=this.dataProvider.updateFormQuestion(f.Form.Model.Id,f.Model.Id,f.Model.Type,d)}return e.then(function(b){return b&&b[a.propertyName]})},c.prototype.createImageFromUrl=function(c,d){var e={SourceUrl:c,Title:a.Utilities.Guid.newGuid(),Size:d},f=this.image.Parent;return f instanceof b.FormMaster?this.dataProvider.createFormImageFromUrl(f.Model.Id,this.propertyName,e):f instanceof b.QuestionMaster?this.dataProvider.createQuestionImageFromUrl(f.Form.Model.Id,f.Model.Id,e):Nerve.Debugger.throwError("not supported")},c.prototype.uploadFromImageFile=function(c){var d={ImageBlob:c,ImageName:a.Utilities.Guid.newGuid(),ImageType:c.type},e=this.image.Parent;return e instanceof b.FormMaster?this.imageProvider.uploadFormImage(e.Model.Id,this.propertyName,d):e instanceof b.QuestionMaster?this.imageProvider.uploadQuestionImage(e.Form.Model.Id,e.Model.Id,this.propertyName,d):Nerve.Debugger.throwError("not supported")},c.prototype.deleteImage=function(){var c,d=this,e=this.image.Parent;if(e instanceof b.FormMaster)c=this.imageProvider.deleteFormImage(e.Model.Id,this.propertyName);else{if(!(e instanceof b.QuestionMaster))return Nerve.Debugger.throwError("not supported");c=this.imageProvider.deleteQuestionImage(e.Form.Model.Id,e.Model.Id,this.propertyName)}return c.then(null,function(b){return b&&b.innerCode===a.DataProvider.ErrorCode.InnerCode.ImageNotFound?(a.Event.ErrorEvent.logData({type:a.Event.ErrorType.DeleteImageNotFoundError,errorInfo:{imageUrl:d.image.Model.ResourceUrl}}),$.Deferred().resolve().promise()):b}).then(function(){return{altText:null,contentType:null,fileIdentifier:null,height:null,imageFile:null,originalFileName:null,resourceId:null,resourceUrl:null,size:null,width:null}})},c}();b.ImageDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(b,c){this.permission=b,this.receiver=c,this.dataProvider=a.FormDataSource.getDataProviderByFormMaster(this.permission.Form)}return Object.defineProperty(b.prototype,"FormId",{get:function(){return this.permission.FormId},enumerable:!0,configurable:!0}),b.prototype.add=function(a){return this.dataProvider.createPermissionLink(this.FormId,a)},b.prototype["delete"]=function(a){return this.dataProvider.deletePermissionLink(this.FormId,a.principalId)},b.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},b.prototype.update=function(b,c){return c.Snapshot.type===a.PermissionType[a.PermissionType.OrgLink]||c.Snapshot.type===a.PermissionType[a.PermissionType.Link]?this.dataProvider.createPermissionLink(this.FormId,{permissionSet:c.Snapshot.permissionSet,type:c.Snapshot.type}):Nerve.Debugger.throwError("No scenario to call this method currently.")},b}();a.PermissionDataSource=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(b,c){this.permissionToken=b,this.receiver=c,this.dataProvider=a.FormDataSource.getDataProviderByFormMaster(this.permissionToken.Form)}return Object.defineProperty(b.prototype,"FormId",{get:function(){return this.permissionToken.FormId},enumerable:!0,configurable:!0}),b.prototype.add=function(a){return this.dataProvider.createPermissionToken(this.FormId,a)},b.prototype["delete"]=function(a){return this.dataProvider.deletePermissionToken(this.FormId,a.principalId)},b.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},b.prototype.update=function(a,b){return Nerve.Debugger.throwError("No scenario to call this method currently.")},b}();a.PermissionTokenDataSource=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a,c){this.question=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.question.Form)}return Object.defineProperty(c.prototype,"FormId",{get:function(){return this.question.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionId",{get:function(){return this.question.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionType",{get:function(){return this.question.Model.Type},enumerable:!0,configurable:!0}),c.prototype.add=function(a){var c=this;if(this.question.Form.SyncContext===b.FormSyncContext.DesignTimeForm){var d=this.question.ParentQuestionMaster;return d?d.Synchronizer.existingInDataSource().then(function(){return c.addInternally(a)}):this.addInternally(a)}Nerve.Debugger.throwError("Trying to create a question without design type.")},c.prototype["delete"]=function(a){var c=this;this.question.Form.SyncContext!==b.FormSyncContext.DesignTimeForm&&Nerve.Debugger.throwError("Trying to delete a question without design type.");var d=this.question.ParentQuestionMaster;if(d&&d.Deleted)return $.Deferred().resolve().promise();var e=this.question.SubQuestionMasters.map(function(a){return a.Synchronizer.flush()});return $.when.apply($,e).then(function(){return c.question.createSyncJob(function(){return c.dataProvider.deleteFormQuestion(c.FormId,a.id,c.QuestionType)})})},c.prototype.query=function(a){var b=this;return Nerve.Debugger.throwError("No scenario to call this method currently."),this.question.createSyncJob(function(){return b.dataProvider.getFormQuestion(b.FormId,b.QuestionId,a)})},c.prototype.update=function(c,d){var e=this;if(this.question.Form.SyncContext!==b.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();if("id"in c){var f=c.id,g=d.ValuesBefore.id;a.Event.ErrorEvent.logData({type:a.Event.ErrorType.DataSourceUpdatingQuestionId,errorInfo:{newId:f,oldId:g}})}if(null===c.allowMultipleValues)try{throw Error("allowMultipleValues null error")}catch(h){a.Event.ErrorEvent.logData({type:a.Event.ErrorType.DataSourceUpdatingQuestionNullAllowMultipleValues,errorInfo:{stack:h.stack}})}return this.question.createSyncJob(function(){return e.dataProvider.updateFormQuestion(e.FormId,e.QuestionId,e.QuestionType,c)})},c.prototype.addInternally=function(b){var c=this,d=this.question.createSyncJob(function(){return c.dataProvider.createFormQuestion(c.FormId,b)});return d.done(function(b){"id"in b&&b.id!==c.QuestionId&&a.Event.ErrorEvent.logData({type:a.Event.ErrorType.ChangedIdFromServerSide,errorInfo:{newId:b.id,oldId:c.QuestionId,formId:c.FormId}})}),d},c}();b.QuestionDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c="0001-01-01T00:00:00Z",d=function(){function d(a,c){this.response=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.response.Form)}return Object.defineProperty(d.prototype,"FormId",{get:function(){return this.response.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"ResponseId",{get:function(){return this.response.ResponseId},enumerable:!0,configurable:!0}),d.submitResponse=function(a,c){var d=_.map(c.Answers,function(a){return{questionId:a.QuestionId,answer1:a.Answer}}),e={answers:JSON.stringify(d),startDate:c.StartDate instanceof Date?c.StartDate.toISOString():"",submitDate:c.SubmitDate instanceof Date?c.SubmitDate.toISOString():""};return c.Responder&&(e.responder=c.Responder,e.responderName=c.ResponderName),this.logResponseSubmittedEventForQti(a),b.FormDataSource.getDataProviderByFormMaster(a).submitFormResponse(a.Model.Id,e)},d.getResponses=function(a,c,e){return b.FormDataSource.getDataProviderByFormMaster(a).getFormResponses(a.Model.Id,null,c,e).then(function(a){return a.map(d.toClientPayload)})},d.getRuntimeResponses=function(a){return b.FormDataSource.getDataProviderByFormMaster(a).getRuntimeResponses(a.Model.Id).then(function(a){return a.map(d.toClientPayload)})},d.deleteAllResponses=function(a){return b.FormDataSource.getDataProviderByFormMaster(a).deleteFormResponses(a.Model.Id)},d.getReleasedResponsesByResponder=function(a,e){return b.FormDataSource.getDataProviderByFormMaster(a).getRuntimeResponses(a.Model.Id,e).then(function(a){return a.filter(function(a){return a.releaseDate!==c}).map(d.toClientPayload)})},d.deleteResponses=function(a,c){var d=b.FormDataSource.getDataProviderByFormId(a);return $.when.apply($,c.map(function(b){return d.deleteFormResponse(a,b)}))},d.toClientPayload=function(a){var d=Nerve.convertFromSourceData(a,b.ResponseMaster.Schema);void 0!==d.StartDateAsString&&(d.StartDate=new Date(d.StartDateAsString)),void 0!==d.SubmitDateAsString&&(d.SubmitDate=new Date(d.SubmitDateAsString)),void 0!==d.ReleaseDateAsString&&(null===d.ReleaseDateAsString?d.ReleaseDate=new Date(c):d.ReleaseDate=new Date(d.ReleaseDateAsString));var e=[];if(d.AnswersAsString&&(e=JSON.parse(d.AnswersAsString).map(function(a){return{QuestionId:a.questionId,Answer:a.answer1}}),d.Answers=e),d.Comments){var f={},g=[],h="___";_.forEach(d.Comments,function(a){var b=a.QuestionId||h;f[b]&&g.push(f[b]),f[b]=a}),d.Comments=_.difference(d.Comments,g)}if(d.Comments){var i={};e.forEach(function(a){return i[a.QuestionId]=a}),_.forEach(d.Comments,function(a){var b=a.QuestionId;if(b){var c=i[b];c||(c={QuestionId:b,Answer:null},e.push(c),i[b]=c),c.Feedback=a.Feedback,c.Score=a.Score}else d.Feedback=a.Feedback,d.TotalScore=a.Score})}return d},d.prototype.add=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},d.prototype["delete"]=function(a){return this.dataProvider.deleteFormResponse(this.FormId,a.id)},d.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},d.prototype.update=function(a,c){var d=a.releaseDate,e=this.response.Form.SyncContext;return e!==b.FormSyncContext.DesignTimeForm&&e!==b.FormSyncContext.AnalysisTimeForm?$.Deferred().promise():void 0!==d?(this.logPostScoreEventForQti(),this.dataProvider.setResponseReleaseDate(this.FormId,this.ResponseId,d)):$.Deferred().resolve().promise()},d.isQtiForm=function(a){return null!=a&&a.startsWith("qti_")?!0:!1},d.logResponseSubmittedEventForQti=function(c){if(c.isFieldReady(b.FormMaster.Schema.TrackingId)){var d=c.Model.TrackingId;this.isQtiForm(d)&&a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.SubmitQtiResponse,extraData:{FormId:c.Model.Id,LorId:c.Model.TrackingId}})}},d.prototype.logPostScoreEventForQti=function(){var c=this.response.Form;if(c.isFieldReady(b.FormMaster.Schema.TrackingId)){var e=c.Model.TrackingId;d.isQtiForm(e)&&a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.PostQtiGrade,extraData:{FormId:c.Model.Id,LorId:c.Model.TrackingId}})}},d}();b.ResponseDataSource=d}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(a,b){void 0===a&&(a=1e3),void 0===b&&(b=5e3);var c=this;this.fast=a,this.slow=b,this.updateTrigger=function(){return c.clearUpdateSchedule().resolve()}}return b.prototype.scheduleUpdate=function(){if(this.deferred)throw Error("Calling schedule() before the previous one is resolved.");return this.deferred=$.Deferred(),this.updateFastTimer=window.setTimeout(this.updateTrigger,this.fast),this.updateSlowTimer=window.setTimeout(this.updateTrigger,this.slow),this.deferred.promise()},b.prototype.postponeUpdate=function(){window.clearTimeout(this.updateFastTimer),this.updateFastTimer=window.setTimeout(this.updateTrigger,this.fast)},b.prototype.cancelUpdate=function(){this.clearUpdateSchedule().reject()},b.prototype.clearUpdateSchedule=function(){window.clearTimeout(this.updateFastTimer),this.updateFastTimer=void 0,window.clearTimeout(this.updateSlowTimer),this.updateSlowTimer=void 0;var a=this.deferred;return this.deferred=void 0,a},b.prototype.retryForCreation=function(b){return 3>b?a.Utilities.Promise.getResolvedPromise():a.Utilities.Promise.getRejectedPromise()},b.prototype.retryForUpdate=function(a){var b=this,c=e;f>a&&(c=d*Math.pow(2,a)),this.updateRetryTimer=window.setTimeout(function(){b.updateRetryTimer=void 0,g.resolve()},c);var g=$.Deferred();return g.promise()},b.prototype.cancelRetryForUpdate=function(){window.clearTimeout(this.updateRetryTimer),this.updateRetryTimer=void 0},b}();b.Scheduler=c;var d=2500,e=6e5,f=Math.log(e/d)/Math.log(2)}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;
!function(a){var b;!function(a){var b;!function(a){function b(a,c){if(null==a)return null;if(Array.isArray(a)){if(a.length){var d=c[0];return a.map(function(a){return b(a,d)})}return[]}var e={},f=0;return Nerve.getSubFieldSchemas(c).forEach(function(c){var d=Nerve.getFieldSchemaInfo(c),g=d.Attributes.SourceFieldName||d.Name,h=a[g];d.IsLeaf||(h=b(h,c)),null!=h&&(++f,e[g]=h)}),f>0?e:null}var c=function(){function a(a,b,c){this.master=a,this.targetField=b,this.bindedFields=c.FieldSchemas,this.bind()}return a.prototype.serialize=function(){var a=this.master.getSnapshot(this.bindedFields),c=this.master.Schema,d={};this.bindedFields.forEach(function(b){var c=Nerve.getFieldSchemaInfo(b).Name;d[c]=Nerve.convertToSourceData(a[c],b)});var e=b(d,c),f=e?JSON.stringify(e):null,g=Nerve.getFieldSchemaInfo(this.targetField).Name;this.master.Model[g]=f},a.prototype.deserialize=function(){var a=Nerve.getFieldSchemaInfo(this.targetField).Name,b=this.master.Model[a],c=b?JSON.parse(b):{},d={};this.bindedFields.forEach(function(a){var b=Nerve.getFieldSchemaInfo(a).Name;d[b]=Nerve.convertFromSourceData(c[b],a)}),this.master.setData(d,this.bindedFields)},a.prototype.bind=function(){var a=this,b=Nerve.getFieldSchemaInfo(this.targetField).Name;this.master.addRule({Name:"Deserialize - "+b,InterestedFields:[this.targetField],onChange:function(b){b.BeingDeleted||a.deserialize()}}),this.master.addRule({Name:"Serialize - "+b,InterestedFields:this.bindedFields,onChange:function(b){b.BeingDeleted||a.serialize()}})},a}();a.FieldBinder=c}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(a){this.fieldSchemas=a.concat(),this.fieldNames=a.map(function(a){return Nerve.getFieldSchemaInfo(a).Name})}return Object.defineProperty(b.prototype,"FieldSchemas",{get:function(){return this.fieldSchemas.concat()},enumerable:!0,configurable:!0}),b.prototype.covers=function(b){return a.Utilities.Type.isString(b)?_.contains(this.fieldNames,b):_.contains(this.fieldSchemas,b)},b}();b.FieldSet=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return e(a,!0)}function e(b,d){if(d&&(b.SoftDeleted=b.SoftDeleted),b.Id)return c.exportConverter(l.getDesignFormMaster(b));var e=q.FieldsForCreatingForm.map(Nerve.getFieldSchemaInfo).map(function(a){return a.Name});if(b=_.pick(b,e),d?(b.OwnerId=b.OwnerId||a.EnvironmentSettings.GroupId,b.OwnerTenantId=b.OwnerTenantId||a.EnvironmentSettings.TenantId||OfficeFormServerInfo.userInfo.TenantId):(b.OwnerId=b.OwnerId||OfficeFormServerInfo.userInfo.UserId,b.OwnerTenantId=b.OwnerTenantId||OfficeFormServerInfo.userInfo.TenantId),!b.OwnerId||!b.OwnerTenantId)throw new Error("Form OwnerId or OwnerTenantId cannot be null!");return c.exportConverter(l.createNewFormMaster(b,d?"Group":"User"))}function f(b){var d=a.Utilities.FormId.decodeFormId(b);return new c.FormMaster(j.ResponseTimeForm,{InitialData:{Id:b,OwnerId:d.OwnerId,OwnerTenantId:d.OrgId,TableId:d.TableId},ExistingInDataSource:!0},d.IsGroupOwner)}function g(b){var d=a.Utilities.FormId.decodeFormId(b);return new c.FormMaster(j.SharedTimeForm,{InitialData:{Id:b,OwnerId:d.OwnerId,OwnerTenantId:d.OrgId,TableId:d.TableId},ExistingInDataSource:!0},d.IsGroupOwner)}function h(b){var d=a.Utilities.FormId.decodeFormId(b);return new c.FormMaster(j.AnalysisTimeForm,{InitialData:{Id:b,OwnerId:d.OwnerId,OwnerTenantId:d.OrgId,TableId:d.TableId},ExistingInDataSource:!0},d.IsGroupOwner)}function i(a){return new c.FormMaster(j.LocalForm,{InitialData:a},!1)}var j,k=Nerve.Spec,l=Forms.Models.FormManager,m={Id:k.string({IsSourceGenerated:!0,IsKeyField:!0,SourceFieldName:"id"}),Description:k.string({SourceFieldName:"description"}),Background:k.fromMasterClass(function(){return c.ImageInfoMaster},{SourceFieldName:"background"}),Category:k.string({SourceFieldName:"category"}),Logo:k.fromMasterClass(function(){return c.ImageInfoMaster},{SourceFieldName:"logo"}),ModifiedDate:k.string({SourceFieldName:"modifiedDate"}),OtherInfo:k.string({SourceFieldName:"otherInfo"}),OwnerId:k.string({SourceFieldName:"ownerId"}),OwnerTenantId:k.string({SourceFieldName:"ownerTenantId"}),RowCount:k.number({SourceFieldName:"rowCount"}),SharedBy:k.string({SourceFieldName:"sharedBy"}),SharedFormOwnerName:k.string({SourceFieldName:"ownerDisplayName"}),SharedDate:k.string({SourceFieldName:"dateTimeShared"}),TableId:k.string({IsSourceGenerated:!0,SourceFieldName:"tableId"}),Title:k.string({SourceFieldName:"title"}),Version:k.string({SourceFieldName:"version"}),XlWorkbookId:k.string({SourceFieldName:"xlWorkbookId"}),XlExportingTag:k.string({SourceFieldName:"xlExportingTag"}),XlFileUnsynced:k["boolean"]({SourceFieldName:"xlFileUnSynced"}),Permissions:k.collectionOf(function(){return c.PermissionMaster},{SourceFieldName:"permissions"}),PermissionTokens:k.collectionOf(function(){return c.PermissionTokenMaster},{SourceFieldName:"permissionTokens"}),Questions:k.collectionOf(function(){return c.QuestionMaster},{SourceFieldName:"questions"}),MovingToRecycleBin:k["boolean"]({IsLocalField:!0}),SoftDeleted:k.enumeration(function(){return o},{SourceFieldName:"softDeleted",IsNumberTypeInDataSource:!0}),TrackingId:k.string({SourceFieldName:"trackingId"}),PrivacyUrl:k.string({IsSourceGenerated:!0,SourceFieldName:"privacyStatement"}),ThankYouMessage:k.string({SourceFieldName:"thankYouMessage"}),BufferResponses:k.collectionOf(k.reference({},function(a){return a.Id.toString()}),{IsLocalField:!0}),CoAuthMessage:k.string({IsLocalField:!0}),DeleteCollaborationPermission:k["boolean"]({IsLocalField:!0}),HasValidBranching:k["boolean"]({IsLocalField:!0}),HasQuestionMedia:k["boolean"]({IsLocalField:!0}),Modified:k.string({IsLocalField:!0}),PredefinedResponses:k.collectionOf({Id:k.number({IsKeyField:!0}),Answers:k.collectionOf({QuestionId:k.string(),Answer:k.reference()})},{IsLocalField:!0}),PrimaryCustomizedThemeColor:k.string({IsLocalField:!0}),QuizQuestionsCount:k.number({IsLocalField:!0}),SecondaryCustomizedThemeColor:k.string({IsLocalField:!0}),Responses:k.collectionOf(k.reference({},function(a){return a.Id.toString()}),{IsLocalField:!0}),ResponsesCount:k.number({IsLocalField:!0}),XlExportingLocalTag:k.string({IsLocalField:!0}),SerializedSettings:k.string({SourceFieldName:"settings"}),Settings:k.fromMasterClass(function(){return c.FormSettingsMaster},{IsLocalField:!0}),SerializedPredefinedResponses:k.string({SourceFieldName:"predefinedResponses"}),TertiaryCustomizedThemeColor:k.string({IsLocalField:!0}),Theme:k.fromMasterClass(function(){return Forms.Models.FormThemeMaster},{IsLocalField:!0}),ResponseModels:k.collectionOf(function(){return c.ResponseMaster},{IsLocalField:!0}),IntegratedSavingState:k.enumeration(function(){return c.SavingState},{IsLocalField:!0}),SavingState:k.enumeration(function(){return c.SavingState},{IsLocalField:!0}),LogoInfo:k.fromMasterClass(function(){return c.ImageSettingsMaster},{IsLocalField:!0}),CreatedFromOneDrive:k["boolean"]({IsLocalField:!0}),TransferInProgress:k["boolean"]({IsLocalField:!0})};!function(a){a[a.DesignTimeForm=0]="DesignTimeForm",a[a.ResponseTimeForm=1]="ResponseTimeForm",a[a.SharedTimeForm=2]="SharedTimeForm",a[a.LocalForm=3]="LocalForm",a[a.AnalysisTimeForm=4]="AnalysisTimeForm"}(j=c.FormSyncContext||(c.FormSyncContext={}));var n;!function(a){a[a.ConnectionStateChanged=0]="ConnectionStateChanged",a[a.UserAction=1]="UserAction",a[a.UserConnect=2]="UserConnect",a[a.UserDisconnect=3]="UserDisconnect"}(n=c.FormChangeActionType||(c.FormChangeActionType={}));var o;!function(a){a[a.Normal=0]="Normal",a[a.SoftDeleted=1]="SoftDeleted"}(o=c.FormDeletedState||(c.FormDeletedState={})),c.createGroupDesignFormMaster=d,c.createDesignFormMaster=e,c.createResponseFormMaster=f,c.createSharedFormMaster=g,c.createAnalysisFormMaster=h,c.createLocalFormMaster=i;var p=function(a,b){return new c.FormDataSource(a,b)},q=function(d){function f(b,e,g){var h=this,i=$.Deferred();return e=f.normalizeInitialData(e),h=d.call(this,e,{Scheduler:new c.Scheduler,MasterReady:i.promise()})||this,h.isGroupForm=g,h.currentQuestionListDownloadJob=$.Deferred().resolve().promise(),h.questionSyncJobs=[],h.syncContext=b,h.initializeQuestionOrderRule(),h.initializeOtherInfoBinder(e),h.initializeSavingStateIntegration(),h.initializeModifiedDate(e),h.initializeResponseCount(),c.bindImageSettings(h,f.Schema.Logo,f.Schema.LogoInfo),h.observe(function(){h.ensureFieldsReady([c.FormMaster.Schema.XlExportingTag]).done(function(){return h.Model.XlExportingLocalTag=h.Model.XlExportingTag.toLocaleLowerCase()})},[c.FormMaster.Schema.XlExportingTag]),f.Rules.forEach(function(a){return h.addRule(a)}),h.coAuthUserStateChangeCallbacks=new a.Utilities.Process.CallbackManager,i.resolve(),h}return __extends(f,d),Object.defineProperty(f,"QuestionOrderFloor",{get:function(){return 500},enumerable:!0,configurable:!0}),Object.defineProperty(f,"QuestionOrderDefaultStep",{get:function(){return 100},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ExportingProcessingStatusString",{get:function(){return"exporting"},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ExportingFailedStatusString",{get:function(){return"failed"},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ExportingTimeoutStatusString",{get:function(){return"timeout"},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ReexportToExcelMaxTimeForTimeout",{get:function(){return 3e5},enumerable:!0,configurable:!0}),f.getSourceFields=function(a){var b=f.Schema,c=[];return a.forEach(function(a){switch(a){case"Settings":case b.Settings:c.push(b.SerializedSettings);break;case"Modified":case b.Modified:c.push(b.ModifiedDate);break;case"ResponsesCount":case b.ResponsesCount:c.push(b.RowCount);break;case"PredefinedResponses":case b.PredefinedResponses:c.push(b.SerializedPredefinedResponses);break;case"Theme":case b.Theme:c.push(b.Background,b.OtherInfo);break;default:if(f.OtherInfoFieldSet.covers(a)){c.push(b.OtherInfo);break}c.push(a)}}),_.uniq(c)},f.prototype.createExportFile=function(){return c.FormDataSource.createExportFile(this)},f.prototype.downloadExcelFile=function(a,b){return c.FormDataSource.downloadExcelFile(this,a,b)},Object.defineProperty(f.prototype,"IsGroupForm",{get:function(){return this.isGroupForm},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"SyncContext",{get:function(){return this.syncContext},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"TopQuestionMasters",{get:function(){return _.filter(this.Model.Questions,function(a){return!a.GroupId}).map(function(a){return Nerve.getObjectMasterFromModel(a)})},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"QuestionMasters",{get:function(){return b.convertToArray(this.Model.Questions).map(function(a){return Nerve.getObjectMasterFromModel(a)})},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"SettingMaster",{get:function(){return Nerve.getObjectMasterFromModel(this.Model.Settings)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"ThemeMaster",{get:function(){return Nerve.getObjectMasterFromModel(this.Model.Theme)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"QRCodeImage",{get:function(){return this.qrCodeImage||void 0},set:function(a){this.qrCodeImage=a},enumerable:!0,configurable:!0}),f.prototype.getRelatedSourceFields=function(a){return f.getSourceFields(a)},f.prototype.existingOnServerSide=function(){return this.Synchronizer.existingInDataSource()},f.prototype.getImageMaster=function(a){return c.getImageInfoMaster(this.getModelByFieldSchema(a))},f.prototype.getImageSettingsMaster=function(a){return c.getImageSettingsMaster(this.getModelByFieldSchema(a))},f.prototype.getQuestionById=function(a){var b=Nerve.Collection.getItemWithKeyFields(this.Model.Questions,{Id:a});return b&&c.getQuestionMaster(b)},f.prototype.getQuestionListDownloadBlocker=function(b){var c=this.questionSyncJobs;return this.questionSyncJobs=[],this.currentQuestionListDownloadJob=a.Utilities.Promise.always(b),$.when.apply($,c)},f.prototype.getQuestionSyncBlocker=function(b){return this.questionSyncJobs.push(a.Utilities.Promise.always(b)),this.currentQuestionListDownloadJob},f.prototype.getReleasedResponsesByResponder=function(a){var b=this;return a&&!this.SettingMaster.Model.IsAnonymous?c.ResponseDataSource.getReleasedResponsesByResponder(this,a).then(function(a){return b.normalizeResponses(a)}):$.Deferred().resolve().promise()},f.prototype.appendElement=function(a,b){var d=[];a.Id||(a=_.clone(a),a.Id=f.createNewQuestionId());var e=this.Model.Questions.length>0?this.Model.Questions[this.Model.Questions.length-1].Order:f.QuestionOrderFloor;a.Order=e+f.QuestionOrderDefaultStep,b&&(d=b.map(function(b,c){return b=_.clone(b),b.Id=f.createNewQuestionId(),b.GroupId=a.Id,b.Order=a.Order+(c+1)*f.QuestionOrderDefaultStep,b}));var g=[a];g=g.concat(d);var h=Nerve.Collection.addItems(this.Model.Questions,g);return c.getQuestionMaster(h[0])},f.prototype.duplicateElement=function(a){var b=a.getSnapshotWithoutBranchInfo();delete b.Id;var c=a.SubQuestionMasters.map(function(a){var b=a.getSnapshotWithoutBranchInfo();return delete b.Id,delete b.GroupId,delete b.QuestionInfo,b});return this.insertElementAfter(b,a,c)},f.prototype.duplicateForm=function(a,b){var c=this;return this.ensureFieldsReady(f.FieldsToCopy).then(function(){var d=_.clone(c.getSnapshotToCopy());return d.OwnerId=a.OwnerId,d.OwnerTenantId=a.OwnerTenantId,d.Title=b,d.Settings=_.clone(d.Settings),d.Settings.AllowCopy=!1,d.Settings.ShareToken=null,e(d,a.IsGroupForm)})},f.prototype.ensureCreationDone=function(){var a=this,b=this.getImageMaster(f.Schema.Background),c=this.getImageMaster(f.Schema.Logo);return $.when.apply($,[b.Synchronizer.flush(),c.Synchronizer.flush().then(function(){return a.Synchronizer.flush()})].concat(this.QuestionMasters.map(function(a){return a.ensureCreationDone()})))},f.prototype.ensureReadyToDesign=function(){return this.ensureFieldsReady(f.FieldsToDesign)},f.prototype.ensureReadyToResponse=function(){return this.ensureFieldsReady(f.FieldsToResponse)},f.prototype.ensureReadyToShare=function(){var a=f.Schema;return this.ensureFieldsReady([a.Title,a.ModifiedDate,a.OwnerId,a.OwnerTenantId,a.Description,a.Questions,a.Settings,a.Theme,a.Logo,a.LogoInfo,a.Background,a.XlWorkbookId,a.Category])},f.prototype.ensureReadyForMruCard=function(){var a=f.Schema;return this.ensureFieldsReady([a.Title,a.ModifiedDate,a.Settings,a.XlWorkbookId,a.OwnerId,a.OwnerTenantId,a.Category,a.OtherInfo,a.Theme,a.RowCount])},f.prototype.getDefaultResponse=function(){var b={};return a.Utilities.Flight.isDarkFunctionalitiesEnabled()&&_.forEach(this.Model.Questions,function(a){return b[a.Id]=a.DefaultValue}),b},f.prototype.insertElementAfter=function(a,b,d){a=_.clone(a);var e=[];d&&(e=d.map(_.clone));var g=this.Model.Questions,h=f.QuestionOrderFloor,i=h+f.QuestionOrderDefaultStep;if(b){b.SubQuestionMasters.length>0&&(b=b.SubQuestionMasters[b.SubQuestionMasters.length-1]);var j=_.indexOf(g,b.Model);j!==g.length-1?(h=b.Model.Order,i=g[j+1].Order):(h=b.Model.Order,i=b.Model.Order+f.QuestionOrderDefaultStep)}else g.length>0&&(i=g[0].Order);this.updateQuestionOrder(a,e,h,i),a.Id||(a.Id=f.createNewQuestionId(),e.forEach(function(b){b.Id=f.createNewQuestionId(),b.GroupId=a.Id}));var k=[a];k=k.concat(e);var l=Nerve.Collection.addItems(this.Model.Questions,k);return c.getQuestionMaster(l[0])},f.prototype.moveElementDown=function(a){var b=this,c=_.indexOf(this.TopQuestionMasters,a);if(c!==this.TopQuestionMasters.length-1){var d=this.TopQuestionMasters[c+1],e=d.SubQuestionMasters.length>0?d.SubQuestionMasters[d.SubQuestionMasters.length-1].Model.Order:d.Model.Order,g=e+f.QuestionOrderDefaultStep;c+1<this.TopQuestionMasters.length-1&&(g=this.TopQuestionMasters[c+2].Model.Order);var h=a.SubQuestionMasters.map(function(a){return a.Model});this.bulkEdit(function(){return b.updateQuestionOrder(a.Model,h,e,g)})}},f.prototype.moveElementUp=function(a){var b=this,c=_.indexOf(this.TopQuestionMasters,a);if(!(0>=c)){var d=f.QuestionOrderFloor,e=this.TopQuestionMasters[c-1],g=_.indexOf(this.QuestionMasters,e);g>0&&(d=this.QuestionMasters[g-1].Model.Order);var h=this.TopQuestionMasters[c-1].Model.Order,i=a.SubQuestionMasters.map(function(a){return a.Model});this.bulkEdit(function(){return b.updateQuestionOrder(a.Model,i,d,h)})}},f.prototype.moveToRecycleBin=function(){var a=this;return this.bulkEdit(function(){a.Model.MovingToRecycleBin=!0,a.Model.SoftDeleted=c.FormDeletedState.SoftDeleted}),this.Synchronizer.flush().done(function(){a.Model.MovingToRecycleBin=!1})},f.prototype.reachedQuestionNumberLimitation=function(){return this.QuestionMasters.length>=b.FormLimitation.QuestionNumber},f.prototype.syncFormResponses=function(){var b=this;return this.responsesQueryJob&&this.responsesQueryJob.state()===a.Utilities.Promise.State.Pending?this.responsesQueryJob:(this.responsesQueryJob=this.Synchronizer.existingInDataSource().then(function(){var a=[f.Schema.Questions];a.push(f.Schema.Settings);var d=b.ensureFieldsReady(a);return $.when(c.ResponseDataSource.getResponses(b),d).then(function(a){b.updatingResponsesFromServer=!0,b.bulkEdit(function(){b.Model.Responses=b.normalizeResponses(a),b.Synchronizer.onSourceDataReceived({rowCount:a.length})}),b.updatingResponsesFromServer=!1})}),this.responsesQueryJob)},f.prototype.syncFormResponsesByPaging=function(a,b){var c=this;return this.getFormResponsesByPaging(a,b).then(function(a){c.updatingResponsesFromServer=!0,c.Model.BufferResponses=a,c.updatingResponsesFromServer=!1})},f.prototype.getFormResponsesByPaging=function(a,b){var d=this,e=[f.Schema.Questions];e.push(f.Schema.Settings);var g=this.ensureFieldsReady(e),h=this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.getResponses(d,a,b)});return $.when(h,g).then(function(a){return d.normalizeResponses(a)})},f.prototype.syncAnalysisTimeResponsesByPaging=function(a,b){var c=this;return this.getAnalysisTimeResponsesByPaging(a,b).then(function(a){c.updatingResponsesFromServer=!0,c.Model.BufferResponses=a,c.updatingResponsesFromServer=!1})},f.prototype.getAnalysisTimeResponsesByPaging=function(a,c){var d=this;return b.Model.FormDataSource.getDataProviderByFormMaster(this).getAnalysisTimeResponses(this.Model.Id,a,c).then(function(a){return d.normalizeResponses(a.map(b.Model.ResponseDataSource.toClientPayload))})},f.prototype.syncRuntimeResponses=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.getRuntimeResponses(a)}).then(function(b){a.updatingResponsesFromServer=!0,a.bulkEdit(function(){return a.Model.Responses=a.normalizeResponses(b)}),a.updatingResponsesFromServer=!1})},f.prototype.getFormResponsesCountByAPICall=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){return c.FormDataSource.getResponseCount(a)}).then(function(b){a.Model.ResponsesCount=b})},f.prototype.refreshFormResponsesCount=function(){return this.Synchronizer.query([f.Schema.ResponsesCount])},f.prototype.submitResponse=function(b){var d=this,e=0,f=0;return b=_.clone(b),b.Answers=_.map(b.Answers,function(a){var b=d.getQuestionById(a.QuestionId);return b&&b.Model&&(a=_.clone(a),a.Answer=b.serializeAnswer(a.Answer),b.Model.Type===c.QuestionType.TextField&&(e++,a.Answer&&(f+=a.Answer.length))),a}),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.TextQuestionInfoOfSubmit,extraData:{textQuestionCount:e,textQuestionAnswerTotalLength:f,isQuiz:this.SettingMaster.Model.IsQuizMode}}),this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.submitResponse(d,b)})},f.prototype.deleteAllResponses=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.deleteAllResponses(a)}).then(function(){var b={};b.Responses=[],b.ResponsesCount=0,a.updatingResponsesFromServer=!0,a.setData(b),a.updatingResponsesFromServer=!1})},f.prototype.deleteBufferResponse=function(a){var b=this;return this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.deleteResponses(b.Model.Id,[a])}).then(function(){var c=Nerve.getCollectionMasterFromModel(b.Model.BufferResponses),d=c.getItemWithKeyFields({Id:a});d&&b.bulkEdit(function(){c.itemsDeletedInSource([d]),--b.Model.ResponsesCount})})},f.prototype.setResponseComment=function(a,b){var c=this.ensureResponseMasterById(a);c.Model.Feedback=b},f.prototype.setAnswerGrading=function(a,b,c,d){var e=this.ensureResponseMasterById(a);e.setAnswerGrading(b,c,d)},f.prototype.setReleaseDate=function(a,b){var c=this.ensureResponseMasterById(a);c.Model.ReleaseDate=b},f.prototype.resetBranchInfo=function(){this.QuestionMasters.forEach(function(a){return a.resetBranchInfo()})},f.prototype.startReceivingNotifications=function(a){var b=this,c=f.Schema,d=[c.Id,c.OwnerId,c.OwnerTenantId,c.TableId];return this.ensureFieldsReady(d).done(function(){a&&b.coAuthUserStateChangeCallbacks.register(a),b.receivingNotifications||(b.receivingNotifications=!0,b.startReceivingNotificationsInternal())})},f.prototype.stopReceivingNotifications=function(b){var c=this;this.existingOnServerSide().done(function(){var d=a.DataProvider.ProviderManager.getInstance().CurrentNotificationProvider;d.close(c.Model.Id),c.receivingNotifications=!1,c.coAuthUserStateChangeCallbacks.clear(),c.responsesQueryJob=null,b()})},f.prototype.formOwnedByMe=function(){return this.Model.OwnerId&&this.Model.OwnerId===OfficeFormServerInfo.userInfo.UserId},f.prototype.appendPermission=function(a){for(var b=this.Model.Permissions,d=function(d){if(b[d].Type===c.PermissionType.OrgLink||b[d].Type===c.PermissionType.Link){var e=b[d],f=c.getPermissionMaster(e),g=f.Model.Type;return f.Model.Type=a,{value:f.Synchronizer.flush().then(function(){return e.PrincipalId}).fail(function(){return f.Model.Type=g})}}},e=0;e<b.length;e++){var f=d(e);if("object"==typeof f)return f.value}var g=Nerve.Collection.addItems(b,[c.createDefaultPermission(a)]),h=c.getPermissionMaster(g[0]);return h.Synchronizer.existingInDataSource().then(function(){return h.Model.PrincipalId})},f.prototype.removeLinkPermission=function(){var a=this.getLinkPermissions();Nerve.Collection.deleteItems(this.Model.Permissions,a);var b=a.map(c.getPermissionMaster).map(function(a){return a.Synchronizer.deletedFromDataSource()});return $.when.apply($,b)},f.prototype.getPermissionToken=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){var b=a.getLinkPermissions().map(c.getPermissionMaster);return 0!==b.length?b[0].Synchronizer.existingInDataSource().then(function(){return b[0].Model.PrincipalId}):null})},f.prototype.getSnapshotToCopy=function(){var a=this.getSnapshot(f.FieldsToCopy);return a.XlWorkbookId&&(a=_.clone(a),a.XlWorkbookId="WaitingForExport"),a},f.prototype.SetToExporting=function(){var a=this;this.ensureFieldsReady([c.FormMaster.Schema.XlExportingLocalTag]).done(function(){a.Model.XlExportingLocalTag=f.ExportingProcessingStatusString})},f.prototype.IsExporting=function(){var a,b=this,d=0;if(this.isFieldReady(c.FormMaster.Schema.XlExportingLocalTag)&&this.Model.XlExportingLocalTag&&this.Model.XlExportingLocalTag.indexOf(f.ExportingProcessingStatusString)>=0)try{var e=JSON.parse(this.Model.XlExportingLocalTag),g=Date.parse(e.starttime.toUpperCase()),h=new Date;d=h.getTime()-g,a=d<f.ReexportToExcelMaxTimeForTimeout}catch(i){a=!0}else a=!1;return a?this.exportingTimeout=this.exportingTimeout||window.setTimeout(function(){b.Model.XlExportingLocalTag=f.ExportingTimeoutStatusString},f.ReexportToExcelMaxTimeForTimeout-d):window.clearTimeout(this.exportingTimeout),a},f.prototype.IsExportingFailed=function(){return this.Model.XlExportingLocalTag.toLocaleLowerCase().indexOf(f.ExportingFailedStatusString)>=0?!0:!1},Object.defineProperty(f,"FieldsForCreatingForm",{get:function(){return f.FieldsToCopy.concat([f.Schema.OwnerId,f.Schema.OwnerTenantId])},enumerable:!0,configurable:!0}),Object.defineProperty(f,"FieldsToCopy",{get:function(){var a=f.Schema,b=[a.Background,a.Description,a.Logo,a.LogoInfo,a.Questions,a.Settings,a.SoftDeleted,a.Title,a.TertiaryCustomizedThemeColor,a.Theme,a.TrackingId,a.XlWorkbookId,a.ThankYouMessage];return b},enumerable:!0,configurable:!0}),Object.defineProperty(f,"FieldsToDesign",{get:function(){var a=f.Schema;return[a.Title,a.ModifiedDate,a.OwnerId,a.OwnerTenantId,a.Description,a.Questions,a.Permissions,a.PermissionTokens,a.ResponsesCount,a.Settings,a.Theme,a.Logo,a.LogoInfo,a.Background,a.XlWorkbookId,a.XlExportingTag,a.XlFileUnsynced,a.Category,a.TrackingId,a.PredefinedResponses,a.PrivacyUrl,a.ThankYouMessage]},enumerable:!0,configurable:!0}),Object.defineProperty(f,"FieldsToResponse",{get:function(){var a=f.Schema;return[a.Title,a.ModifiedDate,a.Description,a.Settings,a.Theme,a.Questions,a.Logo,a.LogoInfo,a.Background,a.Category,a.PredefinedResponses,a.PrivacyUrl,a.ThankYouMessage]},enumerable:!0,configurable:!0}),Object.defineProperty(f,"OtherInfoFieldSet",{get:function(){return f.otherInfoFieldSet||(f.otherInfoFieldSet=new c.FieldSet([f.Schema.PrimaryCustomizedThemeColor,f.Schema.SecondaryCustomizedThemeColor,f.Schema.TertiaryCustomizedThemeColor,f.Schema.Theme,f.Schema.LogoInfo,f.Schema.CreatedFromOneDrive])),f.otherInfoFieldSet},enumerable:!0,configurable:!0}),Object.defineProperty(f,"Rules",{get:function(){if(!f.rules){var a=f.Schema,d=Nerve.getSubFieldSchemas(a).filter(function(a){return!Nerve.getFieldSchemaInfo(a).Attributes.IsLocalField});f.rules=[{Name:"IntegrateSavingState",InterestedFields:[a.Background.SavingState,a.Logo.SavingState,a.SavingState],onChange:function(a){return a.Master.updateIntegratedSavingState()}},{Name:"Modified",InterestedFields:d,onChange:function(b){if(!b.BeingDeleted&&!_.contains(b.FieldSchemas,a.Modified)){var c=b.Master;if(_.contains(b.FieldSchemas,a.ModifiedDate))return void(c.Model.Modified=c.Model.ModifiedDate);if(c.isFieldReady(a.Modified)){var e=_.intersection(b.FieldSchemas,d).map(Nerve.getFieldSchemaInfo).map(function(a){return a.Name}).some(function(a){return a in b.OldValues});e&&(c.Model.Modified=(new Date).toISOString())}}}},{Name:"RowCount",InterestedFields:[a.RowCount],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model;b.ResponsesCount=b.RowCount}}},{Name:"CollaboratedQuestionProperties",InterestedFields:[a.Questions],onChange:function(a){var c=b.convertToArray(a.Master.getSnapshot().Questions),d=a.Master.Model;d.HasValidBranching=c.some(function(a){return a.HasValidBranching}),d.HasQuestionMedia=c.some(function(a){return!(!a.ImageInfo.ResourceUrl&&!a.VideoInfo.Url)}),d.QuizQuestionsCount=c.filter(function(a){return a.IsQuiz}).length}},{Name:"DeserializeSettings",InterestedFields:[a.SerializedSettings],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model.SerializedSettings||"{}",c=JSON.parse(b);a.Master.setData({Settings:c})}}},{Name:"SerializeSettings",InterestedFields:[f.Schema.Settings],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model;b.SerializedSettings=c.FormSettingsMaster.serialize(b.Settings)}}},{Name:"DeserializePredefinedResponses",InterestedFields:[a.SerializedPredefinedResponses],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model.SerializedPredefinedResponses||"[]",c=JSON.parse(b);a.Master.setData({PredefinedResponses:c})}}},{Name:"SerializePredefinedResponses",InterestedFields:[f.Schema.PredefinedResponses],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model;b.SerializedPredefinedResponses=f.serializePredefinedReponses(b.PredefinedResponses)}}},{Name:"DeleteResponseModels",InterestedFields:[a.Responses],onChange:function(a){var b=a.Master,d=b.Model.Responses,e=[],f=[];a.SubChanges.filter(function(a){return a.Master.Model===d}).forEach(function(a){return a.RemovedModels.forEach(function(a){var c=b.getResponseModelById(a.Id);c?e.push(c):f.push(a.Id)})});var g=Nerve.getCollectionMasterFromModel(b.Model.ResponseModels);b.updatingResponsesFromServer?g.itemsDeletedInSource(e):(g.deleteItems(e),c.deleteResponses(b,f))}},{Name:"ResponsesCount",InterestedFields:[a.ResponsesCount],onChange:function(b){var c=b.Master;c.isFieldReady(a.ResponsesCount)&&-1===c.Model.ResponsesCount&&(c.Model.ResponsesCount=null)}},{Name:"ResponseModel Change",InterestedFields:[a.ResponseModels],onChange:function(a){var b=a.Master,c=Nerve.getCollectionMasterFromModel(b.Model.ResponseModels),d=Nerve.getCollectionMasterFromModel(b.Model.Responses);a.SubChanges.filter(function(a){return a.Master===c}).forEach(function(a){a.SubChanges.forEach(function(a){var b=_.indexOf(d.Model,a.Master.Model);b>=0&&d.markAsChanged(b)})})}}]}return f.rules},enumerable:!0,configurable:!0}),f.questionComparer=function(a,b){var c=a.Order-b.Order;return a.Order&&b.Order||(c=-c),c||a.Id.localeCompare(b.Id)},f.createNewQuestionId=function(){var b=a.Utilities.Guid.newGuid();return"r"+b.replace(/-/g,"")},f.normalizeInitialData=function(a){var b;return a.InitialData&&((a.InitialData.SerializedSettings||a.InitialData.Settings)&&(b=b||{},a.InitialData.SerializedSettings?b.Settings=JSON.parse(a.InitialData.SerializedSettings):b.SerializedSettings=c.FormSettingsMaster.serialize(a.InitialData.Settings)),(a.InitialData.SerializedPredefinedResponses||a.InitialData.PredefinedResponses)&&(b=b||{},a.InitialData.SerializedPredefinedResponses?b.PredefinedResponses=JSON.parse(a.InitialData.SerializedPredefinedResponses):b.SerializedPredefinedResponses=f.serializePredefinedReponses(a.InitialData.PredefinedResponses))),b&&(a=_.clone(a),a.InitialData=_.extend({},a.InitialData,b)),a},f.serializePredefinedReponses=function(a){return a&&a.length>0?JSON.stringify(a):null},f.prototype.initializeQuestionOrderRule=function(){var a=this;this.adjustQuestionOrders(),this.addRule({Name:"QuestionOrder",InterestedFields:[f.Schema.Questions],onChange:function(){return a.adjustQuestionOrders()}})},f.prototype.initializeSavingStateIntegration=function(){var a=this;c.keepSavingStateUpdated(this),this.questionsSavingState=c.SavingState.Idle,this.responsesSavingState=c.SavingState.Idle,this.fieldsReady([f.Schema.Questions]).done(function(){var b=Nerve.getCollectionMasterFromModel(a.Model.Questions);c.observeIntegratedSavingState(b,b.Schema[0].IntegratedSavingState,function(b){a.questionsSavingState=b,a.updateIntegratedSavingState()})});var b=Nerve.getCollectionMasterFromModel(this.Model.ResponseModels);c.observeIntegratedSavingState(b,b.Schema[0].IntegratedSavingState,function(b){a.responsesSavingState=b,a.updateIntegratedSavingState()}),this.updateIntegratedSavingState()},f.prototype.initializeModifiedDate=function(a){a.ExistingInDataSource?this.isFieldReady(f.Schema.ModifiedDate)&&(this.Model.Modified=this.Model.ModifiedDate):this.Model.Modified=(new Date).toISOString()},f.prototype.initializeResponseCount=function(){this.isFieldReady(f.Schema.RowCount)&&(this.Model.ResponsesCount=this.Model.RowCount)},f.prototype.updateIntegratedSavingState=function(){var a=[this.Model.SavingState,this.questionsSavingState,this.responsesSavingState],b=f.Schema;this.isFieldReady(b.Logo)&&a.push(this.Model.Logo.SavingState),this.isFieldReady(b.Background)&&a.push(this.Model.Background.SavingState),this.Model.IntegratedSavingState=c.integrateSavingState(a)},f.prototype.initializeOtherInfoBinder=function(a){this.otherInfoBinder=new c.FieldBinder(this,f.Schema.OtherInfo,f.OtherInfoFieldSet),a.InitialData&&this.isFieldReady(f.Schema.OtherInfo)&&(a.ExistingInDataSource||a.InitialData.OtherInfo?this.otherInfoBinder.deserialize():this.otherInfoBinder.serialize())},f.prototype.adjustQuestionOrders=function(){var a=this;if(this.isFieldReady(f.Schema.Questions)){var c=b.convertToArray(this.Model.Questions);c.length&&this.bulkEdit(function(){c.sort(f.questionComparer),c[0].Order||(c[0].Order=f.QuestionOrderFloor+f.QuestionOrderDefaultStep);for(var b=0,d=c[0].Order,e=1;e<=c.length;++e){var g=c[e]&&c[e].Order;
if(!g)break;if(d!==g){var h=(g-d)/(e-b);for(d+=h;++b<e;)c[b].Order=d,d+=h}}for(;++b<c.length;)d+=f.QuestionOrderDefaultStep,c[b].Order=d;a.Model.Questions=c})}},f.prototype.updateCoAuthors=function(b,c){if(a.UserRepository.isValidUser(c)){var d=this.getQuestionById(b);if(d){var e=_.filter(d.Model.CoAuthors,function(a){return c.userId===a.userId})[0],g=function(){e&&h.deleteItems([e]),c.userId in f.coAuthorTimers&&(clearTimeout(f.coAuthorTimers[c.userId]),delete f.coAuthorTimers[c.userId])},h=Nerve.getCollectionMasterFromModel(d.Model.CoAuthors);h.bulkEdit(function(){g(),e=Nerve.Collection.addItems(d.Model.CoAuthors,[c])[0]}),f.coAuthorTimers[c.userId]=setTimeout(g,1e4)}}},f.prototype.startReceivingNotificationsInternal=function(){var b,d=this,e=function(a,b){return d.coAuthUserStateChangeCallbacks.trigger(a,b)},g=a.DataProvider.ProviderManager.getInstance().CurrentNotificationProvider,h=this.Model,i=$.Deferred().resolve().promise(),j=0,k=function(a){i.done(function(){a===j&&(i=d.refreshFormResponsesCount())})},l=function(){d.Synchronizer.query(f.FieldsToDesign)};b=a.EnvironmentConfig.isProduction()?function(a){}:function(a){h.CoAuthMessage=a};var m={onConnectionStarted:function(a){k(++j),e(a||[],n.ConnectionStateChanged),b("Connection established")},onConnectionFailed:function(a){b("Connection failed to be established")},onConnectionSlow:function(){b("Connection is slow")},onConnectionError:function(a){b("Connection has error")},onConnectionReconnecting:function(){b("Connection reestablishing")},onConnectionReconnected:function(a){k(++j),e(a||[],n.ConnectionStateChanged),l(),b("Connection reestablished")},onConnectionDisconnected:function(){b("Connection disconnected")},onQuestionAdded:function(f,g){var h=d.getQuestionById(f.id);f.choices||(f.choices=[]),h?h.Synchronizer.onSourceDataReceived(f):d.currentQuestionListDownloadJob=a.Utilities.Promise.always(d.currentQuestionListDownloadJob.then(function(){Nerve.Collection.itemsAddedInSource(d.Model.Questions,[Nerve.convertFromSourceData(f,c.QuestionMaster.Schema)])})),d.updateCoAuthors(f.id,g),e([g],n.UserAction),b("Question added")},onQuestionDeleted:function(c,f){d.currentQuestionListDownloadJob=a.Utilities.Promise.always(d.currentQuestionListDownloadJob.then(function(){var a=d.getQuestionById(c);if(a){var b=a.SubQuestionMasters.concat(a);Nerve.Collection.itemsDeletedInSource(d.Model.Questions,b.map(function(a){return a.Model}))}})),e([f],n.UserAction),b("Question deleted")},onQuestionUpdated:function(a,c,f){var g=d.getQuestionById(a);g&&(g.Synchronizer.onSourceDataReceived(c),d.updateCoAuthors(a,f),e([f],n.UserAction),b("Question updated"))},onChoiceAdded:function(a,f,g){var h=d.getQuestionById(a);if(h){var i=_.map(h.Model.ChoiceGroup,function(a){var b=Nerve.getObjectMasterFromModel(a);return b.Synchronizer.existingInDataSource()});$.when.apply($,i).then(function(){var i=h.getChoiceByKey(f.key);i||(Nerve.Collection.itemsAddedInSource(h.Model.ChoiceGroup,[Nerve.convertFromSourceData(f,c.ChoiceV2Master.Schema)]),d.updateCoAuthors(a,g),e([g],n.UserAction),b("Choice added"))})}},onChoiceDeleted:function(a,c,f){var g=d.getQuestionById(a);if(g){var h=g.getChoiceById(c);h&&(h.Synchronizer.onDeletedInDataSource(),e([f],n.UserAction),b("Question deleted"))}},onChoiceUpdated:function(a,c,f,g){var h=d.getQuestionById(a);if(h){var i=h.getChoiceById(c);i&&(i.Synchronizer.onSourceDataReceived(f),d.updateCoAuthors(a,g),e([g],n.UserAction),b("Choice updated"))}},onUserConnected:function(a){e([a],n.UserConnect),b("New user connected")},onUserDisconnected:function(a){e([a],n.UserDisconnect),b("Existing user disconnected")},onFormUpdated:function(a,c){var f=_.map(d.Model.PermissionTokens,function(a){var b=Nerve.getObjectMasterFromModel(a);return b.Synchronizer.existingInDataSource()});$.when.apply($,f).then(function(){d.Synchronizer.onSourceDataReceived(a),e([c],n.UserAction),b("Form updated")})},onResponseAdded:function(a){d.bulkEdit(function(){k(++j),b("Response added")})},onResponseDeleted:function(a){d.bulkEdit(function(){k(++j),b("Response deleted")})},onResponsesAllDeleted:function(){d.bulkEdit(function(){k(++j),b("All responses deleted")})}},o=a.Utilities.FormId.decodeFormId(h.Id),p={OwnerTenantId:h.OwnerTenantId,OwnerId:h.OwnerId,TableId:h.TableId,IsGroupTable:o.IsGroupOwner};g.open(h.Id,m,p).done(function(){return l()})},f.prototype.ensureResponseMasterById=function(a){var b=this,d=this.getResponseModelById(a);if(!d){var e=this.Model.Responses,f=_.findIndex(e,function(b){return b.Id===a});0>f&&Nerve.Debugger.throwError("no such response"),this.bulkEdit(function(){d=Nerve.Collection.itemsAddedInSource(b.Model.ResponseModels,[e[f]])[0],e[f]=d})}return c.getResponseMaster(d)},f.prototype.getLinkPermissions=function(){return _.filter(this.Model.Permissions,function(a){return a.Type===c.PermissionType.Link||a.Type===c.PermissionType.OrgLink})},f.prototype.getResponseModelById=function(a){return Nerve.Collection.getItemWithKeyFields(this.Model.ResponseModels,{Id:a})},f.prototype.normalizeResponses=function(a){var b=this,d=this.Model.Settings.IsQuizMode&&this.SyncContext!==j.ResponseTimeForm,e={};return this.QuestionMasters.forEach(function(a){return e[a.Model.Id]=a}),this.bulkEdit(function(){a=a.map(function(a){a=_.clone(a),a.Answers=_.map(a.Answers,function(a){var b=e[a.QuestionId];return b&&(a=_.clone(a),a.Answer=b.deserializeAnswer(a.Answer),null==a.Score&&d&&b.autoGradeAnswer(a)),a});var f=b.getResponseModelById(a.Id);return f&&(c.getResponseMaster(f).updateWithNormalizedResponse(a),a=f),a})}),a},f.prototype.updateQuestionOrder=function(a,b,c,d){var e=(d-c)/(b.length+2);a.Order=c+e,b.forEach(function(b,c){b.Order=a.Order+e*(c+1)})},f.coAuthorTimers={},f}(Nerve.createObjectMasterClass("FormMaster",m,p));c.FormMaster=q}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=Nerve.Spec,d={QuestionRuntimeMasters:c.collectionOf(c.reference()),UploadingFileCount:c.number()},e=function(c){function d(d,e){var f=c.call(this)||this;return f.questionRuntimeMasters={},f.answerChangeNotifier=new a.Utilities.Process.CallbackManager,f.questionAnswerChangeCallback=function(){return f.answerChangeNotifier.trigger()},f.onQuestionListChangeCallback=function(a){return f.updateQuestionList(a)},f.updateQuestionListCallback=function(){return f.updateQuestionList()},f.branchingChangeCallback=function(){return f.calculation.callOnceLater()},f.calculation=new a.Utilities.Process.CallLater(function(){return f.calculateQuestionRuntimeList()}),f.formMaster=d,f.disableShuffle=e,f.updateQuestionList(),f.calculation.callImmediately(),f.Model.UploadingFileCount=0,Nerve.getCollectionMasterFromModel(d.Model.Questions).observe(f.onQuestionListChangeCallback),d.observe(f.updateQuestionListCallback,[b.FormMaster.Schema.HasValidBranching,b.FormMaster.Schema.Settings.ShuffleQuestionOrder]),f}return __extends(d,c),Object.defineProperty(d.prototype,"Form",{get:function(){return this.formMaster},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"Answers",{get:function(){return Nerve.convertToArray(this.Model.QuestionRuntimeMasters).filter(function(a){return 0==a.SubQuestionRuntimeMasters.length}).map(function(a){return a.getAnswerEntity()})},set:function(a){var b=this,c={};_.forEach(a,function(a){return c[a.QuestionId]=a.Answer}),this.bulkEdit(function(){b.formMaster.QuestionMasters.map(function(a){return b.getOrCreateQuestionRuntime(a)}).forEach(function(a){a.Model.Answer=c[a.Question.Model.Id]})}),this.calculation.flush()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"TopQuestionRuntimeMasters",{get:function(){return Nerve.convertToArray(this.Model.QuestionRuntimeMasters).filter(function(a){return!a.Question.Model.GroupId})},enumerable:!0,configurable:!0}),d.prototype.isDefaultAnswer=function(){var a=this.formMaster.getDefaultResponse();return Nerve.convertToArray(this.Model.QuestionRuntimeMasters).every(function(b){var c=b.Question.Model.Id;return a[c]===b.Model.Answer})},d.prototype.updateWithResponse=function(a){var b=this,c={};a&&a.Answers&&_.forEach(a.Answers,function(a){return c[a.QuestionId]=a}),this.bulkEdit(function(){b.formMaster.QuestionMasters.map(function(a){return b.getOrCreateQuestionRuntime(a)}).forEach(function(a){var b=a.Question.Model.Id,d=c[b];a.bulkEdit(function(){a.Model.Answer=d&&d.Answer,a.Model.AnswerEntity=d})})}),this.updateQuestionList()},d.prototype.setQuizResults=function(a){var b=this;a.forEach(function(a){var c=b.questionRuntimeMasters[a.id];c&&(c.Model.QuizResult={IsAnswerCorrect:a.isAnswerCorrect,AnswerHints:a.answerHints,IsAnswerKeys:a.answerKeys,Choices:_.map(c.Question.Model.Choices,function(a){return a.Description}),GradingBasis:a.gradingBasis})})},d.prototype.clearQuizResult=function(){for(var a in this.questionRuntimeMasters)this.questionRuntimeMasters[a].Model.QuizResult=void 0},d.prototype.calculateQuizResultFromModel=function(){Nerve.convertToArray(this.Model.QuestionRuntimeMasters).forEach(function(a){return a.calculateQuizResultFromModel()})},d.prototype.getQuestionCountWithWrongAnswer=function(){return Nerve.convertToArray(this.Model.QuestionRuntimeMasters).filter(function(a){return!a.Question.Model.GroupId&&!a.verifyAnswer()}).length},d.prototype.getOrCreateQuestionRuntimeById=function(a){var b=this.formMaster.getQuestionById(a);return b&&this.getOrCreateQuestionRuntime(b)},d.prototype.observeAnswerChange=function(a){this.answerChangeNotifier.register(a)},d.prototype.unobserveAnswerChange=function(a){this.answerChangeNotifier.unregister(a)},d.prototype.release=function(){for(var a in this.questionRuntimeMasters){var b=this.questionRuntimeMasters[a];b.unobserve(this.branchingChangeCallback),b.unobserve(this.questionAnswerChangeCallback),b.release()}Nerve.getCollectionMasterFromModel(this.formMaster.Model.Questions).unobserve(this.onQuestionListChangeCallback),this.formMaster.unobserve(this.updateQuestionListCallback),this.clearOD4BTempFolder()},d.prototype.createOD4BTempFolder=function(){return this.od4bTempFolder||(this.od4bTempFolder=a.DataProvider.createDataProvider().createOD4BSessionTempFolder(this.formMaster.Model.Id)),this.od4bTempFolder},d.prototype.clearOD4BTempFolder=function(){this.od4bTempFolder=null},d.prototype.getOrCreateQuestionRuntime=function(a){var b=a.Model.Id;this.questionRuntimeMasters[b];return this.questionRuntimeMasters[b]||(this.questionRuntimeMasters[b]=this.createQuestionRuntimeMaster(a)),this.questionRuntimeMasters[b]},d.prototype.createQuestionRuntimeMaster=function(a){var c=new b.QuestionRuntimeMaster(a,this);return c.observe(this.branchingChangeCallback,[b.QuestionRuntimeMaster.Schema.BranchedQuestion]),c.observe(this.questionAnswerChangeCallback,[b.QuestionRuntimeMaster.Schema.Answer]),c},d.prototype.updateQuestionList=function(b){var c=this,d=this.formMaster.Model.Settings;if(this.questionMasters=this.formMaster.TopQuestionMasters,!this.disableShuffle&&!this.formMaster.Model.HasValidBranching&&d.ShuffleQuestionOrder)if(d.ShuffleAllQuestions||null==d.ShuffleAllQuestions)this.questionMasters=_.shuffle(this.questionMasters);else if(a.Utilities.NumberValidation.isInteger(d.LockGivenQuestionsStartDisplayOrder)&&a.Utilities.NumberValidation.isInteger(d.LockGivenQuestionsEndDisplayOrder)){var e=d.LockGivenQuestionsStartDisplayOrder-1,f=d.LockGivenQuestionsEndDisplayOrder-1,g=this.questionMasters.splice(e,f-e+1);this.questionMasters=_.shuffle(this.questionMasters),(h=this.questionMasters).splice.apply(h,[e,0].concat(g))}this.questionMasters.forEach(function(a,b){var d=c.getOrCreateQuestionRuntime(a).Model;d.NextQuestionInOrder=c.questionMasters[b+1],a.SubQuestionMasters.forEach(function(a){return c.getOrCreateQuestionRuntime(a)})}),b&&(b.AddedModels.length||b.RemovedModels.length)&&this.calculation.callOnceLater();var h},d.prototype.calculateQuestionRuntimeList=function(){for(var a,b=this,c=[],d=this.questionMasters[0];d&&(a=this.getOrCreateQuestionRuntime(d),!_.include(c,a));d=a.Model.BranchedQuestion)c.push(a),d.SubQuestionMasters.forEach(function(a){var d=b.getOrCreateQuestionRuntime(a);c.push(d)});this.Model.QuestionRuntimeMasters=c},d}(Nerve.createObjectMasterClass("FormRuntime",d));b.FormRuntimeMaster=e}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c,d=Nerve.Spec,e={LockGivenQuestionsEndDisplayOrder:d.number(),LockGivenQuestionsStartDisplayOrder:d.number(),FormClosed:d["boolean"](),FormClosedMessage:d.string(),FormClosedMessageChanged:d["boolean"](),TimerEnabled:d["boolean"](),TimerEnabledStart:d["boolean"](),TimerEnabledEnd:d["boolean"](),StartTime:d.string(),EndTime:d.string(),RequiresUniqueResponse:d["boolean"](),IsAnonymous:d["boolean"](),NotRecordIdentity:d["boolean"](),ShuffleAllQuestions:d["boolean"](),ShuffleQuestionOrder:d["boolean"](),ShowGradedResults:d["boolean"](),ShowGradedScores:d["boolean"](),RespondInAppOnly:d["boolean"](),AllowCopy:d["boolean"](),ShareToken:d.string(),ManualGradingEnabled:d["boolean"](),IsQuizMode:d["boolean"](),EmailNotification:d["boolean"](),AllowResponderGetAllResponses:d["boolean"]()};!function(a){a[a.NotStarted=0]="NotStarted",a[a.Opened=1]="Opened",a[a.Expired=2]="Expired",a[a.Closed=3]="Closed"}(c=b.FormStatusType||(b.FormStatusType={}));var f=function(d){function e(a){var b=d.call(this,a)||this;return b.addRule({Name:"updateClosedMessage",InterestedFields:[b.Schema.FormClosed],onChange:e.updateClosedMessage}),b.addRule({Name:"updateAllowCopy",InterestedFields:[b.Schema.ShareToken],onChange:e.updateAllowCopy}),b}return __extends(e,d),e.serialize=function(a){var b=Nerve.convertToSourceData(a,this.Schema),c=0;return Object.keys(b).forEach(function(a){null==b[a]?delete b[a]:++c}),c>0?JSON.stringify(b):null},e.prototype.isAcceptingResponse=function(){return null==this.getFormClosedMessage()},e.prototype.getFormStatus=function(){var a=this.Model;if(a.FormClosed)return c.Closed;if(a.TimerEnabled){var b=Date.now();if(null!=a.StartTime&&Date.parse(a.StartTime)>b)return c.NotStarted;if(null!=a.EndTime&&Date.parse(a.EndTime)<b)return c.Expired}return c.Opened},e.prototype.getFormClosedMessage=function(){var b=this.Model,d=this.getFormStatus();switch(d){case c.Closed:return b.FormClosedMessage;case c.NotStarted:return a.Resources.LocalizedStrings.FormSetting_NotStartForm_DefaultMessage.format(new Date(b.StartTime).toLocaleString());case c.Expired:return a.Resources.LocalizedStrings.FormSetting_ExpiredForm_DefaultMessage;default:return void 0}},e.prototype.setSharingStatus=function(a,c){var d=this,e=this.Parent,f=b.FormDataSource.getDataProviderByFormMaster(e);return e.existingOnServerSide().then(function(){return f.changeSharingStatus(e.Model.Id,c)}).then(function(a){d.Model.ShareToken=a})},e.updateClosedMessage=function(b){if(-1===b.FieldSchemas.indexOf(e.Schema.FormClosedMessage)){var c=b.Master.Model;c.FormClosed?null!=c.FormClosedMessage&&a.Resources.loadLocalizedStrings().done(function(a){return c.FormClosedMessage=a.FormSetting_ClosedForm_DefaultMessage}):c.FormClosedMessage=null}},e.updateAllowCopy=function(a){var b=a.Master.Model;b.AllowCopy=!!b.ShareToken},e.prototype.serialize=function(){return e.serialize(this.Model)},e.prototype.deserialize=function(a){this.setData(a?JSON.parse(a):{},Nerve.getSubFieldSchemas(this.Schema))},e}(Nerve.createObjectMasterClass("FormSettingsMaster",e));b.FormSettingsMaster=f}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){if(!a)return!1;if(a.ResourceUrl)return!0;var b=a.UploadParameters;return!!b&&!!b.ImageFile}function e(a){return Nerve.getObjectMasterFromModel(a)}var f,g=Nerve.Spec,h={AltText:g.string({SourceFieldName:"altText"}),ContentType:g.string({SourceFieldName:"contentType"}),FileIdentifier:g.string({SourceFieldName:"fileIdentifier"}),OriginalFileName:g.string({SourceFieldName:"originalFileName"}),ResourceId:g.string({SourceFieldName:"resourceId"}),ResourceUrl:g.string({SourceFieldName:"resourceUrl"}),Width:g.number({SourceFieldName:"width"}),Height:g.number({SourceFieldName:"height"}),UploadParameters:g.reference({SourceFieldName:"uploadParameters"}),ErrorType:g.enumeration(function(){return i},{IsLocalField:!0}),ResponseError:g.reference({IsLocalField:!0}),ImageProcessingStatus:g.enumeration(function(){return f},{IsLocalField:!0}),SavingState:g.enumeration(function(){return c.SavingState},{IsLocalField:!0})};!function(a){a[a.Idle=0]="Idle",a[a.Picking=1]="Picking",a[a.Uploading=2]="Uploading",a[a.Deleting=3]="Deleting"}(f=c.ImageProcessingStatus||(c.ImageProcessingStatus={}));var i;!function(a){a[a.NoError=0]="NoError",a[a.SizeTooLarge=1]="SizeTooLarge",a[a.InvalidType=2]="InvalidType",a[a.BrokenImage=3]="BrokenImage",a[a.ServerError=4]="ServerError",a[a.DeleteFailError=5]="DeleteFailError"}(i=c.ImageErrorType||(c.ImageErrorType={})),c.hasImage=d,c.getImageInfoMaster=e;var j=function(a,b){return new c.ImageDataSource(a,b)},k=function(d){function e(a){var b=this,g=$.Deferred(),h=!a.ExistingInDataSource&&a.InitialData&&!!a.InitialData.ResourceUrl,j=_.clone(a.InitialData);a=_.clone(a),h?(a.InitialData=e.getDefaultClientFieldValues(),a.InitialData.ImageProcessingStatus=f.Uploading):a.InitialData=_.extend({},j,e.getDefaultClientFieldValues()),b=d.call(this,a,{Scheduler:new c.Scheduler,MasterReady:g.promise()})||this,c.keepSavingStateUpdated(b);var k=b.Synchronizer;return k.observe(function(a){var c;_.contains(a.FieldSchemas,k.Schema.CreationError)?c=k.Model.CreationError:_.contains(a.FieldSchemas,k.Schema.UpdateError)&&(c=k.Model.UpdateError),c&&b.bulkEdit(function(){b.Model.ResponseError=c;var a=b.Model.UploadParameters;a&&a.Delete?b.Model.ErrorType=i.DeleteFailError:b.Model.ErrorType=i.ServerError})},[k.Schema.CreationError,k.Schema.UpdateError]),g.resolve(),h&&b.Synchronizer.existingInDataSource().done(function(){return b.duplicateFrom(j)}),b}return __extends(e,d),Object.defineProperty(e.prototype,"SettingsMaster",{get:function(){return this.settingsMaster},set:function(a){this.settingsMaster=a},enumerable:!0,configurable:!0}),e.prototype.addImage=function(a){var c,d=this;if(a.File)c=function(){return d.addImageFromFile(a.File,b.FormLimitation.ImageMaxWidth,b.FormLimitation.ImageMaxHeight)};else{if(!a.FromUrl)throw Error("Invalid picked image result.");c=function(){return d.addImageFromUrl(a.FromUrl.Url,a.FromUrl.Size,a.FromUrl.Width,a.FromUrl.Height)}}this.Model.ImageProcessingStatus=f.Picking;var e=this.Synchronizer.existingInDataSource().then(c).done(function(){d.Model.AltText=null});return e},e.prototype.getImageErrorMessage=function(){switch(this.Model.ErrorType){case i.NoError:return null;case i.SizeTooLarge:return b.Resources.LocalizedStrings.Error_Message_5208;case i.InvalidType:return b.Resources.LocalizedStrings.Error_Message_5209;case i.BrokenImage:return b.Resources.LocalizedStrings.ImagePicker_Broken_Image;case i.ServerError:return this.getReponseErrorMessage();case i.DeleteFailError:return b.Resources.LocalizedStrings.Image_Delete_Fail}},e.prototype.clear=function(){var a=this,b=this.Model;return b.ResourceUrl?(this.bulkEdit(function(){b.ImageProcessingStatus=f.Deleting,b.UploadParameters={Delete:!0}}),this.flushUpload(function(){return a.setData(e.getDefaultClientFieldValues())})):$.Deferred().resolve().promise()},e.prototype.updateSettings=function(a,b){this.SettingsMaster&&this.SettingsMaster.updateWith(this.Model,a,b)},e.prototype.duplicateFrom=function(a){var c=this,d=a.AltText,e=this.SettingsMaster,f={};e&&(f=_.clone(e.getSnapshot())),this.Synchronizer.existingInDataSource().then(function(){return c.addImageFromUrl(a.ResourceUrl,0,f?f.NaturalWidth:b.FormLimitation.ImageMaxWidth,f?f.NaturalHeight:b.FormLimitation.ImageMaxHeight)}).done(function(){c.Model.AltText=d,e&&(delete f.TargetResourceId,delete f.NaturalHeight,delete f.NaturalWidth,e.setData(f))})},e.prototype.addImageFromUrl=function(b,c,d,g){var h=this;a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.DesignPage.ImageLayout.ImageSize,extraData:{width:d,height:g}});var j=this.Model;return this.bulkEdit(function(){var a=e.getLimitedSize(d,g,800,600);return j.Width=a.width,j.Height=a.height,j.ErrorType=h.validateImage(c),j.ErrorType!==i.NoError?$.Deferred().reject(j.ErrorType).promise():(h.resetStatus(f.Picking),j.UploadParameters={Url:b,Size:c},h.flushUpload(void 0,a.width,a.height))})},e.prototype.addImageFromFile=function(a,b,c){var d=this,e=this.Model;return this.bulkEdit(function(){var b=d.validateImage(a.size,a.type);return b===i.NoError?(d.resetStatus(f.Uploading),e.UploadParameters={ImageFile:a},d.flushUpload()):(e.ErrorType=b,e.ImageProcessingStatus=f.Idle,$.Deferred().reject(e.ErrorType))})},e.prototype.flushUpload=function(a,b,c){var d=this;return this.Synchronizer.flush().always(function(){return d.Model.ImageProcessingStatus=f.Idle}).then(a).then(function(){return d.updateSettings(b,c)}).fail(function(a){d.Model.UploadParameters=null})},e.getLimitedSize=function(a,b,c,d){if(a>c||b>d){var e=Math.min(d/b,c/a);a*=e,b*=e}return{width:a,height:b}},e.prototype.validateImage=function(a,c,d,e){var f=i.NoError;return a>b.FormLimitation.ImageMaxSize&&(f=i.SizeTooLarge),c&&$.inArray(c,b.FormLimitation.ImageSupportMimeType)<0&&(f=i.InvalidType),f},e.prototype.resetToDefault=function(){this.setData(e.getDefaultClientFieldValues(),Nerve.getSubFieldSchemas(e.Schema)),this.updateSettings()},e.getDefaultClientFieldValues=function(){return{UploadParameters:null,ErrorType:i.NoError,ResponseError:null,ImageProcessingStatus:f.Idle,Width:null,Height:null}},e.prototype.resetStatus=function(a){var b=this.Model;this.bulkEdit(function(){b.ErrorType=i.NoError,b.ResponseError=void 0,b.ImageProcessingStatus=a})},e.prototype.getReponseErrorMessage=function(){var a=this.Model,c=a.ResponseError&&a.ResponseError.innerCode;return b.Resources.LocalizedStrings["Error_Message_"+c]||b.Resources.LocalizedStrings.Image_Upload_Fail},e}(Nerve.createObjectMasterClass("ImageInfoMaster",h,j));c.ImageInfoMaster=k}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return Nerve.getObjectMasterFromModel(a)}function e(a,b,e){a.fieldsReady([b]).done(function(){var f=a.getModelByFieldSchema(b),g=c.getImageInfoMaster(f);a.ensureFieldsReady([e]).done(function(){var b=a.getModelByFieldSchema(e),c=d(b);g.SettingsMaster=c})})}var f,g=Nerve.Spec,h={TargetResourceId:g.string(),Layout:g.enumeration(function(){return f}),Size:g.enumeration(function(){return i}),NaturalWidth:g.number(),NaturalHeight:g.number(),ContainerWidth:g.number(),ContainerHeight:g.number(),ActualWidth:g.number(),ActualHeight:g.number(),Left:g.number(),Top:g.number()};!function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.Square=2]="Square"}(f=c.ImageLayout||(c.ImageLayout={}));var i;!function(a){a[a.Small=0]="Small",a[a.Large=1]="Large"}(i=c.ImageSize||(c.ImageSize={})),c.getImageSettingsMaster=d,c.bindImageSettings=e;var j=function(d){function e(a){var b=d.call(this,a)||this;return a.MasterTreeReady&&a.MasterTreeReady.done(function(){var a=b.Parent;a instanceof c.FormMaster&&a.fieldsReady([c.FormMaster.Schema.LogoInfo]).done(function(){a.Model.LogoInfo===b.Model&&(b.isFormLogo=!0)})}),b}return __extends(e,d),e.prototype.initImageSetting=function(a,b,d){var e=this,f=this.Model;this.bulkEdit(function(){f.TargetResourceId=a.ResourceId,null==f.Layout&&(a.ResourceUrl||a.ImageProcessingStatus!==c.ImageProcessingStatus.Idle?(f.NaturalWidth=a.Width||b,f.NaturalHeight=a.Height||d,e.initLayout(),e.applyDefaultImageSettings()):e.clear())})},e.prototype.updateWith=function(a,b,c){var d=this;this.bulkEdit(function(){d.clear(),d.initImageSetting(a,b,c)})},e.prototype.onImageStyleChange=function(a){var b=this,c=this.Model;c.Size!==a&&this.bulkEdit(function(){c.Size=a,b.applyDefaultImageSettings()})},e.prototype.clear=function(){return this.setData({},Nerve.getSubFieldSchemas(this.Schema))},e.prototype.validateImageSettings=function(a){var c=_.clone(this.getSnapshot());if(744===c.ContainerWidth&&(c.ContainerHeight=c.ContainerHeight*b.FormLimitation.QuestionCarMaxWidth/c.ContainerWidth,c.ContainerWidth=b.FormLimitation.QuestionCarMaxWidth,!a)){var d=this.Model;d.ContainerWidth=c.ContainerWidth,d.ContainerHeight=c.ContainerHeight}if(null==c.ContainerHeight||null==c.ContainerWidth||null==c.ActualHeight||null==c.ActualWidth||null==c.Top||this.isFormLogo&&(120!==c.ContainerHeight||120!==c.ContainerWidth)||c.Left>0||c.ContainerWidth>c.Left+c.ActualWidth||c.Top>0||c.ContainerHeight>c.Top+c.ActualHeight){var e=this.getDefaultImageSettings();for(var f in e)c[f]=Math.round(e[f]),a||(this[f]=c[f])}return c},e.prototype.calcLogoLayout=function(a,c){var d,e,g,h=this.Model.NaturalWidth||b.FormLimitation.ImageMaxWidth,i=this.Model.NaturalHeight||b.FormLimitation.ImageMaxHeight,j=h/i;if(c)d=a?70:80,e=d*j,g=e>d?f.Vertical:f.Horizontal;else{var k=void 0;a?(d=70,k=125):(d=120,k=215),e=d*j,e>k?(d=a?40:70,e=d*j,g=f.Vertical):g=f.Horizontal}return e=Math.min(e,750),{ActualWidth:e,ActualHeight:d,Layout:g}},e.prototype.initLayout=function(){var a=this.Model;if(this.isFormLogo)a.Size=i.Small;else{var b=a.NaturalHeight/a.NaturalWidth;b>1?a.Layout=f.Vertical:1>b?a.Layout=f.Horizontal:a.Layout=f.Square,a.Size=.5>b?i.Large:i.Small}},e.prototype.applyDefaultImageSettings=function(){var a=this.Model,b=this.getDefaultImageSettings();for(var c in b)a[c]=Math.round(b[c])},e.prototype.getDefaultImageSettings=function(){var c,d=this.Model;if(d.NaturalHeight&&d.NaturalWidth)c={NaturalHeight:d.NaturalHeight,NaturalWidth:d.NaturalWidth};else{var e=d.NaturalHeight||b.FormLimitation.ImageMaxHeight,f=d.NaturalWidth||b.FormLimitation.ImageMaxWidth;c={NaturalHeight:e,NaturalWidth:f}}if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormLogoBrand)&&this.isFormLogo)return c;var g=this.getImageLayoutPatten();if(null==g.Height?(c.ContainerWidth=g.Width,c.ContainerHeight=g.Width*c.NaturalHeight/c.NaturalWidth):null==g.Width?(c.ContainerWidth=g.Height*c.NaturalWidth/c.NaturalHeight,c.ContainerHeight=g.Height):(c.ContainerWidth=g.Width,c.ContainerHeight=g.Height),null==g.Height||null==g.Width)c.Left=0,c.Top=0,c.ActualWidth=c.ContainerWidth,c.ActualHeight=c.ContainerHeight;else{var h=Math.max(c.ContainerWidth/c.NaturalWidth,c.ContainerHeight/c.NaturalHeight);c.ActualWidth=h*c.NaturalWidth,c.ActualHeight=h*c.NaturalHeight,c.Left=(c.ContainerWidth-c.ActualWidth)/2,c.Top=(c.ContainerHeight-c.ActualHeight)/2}return c},e.prototype.getImageLayoutPatten=function(){var a=this.Model;if(this.isFormLogo)return{Height:120,Width:120};if(null==a.Size||a.Size===i.Small)switch(a.Layout){case f.Square:return{Width:314,Height:314};case f.Vertical:return{Height:314};case f.Horizontal:default:return{Width:314}}else switch(a.Layout){case f.Square:return{Width:414,Height:414};case f.Vertical:return{Height:414};case f.Horizontal:default:return{Width:b.FormLimitation.QuestionCarMaxWidth}}},e}(Nerve.createObjectMasterClass("ImageSettingsMaster",h));c.ImageSettingsMaster=j}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return a}a.Exports.Models=a.Form.Model,b.exportConverter=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return{PermissionSet:"Read, Write, Share",Type:a}}function c(a){return Nerve.getObjectMasterFromModel(a)}var d,e=Nerve.Spec,f={PrincipalId:e.string({SourceFieldName:"principalId"}),PermissionSet:e.string({SourceFieldName:"permissionSet"}),Type:e.enumeration(function(){return d},{SourceFieldName:"type"}),FormId:e.string({IsSourceGenerated:!0,SourceFieldName:"formId"}),IsOwner:e["boolean"]({IsSourceGenerated:!0,SourceFieldName:"isOwner"}),PrincipalEmailAddress:e.string({IsSourceGenerated:!0,SourceFieldName:"principalEmailAddress"}),PrincipalName:e.string({IsSourceGenerated:!0,SourceFieldName:"principalName"}),SavingState:e.enumeration(function(){return a.SavingState},{IsLocalField:!0})};!function(a){a[a.User=0]="User",a[a.Group=1]="Group",a[a.Tenant=2]="Tenant",a[a.Link=3]="Link",a[a.OrgLink=4]="OrgLink"}(d=a.PermissionType||(a.PermissionType={})),a.createDefaultPermission=b,a.getPermissionMaster=c;var g=function(b,c){return new a.PermissionDataSource(b,c)},h=function(b){function c(c){var d=b.call(this,c)||this;return a.keepSavingStateUpdated(d),d}return __extends(c,b),Object.defineProperty(c.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),c}(Nerve.createObjectMasterClass("Permission",f,g));a.PermissionMaster=h}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){function c(a,b){return{Type:a,Name:b}}function d(a){return Nerve.getObjectMasterFromModel(a)}var e,f=Nerve.Spec,g={PrincipalId:f.string({IsSourceGenerated:!0,SourceFieldName:"principalId"}),Type:f.enumeration(function(){return e},{SourceFieldName:"type"}),Name:f.string({SourceFieldName:"name"})};!function(a){a[a.Default=0]="Default",a[a.AnalyzerToken=1]="AnalyzerToken",a[a.OrgAnalyzerToken=2]="OrgAnalyzerToken"}(e=b.PermissionTokenType||(b.PermissionTokenType={})),b.createDefaultPermissionToken=c,b.getPermissionTokenMaster=d;var h=function(a,c){return new b.PermissionTokenDataSource(a,c)},i=function(e){function f(a){return e.call(this,a)||this}return __extends(f,e),Object.defineProperty(f.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),f.appendPermissionToken=function(a,b,e){var f=Nerve.Collection.addItems(a.Model.PermissionTokens,[c(b,e)]),g=d(f[0]);return g.Synchronizer.existingInDataSource().then(function(){return g.Model.PrincipalId})},f.removePermissionToken=function(a,b){return b?(Nerve.Collection.deleteItems(a.Model.PermissionTokens,[b]),d(b).Synchronizer.deletedFromDataSource().done()):void 0},f.getShareResultPermissionToken=function(a){return a.Synchronizer.existingInDataSource().then(function(){var b=f.getShareResultPermissions(a);if(!b)return null;var c=d(b);return c?c.Synchronizer.existingInDataSource().then(function(){return c.Model.PrincipalId}):void 0})},f.getShareResultPermissions=function(c){return _.filter(c.Model.PermissionTokens,function(c){return c.Type===b.PermissionTokenType.AnalyzerToken&&c.Name===a.FormLimitation.AnalysisTokenName})[0]},f}(Nerve.createObjectMasterClass("PermissionToken",g,h));b.PermissionTokenMaster=i}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}var c=Nerve.Spec,d={Id:c.number({IsSourceGenerated:!0,IsKeyField:!0,SourceFieldName:"id"}),AnswerHint:c.string({SourceFieldName:"description"}),CustomProperties:c.string({SourceFieldName:"customProperties"}),Description:c.string({SourceFieldName:"displayText"}),Order:c.number({SourceFieldName:"order"}),Key:c.string({SourceFieldName:"key"}),IsGenerated:c["boolean"]({IsLocalField:!0}),IsMathOption:c["boolean"]({IsLocalField:!0}),BranchInfo:c.fromMasterClass(function(){return a.BranchInfoMaster},{IsLocalField:!0}),SavingState:c.enumeration(function(){return a.SavingState},{IsLocalField:!0})};a.getChoiceV2Master=b;var e=function(b,c){return new a.ChoiceDataSource(b,c)},f=function(b){function c(c){var d=b.call(this,c,{Scheduler:new a.Scheduler})||this;return a.keepSavingStateUpdated(d),d.initializeCustomPropertiesBinder(c),d}return __extends(c,b),Object.defineProperty(c.prototype,"Question",{get:function(){
return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionId",{get:function(){return this.Question.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Form",{get:function(){return this.Question.Form},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),c.prototype.initializeCustomPropertiesBinder=function(b){this.customPropertiesBinder=new a.FieldBinder(this,c.Schema.CustomProperties,c.CustomPropertiesFieldSet),b.InitialData&&this.isFieldReady(c.Schema.CustomProperties)&&(b.ExistingInDataSource||b.InitialData.CustomProperties?this.customPropertiesBinder.deserialize():this.customPropertiesBinder.serialize())},Object.defineProperty(c,"CustomPropertiesFieldSet",{get:function(){return c.customPropertiesFieldSet||(c.customPropertiesFieldSet=new a.FieldSet([c.Schema.BranchInfo,c.Schema.IsGenerated,c.Schema.IsMathOption])),c.customPropertiesFieldSet},enumerable:!0,configurable:!0}),c}(Nerve.createObjectMasterClass("ChoiceV2Master",d,e));a.ChoiceV2Master=f}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return Nerve.getObjectMasterFromModel(a)}var e,f=Nerve.Spec,g={Id:f.string({IsKeyField:!0,SourceFieldName:"id"}),DefaultValue:f.reference({SourceFieldName:"defaultValue"}),ImageInfo:f.fromMasterClass(function(){return c.ImageInfoMaster},{SourceFieldName:"image"}),ImageSettings:f.fromMasterClass(function(){return c.ImageSettingsMaster},{IsLocalField:!0}),Order:f.number({SourceFieldName:"order"}),QuestionInfo:f.string({SourceFieldName:"questionInfo"}),Required:f["boolean"]({SourceFieldName:"required"}),Subtitle:f.string({SourceFieldName:"subtitle"}),CombinedTitle:f.string({SourceFieldName:"title"}),Type:f.reference({SourceFieldName:"type"}),GroupId:f.string({SourceFieldName:"groupId"}),ShowSubtitle:f["boolean"]({IsLocalField:!0}),Hidden:f["boolean"]({IsLocalField:!0}),Title:f.string({IsLocalField:!0}),HasValidBranching:f["boolean"]({IsLocalField:!0}),BranchInfo:f.fromMasterClass(function(){return c.BranchInfoMaster},{IsLocalField:!0}),IntegratedSavingState:f.enumeration(function(){return c.SavingState},{IsLocalField:!0}),SavingState:f.enumeration(function(){return c.SavingState},{IsLocalField:!0}),PhshingScanState:f.enumeration(function(){return k},{IsLocalField:!0}),TitleHasPhishingKeywords:f["boolean"]({SourceFieldName:"titleHasPhishingKeywords"}),SubtitleHasPhishingKeywords:f["boolean"]({SourceFieldName:"subtitleHasPhishingKeywords"}),IsQuiz:f["boolean"]({SourceFieldName:"isQuiz"}),GradingBasis:f.string({IsLocalField:!0}),Point:f.number({IsLocalField:!0}),ChoiceType:f.reference({IsLocalField:!0}),Choices:f.collectionOf({Description:f.string(),BranchInfo:f.fromMasterClass(function(){return c.BranchInfoMaster}),IsAnswerKey:f["boolean"](),AnswerHint:f.string(),IsGenerated:f["boolean"](),IsMathOption:f["boolean"]()},{IsLocalField:!0}),Hint:f.string({IsLocalField:!0}),AllowMultipleValues:f["boolean"]({SourceFieldName:"allowMultipleValues"}),AllowOtherAnswer:f["boolean"]({IsLocalField:!0}),OptionDisplayStyle:f.enumeration(function(){return l},{IsLocalField:!0}),ShuffleOptions:f["boolean"]({IsLocalField:!0}),HasMaxSelectionCount:f["boolean"]({IsLocalField:!0}),MaxSelectionCount:f.number({IsLocalField:!0}),BranchInfoForOtherChoice:f.fromMasterClass(function(){return c.BranchInfoMaster},{IsLocalField:!0}),ChoiceGroup:f.collectionOf(function(){return c.ChoiceV2Master},{SourceFieldName:"choices"}),Length:f.number({IsLocalField:!0}),RatingShape:f.enumeration(function(){return h},{IsLocalField:!0}),LeftDescription:f.string({IsLocalField:!0}),RightDescription:f.string({IsLocalField:!0}),ShowRatingLabel:f["boolean"]({IsLocalField:!0}),MinRating:f.number({IsLocalField:!0}),Multiline:f["boolean"]({IsLocalField:!0}),IsNumber:f["boolean"]({IsLocalField:!0}),Placeholder:f.string({IsLocalField:!0}),NumberValidationRule:f.enumeration(function(){return i},{IsLocalField:!0}),NumberMinBoundary:f.string({IsLocalField:!0}),NumberMaxBoundary:f.string({IsLocalField:!0}),Date:f["boolean"]({IsLocalField:!0}),Time:f["boolean"]({IsLocalField:!0}),FileUploadFolderId:f.string({SourceFieldName:"fileUploadFolderId"}),FileTypes:f.create({Word:f["boolean"](),Excel:f["boolean"](),PowerPoint:f["boolean"](),PDF:f["boolean"](),Image:f["boolean"](),Text:f["boolean"](),Video:f["boolean"](),Audio:f["boolean"]()},{IsLocalField:!0}),HasSpecificFileType:f["boolean"]({IsLocalField:!0}),CoAuthors:f.collectionOf(f.reference(),{IsLocalField:!0}),IsMathQuiz:f["boolean"]({IsLocalField:!0}),IsPlainTextInMathField:f["boolean"]({IsLocalField:!0}),MathPatterns:f.collectionOf(f.string(),{IsLocalField:!0}),MathAriaLabels:f.collectionOf(f.string(),{IsLocalField:!0}),LastMathMLFormula:f.string({IsLocalField:!0}),VideoInfo:f.create({Url:f.string(),Title:f.string(),Author:f.string(),Thumbnail_url:f.string(),OriginalWidth:f.number(),OriginalHeight:f.number()},{IsLocalField:!0}),TrackingId:f.string({SourceFieldName:"trackingId"}),LorEdited:f.string({SourceFieldName:"lorEdited"})};g.Choices[0],g.ChoiceGroup[0];!function(a){a[a.SingleChoice=1]="SingleChoice",a[a.MultiChoice=2]="MultiChoice"}(e=c.ChoiceType||(c.ChoiceType={}));var h;!function(a){a[a.Number=0]="Number",a[a.Star=1]="Star"}(h=c.RatingShape||(c.RatingShape={}));var i;!function(a){a[a.None=0]="None",a[a.Greater=1]="Greater",a[a.GreaterOrEqual=2]="GreaterOrEqual",a[a.Less=3]="Less",a[a.LessOrEqual=4]="LessOrEqual",a[a.Equal=5]="Equal",a[a.NotEqual=6]="NotEqual",a[a.Between=7]="Between",a[a.NotBetween=8]="NotBetween",a[a.Max=9]="Max"}(i=c.NumberValidationRule||(c.NumberValidationRule={}));var j;!function(a){a[a.Success=0]="Success",a[a.RequiredError=1]="RequiredError",a[a.NumberValidationError=2]="NumberValidationError",a[a.QuizWrongChoiceError=3]="QuizWrongChoiceError",a[a.ChoiceValidationError=4]="ChoiceValidationError"}(j=c.QuestionValidationResult||(c.QuestionValidationResult={}));var k;!function(a){a[a.NotScaned=0]="NotScaned",a[a.Safe=1]="Safe",a[a.Unsafe=2]="Unsafe"}(k=c.PhishingScanState||(c.PhishingScanState={}));var l;!function(a){a[a.Dropdown=0]="Dropdown",a[a.ListAll=1]="ListAll"}(l=c.OptionDisplayStyle||(c.OptionDisplayStyle={}));var m;!function(a){a.Choice="Question.Choice",a.ChoiceV2="Question.Choices",a.DateTime="Question.DateTime",a.Rating="Question.Rating",a.TextField="Question.TextField",a.Ranking="Question.Ranking",a.MatrixChoiceGroup="Question.MatrixChoiceGroup",a.MatrixChoice="Question.MatrixChoice",a.FileUpload="Question.FileUpload",a.NPS="Question.NPS"}(m=c.QuestionType||(c.QuestionType={})),c.getQuestionMaster=d;var n=function(a,b){return new c.QuestionDataSource(a,b)},o=function(d){function e(b){var f=this,g=$.Deferred();return b.InitialData?(e.resolveQuestionNullTypeIssue(b.InitialData),b=_.clone(b),b.InitialData=_.clone(b.InitialData),void 0!==b.InitialData.CombinedTitle?e.updateTitleWithCombinedTitle(b.InitialData):e.updateCombinedTitle(b.InitialData)):Nerve.Debugger.throwError("Question model should created with initial data."),f=d.call(this,b,{MasterReady:g.promise(),Scheduler:new c.Scheduler})||this,f.fieldsReady([e.Schema.ChoiceGroup]).done(function(){Nerve.Collection.setComparer(f.Model.ChoiceGroup,function(a,b){return a.Order-b.Order})}),c.keepSavingStateUpdated(f),f.updateIntegratedSavingState(),f.updateBranchInfoValidness(),f.initializeQuestionInfoBinder(b),c.bindImageSettings(f,e.Schema.ImageInfo,e.Schema.ImageSettings),e.Rules.forEach(function(a){return f.addRule(a)}),a.Flighting.Flight.isEnabled(a.Flighting.Flights.PhishingAutoDetection)&&!a.Flighting.Flight.isEnabled(a.Flighting.Flights.AutoCloseForm)&&f.Form.SyncContext===c.FormSyncContext.DesignTimeForm&&f.phishingScan(),g.resolve(),f}return __extends(e,d),Object.defineProperty(e,"SubQuestionOrderDefaultStep",{get:function(){return 100},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ImageInfoMaster",{get:function(){return c.getImageInfoMaster(this.Model.ImageInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ImageSettingsMaster",{get:function(){return c.getImageSettingsMaster(this.Model.ImageSettings)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ParentQuestionMaster",{get:function(){if(!this.isFieldReady(this.Schema.GroupId))return null;var a=this.Model.GroupId;return a&&this.Form.getQuestionById(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SubQuestionMasters",{get:function(){var a=this;return this.Form.QuestionMasters.filter(function(b){return b.Model.GroupId===a.Model.Id})},enumerable:!0,configurable:!0}),e.prototype.isFieldReady=function(a){return a=e.getSourceFields([a])[0],d.prototype.isFieldReady.call(this,a)},e.prototype.ensureFieldsReady=function(a){return d.prototype.ensureFieldsReady.call(this,e.getSourceFields(a))},e.prototype.fieldsReady=function(a){return d.prototype.fieldsReady.call(this,e.getSourceFields(a))},e.prototype.ensureCreationDone=function(){var a=this;return this.ImageInfoMaster.Synchronizer.flush().then(function(){return a.Synchronizer.flush()})},e.prototype.setVideoUrl=function(a){var b=this,c=this.Model.VideoInfo,d=Nerve.getObjectMasterFromModel(c);d.bulkEdit(function(){c.Url=b.generateEmbedURLLocally(a),c.Title="",c.Author="",c.Thumbnail_url="",c.OriginalWidth=459,c.OriginalHeight=256})},e.prototype.clearVideoInfo=function(){this.Model.VideoInfo={}},e.prototype.isSubQuestion=function(){return!!this.Model.GroupId},e.prototype.addSubQuestion=function(a){a.GroupId=this.Model.Id,a.Required=this.Model.Required,this.Form.insertElementAfter(a,this)},e.prototype.deleteSubQuestion=function(a){var b=this.Form.getQuestionById(a);b.Deleted=!0},e.prototype.moveSubQuestionUp=function(a){var b=_.indexOf(this.SubQuestionMasters,a);if(!(0>=b)){var c=this.Model.Order;b>1&&(c=this.SubQuestionMasters[b-2].Model.Order);var d=this.SubQuestionMasters[b-1].Model.Order;a.Model.Order=(c+d)/2}},e.prototype.moveSubQuestionDown=function(a){var b=_.indexOf(this.SubQuestionMasters,a);if(!(b>=this.SubQuestionMasters.length-1)){var c=this.SubQuestionMasters[b+1].Model.Order,d=_.indexOf(this.Form.QuestionMasters,a);if(d<this.Form.QuestionMasters.length-2){var f=this.Form.QuestionMasters[d+2].Model.Order;a.Model.Order=(c+f)/2}else a.Model.Order=c+e.SubQuestionOrderDefaultStep}},e.prototype.createSyncJob=function(a){var b=this,c=$.Deferred(),d=c.promise().then(function(){return b.Form.getQuestionSyncBlocker(d)}).then(a);return c.resolve(),d},e.prototype.getMethodDelegator=function(){var a=this.Model.Type;this.delegators=this.delegators||(this.delegators={});var b=this.delegators[a];if(!b){var d=c.Question.getQuestionDelegatorClass(a);b=new d(this),this.delegators[a]=b}return b},e.prototype.getChoiceById=function(a){var b=Nerve.Collection.getItemWithKeyFields(this.Model.ChoiceGroup,{Id:a});return b&&Nerve.getObjectMasterFromModel(b)},e.prototype.getChoiceByKey=function(a){var b=_.find(this.Model.ChoiceGroup,function(b){return b.Key===a});return b&&c.getChoiceV2Master(b)},e.prototype.initializeQuestionInfoBinder=function(a){this.questionInfoBinder=new c.FieldBinder(this,e.Schema.QuestionInfo,e.QuestionInfoFieldSet),a.InitialData&&this.isFieldReady(e.Schema.QuestionInfo)&&(a.ExistingInDataSource||a.InitialData.QuestionInfo?this.questionInfoBinder.deserialize():this.questionInfoBinder.serialize()),this.justifyQuestionInfo()},e.prototype.updateIntegratedSavingState=function(){[this.Model.SavingState];this.isFieldReady(e.Schema.ImageInfo)?this.Model.IntegratedSavingState=c.integrateSavingState([this.Model.ImageInfo.SavingState,this.Model.SavingState]):this.Model.IntegratedSavingState=this.Model.SavingState},e.prototype.updateBranchInfoValidness=function(){var a=this.Model,b=_.map(a.Choices,function(a){return a.BranchInfo}).concat([a.BranchInfo,a.BranchInfoForOtherChoice]);a.HasValidBranching=b.some(function(a){return a.IsQuestionBranchingValid})},e.prototype.generateEmbedURLLocally=function(b){var c=document.createElement("a");c.href=b;var d=c.pathname.split("/"),e=b.substring(b.indexOf("?")+1),f=a.Utilities.Html.getQueries(e),g=f.v||d[0]||d[1];return"https://www.youtube.com/embed/"+g+"?feature=oembed&modestbranding=1&rel=0"},e.prototype.phishingScan=function(){var b=this;this.fieldsReady([e.Schema.Title,e.Schema.Subtitle]).done(function(){var c=b.Model.Title+" "+b.Model.Subtitle,d=500;window.clearTimeout(b.phishingScanTimeOut),b.phishingScanTimeOut=window.setTimeout(function(){var d=a.DataProvider.ProviderManager.getInstance().CurrentMathProvider;d.textAnalyzeWithFeatures(a.DataProvider.Models.TextAnalyzerFeatures.AntiPhishing,c).done(function(a){a.Results&&a.Results.length?b.Model.PhshingScanState=k.Unsafe:b.Model.PhshingScanState=k.Safe})},d)})},Object.defineProperty(e,"QuestionInfoFieldSet",{get:function(){return e.questionInfoFieldSet||(e.questionInfoFieldSet=new c.FieldSet([e.Schema.VideoInfo,e.Schema.ShowSubtitle,e.Schema.Hidden,e.Schema.BranchInfo,e.Schema.ShowRatingLabel,e.Schema.Point,e.Schema.ImageSettings,e.Schema.GradingBasis,e.Schema.ChoiceType,e.Schema.Choices,e.Schema.Hint,e.Schema.AllowOtherAnswer,e.Schema.OptionDisplayStyle,e.Schema.ShuffleOptions,e.Schema.BranchInfoForOtherChoice,e.Schema.Length,e.Schema.RatingShape,e.Schema.LeftDescription,e.Schema.RightDescription,e.Schema.Multiline,e.Schema.IsNumber,e.Schema.Placeholder,e.Schema.NumberValidationRule,e.Schema.NumberMinBoundary,e.Schema.NumberMaxBoundary,e.Schema.Date,e.Schema.Time,e.Schema.IsMathQuiz,e.Schema.IsPlainTextInMathField,e.Schema.MathPatterns,e.Schema.MathAriaLabels,e.Schema.HasMaxSelectionCount,e.Schema.MaxSelectionCount,e.Schema.HasSpecificFileType,e.Schema.FileTypes,e.Schema.MinRating])),e.questionInfoFieldSet},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Rules",{get:function(){if(!e.rules){var c=e.Schema;e.rules=[{Name:"block id changes",InterestedFields:[c.Id],onChange:function(b){var c=b.Master.Model,d=c.Id,e=b.OldValues.Id;c.Id=e;var f;try{throw Error("Changing question id")}catch(g){f=g}a.Event.ErrorEvent.logData({type:a.Event.ErrorType.UpdatingQuestionId,errorInfo:{newId:d,oldId:e,stack:f.stack}})}},{Name:"update LOR edited property when LOR question edited",InterestedFields:[c.Title,c.Subtitle,c.ImageInfo,c.GradingBasis].concat(_.without(Nerve.getSubFieldSchemas(c.Choices[0]),c.Choices[0].BranchInfo)),onChange:function(a){return a.Master.setLorQuestionEditedProperty(a.Master.Model)}},{Name:"null type resolver",InterestedFields:[c.Type],onChange:function(a){return e.resolveQuestionNullTypeIssue(a.Master.Model)}},{Name:"update CombinedTitle",InterestedFields:[c.Title,c.IsMathQuiz,c.Subtitle],onChange:function(a){return e.updateCombinedTitle(a.Master.Model)}},{Name:"update Title",InterestedFields:[c.CombinedTitle],onChange:function(a){return e.updateTitleWithCombinedTitle(a.Master.Model)}},{Name:"IntegrateSavingState",InterestedFields:[c.ImageInfo.SavingState,c.SavingState],onChange:function(a){return a.Master.updateIntegratedSavingState()}},{Name:"HasValidBranching",InterestedFields:[c.BranchInfo,c.BranchInfoForOtherChoice,c.Choices],onChange:function(a){return a.Master.updateBranchInfoValidness()}},{Name:"IsQuiz",InterestedFields:[c.IsQuiz],onChange:function(a){var c=a.Master.Model;c.IsQuiz||(c.IsMathQuiz=null,b.convertToArray(c.Choices).forEach(function(a){a.IsAnswerKey=null}))}},{Name:"IsMathQuiz",InterestedFields:[c.IsMathQuiz],onChange:function(a){var b=a.Master.Model;b.IsMathQuiz||(b.IsMathQuiz=null,b.MathPatterns=null,b.MathAriaLabels=null,b.IsPlainTextInMathField=null,b.LastMathMLFormula=null)}},{Name:"NumberValidationRule",InterestedFields:[c.IsNumber],onChange:function(a){var b=a.Master.Model;b.IsNumber?null==b.NumberValidationRule&&(b.NumberValidationRule=i.None):b.NumberValidationRule=null}},{Name:"JustifyNumberBoundaries",InterestedFields:[c.NumberValidationRule],onChange:function(a){return a.Master.justifyNumberBoundaries()}}],a.Flighting.Flight.isEnabled(a.Flighting.Flights.PhishingAutoDetection)&&!a.Flighting.Flight.isEnabled(a.Flighting.Flights.AutoCloseForm)&&e.Rules.push({Name:"Phishing scan",InterestedFields:[c.Title,c.Subtitle],onChange:function(a){a.Master.phishingScan()}})}return e.rules},enumerable:!0,configurable:!0}),e.resolveQuestionNullTypeIssue=function(b){if(!b.Type){var d={choiceType:b.ChoiceType,date:b.Date,time:b.Time,ratingShape:b.RatingShape,multiline:b.Multiline};null!=d.choiceType?b.Type=c.Question.Choice.getElementTypeName():null!=d.date||null!=d.time?b.Type=c.Question.DateTime.getElementTypeName():d.ratingShape?b.Type=c.Question.Rating.getElementTypeName():b.Type=c.Question.TextField.getElementTypeName(),a.Event.ErrorEvent.logData({type:a.Event.ErrorType.QuestionNullTypeError,errorInfo:{message:"question type resolved",conditions:d,resolvedType:b.Type}})}},e.updateCombinedTitle=function(b){if(b.IsMathQuiz&&b.Subtitle){var c=b.Title||"";b.CombinedTitle=c+a.Utilities.MathHelper.mathSeparator+b.Subtitle}else b.CombinedTitle=b.Title},e.prototype.setLorQuestionEditedProperty=function(a){if(this.isFieldReady(e.Schema.TrackingId)&&a.TrackingId){var b=a.TrackingId.startsWith("qti_");b&&this.isFieldReady(e.Schema.LorEdited)&&"false"===a.LorEdited&&(a.LorEdited="true")}},e.updateTitleWithCombinedTitle=function(b){var c=b.CombinedTitle;c&&(c=c.split(a.Utilities.MathHelper.mathSeparator)[0]),b.Title=c},e.getSourceFields=function(a){return _.uniq(a.map(function(a){return e.QuestionInfoFieldSet.covers(a)?e.Schema.QuestionInfo:a}))},e}(Nerve.createObjectMasterClass("QuestionMaster",g,n));c.QuestionMaster=o;var p={verify:null,isEmpty:null,getTypeDisplayName:null,getBranchedQuestion:null,isNumberType:null,resetBranchInfo:null,getNormalizedAnswer:null,justifyNumberBoundaries:null,getNumberValidationErrorMessage:null,supportsQuestionLevelBranching:null,supportsChoiceLevelBranching:null,getSnapshotWithoutBranchInfo:null,insertChoice:null,setAnswerKey:null,createQuizResult:null,autoGradeAnswer:null,autoGradeWithQuizResult:null,serializeAnswer:null,deserializeAnswer:null,justifyQuestionInfo:null,showAsDropdown:null,hasCorrectAnswers:null,isCorrectAnswer:null};Object.keys(p).forEach(function(a){o.prototype[a]=function(){var b=this.getMethodDelegator();return b[a].apply(b,arguments)}})}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(b){function c(a){f[a.getElementTypeName()]=a}function d(a){return f[a]}var e=function(){function b(a){this.questionMaster=a}return Object.defineProperty(b.prototype,"Master",{get:function(){return this.questionMaster},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Model",{get:function(){return this.questionMaster.Model},enumerable:!0,configurable:!0}),b.prototype.isEmpty=function(a){return!a},b.prototype.justifyNumberBoundaries=function(){throw Error("to be overridden")},b.prototype.supportsQuestionLevelBranching=function(){return!0},b.prototype.supportsChoiceLevelBranching=function(){return!1},b.prototype.getBranchedQuestion=function(b,c){var d=this.getBranchingResult(b);switch(d.Type){case a.BranchingType.Next:return c;case a.BranchingType.Specified:return d.TargetQuestion;case a.BranchingType.Pending:case a.BranchingType.End:default:return null}},b.prototype.isNumberType=function(){return!1},b.prototype.getNumberValidationErrorMessage=function(){throw Error("to be overridden")},b.prototype.getSnapshotWithoutBranchInfo=function(){var a=_.clone(this.Master.getSnapshot());return delete a.BranchInfo,delete a.BranchInfoForOtherChoice,a},b.prototype.resetBranchInfo=function(){this.getBranchInfoMaster(this.Model.BranchInfo).resetToDefault()},b.prototype.insertChoice=function(a,b){},b.prototype.getNormalizedAnswer=function(a){return a},b.prototype.hasCorrectAnswers=function(){return!1},b.prototype.isCorrectAnswer=function(a){return!1},b.prototype.setAnswerKey=function(a,b){},b.prototype.createQuizResult=function(a){return null},b.prototype.autoGradeAnswer=function(a){var b=!this.Model.Point,c=null==a.Answer||""===a.Answer;(b||c)&&(a.Score=0,a.IsAutoGraded=!0)},b.prototype.autoGradeWithQuizResult=function(a,b){var c=this.Master.Parent,d=c&&c.Model||this.Model,e=d.Point,f=null==a||""===a;return e||f?0:null},b.prototype.serializeAnswer=function(a){return a},b.prototype.deserializeAnswer=function(a){return a},b.prototype.justifyQuestionInfo=function(){},b.prototype.showAsDropdown=function(){},b.prototype.getBranchInfoMaster=function(a){return Nerve.getObjectMasterFromModel(a)},b.prototype.getBranchingResult=function(a){return this.getBranchInfoMaster(this.Model.BranchInfo).getBranchingResult()},b}();b.MethodDelegatorBase=e;var f={};b.registerQuestionDelegatorClass=c,b.getQuestionDelegatorClass=d}(b=a.Question||(a.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){var e=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),Object.defineProperty(f,"MinimumOptionsForDropDown",{get:function(){return 7},enumerable:!0,configurable:!0}),f.getElementTypeName=function(){return c.QuestionType.Choice},f.createDefaultDefinition=function(){var a=[{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),IsGenerated:!0},{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),IsGenerated:!0}];return{Type:f.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle,Choices:a,ChoiceType:c.ChoiceType.SingleChoice,OptionDisplayStyle:c.OptionDisplayStyle.ListAll}},f.prototype.verify=function(b){var d=a.Utilities.tryParseJson(b);return!this.Model.Required||b&&"[]"!==b?a.Flighting.Flight.isEnabled(a.Flighting.Flights.MaxChoiceCount)&&this.Model.HasMaxSelectionCount&&b&&_.isArray(d)&&d.length>this.Model.MaxSelectionCount?c.QuestionValidationResult.ChoiceValidationError:c.QuestionValidationResult.Success:c.QuestionValidationResult.RequiredError},f.prototype.isEmpty=function(a){return this.Model.ChoiceType===c.ChoiceType.SingleChoice?!a:!a||"[]"===a},f.prototype.getTypeDisplayName=function(){switch(this.Model.ChoiceType){case c.ChoiceType.SingleChoice:return b.Resources.LocalizedStrings.QuestionType_SingleChoice;case c.ChoiceType.MultiChoice:return b.Resources.LocalizedStrings.QuestionType_MultiChoice;default:throw Error("Choice Question Type Not Supported")}},f.prototype.supportsQuestionLevelBranching=function(){return this.Model.ChoiceType!==c.ChoiceType.SingleChoice},f.prototype.supportsChoiceLevelBranching=function(){return this.Model.ChoiceType===c.ChoiceType.SingleChoice},f.prototype.getSnapshotWithoutBranchInfo=function(){var a=e.prototype.getSnapshotWithoutBranchInfo.call(this);return a.Choices=b.convertToArray(a.Choices).map(function(a){return a=_.clone(a),delete a.BranchInfo,a}),a},f.prototype.resetBranchInfo=function(){var a=this;e.prototype.resetBranchInfo.call(this),b.convertToArray(this.Model.Choices).filter(function(b){return a.getBranchInfoMaster(b.BranchInfo).resetToDefault()}),this.getBranchInfoMaster(this.Model.BranchInfoForOtherChoice).resetToDefault()},f.prototype.insertChoice=function(a,b){var c=this.Model.Choices,d=_.find(c,function(a){return a.IsGenerated});if(d){var e=Nerve.getObjectMasterFromModel(d);e.bulkEdit(function(){d.Description=a,d.IsGenerated=null,d.IsMathOption=b})}else{var f=Nerve.Collection.addItems(c,[{Description:a,IsMathOption:b}]);d=f[0]}return d},f.prototype.hasCorrectAnswers=function(){return _.some(this.Model.Choices,function(a){return a.IsAnswerKey})},f.prototype.isCorrectAnswer=function(a){var c=d.getChoiceAnswer(a,this.Model),e=b.convertToArray(this.Model.Choices).filter(function(a){return a.IsAnswerKey}).map(function(a){return a.Description}).sort();return _.isEqual(e,c.SelectedOptions.sort())},f.prototype.justifyQuestionInfo=function(){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.DropDown)){var b=this.Master.Model;if(null==b.OptionDisplayStyle){var d=b.ChoiceType===c.ChoiceType.SingleChoice&&!b.IsMathQuiz&&!b.AllowOtherAnswer&&b.Choices.length>=f.MinimumOptionsForDropDown;b.OptionDisplayStyle=d?c.OptionDisplayStyle.Dropdown:c.OptionDisplayStyle.ListAll}}},f.prototype.showAsDropdown=function(){var b=this.Master.Model;return a.Flighting.Flight.isEnabled(a.Flighting.Flights.DropDown)?b.OptionDisplayStyle===c.OptionDisplayStyle.Dropdown:b.ChoiceType===c.ChoiceType.SingleChoice&&!b.IsMathQuiz&&!b.AllowOtherAnswer&&b.Choices.length>=f.MinimumOptionsForDropDown},f.prototype.setAnswerKey=function(a,d){var e=this;this.Master.bulkEdit(function(){a.IsAnswerKey=d,e.Model.ChoiceType===c.ChoiceType.SingleChoice&&a.IsAnswerKey&&b.convertToArray(e.Model.Choices).forEach(function(b){b.IsAnswerKey&&b!==a&&(b.IsAnswerKey=!1)})})},f.prototype.createQuizResult=function(a){if(this.Model.IsQuiz){var c=b.convertToArray(this.Model.Choices),d=c.some(function(a){return a.IsAnswerKey});return d?{IsAnswerCorrect:this.isCorrectAnswer(a),AnswerHints:c.map(function(a){return a.AnswerHint}),IsAnswerKeys:c.map(function(a){return a.IsAnswerKey}),Choices:c.map(function(a){return a.Description}),GradingBasis:this.Model.GradingBasis}:void 0}},f.prototype.autoGradeAnswer=function(a){var b=_.some(this.Model.Choices,function(a){return a.IsAnswerKey});if(b){var c=this.Model.Point?this.Model.Point:0;a.Score=this.isCorrectAnswer(a.Answer)?c:0,a.IsAutoGraded=!0}else e.prototype.autoGradeAnswer.call(this,a)},f.prototype.autoGradeWithQuizResult=function(a,b){return b?b.IsAnswerCorrect?this.Model.Point:0:null},f.prototype.getBranchingResult=function(a){var d=this;if(!this.Model.HasValidBranching||this.Model.ChoiceType!==c.ChoiceType.SingleChoice)return e.prototype.getBranchingResult.call(this,a);var f=b.convertToArray(this.Model.Choices),g=f.filter(function(a){return a.BranchInfo&&a.BranchInfo.IsQuestionBranchingValid});if(0===g.length)return e.prototype.getBranchingResult.call(this,a);var h,i=f.filter(function(b){return d.selected(a,b)}),j=_.intersection(i,g);if(j.length>0||i.length>0){var k=j[0]||i[0];h=k.BranchInfo}else this.isEmpty(a)||(h=this.Model.BranchInfoForOtherChoice);return h?this.getBranchInfoMaster(h).getBranchingResult():{Type:c.BranchingType.Pending}},f.prototype.selected=function(a,b){return b.Description===a},f}(d.MethodDelegatorBase);d.Choice=e,d.registerQuestionDelegatorClass(e)}(d=c.Question||(c.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={})),function(a){var b;!function(a){var b;!function(b){var c;!function(c){function d(c,d){var e=d.ChoiceType===b.ChoiceType.SingleChoice;if(null!=c){var f=a.convertToArray(d.Choices).map(function(a){return a.Description});if(!e||!d.AllowOtherAnswer&&!_.contains(f,c))try{var g=JSON.parse(c);if(Array.isArray(g)){if(!g.some(function(a){return!_.isString(a)}))return{IsSingleChoiceAnswer:!1,IsLegacyChoiceAnswer:!1,SelectedOptions:g}}else if(_.isObject(g)){var h=_.values(g);if(!h.some(function(a){return!_.isString(a)}))return{IsSingleChoiceAnswer:e&&h.length<=1,IsLegacyChoiceAnswer:!0,SelectedOptions:h}}}catch(i){}}return{IsSingleChoiceAnswer:e,IsLegacyChoiceAnswer:!1,SelectedOptions:null==c?[]:[c]}}c.getChoiceAnswer=d}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.getElementTypeName=function(){return b.QuestionType.ChoiceV2},e.createDefaultDefinition=function(){var b=[{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),IsGenerated:!0},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),IsGenerated:!0}];return{Type:c.Choice.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,ChoiceGroup:b}},e.prototype.verify=function(a){return this.Model.Required&&(!a||this.Model.AllowMultipleValues&&0!==[].concat(a).length||!this.Model.AllowMultipleValues&&a==={})?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},e.prototype.isEmpty=function(a){return this.Model.AllowMultipleValues?!a||0!==[].concat(a).length:!a||a==={}},e.prototype.getTypeDisplayName=function(){return this.Model.AllowMultipleValues?a.Resources.LocalizedStrings.QuestionType_MultiChoice:a.Resources.LocalizedStrings.QuestionType_SingleChoice},e.prototype.supportsQuestionLevelBranching=function(){return this.Model.AllowMultipleValues},e.prototype.supportsChoiceLevelBranching=function(){return!this.Model.AllowMultipleValues},e.prototype.getSnapshotWithoutBranchInfo=function(){var b=d.prototype.getSnapshotWithoutBranchInfo.call(this);return b.ChoiceGroup=a.convertToArray(b.ChoiceGroup).map(function(a){return a=_.clone(a),delete a.BranchInfo,a}),b},e.prototype.resetBranchInfo=function(){var b=this;d.prototype.resetBranchInfo.call(this),a.convertToArray(this.Model.ChoiceGroup).filter(function(a){return b.getBranchInfoMaster(a.BranchInfo).resetToDefault()}),this.getBranchInfoMaster(this.Model.BranchInfoForOtherChoice).resetToDefault()},e.prototype.insertChoice=function(a,b){var c=this.Model.ChoiceGroup,d=_.find(c,function(a){return a.IsGenerated});if(d){var e=Nerve.getObjectMasterFromModel(d);e.bulkEdit(function(){d.Description=a,d.IsGenerated=null,d.IsMathOption=b})}else{var f=Nerve.Collection.addItems(c,[{Description:a,IsMathOption:b}]);d=f[0]}return d},e.prototype.hasCorrectAnswers=function(){var a=JSON.parse(this.Model.GradingBasis);return _.some(this.Model.ChoiceGroup,function(b){return-1!==a.indexOf(b.Id)})},e.prototype.isCorrectAnswer=function(a){var b=c.getChoiceV2Answer(a,this.Model),d=JSON.parse(this.Model.GradingBasis).sort();return _.isEqual(d,b.SelectedOptions.sort())},e.prototype.setAnswerKey=function(a,b){var c=JSON.parse(this.Model.GradingBasis),d=c.indexOf(a.Id);b?this.Model.AllowMultipleValues?(c.push(a.Id),this.Model.GradingBasis=JSON.stringify(c)):this.Model.GradingBasis=JSON.stringify([a.Id]):-1!==d&&(this.Model.AllowMultipleValues?(c.splice(d,1),this.Model.GradingBasis=JSON.stringify(c)):this.Model.GradingBasis=JSON.stringify([]))},e.prototype.createQuizResult=function(b){if(this.Model.IsQuiz){var c=a.convertToArray(this.Model.ChoiceGroup);return this.hasCorrectAnswers()?{IsAnswerCorrect:this.isCorrectAnswer(b),AnswerHints:c.map(function(a){return a.AnswerHint}),Choices:c.map(function(a){return a.Description}),GradingBasis:this.Model.GradingBasis}:void 0}},e.prototype.autoGradeAnswer=function(a){if(this.hasCorrectAnswers()){var b=this.Model.Point?this.Model.Point:0;a.Score=this.isCorrectAnswer(a.Answer)?b:0,a.IsAutoGraded=!0}else d.prototype.autoGradeAnswer.call(this,a)},e.prototype.autoGradeWithQuizResult=function(a,b){return b?b.IsAnswerCorrect?this.Model.Point:0:null},e.prototype.getBranchingResult=function(c){var e=this;if(!this.Model.HasValidBranching||this.Model.AllowMultipleValues)return d.prototype.getBranchingResult.call(this,c);var f=a.convertToArray(this.Model.ChoiceGroup),g=f.filter(function(a){return a.BranchInfo&&a.BranchInfo.IsQuestionBranchingValid});if(0===g.length)return d.prototype.getBranchingResult.call(this,c);var h,i=f.filter(function(a){return e.selected(c,a)}),j=_.intersection(i,g);if(j.length>0||i.length>0){var k=j[0]||i[0];h=k.BranchInfo}else this.isEmpty(c)||(h=this.Model.BranchInfo);return h?this.getBranchInfoMaster(h).getBranchingResult():{Type:b.BranchingType.Pending}},e.prototype.selected=function(a,b){return b.Description===a.description},e}(c.MethodDelegatorBase);c.ChoiceV2=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={})),function(a){var b;!function(a){var b;!function(a){var b;!function(a){
function b(a,b){return{IsSingleChoiceAnswer:!b.AllowMultipleValues,IsLegacyChoiceAnswer:!1,SelectedOptions:null==a?[]:[].concat(a)}}a.getChoiceV2Answer=b}(b=a.Question||(a.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.DateTime},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,Date:!0,Time:!1}},d.prototype.verify=function(a){return this.Model.Required&&!a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_DateTime},d}(c.MethodDelegatorBase);c.DateTime=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.FileUpload},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,HasSpecificFileType:!1,FileTypes:{Word:!0,Excel:!0,PowerPoint:!0,PDF:!0,Image:!0,Text:!0,Video:!0,Audio:!0}}},d.prototype.verify=function(a){return this.Model.Required&&!a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_UploadFile},d}(c.MethodDelegatorBase);c.FileUpload=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.getElementTypeName=function(){return a.QuestionType.MatrixChoice},c.prototype.verify=function(b){return!this.Model.Required||b&&0!==b.length?a.QuestionValidationResult.Success:a.QuestionValidationResult.RequiredError},c.prototype.getTypeDisplayName=function(){return"MatrixChoice"},c.prototype.getNormalizedAnswer=function(a){return a},c}(b.MethodDelegatorBase);b.MatrixChoice=c,b.registerQuestionDelegatorClass(c)}(b=a.Question||(a.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.MatrixChoiceGroup},d.createDefaultDefinition=function(){var b=[{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),IsGenerated:!0,Id:1,Order:1},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),IsGenerated:!0,Id:2,Order:2},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(3),IsGenerated:!0,Id:3,Order:3},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(4),IsGenerated:!0,Id:4,Order:4},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(5),IsGenerated:!0,Id:5,Order:5}];return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,ChoiceGroup:b}},d.createSubQuestionsDefinition=function(){var b={Title:a.Resources.LocalizedStrings.Desinger_Likert_DefaultDescription.format(1),Type:"Question.MatrixChoice"},c={Title:a.Resources.LocalizedStrings.Desinger_Likert_DefaultDescription.format(2),Type:"Question.MatrixChoice"};return[b,c]},d.prototype.verify=function(a){return b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_Likert},d}(c.MethodDelegatorBase);c.MatrixChoiceGroup=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.NPS},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.NPS_DefaultTitle,LeftDescription:a.Resources.LocalizedStrings.NPS_LeftDescription,RightDescription:a.Resources.LocalizedStrings.NPS_RightDescription}},d.prototype.verify=function(a){return this.Model.Required&&!a&&0!==a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_NPS},d.prototype.isNumberType=function(){return!0},d}(c.MethodDelegatorBase);c.NPSDelegator=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){var e=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.getElementTypeName=function(){return c.QuestionType.Ranking},e.createDefaultDefinition=function(){var c=[{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),Order:1,Key:a.Utilities.Guid.newGuid()},{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),Order:2,Key:a.Utilities.Guid.newGuid()},{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(3),Order:3,Key:a.Utilities.Guid.newGuid()}];return{Type:e.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle,AllowMultipleValues:!0,ChoiceGroup:c}},e.prototype.verify=function(a){return!this.Model.Required||a&&0!==a.length?c.QuestionValidationResult.Success:c.QuestionValidationResult.RequiredError},e.prototype.getTypeDisplayName=function(){return b.Resources.LocalizedStrings.QuestionType_Ranking},e.prototype.isCorrectAnswer=function(a){var b=this;if(!a)return!1;var c,d=JSON.parse(this.Model.GradingBasis);c=_.isString(a)?JSON.parse(a):_.map(_.sortBy(a,function(a){return a.answerOrder}),function(a){return a.id});var e=_.map(d,function(a){return _.findWhere(b.Model.ChoiceGroup,{Key:a}).Id});return c.length<e.length?!1:(c=_.filter(c,function(a){return _.contains(e,a)}),_.isEqual(e,c))},e.prototype.autoGradeAnswer=function(a){var b=this.Model.Point||0;a.Score=this.isCorrectAnswer(a.Answer)?b:0,a.IsAutoGraded=!0},e.prototype.autoGradeWithQuizResult=function(a,b){return b?b.IsAnswerCorrect?this.Model.Point:0:null},e.prototype.getNormalizedAnswer=function(a){return a||[]},e.prototype.hasCorrectAnswers=function(){return!0},e}(d.MethodDelegatorBase);d.Ranking=e,d.registerQuestionDelegatorClass(e)}(d=c.Question||(c.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.Rating},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,Length:5,RatingShape:b.RatingShape.Star,LeftDescription:"",RightDescription:"",MinRating:1}},d.prototype.verify=function(a){return this.Model.Required&&!a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_Rating},d.prototype.isNumberType=function(){return!0},d}(c.MethodDelegatorBase);c.Rating=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=function(){function b(b,c){this.answer=b,this.id=c||a.Utilities.Guid.newGuid()}return b}();b.ShortTextAnswer=c,a.Exports.Models.ShortTextAnswer=c;var d=function(){function b(c){if(this.possibleCorrectAnswers=[],null!=c.GradingBasis)try{this.possibleCorrectAnswers=JSON.parse(c.GradingBasis)}catch(d){this.possibleCorrectAnswers=[],a.Event.ErrorEvent.logData({type:a.Event.ErrorType.ShortTextGradingBasisJsonParseFailure,errorInfo:{gradingBasisLength:c.GradingBasis.length,nonAsciiDetected:b.doesContainNonAsciiCharacters(c.GradingBasis)}})}else this.possibleCorrectAnswers=[]}return b.prototype.serialize=function(){return JSON.stringify(this.possibleCorrectAnswers)},b.prototype.getAnswers=function(){return _.clone(this.possibleCorrectAnswers)},b.prototype.areAnyAnswersDefined=function(){return 0!==this.possibleCorrectAnswers.length},b.prototype.addAnswer=function(a){return this.isInvalidAnswerCandidate(a)?!1:this.hasAnswerBeenPreviouslyAdded(a)?!1:(this.possibleCorrectAnswers.push(new c(a)),!0)},b.prototype.updateAnswer=function(a,b){if(this.isInvalidAnswerCandidate(b))return!1;if(this.hasAnswerBeenPreviouslyAdded(b,a))return!1;var d=this.getPossibleAnswerIndex(a);if(0>d)return!1;var e=this.possibleCorrectAnswers[d];return this.possibleCorrectAnswers[d]=new c(b,e.id),!0},b.prototype.deleteAnswer=function(a){var b=this.getPossibleAnswerIndex(a);b>=0&&this.possibleCorrectAnswers.splice(b,1)},b.prototype.isCorrect=function(a){return this.isInvalidAnswerCandidate(a)?!1:(a+="",a=a.trim().toUpperCase(),null!=_.find(this.possibleCorrectAnswers,function(b){return b.answer.trim().toUpperCase()===a}))},b.prototype.hasAnswerBeenPreviouslyAdded=function(a,b){a+="";var c=a.toUpperCase();return null!=_.find(this.possibleCorrectAnswers,function(a){return a.answer.toUpperCase()===c&&a.id!==b})},b.prototype.isInvalidAnswerCandidate=function(a){return null==a||""===a},b.prototype.getPossibleAnswerIndex=function(a){return _.findIndex(this.possibleCorrectAnswers,function(b){return b.id===a})},b.doesContainNonAsciiCharacters=function(a){for(var b=0;b<a.length;b++)if(a.charCodeAt(b)>127)return!0;return!1},b}();b.ShortTextAutograder=d,a.Exports.Models.ShortTextAutograder=d}(c=b.Question||(b.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){var d=c.NumberValidationRule[a];return b.Resources.LocalizedStrings["NumberValidation"+d]}d.getLocalizedNumberValidationRuleName=e;var f=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),f.getElementTypeName=function(){return c.QuestionType.TextField},f.createDefaultDefinition=function(){return f.createDefaultSingleLineDefinition()},f.createDefaultSingleLineDefinition=function(){return{Type:f.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle}},f.createDefaultMultiLineDefinition=function(){return{Type:f.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle,Multiline:!0}},f.prototype.verify=function(a){return this.Model.Required&&!a?c.QuestionValidationResult.RequiredError:this.Model.IsNumber&&!this.verifyNumber(a)?c.QuestionValidationResult.NumberValidationError:c.QuestionValidationResult.Success},f.prototype.getTypeDisplayName=function(){return this.Model.Multiline?b.Resources.LocalizedStrings.QuestionType_MultiLineText:this.Model.IsNumber?b.Resources.LocalizedStrings.QuestionType_Number:b.Resources.LocalizedStrings.QuestionType_SingleLineText},f.prototype.isNumberType=function(){return!!this.Model.IsNumber},f.prototype.justifyNumberBoundaries=function(){var b=this;this.Master.bulkEdit(function(){var d=b.Master.Model,e=a.Utilities.NumberValidation.formatAsFloat(d.NumberMinBoundary)||"1",f=a.Utilities.NumberValidation.formatAsFloat(d.NumberMaxBoundary)||"10";switch(d.NumberValidationRule){case c.NumberValidationRule.Greater:case c.NumberValidationRule.GreaterOrEqual:case c.NumberValidationRule.Equal:case c.NumberValidationRule.NotEqual:f=null;break;case c.NumberValidationRule.Less:case c.NumberValidationRule.LessOrEqual:e=null;break;case c.NumberValidationRule.Between:case c.NumberValidationRule.NotBetween:if(parseFloat(e)>parseFloat(f)){var g=e;e=f,f=g}}d.NumberMinBoundary=e,d.NumberMaxBoundary=f})},f.prototype.getNumberValidationErrorMessage=function(){var a=this.Model.NumberValidationRule;if(null!=a){var d=b.Resources.LocalizedStrings["NumberValidation_ErrorMessage_"+c.NumberValidationRule[a]];return d.format(this.Model.NumberMinBoundary,this.Model.NumberMaxBoundary)}},f.prototype.hasCorrectAnswers=function(){if(this.Model.IsQuiz&&!this.Model.Multiline){var a=new d.ShortTextAutograder(this.Model);return a.areAnyAnswersDefined()}return!1},f.prototype.isCorrectAnswer=function(a){if(this.Model.IsQuiz&&!this.Model.Multiline){var b=new d.ShortTextAutograder(this.Model);return b.isCorrect(a)}return e.prototype.isCorrectAnswer.call(this,a)},f.prototype.createQuizResult=function(a){var b=new d.ShortTextAutograder(this.Model);return b.areAnyAnswersDefined()&&this.Model.IsQuiz?{IsAnswerCorrect:this.isCorrectAnswer(a),GradingBasis:this.Model.GradingBasis}:void 0},f.prototype.autoGradeAnswer=function(a){if(this.Model.IsQuiz&&!this.Model.Multiline){var b=new d.ShortTextAutograder(this.Model);if(b.areAnyAnswersDefined()){var c=this.Model.Point?this.Model.Point:0;a.Score=b.isCorrect(a.Answer)?c:0,a.IsAutoGraded=!0}else e.prototype.autoGradeAnswer.call(this,a)}else e.prototype.autoGradeAnswer.call(this,a)},f.prototype.autoGradeWithQuizResult=function(a,b){return b?this.Model.IsQuiz&&!this.Model.Multiline?b.IsAnswerCorrect?this.Model.Point:0:e.prototype.autoGradeWithQuizResult.call(this,a,b):null},f.prototype.verifyNumber=function(b){if(void 0===b||""===b)return!0;if(!a.Utilities.NumberValidation.isFormatedAsFloat(b))return!1;var d=parseFloat(a.Utilities.NumberValidation.formatAsFloat(b)),e=parseFloat(this.Model.NumberMinBoundary),f=parseFloat(this.Model.NumberMaxBoundary);switch(this.Model.NumberValidationRule){case c.NumberValidationRule.None:return!0;case c.NumberValidationRule.Between:return d>=e&&f>=d;case c.NumberValidationRule.NotBetween:return!(d>=e&&f>=d);case c.NumberValidationRule.Greater:return d>e;case c.NumberValidationRule.GreaterOrEqual:return d>=e;case c.NumberValidationRule.Less:return f>d;case c.NumberValidationRule.LessOrEqual:return f>=d;case c.NumberValidationRule.Equal:return d===e;case c.NumberValidationRule.NotEqual:return d!==e;default:return!0}},f}(d.MethodDelegatorBase);d.TextField=f,d.registerQuestionDelegatorClass(f)}(d=c.Question||(c.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=Nerve.Spec,c={Answer:b.reference(),AnswerEntity:b.reference(),BranchedQuestion:b.reference(),NextQuestionInOrder:b.reference(),QuizResult:b.reference()},d=function(b){function c(a,c){var d=b.call(this)||this;return d.calculateNextQuestionCallback=function(){return d.updateBranchedQuestion()},d.question=a,d.question.observe(d.calculateNextQuestionCallback),d.formRuntimeMaster=c,d.addRule({Name:"UpdateBranchedQuestion",onChange:function(a){return d.updateBranchedQuestion()}}),d}return __extends(c,b),Object.defineProperty(c.prototype,"Question",{get:function(){return this.question},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"SubQuestions",{get:function(){return this.Question.SubQuestionMasters},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"SubQuestionRuntimeMasters",{get:function(){var a=this;return this.SubQuestions.map(function(b){return a.getSubQuestionRuntimeById(b.Model.Id)})},enumerable:!0,configurable:!0}),c.prototype.getSubQuestionRuntimeById=function(a){return this.formRuntimeMaster?this.formRuntimeMaster.getOrCreateQuestionRuntimeById(a):null},c.prototype.verifyAnswer=function(){return 0===this.SubQuestionRuntimeMasters.length?this.Question.verify(this.Model.Answer)===a.QuestionValidationResult.Success:this.SubQuestionRuntimeMasters.every(function(b){return b.Question.verify(b.Model.Answer)===a.QuestionValidationResult.Success})},c.prototype.release=function(){this.question.unobserve(this.calculateNextQuestionCallback)},c.prototype.getAnswerEntity=function(){return{Answer:this.Question.getNormalizedAnswer(this.Model.Answer),QuestionId:this.Question.Model.Id}},c.prototype.calculateQuizResultFromModel=function(){0===this.SubQuestionRuntimeMasters.length?this.Model.QuizResult=this.Question.createQuizResult(this.Model.Answer):this.Model.QuizResult={IsAnswerCorrect:!1}},c.prototype.getScore=function(){var a=this.Model.AnswerEntity,b=a&&a.Score;return null!=b?b:this.Question.autoGradeWithQuizResult(this.Model.Answer,this.Model.QuizResult)},c.prototype.createOD4BTempFolder=function(){if(this.formRuntimeMaster)return this.formRuntimeMaster.createOD4BTempFolder();throw Error("No FormRuntimeMaster specified.")},c.prototype.updateBranchedQuestion=function(){var a=this.Model;a.BranchedQuestion=this.Question.getBranchedQuestion(a.Answer,a.NextQuestionInOrder)},c}(Nerve.createObjectMasterClass("QuestionRuntime",c));a.QuestionRuntimeMaster=d}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}function c(b,c){return a.ResponseDataSource.deleteResponses(b.Model.Id,c)}var d=Nerve.Spec,e={Id:d.number({IsKeyField:!0,SourceFieldName:"id"}),Comments:d.collectionOf(function(){return a.CommentMaster},{SourceFieldName:"comments"}),AnswersAsString:d.string({SourceFieldName:"answers"}),StartDateAsString:d.string({SourceFieldName:"startDate"}),SubmitDateAsString:d.string({SourceFieldName:"submitDate"}),Responder:d.string({SourceFieldName:"responder"}),ResponderName:d.string({SourceFieldName:"responderName"}),QuizResult:d.string({SourceFieldName:"quizResult"}),ReleaseDateAsString:d.string({SourceFieldName:"releaseDate"}),Answers:d.collectionOf({QuestionId:d.string({IsKeyField:!0,SourceFieldName:"questionId"}),Answer:d.reference({SourceFieldName:"answer1"}),Feedback:d.string({IsLocalField:!0}),Score:d.number({IsLocalField:!0}),IsAutoGraded:d["boolean"]({IsLocalField:!0})},{IsLocalField:!0}),StartDate:d.reference({IsLocalField:!0}),SubmitDate:d.reference({IsLocalField:!0}),ReleaseDate:d.reference({IsLocalField:!0}),Feedback:d.string({IsLocalField:!0}),TotalScore:d.number({IsLocalField:!0}),IntegratedSavingState:d.enumeration(function(){return a.SavingState},{IsLocalField:!0}),SavingState:d.enumeration(function(){return a.SavingState},{IsLocalField:!0})};e.Answers[0];a.getResponseMaster=b,a.deleteResponses=c;var f=function(b,c){return new a.ResponseDataSource(b,c)},g=function(b){function c(d){var e=this,f=$.Deferred();return e=b.call(this,d,{Scheduler:new a.Scheduler,MasterReady:f.promise()})||this,e.initializeSavingStateIntegration(),c.Rules.forEach(function(a){return e.addRule(a)}),f.resolve(),e}return __extends(c,b),Object.defineProperty(c.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ResponseId",{get:function(){return this.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Comment",{get:function(){return this.getCommentByQuestionId(null)},enumerable:!0,configurable:!0}),c.prototype.updateWithNormalizedResponse=function(a){var b=this;this.bulkEdit(function(){b.Synchronizer.onSourceDataReceived(Nerve.convertToSourceData(a,c.Schema)),b.setData(a)})},c.prototype.getAnswerByQuestionId=function(a){var b=Nerve.Collection.getItemWithKeyFields(this.Model.Answers,{QuestionId:a});return b&&Nerve.getObjectMasterFromModel(b)},c.prototype.getCommentByQuestionId=function(b){var c=Nerve.Collection.getItemWithKeyFields(this.Model.Comments,{QuestionId:b});return c&&a.getCommentMaster(c)},c.prototype.setAnswerGrading=function(a,b,c){var d=this.Form.getQuestionById(a),e=d.SubQuestionMasters;e.length>0&&(a=e[e.length-1].Model.Id);var f=this.getCommentByQuestionId(a);if(f)f.bulkEdit(function(){f.Model.Score=b,f.Model.Feedback=c});else{var g={QuestionId:a,Feedback:c,Score:b};Nerve.Collection.addItems(this.Model.Comments,[g])}},c.prototype.initializeSavingStateIntegration=function(){var b=this;this.commentsSavingState=a.SavingState.Idle;var c=Nerve.getCollectionMasterFromModel(this.Model.Comments);a.observeIntegratedSavingState(c,c.Schema[0].SavingState,function(a){b.commentsSavingState=a,b.updateIntegratedSavingState()}),a.keepSavingStateUpdated(this),this.updateIntegratedSavingState()},c.prototype.ensureAnswerByQuestionId=function(a){var b=this.getAnswerByQuestionId(a);if(b)return b;var c=Nerve.Collection.addItems(this.Model.Answers,[{QuestionId:a}])[0];return Nerve.getObjectMasterFromModel(c)},c.prototype.updateIntegratedSavingState=function(){this.Model.IntegratedSavingState=a.integrateSavingState([this.Model.SavingState,this.commentsSavingState])},Object.defineProperty(c,"Rules",{get:function(){if(!c.rules){var a=c.Schema;c.rules=[{Name:"ResponseComment",InterestedFields:[a.Feedback,a.TotalScore],onChange:function(a){var b=a.Master,c=b.getCommentByQuestionId(null);c?c.bulkEdit(function(){c.Model.Feedback=b.Model.Feedback,c.Model.Score=b.Model.TotalScore}):Nerve.Collection.addItems(b.Model.Comments,[{QuestionId:null,Feedback:b.Model.Feedback,Score:b.Model.TotalScore}])}},{Name:"AnswerComment",InterestedFields:[a.Answers[0].Feedback,a.Answers[0].Score,a.Answers[0].IsAutoGraded],onChange:function(a){var b=a.Master,c=b.Model.Answers,d=function(a){a.IsAutoGraded||b.setAnswerGrading(a.QuestionId,a.Score,a.Feedback)};a.SubChanges.filter(function(a){return a.Master.Model===c}).forEach(function(a){a.AddedModels.forEach(d),a.SubChanges.forEach(function(a){return d(a.Master.Model)})})}},{Name:"ApplyCommentChange",InterestedFields:[a.Comments],onChange:function(a){var b=a.Master,c=b.Model.Comments,d=function(a){var c=a.QuestionId;if(c){var d=b.ensureAnswerByQuestionId(c);d.bulkEdit(function(){d.Model.Feedback=a.Feedback,d.Model.Score=a.Score,d.Model.IsAutoGraded=!1})}else b.bulkEdit(function(){b.Model.Feedback=a.Feedback,b.Model.TotalScore=a.Score})};a.SubChanges.filter(function(a){return a.Master.Model===c}).forEach(function(a){a.AddedModels.forEach(d),a.SubChanges.forEach(function(a){return d(a.Master.Model)})})}}],c.rules=c.rules.concat(c.getRulesForSyncBetweenDateFields(a.StartDate,a.StartDateAsString),c.getRulesForSyncBetweenDateFields(a.SubmitDate,a.SubmitDateAsString),c.getRulesForSyncBetweenDateFields(a.ReleaseDate,a.ReleaseDateAsString))}return c.rules},enumerable:!0,configurable:!0}),c.getRulesForSyncBetweenDateFields=function(a,b){var c=Nerve.getFieldSchemaInfo(a).Name,d=Nerve.getFieldSchemaInfo(b).Name;return[{Name:"update "+c,InterestedFields:[b],onChange:function(a){var b=a.Master.Model;b[c]=new Date(b[d])}},{Name:"update "+d,InterestedFields:[a],onChange:function(a){var b=a.Master.Model;b[d]=b[c].toISOString()}}]},c}(Nerve.createObjectMasterClass("Response",e,f));a.ResponseMaster=g}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){function c(a){var b=a.Synchronizer;b.observe(function(){return f(a)},[b.Schema.CreationFailed,b.Schema.CreationInProcess,b.Schema.CreationScheduled,b.Schema.UpdateFailed,b.Schema.UpdateInProcess,b.Schema.UpdateScheduled]),f(a)}function d(b,c,d){function f(){var a=g.map(function(a){return a.getModelByFieldSchema(c)});d(e(a))}var g=a.convertToArray(b.Model).map(Nerve.getObjectMasterFromModel);f(),b.observe(function(a){a.AddedModels.length&&(g=g.concat(a.AddedModels.map(Nerve.getObjectMasterFromModel))),a.RemovedModels.length&&a.RemovedModels.map(Nerve.getObjectMasterFromModel).forEach(function(a){a.Synchronizer.deletedFromDataSource().done(function(){g=_.without(g,a),f()})}),f()},[c])}function e(a){return _.contains(a,g.Saving)?g.Saving:_.contains(a,g.Scheduled)?g.Scheduled:_.contains(a,g.Failed)?g.Failed:g.Idle}function f(a){var b=a.Synchronizer.Model;b.CreationInProcess||b.UpdateInProcess?a.Model.SavingState=g.Saving:b.CreationScheduled||b.UpdateScheduled?a.Model.SavingState=g.Scheduled:b.CreationFailed||b.UpdateFailed?a.Model.SavingState=g.Failed:a.Model.SavingState=g.Idle}var g;!function(a){a[a.Idle=0]="Idle",a[a.Scheduled=1]="Scheduled",a[a.Saving=2]="Saving",a[a.Failed=3]="Failed"}(g=b.SavingState||(b.SavingState={})),b.keepSavingStateUpdated=c,b.observeIntegratedSavingState=d,b.integrateSavingState=e}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(){return g||(g=new h)}function d(a){var c=parseInt(a);return isNaN(c)||c<b.MAXRUNVERSION}var e=Nerve.Spec,f={ExportToExcelCalloutVersion:e.string(),NewFormTeachingCalloutVersion:e.string(),SendTeachingCalloutVersion:e.string(),WhatsNewVersion:e.string(),PortalFormIntroduction:e.string(),PreviewLabelForSurvey:e.string()};b.MAXRUNVERSION=2;var g;b.getUserProfileMaster=c,b.isVersionOk=d;var h=function(b){function c(){var a=b.call(this,{InitialData:c.getInitialData()})||this;return a.observe(c.onChange),a}return __extends(c,b),c.getInitialData=function(){var b=a.SafeStorage.DefaultStorage,d={};return Object.keys(c.Schema).forEach(function(a){return d[a]=b.getItem(a)}),d},c.onChange=function(b){var c=a.SafeStorage.DefaultStorage;b.FieldSchemas.map(Nerve.getFieldSchemaInfo).map(function(a){return a.Name}).forEach(function(a){return c.setItem(a,b.NewValues[a])})},c}(Nerve.createObjectMasterClass("UserProfileMaster",f));b.UserProfileMaster=h}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return a&&a[e]}b.getMasterFromModel=c;var d=function(){function b(b){var c=this;this.instanceId=a.Utilities.Guid.newGuid(),this.values=[],this.allFields=[],this.changedFieldNames={},this.observers=[],this.bulkChangingModeStackedCount=0;var d=this.FieldOptions||{};this.arrayFields=[],this.fieldsEnumType=b,this.allFields=a.Utilities.getAllEnumValues(b),d.ArrayFields&&d.ArrayFields.forEach(function(a){return c.arrayFields[a.Field]=a}),this.enumFields=[],d.EnumFields&&d.EnumFields.forEach(function(a){var b=a.EnumField,d=a.StringField;c.enumFields[b]=c.enumFields[d]=_.clone(a),a.EnumType[a.DefaultValue]&&(c.values[b]=a.DefaultValue,c.values[d]=a.EnumType[a.DefaultValue])});var f=this.values.map(function(a,b){return b});this.snapshotBeforeChange=this.getSnapshot(f),this.changeNotifier=new a.Utilities.Process.CallLater(function(){return c.notifyChange()}),this.model={},Object.defineProperty(this.model,e,{get:function(){return c},enumerable:!1,configurable:!1});var g=this.toJSON.bind(this);Object.defineProperty(this.model,"toJSON",{get:function(){return g},enumerable:!1,configurable:!1}),this.allFields.forEach(function(a){var d=b[a];Object.defineProperty(c.model,d,{get:function(){return c.getFieldValue(a)},set:function(b){return c.setFieldValue(a,b)},enumerable:!0,configurable:!0})})}return b.prototype.getInstanceId=function(){return this.instanceId},Object.defineProperty(b.prototype,"Model",{get:function(){return this.model},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FieldsEnumType",{get:function(){return this.fieldsEnumType},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"AllFields",{get:function(){return _.clone(this.allFields)},enumerable:!0,configurable:!0}),b.prototype.toJSON=function(){return this.getSnapshot()},b.prototype.getSnapshot=function(b){var c=this;b=b||a.Utilities.getAllEnumValues(this.fieldsEnumType);var d={};return b.forEach(function(a){d[c.fieldsEnumType[a]]=c.getFieldValue(a)}),d},b.prototype.setData=function(b,c){var d=this;if(b){var e;e=c?c.map(function(a){return d.FieldsEnumType[a]}):_.intersection(_.keys(b),a.Utilities.getAllEnumValueNames(this.FieldsEnumType)),this.startBulkEditMode(),e.forEach(function(a){d.Model[a]=b[a]}),this.endBulkEditMode()}},b.prototype.getFieldValue=function(a){var b=this.values[a];return this.isArrayField(a)&&(b=_.clone(b)||[]),b},b.prototype.setFieldValue=function(a,b){var c=a,d=this.values[c]===b,e=this.isArrayField(a);if(e){if(b=b||[],!_.isArray(b))throw Error('Type of field named "'+this.fieldsEnumType[c]+'" should be an array.');var f=this.values[c]||[];d=f.length===b.length,d=d&&!f.some(function(a,c){return a!==b[c]})}if(!d){var g=this.enumFields[a];if(g){var h=a===g.EnumField?b:g.EnumType[b];this.values[g.EnumField]=h,this.values[g.StringField]=g.EnumType[h],this.markFieldAsChanged([g.EnumField,g.StringField])}else e?this.onArrayFieldChange(c,b):this.values[c]=b,this.markFieldAsChanged([a])}},b.prototype.onArrayFieldChange=function(a,b){var c=this.arrayFields[a],d=this.values[a]||[];b=c.onAdd?b.map(function(a){return _.contains(d,a)?a:c.onAdd(a,b,d)}):_.clone(b),c.onDelete&&_.difference(d,b).forEach(function(a){c.onDelete(a,b,d)||b.push(a)}),c.comparer&&b.sort(c.comparer);var e=b.length===d.length&&!b.some(function(a,b){return a!==d[b]});e||(c.adjust&&(b=c.adjust(b)),this.values[a]=b)},b.prototype.observe=function(a,b){b&&b.length||(b=this.AllFields);var c=this.findObserver(a);c?c.Fields=_.union(c.Fields,b):(c={Callback:a,Fields:b},this.observers.push(c))},b.prototype.unobserve=function(a,b){var c=this.findObserver(a);if(c){if(b&&b.length&&(c.Fields=_.difference(c.Fields,b),c.Fields.length))return;this.observers=_.without(this.observers,c)}},b.prototype.triggerChangeNotificationImmediately=function(){this.changeNotifier.callImmediately()},b.prototype.startBulkEditMode=function(){++this.bulkChangingModeStackedCount},b.prototype.endBulkEditMode=function(){--this.bulkChangingModeStackedCount<=0&&(this.bulkChangingModeStackedCount=0,this.changeNotifier.flush())},Object.defineProperty(b.prototype,"FieldOptions",{get:function(){return{ArrayFields:[],EnumFields:[]}},enumerable:!0,configurable:!0}),b.prototype.isArrayField=function(a){return!!this.arrayFields[a]},b.prototype.markFieldAsChanged=function(a){var b=this;a.forEach(function(a){return b.changedFieldNames[b.fieldsEnumType[a]]=!0}),this.bulkChangingModeStackedCount>0?this.triggerChangeNotificationLater():this.triggerChangeNotificationImmediately()},b.prototype.triggerChangeNotificationLater=function(){this.changeNotifier.callOnceLater()},b.prototype.asInterface=function(){return this},b.prototype.notifyChange=function(){var a=this,b=this.snapshotBeforeChange,c=this.getSnapshot(),d=_.keys(this.changedFieldNames).map(function(b){return a.fieldsEnumType[b]});this.snapshotBeforeChange=c,this.changedFieldNames={},this.bulkChangingModeStackedCount=0,this.observers.forEach(function(e){var f=_.intersection(e.Fields,d);f.length&&e.Callback({Master:a.asInterface(),FieldSchemas:d,NewValues:c,OldValues:b})})},b.prototype.findObserver=function(a){return this.observers.filter(function(b){return b.Callback===a})[0]},b}();b.MasterBase=d;var e="__master__"}(c=b.Model_v2||(b.Model_v2={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}a.Exports.createErrorPage=c,b.createErrorPage=c;var d=a.DataProvider.ErrorCode.InnerCode,e=function(c){function e(a){var b=c.call(this,a)||this;return b.state={showErrorDetail:!1},b}return __extends(e,c),e.prototype.componentDidMount=function(){var b=this.props.Error;a.Event.EngagementEvent.logData({name:"Error"===this.props.ErrorType?a.Event.EngagementEventNames.Error.ErrorPage.Error:a.Event.EngagementEventNames.Error.ErrorPage.Information,
extraData:{Error:b,ErrorTitle:this.props.ErrorTitle,ErrorMessage:this.props.ErrorMessage,stack:b&&b.stack}}),a.Utilities.OEmbed.notifyResponsePageFixedHeightToParentWindow(450)},e.prototype.render=function(){var c,f=this.props.Error||{},g=b.Resources.LocalizedStrings["Error_Message_"+f.innerCode+"_title"]||b.Resources.LocalizedStrings.Error_Page_DefaultErrorTitle,h=b.Resources.LocalizedStrings["Error_Message_"+f.innerCode],i=e.getErrorMessage(this.props.Error),j=this.props.ErrorType;"Error"===j?(g=g||b.Resources.LocalizedStrings.Error_Page_DefaultErrorTitle,h=h||i):"Information"===j&&(g?h=h||i:g=i);var k=void 0;if(this.props.ShowCreateFormLink&&this.props.IsResponsePage&&f.name!==b.ClientErrorNames.LoginIECrossZoneError&&f.name!==b.ClientErrorNames.ThirdPartyCookieBlockedError&&f.name!==b.ClientErrorNames.AuthNoStorageError&&f.name!==b.ClientErrorNames.AADAcquireTokenMfaCheckError&&f.name!==b.ClientErrorNames.TeamSiteNoGroupError&&f.innerCode!==d.DisabledByTenantAdmin&&f.innerCode!==d.LoginNotSupportInCurrentBrowser&&(k=this.createPropotionMessage()),f.innerCode===d.NoPermission)this.props.IsResponsePage?(g=b.Resources.LocalizedStrings["Error_Message_"+f.innerCode+"_title_2"],h=void 0):this.props.IsAnalysisPage?(g=b.Resources.LocalizedStrings["Error_Message_"+f.innerCode+"_title_3"],h=void 0):g=b.Resources.LocalizedStrings["Error_Message_"+f.innerCode+"_title_1"];else if(f.innerCode===d.FormClosed){var l="This form is closed."===f.innerMessage;if(l)g=b.Resources.LocalizedStrings.Error_Message_FormClosed;else{var m="Inner Message:",n=f.innerMessage.indexOf("Inner Message:")+m.length,o=f.innerMessage.length;g=f.innerMessage.substring(n,o).trim()}h=""}else f.innerCode===d.ExceedMaximumFormLimition&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.RecycleBin)&&(h=b.Resources.LocalizedStrings["Error_Message_"+f.innerCode+"_recyclebin"]);f.message===b.Resources.LocalizedStrings.Error_Message_FormClosed&&(g=f.message),(f.innerCode===d.FormEnded||f.innerCode===d.FormNotStarted)&&(g=b.Resources.LocalizedStrings["Error_Message_"+f.innerCode+"_title"],h=""),(f.message===b.Resources.LocalizedStrings.TakeATest_Win10||f.message===b.Resources.LocalizedStrings.TakeATest_NotWin10)&&(g=f.message,h=b.Resources.LocalizedStrings.TakeATest_Subtitle,c=this.createLinkMessage(b.Resources.LocalizedStrings.TakeATest_LearnMore,b.Resources.LocalizedStrings.TakeATest_LearnMoreLink,!0,a.Event.EngagementEventNames.ResponsePage.ThanksView.LearnMoreForTakeATest));var p=this.createErrorDetail();return f.innerCode===d.LoginNotSupportInCurrentBrowser&&(g="",h=React.DOM.div({dangerouslySetInnerHTML:{__html:h}}),p=void 0),React.DOM.div({className:a.Utilities.isOEmbedSPO()?"office-form-page-padding office-form-error-page-container office-form-spo-embed":"office-form-page-padding office-form-error-page-container"},React.DOM.div({className:"office-form office-form-info-container"},g&&React.DOM.div({className:"office-form-info-title"},g),h&&React.DOM.div({className:"office-form-info-subtitle"},h),c&&React.DOM.div({className:"office-form-info-subtitle"},c),p,React.DOM.div({className:"office-form-info-other"},k),!a.Utilities.isOEmbedSPO()&&Forms.UX.Renderer.createFooter()))},e.getErrorMessage=function(c){var d=void 0;if(c)if(c.correlationId){var e=c;e.innerCode&&(d=b.Resources.LocalizedStrings["Error_Message_"+e.innerCode]||b.Resources.LocalizedStrings.Error_Message_Default.format(e.innerCode))}else{var f=c;switch(f.name){case b.ClientErrorNames.LoginIECrossZoneError:d=b.Resources.LocalizedStrings.Error_Message_Client_LoginIECrossZoneError.format(a.Authenticator.getProtocol()+window.location.host,a.EnvironmentConfig.getAadInstance());break;case b.ClientErrorNames.ThirdPartyCookieBlockedError:d=b.Resources.LocalizedStrings.Error_Message_Client_ThirdPartyCookieError.format(a.EnvironmentConfig.getAadInstance());break;case b.ClientErrorNames.AuthNoStorageError:d=b.Resources.LocalizedStrings.Error_Message_Client_AuthNoStorageError;break;case b.ClientErrorNames.AADAcquireTokenMfaCheckError:d=b.Resources.LocalizedStrings.Error_Message_705;break;case b.ClientErrorNames.TeamSiteNoGroupError:d=b.Resources.LocalizedStrings.Error_Message_Client_TeamSiteNoGroupError}}return d},e.prototype.getTechnicalMessage=function(){var c=this.props.Error;return c?c.correlationId?b.Resources.LocalizedStrings.Error_TechnicalMessage2.format(a.Telemetry.getCurrentSessionId(),c.correlationId):b.Resources.LocalizedStrings.Error_TechnicalMessage.format(a.Telemetry.getCurrentSessionId()):void 0},e.prototype.createErrorDetail=function(){var c=this;if("Information"===this.props.ErrorType)return void 0;var e,f=this.getTechnicalMessage(),g=a.Control.createGlyphButton({HTMLAttributes:{onClick:function(){return c.setState({showErrorDetail:!c.state.showErrorDetail})}},Icon:this.state.showErrorDetail?"ChevronUp":"ChevronDown",IconClassName:"office-form-info-error-detail-button office-form-info-error-children forms-icon-size12x12",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly});this.state.showErrorDetail&&(e=React.DOM.div({className:"office-form-info-error-detail"},f));var h=null;return this.props.Error.innerCode===d.NotRolloutMsaUser&&(a.DataProvider.AuthTokenHelper.signOutInIframe(),h=React.DOM.div({className:"office-form-info-signin"},a.Control.createTextButton({HTMLAttributes:{onClick:a.DataProvider.AuthTokenHelper.signInWithOtherAccount,className:"office-form-info-signin-button"},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Error_Message_BackToLoginButton}))),React.DOM.div({className:"office-form-info-error-detail-container"},g,React.DOM.span({className:"office-form-info-error-children office-form-info-children"},b.Resources.LocalizedStrings.Error_More_Detail),e,h)},e.prototype.createPropotionMessage=function(){if(this.props.IsResponsePage&&!a.Utilities.Flight.isPPTIntegration()&&!a.EnvironmentSettings.IsAssignmentsIntegration){var c="DesignPage.aspx",d=a.Utilities.isOEmbed()||a.Utilities.isOEmbedSPO();if(d){var e=a.Utilities.getNonEmbedQuery(),f="../Pages/DesignPage.aspx?"+jQuery.param(e);c=a.Utilities.Html.getAbsoluteUrl(f)}return this.createLinkMessage(b.Resources.LocalizedStrings.Renderer_PromotionMessage,c,d)}},e.prototype.createLinkMessage=function(b,c,d,e){var f="office-form-info-premotion office-form-info-children";return a.Utilities.isOEmbedSPO()&&(f=a.Utilities.Html.combineAttributes(f,"office-form-theme-spo-link")),React.DOM.div(null,React.DOM.a({className:f,onClick:function(){a.Event.EngagementEvent.logData({name:e?e:a.Event.EngagementEventNames.ResponsePage.ThanksView.NavigateToPortal});var b=d?"_blank":"_self";a.Utilities.Html.safeOpen(c,b)}},b))},e}(a.ReactComponent)}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(g,a)}var d,e=a.DataProvider.ErrorCode.InnerCode;!function(a){a[a.Desktop=0]="Desktop",a[a.Mobile=1]="Mobile",a[a.Auto=2]="Auto"}(d=b.ViewMode||(b.ViewMode={}));var f;!function(a){a[a.NotSubmitted=0]="NotSubmitted",a[a.Submitting=1]="Submitting",a[a.Failed=2]="Failed",a[a.Succeed=3]="Succeed",a[a.SucceedWithQuizResult=4]="SucceedWithQuizResult"}(f=b.SubmitState||(b.SubmitState={})),b.createFormRenderer=c;var g=function(c){function g(a){var b=c.call(this,a)||this;return b.updateScreenSizeClassCallback=function(){return b.updateScreenSizeClass()},b.updateBranchingCallback=function(){return b.forceUpdate()},b.answerChangeCallback=function(){return b.onAnswersChanged()},b.increaseUploadingFileCountCallBack=function(){return b.increaseUploadingFileCount()},b.decreaseUploadingFileCountCallBack=function(){return b.decreaseUploadingFileCount()},b.update=function(){return b.forceUpdate()},b.state={AnsweredQuestionCount:0,IsSmallScreen:$(window).width()<768,SubmitState:f.NotSubmitted,ShowDuplicateSpinner:!1,ShowErrorPage:!1,IsStudentViewMode:null!=b.props.Response,IsReportingView:!1,HideQuestions:!1},b.onThankYouViewResult=b.onThankYouViewResult.bind(b),b.onBackButtonClick=b.onBackButtonClick.bind(b),b}return __extends(g,c),g.prototype.componentWillMount=function(){this.formRuntimeMaster=new b.Model.FormRuntimeMaster(this.props.Master),this.state.IsStudentViewMode?(this.resetAnswers(this.props.Response.Answers),this.formRuntimeMaster.updateWithResponse(this.props.Response),this.setServerQuizResult(this.props.Response.QuizResult),this.setState({ShowQuizResult:!0})):this.resetAnswers(this.props.PersistedAnswers),this.formRuntimeMaster.observeAnswerChange(this.answerChangeCallback),this.formRuntimeMaster.observe(this.updateBranchingCallback,[b.Model.FormRuntimeMaster.Schema.QuestionRuntimeMasters]),this.formRuntimeMaster.observe(this.update,[b.Model.FormRuntimeMaster.Schema.UploadingFileCount]),window.addEventListener("resize",this.updateScreenSizeClassCallback)},g.prototype.componentDidMount=function(){a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow(),this.updateProgressBar()},g.prototype.componentDidUpdate=function(){a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow(),this.updateProgressBar(),$(".office-form-answerhint").linkify();var b=ReactDOM.findDOMNode(this.refs["office-form-quiz-result-container"]);b&&b.focus();var c=ReactDOM.findDOMNode(this.refs["auto-release-grade-quiz-result-container"]);c&&c.focus()},g.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateScreenSizeClassCallback),this.formRuntimeMaster.unobserveAnswerChange(this.answerChangeCallback),this.formRuntimeMaster.unobserve(this.updateBranchingCallback),this.formRuntimeMaster.unobserve(this.update),this.formRuntimeMaster.release()},g.prototype.render=function(){var c=this,e=this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm;if(this.state.ShowErrorPage)return b.createErrorPage({Error:this.error,ErrorType:"Information",FormId:this.props.Master.Model.Id,ShowCreateFormLink:!1});var g,h={className:"office-form-content office-form-page-padding",onScroll:function(){return c.updateProgressBar()}};if(e&&(h.className=a.Utilities.Html.combineAttributes(h.className,"share-page")),(this.props.ViewMode===d.Mobile||this.state.IsSmallScreen)&&(h.className=a.Utilities.Html.combineAttributes(h.className,"small-screen")),this.isMobile()&&(h.className=a.Utilities.Html.combineAttributes(h.className,"mobile-view")),this.state.SubmitState===f.Succeed||a.Flighting.Flight.isEnabled(a.Flighting.Flights.ThankYou)&&this.state.SubmitState===f.SucceedWithQuizResult&&!this.state.ShowQuizResult){var i=void 0;this.props.Master.Model.Settings.RequiresUniqueResponse||(i=function(){return c.submitAnotherResponse()});var j=void 0;this.state.SubmitState===f.SucceedWithQuizResult&&(j=this.onThankYouViewResult),g=a.Flighting.Flight.isEnabled(a.Flighting.Flights.ThankYou)?React.createElement(Forms.UX.Renderer.ThankYouPage,{FormMaster:b.Model.exportConverter(this.props.Master),ShowPromotionMessage:!a.Utilities.Flight.isPPTIntegration(),submitAnother:i,viewResultsHandler:j}):b.createThankYouPage({ShowPromotionMessage:a.Utilities.Flight.isPPTIntegration()?!1:!0,submitAnother:i,PrivacyUrl:this.props.Master.Model.PrivacyUrl})}else if(this.state.IsReportingView)g=b.createReportPage({Callback:function(){return c.setState({IsReportingView:!1})},StatementUrl:this.props.Master.Model.PrivacyUrl});else{var k;a.Utilities.Flight.isProgressBarEnabled()&&(k=this.createProgressBar());var l="ShowStatementWithNotice";this.props.Master.SyncContext===b.Model.FormSyncContext.ResponseTimeForm&&this.props.Master.Model.Settings.IsAnonymous&&(l="ShowStatement"),g=React.DOM.div(null,React.DOM.div({className:"office-form office-form-theme-shadow",role:"form"},k,this.createTitleContainer(),this.createResultContainer(),React.DOM.div({className:"office-form-body"},this.createNoticeContainer(),React.DOM.div(null,this.state.HideQuestions?void 0:this.createElementRenderers()),this.createSubmitButton(),this.showDuplicateMessage(),this.createValidationErrorLabel(),this.createErrorMessage(),this.createPhishingNotice(),this.createBackToThankYouLink())),a.Flighting.Flight.isEnabled(a.Flighting.Flights.ThankYou)||this.createBottomBar(),Forms.UX.Renderer.createFooter({FooterType:l}))}return React.DOM.div({className:"form-content-container"},this.createDuplicateNavBar(),React.DOM.div(h,this.props.HeaderMessage&&this.createHeader(),b.createThemeRender({ThemeMaster:this.props.Master.ThemeMaster}),g))},g.prototype.onThankYouViewResult=function(){this.setState({ShowQuizResult:!0})},g.prototype.createBackToThankYouLink=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.ThankYou)&&this.state.ShowQuizResult?React.DOM.div({className:"office-form-quiz-back-to-result-link"},React.DOM.a({href:"javascript:void(0)",onClick:this.onBackButtonClick},b.Resources.LocalizedStrings.Response_Page_Quiz_Result_Back_To_Thank_You_Message)):void 0},g.prototype.onBackButtonClick=function(){this.setState({ShowQuizResult:!1})},g.prototype.createHeader=function(){return React.DOM.div({className:"form-header-text-message"},this.props.HeaderMessage)},g.prototype.createDuplicateSpinner=function(){return this.state.ShowDuplicateSpinner?React.DOM.div({className:"duplicate-form-spinner"},React.DOM.div({className:"spinner-tile-animation"})):void 0},g.prototype.createDuplicateNavBar=function(){var c=this,d=this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm;if(d){var e=a.Control.createFontIconControl({HTMLAttributes:{className:"duplicate-form-nav-bar-icon"},IconName:"OfficeFormsLogo"}),f=React.DOM.span({className:"duplicate-form-nav-bar-title"},b.Resources.LocalizedStrings.DuplicateForm_Page_Nav_Bar_Title),g=a.Control.createTextButton({HTMLAttributes:{className:"office-form-copy-form-button",titel:b.Resources.LocalizedStrings.DuplicateForm_Page_Duplicate_Button_Text,onClick:function(){return c.duplicateForm()},disabled:this.state.ShowDuplicateSpinner},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.DuplicateForm_Page_Duplicate_Button_Text});return React.DOM.div({className:"office-form-duplicate-form-container"},React.DOM.div({className:"office-form-duplicate-form-content"},e,f,React.DOM.div({className:"office-form-duplicate-form-button-container"},g,this.createDuplicateSpinner())))}},g.prototype.showDuplicateMessage=function(){var a=this;return this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm?React.DOM.div({className:"office-form-duplicate-message-container"},React.DOM.span(null,b.Resources.LocalizedStrings.DuplicateForm_Page_Nav_Bar_Title),React.DOM.div({className:"office-form-duplicate-form-duplicate-link office-form-theme-primary-foreground",onClick:function(){return a.duplicateForm()},disabled:this.state.ShowDuplicateSpinner},b.Resources.LocalizedStrings.DuplicateForm_Page_Duplicate_Button_Text)):void 0},g.prototype.duplicateForm=function(){var c=this,d=a.Utilities.Guid.newGuid();window.sessionStorage.setItem("FormCopy.GUID",d),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ShareFormPage.Copy.DuplicateButton,extraData:{CopyCorelationID:d,Time:(new Date).toUTCString()}});var e=this.props.Master;this.setState({ShowDuplicateSpinner:!0}),b.Model.FormDataSource.getDataProviderByFormId(e.Model.Id).getSharedForm(e.Model.Id).done(function(){var b=e.getSnapshotToCopy();if(window.sessionStorage.setItem("FormCopy.FormModelToJSON",JSON.stringify(b)),a.DataProvider.AuthTokenHelper.getInstance().isUserLoggedIn())a.Authenticator.redirectToDesignPage();else if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)){var c=window.sessionStorage.getItem("FormCopy.GUID");a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ShareFormPage.Copy.LoginToAutoCopy,extraData:{CopyCorelationID:c,Time:(new Date).toUTCString()}}),window.sessionStorage.setItem("FormCopy.LoginToAutoCopy",JSON.stringify("LoginToAutoCopy")),a.DataProvider.AuthTokenHelper.getInstance().redirectToSignIn(a.DataProvider.AuthTokenHelper.DesignPageURL)}else a.Authenticator.redirectToDesignPage()}).fail(function(a){c.error=a,c.setState({ShowErrorPage:!0,ShowDuplicateSpinner:!1})})},g.prototype.createProgressBar=function(){if(this.props.Master.Model.HasValidBranching||this.state.SubmitState!==f.NotSubmitted)return void 0;var a=this.formRuntimeMaster.TopQuestionRuntimeMasters.length,b=0;return a&&(b=this.state.AnsweredQuestionCount/a*100),React.DOM.div({ref:"progress-bar",className:"office-form-progress-container office-form-page-padding"},React.DOM.div({className:"office-form-progress-bar office-form-theme-primary-background"},React.DOM.div({className:"office-form-progress office-form-theme-secondary-background",style:{width:b+"%"}})))},g.prototype.createNoticeContainer=function(){return this.state.SubmitState===f.SucceedWithQuizResult||this.state.IsStudentViewMode?void 0:React.DOM.div({className:"office-form-notice-container"},this.createRecordIdentityNotice(),this.createRequiredNotice())},g.prototype.createRecordIdentityNotice=function(){var c=this.props.Master.Model.Settings,d=this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm;if(d)return void 0;var e=void 0;if(c.IsAnonymous||c.NotRecordIdentity)e="";else{var g=OfficeFormServerInfo.userInfo.GivenName||OfficeFormServerInfo.userInfo.DisplayName;g?e=b.Resources.LocalizedStrings.Response_NonAnonymous_Notice.format(g):(a.Event.ErrorEvent.logData({type:a.Event.ErrorType.MissingUserName,errorInfo:{givenName:!!OfficeFormServerInfo.userInfo.GivenName,displayName:!!OfficeFormServerInfo.userInfo.DisplayName,userId:!!OfficeFormServerInfo.userInfo.UserId}}),e=b.Resources.LocalizedStrings.Response_NonName_Notice)}return this.state.SubmitState!==f.SucceedWithQuizResult?React.DOM.div({},React.DOM.span({className:"office-form-notice-long-text"},e)):void 0},g.prototype.createRequiredNotice=function(){return _.some(this.props.Master.Model.Questions,function(a){return a.Required})?React.DOM.div(null,React.DOM.span({className:"office-form-required-notice-star"}),React.DOM.span(null,b.Resources.LocalizedStrings.Answer_Required_Notice)):void 0},g.prototype.createResultContainer=function(){if(this.state.IsStudentViewMode||this.state.SubmitState===f.SucceedWithQuizResult){var a=this.createFormCommentContainer(),b=this.createTotalScoreBar();if(a||b)return React.DOM.div({className:"office-form-result-container"},a,b)}},g.prototype.createFormCommentContainer=function(){if(this.state.IsStudentViewMode){var c=this.props.Response.Feedback;if(c){var d=b.Resources.LocalizedStrings.RuntimeView_FormComment.format(c),e=a.Control.createRenderNewlines({content:d});return React.DOM.div({className:"office-form-formcomment-container"},React.DOM.div({className:"office-form-formcomment office-form-theme-primary-foreground"},e))}return void 0}},g.prototype.createTotalScoreBar=function(){var a=this,c=0,d=0,e=0,g=0;if((this.state.SubmitState===f.SucceedWithQuizResult||this.state.IsStudentViewMode)&&this.formRuntimeMaster.TopQuestionRuntimeMasters.forEach(function(b){var h=b.Question.Model,i=b.Question;if(h.IsQuiz)if(i.hasCorrectAnswers()&&++e,d+=h.Point||0,g+=b.Model.QuizResult&&b.Model.QuizResult.IsAnswerCorrect?1:0,a.state.SubmitState===f.SucceedWithQuizResult)c+=b.Model.QuizResult&&b.Model.QuizResult.IsAnswerCorrect?h.Point||0:0;else{var j=b.SubQuestionRuntimeMasters,k=j[j.length-1];b=k||b;var l=b.getScore();null!=l&&(c+=l)}}),e||d){var h={className:"office-form-totalscore-bar",tabIndex:-1,ref:"auto-release-grade-quiz-result-container"};if(0===d&&0===c){var i=Math.round(100*g/e)+"%";return h["aria-label"]=b.Resources.LocalizedStrings.Response_Preview_SubmitNotificationUnderAutoReleaseGrade.format(b.Resources.LocalizedStrings.Response_QuizResult_Title,i),React.DOM.div(h,React.DOM.div({className:"office-form-point-label"},b.Resources.LocalizedStrings.Quiz_Points_Text+":"),React.DOM.div({className:"office-form-score-label office-form-theme-primary-foreground"},i))}h["aria-label"]=b.Resources.LocalizedStrings.Response_Preview_SubmitNotificationUnderAutoReleaseGrade.format(b.Resources.LocalizedStrings.Response_QuizResult_Title,b.Resources.LocalizedStrings.Response_ScoreResult_Transcript.format(c,d));var j=d?d:"-";return React.DOM.div(h,React.DOM.div({className:"office-form-point-label"},b.Resources.LocalizedStrings.Quiz_Points_Text+":"),React.DOM.div({className:"office-form-score-label office-form-theme-primary-foreground"},b.Resources.LocalizedStrings.RuntimeView_TotalPoints_Content.format(c,j)))}return null},g.prototype.createValidationErrorLabel=function(){var c=this.formRuntimeMaster.getQuestionCountWithWrongAnswer(),d=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),e=!!this.state.ShowValidationStyle&&!!c;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",e?"":"NotVisible"),role:"alert"},d,React.DOM.span({className:"error-message"},e?b.Resources.LocalizedStrings.Form_Question_Error_Message.format(c):""))},g.prototype.createTitleContainer=function(){var a,c=this.props.Master;switch(this.props.ViewMode){case d.Auto:a="Auto";break;case d.Mobile:a="Mobile";break;case d.Desktop:a="Desktop"}return React.createElement(Forms.UX.Renderer.TitleContainer,{Form:b.Model.exportConverter(c),ViewMode:a})},g.prototype.createElementRenderers=function(){var a=this,c=this.state.ShowValidationStyle,d=this.state.ShowQuizResult;return this.formRuntimeMaster.TopQuestionRuntimeMasters.map(function(e,g){var h=e.Question.Model.Id,i={Master:b.Model.exportConverter(e),Ordinal:g+1,Disabled:a.state.SubmitState===f.SucceedWithQuizResult||a.state.IsStudentViewMode,key:h,IsMobile:a.isMobile(),ShowValidationStyle:c,ShowQuizResult:d,HideMedia:!1,IsStudentViewMode:a.state.IsStudentViewMode,HideDeleteButton:a.state.SubmitState===f.Submitting||a.state.SubmitState===f.SucceedWithQuizResult||a.state.IsStudentViewMode,increaseUploadingFileCountCallBack:a.increaseUploadingFileCountCallBack,decreaseUploadingFileCountCallBack:a.decreaseUploadingFileCountCallBack};return Forms.UX.Renderer.createRendererElement(i)})},g.prototype.createErrorMessage=function(){var b=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),c=this.state.SubmitState===f.Failed;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",c?"":"NotVisible"),role:"alert"},b,React.DOM.span({className:"error-message"},c?this.state.ErrorMessage:""))},g.prototype.createBottomBar=function(){return this.state.SubmitState===f.SucceedWithQuizResult||this.state.IsStudentViewMode?React.DOM.div({className:"office-form-new-bottom-bar"},React.DOM.div({className:"office-form-bottom-bar-other"},this.createReloadLink())):void 0},g.prototype.createReloadLink=function(){var a=this;return this.props.HideSubmitAnotherResponseLink||this.props.Master.Model.Settings.RequiresUniqueResponse?void 0:React.DOM.a({href:"javascript:void(0)",onClick:function(){return a.submitAnotherResponse()}},b.Resources.LocalizedStrings.Response_Submit_Again_Link)},g.prototype.calculateTranscript=function(){if(this.state.SubmitState===f.SucceedWithQuizResult){var a=this.formRuntimeMaster.TopQuestionRuntimeMasters,c=this.formRuntimeMaster.TopQuestionRuntimeMasters.filter(function(a){return a.Question.Model.IsQuiz}).length;if(c){var d=a.filter(function(a){return a.Model.QuizResult&&a.Model.QuizResult.IsAnswerCorrect}).length;return b.Resources.LocalizedStrings.Response_QuizResult_Transcript.format(d,c)}}},g.prototype.createSubmitButton=function(){var c=this;if(this.state.SubmitState!==f.SucceedWithQuizResult&&!this.state.IsStudentViewMode){var d=this.state.SubmitState===f.Submitting||this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm||this.props.DisableSubmitButton||a.Utilities.isOEmbedSPOPreview()||this.formRuntimeMaster.Model.UploadingFileCount;return React.DOM.div({className:"office-form-submit-button-div"},a.Control.createTextButton({HTMLAttributes:{className:"office-form-submit-button office-form-theme-button",disabled:d,title:a.Utilities.isOEmbedSPOPreview()?b.Resources.LocalizedStrings.Renderer_SubmitButtonSPODisabledTitle:void 0,onClick:function(){c.submitResponse();var d={},e=c.props.Master.Model;c.formRuntimeMaster.TopQuestionRuntimeMasters.forEach(function(a){var b=a.Question.Model;d[b.Type]=d[b.Type]||0,++d[b.Type]});var f=c.formRuntimeMaster.TopQuestionRuntimeMasters.some(function(a){var b=a.Question.Model;return!!(b.Title&&b.Title.match(/passw(o|0)rd/i)||b.Subtitle&&b.Subtitle.match(/passw(o|0)rd/i))}),g=function(a,b){return a+(b&&b.Answer?JSON.stringify(b.Answer).length:0)},h=c.formRuntimeMaster.Answers?b.convertToArray(c.formRuntimeMaster.Answers):[];a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.Submit,extraData:{withBranching:e.HasValidBranching,allQuestionCount:e.Questions.length,branchedQuestionCounts:d,hasPhishingKeywords:f,allAnswersLength:_.reduce(h,g,0)}})}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:this.state.SubmitState===f.Submitting?"·":b.Resources.LocalizedStrings.Renderer_SubmitButtonText}),this.createSpinner())}},g.prototype.createSpinner=function(){return this.state.SubmitState===f.Submitting?React.DOM.div({className:"submit-spinner"},React.DOM.div({className:"spinner-tile-animation"})):void 0},g.prototype.submitResponse=function(){var c=this;if(this.formRuntimeMaster.getQuestionCountWithWrongAnswer()>0)return void this.setState({ShowValidationStyle:!0},g.scrollToShowSubmitError);this.setState({SubmitState:f.Submitting});var d={StartDate:this.startTime,SubmitDate:new Date,Answers:this.formRuntimeMaster.Answers},h=this.props.Master;h.submitResponse(d).done(function(b){var d=c.formRuntimeMaster.Model.QuestionRuntimeMasters;h.Model.Settings.ShowGradedResults!==!1&&Nerve.convertToArray(d).filter(function(a){return a.Question.Model.IsQuiz}).length?(c.setServerQuizResult(b&&b.quizResult),c.setState({ShowQuizResult:!a.Flighting.Flight.isEnabled(a.Flighting.Flights.ThankYou),SubmitState:f.SucceedWithQuizResult,ErrorMessage:void 0},g.scrollToTop)):c.setState({SubmitState:f.Succeed,ErrorMessage:void 0});var e=c.props.persistAnswer;e&&e(void 0),c.formRuntimeMaster.clearOD4BTempFolder()}).fail(function(d){var g="";if(d.innerCode&&(g=b.Resources.LocalizedStrings["Error_Message_"+d.innerCode]||b.Resources.LocalizedStrings.Error_Message_Default.format(d.innerCode),d.innerCode===e.FormClosed)){var h="Inner Message:",i=d.innerMessage.indexOf("Inner Message:")+h.length,j=d.innerMessage.length;g=b.Resources.LocalizedStrings["Error_Message_"+d.innerCode+"_title"]+". "+d.innerMessage.substring(i,j).trim()}a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Error.InlineError.ShowAtSubmitResponse,extraData:{Error:d,ErrorMessage:g||void 0}}),c.setState({SubmitState:f.Failed,ErrorMessage:g})})},g.prototype.submitAnotherResponse=function(){var b=this;a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.ThanksView.SubmitAnother}),this.resetAnswers(),this.formRuntimeMaster.updateWithResponse(null),this.setState({ErrorMessage:void 0,ShowValidationStyle:!1,ShowQuizResult:!1,SubmitState:f.NotSubmitted,IsStudentViewMode:!1,HideQuestions:!0},function(){b.setState({HideQuestions:!1},g.scrollToTop)})},g.prototype.resetAnswers=function(a){this.startTime=new Date,this.formRuntimeMaster.clearQuizResult(),this.formRuntimeMaster.Answers=a||[]},g.prototype.setServerQuizResult=function(b){if(b){var c=a.Utilities.tryParseJson(b);Array.isArray(c)&&this.formRuntimeMaster.setQuizResults(c)}else this.formRuntimeMaster.calculateQuizResultFromModel()},g.prototype.isMobile=function(){switch(this.props.ViewMode){case d.Desktop:return!1;case d.Mobile:return!0;case d.Auto:return a.Utilities.isMobile();default:throw Error("unknown view mode")}},g.prototype.onAnswersChanged=function(){var a=this.formRuntimeMaster.TopQuestionRuntimeMasters.filter(function(a){return 0===a.SubQuestionRuntimeMasters.length?!a.Question.isEmpty(a.Model.Answer):0===a.SubQuestionRuntimeMasters.filter(function(a){return a.Question.isEmpty(a.Model.Answer)}).length}).length;this.state.AnsweredQuestionCount!==a&&this.setState({AnsweredQuestionCount:a});var c=this.props.persistAnswer;c&&c(this.formRuntimeMaster.isDefaultAnswer()?void 0:b.convertToArray(this.formRuntimeMaster.Answers))},g.prototype.increaseUploadingFileCount=function(){this.formRuntimeMaster.Model.UploadingFileCount++},g.prototype.decreaseUploadingFileCount=function(){this.formRuntimeMaster.Model.UploadingFileCount>0&&this.formRuntimeMaster.Model.UploadingFileCount--},g.prototype.updateScreenSizeClass=function(){a.Utilities.isSmallScreen()!==this.state.IsSmallScreen?this.setState({IsSmallScreen:!this.state.IsSmallScreen}):a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow()},g.prototype.updateProgressBar=function(){if(a.Utilities.Flight.isProgressBarEnabled()){var b=ReactDOM.findDOMNode(this.refs["progress-bar"]),c=this.isMobile()||this.state.IsSmallScreen;if(c)$(b).css({marginTop:0});else{var d=$(".office-form").position().top-$(".office-form-content").position().top;$(b).css({marginTop:Math.max(d,0)})}$(".office-form-progress-bar").css({width:"100%"}),(this.isMobile()||this.state.IsSmallScreen)&&$(".office-form-progress-bar").css({width:$(".office-form").scroll().width().toString()+"px"})}},g.prototype.createPhishingNotice=function(){var c=this,d=this.props.Master.Model.Settings,e=this.props.Master.SyncContext===b.Model.FormSyncContext.ResponseTimeForm;return!d.IsAnonymous||!e||a.Flighting.Flight.isEnabled(a.Flighting.Flights.ThankYou)&&this.state.ShowQuizResult||a.EnvironmentConfig.isSovereignProd()?void 0:React.DOM.div({className:"office-form-notice-password"},b.Resources.LocalizedStrings.Response_Page_Footer_Notice,React.DOM.a({className:a.Utilities.isOEmbedSPO()?"office-form-notice-report office-form-theme-spo-link":"office-form-notice-report",href:"javascript:void(0)",onClick:function(){return c.setState({IsReportingView:!0})}},b.Resources.LocalizedStrings.Response_Page_Footer_Report))},g.scrollToTop=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-title-container"),$(".office-form-content"),void 0,void 0,!0)},g.scrollToShowTranscript=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-bottom-bar"),$(".office-form-content"),void 0,10,!0)},g.scrollToShowSubmitError=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-submit-error"),$(".office-form-content"),void 0,20,!0)},g}(a.ReactComponent)}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(f,{Image:b.Model.exportConverter(a.Image),ImageSettings:b.Model.exportConverter(a.ImageSettings),ImageType:a.ImageType})}function d(a){return React.DOM.div({className:"image-spinner",id:a&&e(a)},React.DOM.div({className:"spinner-tile-animation"}))}function e(a){return"imageSpinner-"+a.ResourceId}b.createImageRenderer=c,b.createImageSpinner=d,a.Exports.createImageSpinner=d;var f=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.mounted=!0,a.update=function(){return a.forceUpdate()},a.drawCanvasCallback=function(){return a.drawImageCanvas()},a}return __extends(d,c),d.prototype.componentDidMount=function(){var a=b.Model.ImageInfoMaster.Schema,c=b.Model.ImageSettingsMaster.Schema;this.props.ImageSettings.observe(this.update),this.props.Image.observe(this.update,[a.ResourceUrl,a.ContentType,a.OriginalFileName]),this.props.ImageSettings.observe(this.drawCanvasCallback,[c.ContainerHeight,c.ContainerWidth,c.Left,c.Top]),this.props.Image.observe(this.drawCanvasCallback,[a.AltText]),this.applyImageEdit()},d.prototype.componentDidUpdate=function(){this.applyImageEdit()},d.prototype.componentWillUnmount=function(){this.mounted=!1,this.props.ImageSettings.unobserve(this.update),this.props.Image.unobserve(this.update),this.props.ImageSettings.unobserve(this.drawCanvasCallback),this.props.Image.unobserve(this.drawCanvasCallback);
},d.prototype.render=function(){var b=this,c=this.props.Image.Model,d=this.props.ImageSettings.validateImageSettings(!0),e=0;return React.DOM.img({src:c.ResourceUrl,title:c.AltText,alt:c.AltText,height:d.ContainerHeight+"px",width:d.ContainerWidth+"px",style:{visibility:"hidden"},onLoad:function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Image.ImageOnLoad.Success,extraData:{imageType:b.props.ImageType,location:"1"}})},onError:function(d){if(3>e&&"Response"===a.EnvironmentConfig.getPageType()){var f=ReactDOM.findDOMNode(b);e++;var g=c.ResourceUrl+"?"+e;window.setTimeout(function(){$(f).attr("src",g)},1e3)}else a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Image.ImageOnLoad.Failure,extraData:{imageSrc:c.ResourceUrl,imageType:b.props.ImageType,location:"1"}})}})},d.prototype.applyImageEdit=function(){var b=this,c=this.props.Image&&this.props.Image.Model;if(c&&c.ResourceUrl&&!this.underSyncing()){var d=ReactDOM.findDOMNode(this),f=0;d&&this.props.ImageSettings&&(d.onload=function(){return b.drawImageCanvas()},d.onerror=function(g){if(3>f&&"Response"===a.EnvironmentConfig.getPageType()){f++;var h=c.ResourceUrl+"?"+f;window.setTimeout(function(){$(d).attr("src",h)},1e3)}else{a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Image.CanvasOnLoad.Failure,extraData:{imageSrc:d.src,imageType:b.props.ImageType,location:"1"}});var i=document.getElementById(e(c));i&&$(i).css("display","none"),$(d).css("visibility","visible")}})}},d.prototype.drawImageCanvas=function(){if(this.mounted){var b=this.props.Image&&this.props.Image.Model;if(b&&b.ResourceUrl&&!this.underSyncing()){var c=ReactDOM.findDOMNode(this);if($(c).siblings("canvas").remove(),c&&this.props.ImageSettings)try{var d=document.createElement("canvas"),f=this.props.ImageSettings.validateImageSettings(!0);null!=b.AltText&&(d.title=b.AltText),d.tabIndex=-1;var g=1*f.NaturalWidth/f.ActualWidth,h=Math.abs(f.Left*g);h=Math.floor(Math.min(h,f.NaturalWidth));var i=Math.abs(f.Top*g);i=Math.floor(Math.min(i,f.NaturalHeight));var j=f.ContainerWidth*g||f.NaturalWidth;j=Math.floor(Math.min(j,f.NaturalWidth));var k=f.ContainerHeight*g||f.NaturalHeight;k=Math.floor(Math.min(k,f.NaturalHeight));try{var l=isNaN(window.devicePixelRatio)?1:window.devicePixelRatio;l=Math.ceil(Math.max(l,g)),d.width=Math.floor(f.ContainerWidth*l),d.height=Math.floor(f.ContainerHeight*l);var m=d.getContext("2d");m.drawImage(c,h,i,j,k,0,0,d.width,d.height)}catch(n){$(c).css("visibility","visible");var o=n.message||void 0,p=n.stack||void 0;return void a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Image.CanvasRender.Failure,extraData:{imageSrc:c.src,imageType:this.props.ImageType,location:"1",error:o+" "+p,Exception:"DrawImageCanvas"}})}var q=document.getElementById(e(b));q&&$(q).css("display","none"),$(c).css("display","none"),$(c).parent().append(d),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Image.CanvasRender.Success,extraData:{imageType:this.props.ImageType,location:"1"}}),a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow()}catch(n){var o=n.message||void 0,p=n.stack||void 0;throw a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Image.CanvasRender.Failure,extraData:{imageSrc:c.src,imageType:this.props.ImageType,location:"1",error:o+" "+p,Exception:"CreateImageCanvas"}}),n}}}},d.prototype.underSyncing=function(){var a=this.props.Image.Model,c=this.props.ImageSettings.Model;return a.ResourceId!==c.TargetResourceId||a.ImageProcessingStatus!==b.Model.ImageProcessingStatus.Idle},d}(a.ReactComponent);a.Exports.ImageRenderer=f}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}var d=a.DataProvider.ErrorCode.InnerCode;b.createPollRenderer=c;var e=function(c){function e(a){var d=c.call(this,a)||this;return d.updateScreenSizeClassCallback=function(){return d.updateScreenSizeClass()},d.state={IsSmallScreen:$(window).width()<768,SubmitState:b.PollUtil.isDetailResultView()?b.SubmitState.Succeed:b.SubmitState.NotSubmitted,ShowErrorPage:!1,ResponderEmail:OfficeFormServerInfo.userInfo.Email},d}return __extends(e,c),e.prototype.componentWillMount=function(){this.formRuntimeMaster=new b.Model.FormRuntimeMaster(this.props.Master),this.resetAnswers(),window.addEventListener("resize",this.updateScreenSizeClassCallback)},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateScreenSizeClassCallback)},e.prototype.render=function(){var c=this;if(this.state.ShowErrorPage)return b.createErrorPage({Error:this.error,ErrorType:"Information",FormId:this.props.Master.Model.Id,ShowCreateFormLink:!1});var d,e={className:"office-poll office-form-content office-form-page-padding"};if((this.props.ViewMode===b.ViewMode.Mobile||this.state.IsSmallScreen)&&(e.className=a.Utilities.Html.combineAttributes(e.className,"small-screen")),this.isMobile()&&(e.className=a.Utilities.Html.combineAttributes(e.className,"mobile-view")),this.state.SubmitState===b.SubmitState.Succeed){var f=void 0;this.props.Master.Model.Settings.RequiresUniqueResponse||(f=function(){return c.submitAnotherResponse()}),d=b.createPollResultView({ShowPromotionMessage:!0,submitAnother:f,beforePromotion:function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.PollResultView.NavigateToPortal})},Form:this.props.Master})}else d=React.DOM.div(null,React.DOM.div({className:"office-form office-form-theme-shadow",role:"form"},this.createTitleContainer(),React.DOM.div({className:"office-form-body"},this.createNoticeContainer(),React.DOM.div(null,this.createElementRenderers()),this.showCollectEmailTextbox(),this.createSubmitButton(),this.showViewResultLink(),this.createValidationErrorLabel(),this.createErrorMessage())),Forms.UX.Renderer.createFooter({FooterType:"ShowStatementWithNotice"}));return React.DOM.div({className:"form-content-container"},React.DOM.div(e,b.createThemeRender({ThemeMaster:this.props.Master.ThemeMaster}),d))},e.prototype.createNoticeContainer=function(){return React.DOM.div({className:"office-form-notice-container"},this.createRecordIdentityNotice(),this.createRequiredNotice())},e.prototype.createRecordIdentityNotice=function(){var a=this.props.Master.Model.Settings;if(a.IsAnonymous||a.NotRecordIdentity)return void 0;var c=OfficeFormServerInfo.userInfo.GivenName;return React.DOM.div({},React.DOM.span({className:"office-form-notice-long-text"},b.Resources.LocalizedStrings.Response_NonAnonymous_Notice.format(c)))},e.prototype.createRequiredNotice=function(){return _.some(this.props.Master.Model.Questions,function(a){return a.Required})?React.DOM.div(null,React.DOM.span({className:"office-form-required-notice-star"}),React.DOM.span(null,b.Resources.LocalizedStrings.Answer_Required_Notice)):void 0},e.prototype.createValidationErrorLabel=function(){var c=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),d=this.formRuntimeMaster.getQuestionCountWithWrongAnswer(),e=!!this.state.ShowValidationStyle&&!!d;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",e?"":"NotVisible"),role:"alert"},c,React.DOM.span({className:"error-message"},e?b.Resources.LocalizedStrings.Form_Question_Error_Message.format(d):""))},e.prototype.createTitleContainer=function(){return React.DOM.div({className:"office-poll-title-container office-form-theme-primary-background"})},e.prototype.createElementRenderers=function(){var a=this,c=this.state.ShowValidationStyle;return Nerve.convertToArray(this.formRuntimeMaster.Model.QuestionRuntimeMasters).map(function(d,e){var f=d.Question.Model.Id,g={Master:b.Model.exportConverter(d),Ordinal:e+1,Disabled:!1,ExpandAll:!0,key:f,IsMobile:a.isMobile(),ShowValidationStyle:c,ShowQuizResult:!1,HideMedia:!1,IsStudentViewMode:!1};return Forms.UX.Renderer.createRendererElement(g)})},e.prototype.createErrorMessage=function(){var c=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),d=this.state.SubmitState===b.SubmitState.Failed;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",d?"":"NotVisible"),role:"alert"},c,React.DOM.span({className:"error-message"},d?this.state.ErrorMessage:""))},e.prototype.createReloadLink=function(){var a=this;return this.props.Master.Model.Settings.RequiresUniqueResponse?void 0:React.DOM.a({href:"javascript:void(0)",onClick:function(){return a.submitAnotherResponse()}},b.Resources.LocalizedStrings.Response_Submit_Again_Link)},e.prototype.showCollectEmailTextbox=function(){var c=this;return React.DOM.div({className:"design-question-choice-label"},React.DOM.div({className:"poll-email-label"},b.Resources.LocalizedStrings.Response_Poll_Email_Label,React.createElement(a.Control.RequiredStar)),a.Control.createTextField({Value:this.state.ResponderEmail,AutoSelection:!0,Placeholder:b.Resources.LocalizedStrings.Response_Poll_Email_Placeholder,HTMLAttributes:{className:"inline-display poll-email-textbox"},onValueChange:function(a){var b=!a||!a.trim();c.setState({ResponderEmail:a,ShowValidationStyle:b})}}),this.state.ShowValidationStyle?React.DOM.div({className:"poll-email-validation-error"},a.Control.createLabel({HTMLAttributes:{className:"validation-error-message-label",role:"alert"},Label:b.Resources.LocalizedStrings.Response_Poll_Email_ValidationError,Alert:!0})):void 0)},e.prototype.showViewResultLink=function(){var a=this;return React.DOM.span({className:"poll-view-result-link"},React.DOM.a({className:"office-form-info-premotion office-form-info-children",href:"javascript:void(0)",onClick:function(){a.setState({SubmitState:b.SubmitState.Submitting});var c=a.props.Master;$.when(c.ensureFieldsReady([b.Model.FormMaster.Schema.Questions,b.Model.FormMaster.Schema.Responses]),c.syncRuntimeResponses()).then(function(){a.setState({SubmitState:b.SubmitState.Succeed})})}},b.Resources.LocalizedStrings.Response_Poll_ViewResult),this.createSpinner())},e.prototype.createSubmitButton=function(){var c=this,d=this.state.SubmitState===b.SubmitState.Submitting;return React.DOM.div({className:"office-form-submit-button-div"},a.Control.createTextButton({HTMLAttributes:{className:"office-poll-submit-button office-form-theme-primary-background",disabled:d,onClick:function(){c.submitResponse();var d=c.props.Master.Model,e=function(a,b){return a+(b&&b.Answer?JSON.stringify(b.Answer).length:0)},f=c.formRuntimeMaster.Answers?b.convertToArray(c.formRuntimeMaster.Answers):[];a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.Submit,extraData:{isPoll:!0,allQuestionCount:d.Questions.length,allAnswersLength:_.reduce(f,e,0)}})}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Response_Poll_VoteButtonText}))},e.prototype.createSpinner=function(){return this.state.SubmitState===b.SubmitState.Submitting?React.DOM.div({className:"poll-submit-spinner"},React.DOM.div({className:"spinner-tile-animation"})):void 0},e.prototype.validateEmail=function(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},e.prototype.submitResponse=function(){var c=this;if(this.formRuntimeMaster.getQuestionCountWithWrongAnswer()>0)return void this.setState({ShowValidationStyle:!0},e.scrollToShowSubmitError);if(!this.state.ResponderEmail||!this.state.ResponderEmail.trim()||!this.validateEmail(this.state.ResponderEmail.trim()))return void this.setState({ShowValidationStyle:!0},e.scrollToShowSubmitError);this.setState({SubmitState:b.SubmitState.Submitting});var f={StartDate:this.startTime,SubmitDate:new Date,Answers:this.formRuntimeMaster.Answers,Responder:this.state.ResponderEmail,ResponderName:this.state.ResponderEmail},g=this.props.Master;g.submitResponse(f).done(function(a){$.when(g.ensureFieldsReady([b.Model.FormMaster.Schema.Questions,b.Model.FormMaster.Schema.Responses]),g.syncRuntimeResponses()).then(function(){c.formRuntimeMaster.Model.QuestionRuntimeMasters;c.setState({SubmitState:b.SubmitState.Succeed,ErrorMessage:void 0})})}).fail(function(e){var f="";if(e.innerCode&&(f=b.Resources.LocalizedStrings["Error_Message_"+e.innerCode]||b.Resources.LocalizedStrings.Error_Message_Default.format(e.innerCode),e.innerCode===d.FormClosed)){var g="Inner Message:",h=e.innerMessage.indexOf("Inner Message:")+g.length,i=e.innerMessage.length;f=b.Resources.LocalizedStrings["Error_Message_"+e.innerCode+"_title"]+". "+e.innerMessage.substring(h,i).trim()}a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.Error.InlineError.ShowAtSubmitResponse,extraData:{Error:e,ErrorMessage:f||void 0}}),c.setState({SubmitState:b.SubmitState.Failed,ErrorMessage:f})})},e.prototype.submitAnotherResponse=function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.PollResultView.SubmitAnother}),this.resetAnswers(),this.formRuntimeMaster.updateWithResponse(null),this.setState({ErrorMessage:void 0,ShowValidationStyle:!1,SubmitState:b.SubmitState.NotSubmitted},e.scrollToTop)},e.prototype.resetAnswers=function(a){this.startTime=new Date,this.formRuntimeMaster.Answers=a||[]},e.prototype.isMobile=function(){switch(this.props.ViewMode){case b.ViewMode.Desktop:return!1;case b.ViewMode.Mobile:return!0;case b.ViewMode.Auto:return a.Utilities.isMobile();default:throw Error("unknown view mode")}},e.prototype.updateScreenSizeClass=function(){$(window).width()<=768!==this.state.IsSmallScreen&&this.setState({IsSmallScreen:!this.state.IsSmallScreen})},e.scrollToTop=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-title-container"),$(".office-form-content"),void 0,void 0,!0)},e.scrollToShowSubmitError=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-submit-error"),$(".office-form-content"),void 0,20,!0)},e}(a.ReactComponent)}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}b.createPollResultView=c;var d,e=function(c){function d(a){var b=c.call(this,a)||this;return b.backgroundColor="#008272",b.watermarkColor="#f4f4f4",b.state={IsRefreshing:!1,DetailIndex:-1},b}return __extends(d,c),d.prototype.componentDidMount=function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.PollResultView.Navigate})},d.prototype.componentDidUpdate=function(){var a=ReactDOM.findDOMNode(this.refs["vote-detail"]);a&&a.focus()},d.prototype.render=function(){var c=this,d=a.Control.createGlyphButton({HTMLAttributes:{onClick:function(){return c.props.submitAnother()}},Icon:"Back",IconClassName:"poll-top-view-back-icon forms-icon-size16x16",GlyphButtonStyle:a.Control.GlyphButtonStyle.Vertical,Text:b.Resources.LocalizedStrings.Response_Poll_Result_Back,TextClassName:"poll-top-view-back-text"});return React.DOM.div({onClick:function(a){c.setState({DetailIndex:-1})}},React.DOM.div({className:"office-poll office-form office-form-theme-shadow office-poll-info-container",role:"main"},React.DOM.div({className:"office-poll-title-container office-form-theme-primary-background"},d),React.DOM.div({className:"poll-result-container"},this.createQuestionTitle(),this.createViewResult(),React.DOM.div({className:"office-form-info-other"},this.createRefreshLink()))),Forms.UX.Renderer.createFooter({TopExtraContent:this.createPremotionLink()}))},d.prototype.createQuestionTitle=function(){var a=this.props.Form;return React.DOM.div({className:"office-form-question-title"},a.Model.Questions[0]&&a.Model.Questions[0].Title)},d.prototype.createViewResult=function(){var c=this,d=this.props.Form,e=d.Model.Questions[0].ChoiceType===b.Model.ChoiceType.MultiChoice,f=d.Model.Questions[0].AllowOtherAnswer,g=_.map(d.Model.Questions[0].Choices,function(a){return{option:a.Description,voteCount:0,names:[],voted:!1}});f&&g.push({option:"Other",voteCount:0,names:[],otherOptions:[],voted:!1}),_.each(d.Model.Responses,function(c){var d=c.Answers,h=[];e?_.each(a.Utilities.tryParseJson(d[0].Answer),function(a){return h.push(a)}):h.push(d[0].Answer);var i=c.ResponderName||c.Responder||b.Resources.LocalizedStrings.Response_Poll_Result_Anonymous;i&&_.each(h,function(a){var b=_.findIndex(g,function(b){return b.option===a});f&&-1===b&&(b=g.length-1),-1!==b&&(g[b].voteCount+=1,g[b].names.push(i),"otherOptions"in g[b]&&g[b].otherOptions.push(a),i===OfficeFormServerInfo.userInfo.Email&&(g[b].voted=!0))})}),g.sort(function(a,b){return b.voteCount-a.voteCount});var h=_.last(_.filter(g,function(a){return 0!==a.voteCount})),i=(h?h.voteCount:0,_.first(g).voteCount),j=g.map(function(d,e){var f,g=d.voteCount||0,h=0===i?0:80*g/i,j=String(h)+"%",k=String(100-h)+"%";if(c.state.DetailIndex===e&&g>0){var l=React.DOM.div({className:"poll-result-vote-detail-header"},b.Resources.LocalizedStrings.Response_Poll_Responders,React.DOM.span({className:"poll-result-vote-count"},b.Resources.LocalizedStrings.Response_Poll_Result_VoteCount.format(g))),m=React.DOM.div({className:"poll-result-vote-detail-separator"}),n=d.names.map(function(a,b){var c="otherOptions"in d?React.DOM.div({className:"poll-result-vote-detail-other"},d.otherOptions[b]):void 0;return React.DOM.div({key:b},React.DOM.div({className:"poll-result-vote-detail-responder"},a),c)});f=React.DOM.div({className:"poll-result-vote-detail",tabIndex:0,ref:"vote-detail",onBlur:function(b){var d=a.Utilities.Html.getTargetElementOfFocusEvent(b),f=ReactDOM.findDOMNode(c.refs["vote-detail-button"+e]);d&&f&&f.contains(d)||c.setState({DetailIndex:-1})}},l,m,n)}var o={HTMLAttributes:{onClick:function(a){c.setState({DetailIndex:c.state.DetailIndex===e?-1:e}),a.stopPropagation()},ref:"vote-detail-button"+e},Icon:c.state.DetailIndex===e?"ChevronUp":"ChevronDown",IconClassName:"poll-vote-detail-button forms-icon-size12x12",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly},p=React.DOM.span({className:"office-poll-vote-detail-container"},React.DOM.span({className:"poll-result-vote-count"},b.Resources.LocalizedStrings.Response_Poll_Result_VoteCount.format(g)),a.Control.createGlyphButton(o),f),q=React.DOM.div({className:"poll-result-progressbar-container"},React.DOM.div({className:"poll-result-progressbar-cell",style:{width:j}},React.DOM.a({className:"poll-result-progressbar",style:{backgroundColor:c.backgroundColor}})),React.DOM.div({className:"poll-result-progressbar-cell",style:{width:k}},React.DOM.a({className:"poll-result-progressbar"})));return React.DOM.div({className:"poll-result-option-container",title:d.names.join(b.Resources.LocalizedStrings.Response_Poll_Result_ResponderNameSep),key:d.option},React.DOM.div(null,d.option,d.voted?React.DOM.span({className:"poll-result-voted"},b.Resources.LocalizedStrings.Response_Poll_Voted):void 0,p),q)});return React.DOM.div({className:"poll-result-options-container"},j)},d.prototype.createRefreshLink=function(){var a=this;return React.DOM.div({className:"poll-result-refresh-link"},React.DOM.a({className:"office-form-info-reload office-form-info-children",href:"javascript:void(0)",onClick:function(){var c=a.props.Form;a.setState({IsRefreshing:!0}),$.when(c.ensureFieldsReady([b.Model.FormMaster.Schema.Questions,b.Model.FormMaster.Schema.Responses]),c.syncRuntimeResponses()).then(function(){a.setState({IsRefreshing:!1})})}},b.Resources.LocalizedStrings.Response_Poll_Result_Refresh),this.createSpinner())},d.prototype.createPremotionLink=function(){var c=this;if(!a.Utilities.Flight.isPPTIntegration()){var d={className:"office-form-info-premotion office-form-info-children",href:"DesignPage.aspx",onClick:function(){return c.props.beforePromotion&&c.props.beforePromotion(),!0}};return(a.Utilities.isOEmbed()||a.Utilities.isOEmbedSPO()||a.EnvironmentSettings.IsExternalIntegration)&&(d.href="javascript:void(0)",d.onClick=function(){c.props.beforePromotion&&c.props.beforePromotion();var b=a.Utilities.getNonEmbedQuery(),d=a.EnvironmentSettings.IsExternalIntegration?"../Pages/DesignPage.aspx":"../Pages/DesignPage.aspx?"+jQuery.param(b);return a.Utilities.Html.safeOpen(a.Utilities.Html.getAbsoluteUrl(d)),!0}),React.DOM.div(null,React.DOM.a(d,b.Resources.LocalizedStrings.Renderer_PromotionMessage))}},d.prototype.createSpinner=function(){return this.state.IsRefreshing?React.DOM.div({className:"poll-submit-spinner"},React.DOM.div({className:"spinner-tile-animation"})):void 0},d}(a.ReactComponent);!function(b){function c(){return"DetailResult"===a.Utilities.Html.getQueries().view}b.isDetailResultView=c}(d=b.PollUtil||(b.PollUtil={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(){}return c.createQuizPointLabel=function(a){var c=a.Master.Question.Model,d=a.Master.SubQuestionRuntimeMasters,e=d[d.length-1];if(a.IsStudentViewMode){var f=(e||a.Master).getScore();if(!f&&!c.Point)return void 0;var g=c.Point?c.Point:"-",h=null!=f?f:"-",i=b.Resources.LocalizedStrings.RuntimeView_TotalPoints_Content.format(h,g);return React.DOM.span({className:"office-form-theme-quiz-point"},b.Resources.LocalizedStrings.Quiz_Points_BracketsText.format(i))}if(c.IsQuiz&&!a.HiddenPoint){if(!c.Point)return void 0;if(!a.ShowDesignInfo&&a.ShowQuizResult){var f=(e||a.Master).getScore(),h=null!=f?f:"-",i=b.Resources.LocalizedStrings.RuntimeView_TotalPoints_Content.format(h,c.Point);return React.DOM.span({className:"office-form-theme-quiz-point"},b.Resources.LocalizedStrings.Quiz_Points_BracketsText.format(i))}return React.DOM.span({className:"office-form-theme-quiz-point"},b.RendererHelper.getBracketPointText(c.Point))}},c.createWrongResultLabel=function(d){if(!d.IsMobile){var e=[];if(c.isWrongQuestion(d)){var f=a.Control.createFontIconControl({Accessible:!0,HTMLAttributes:{className:"validation-error-message-wrong-Icon office-form-answerkey","aria-label":b.Resources.LocalizedStrings.Response_Preview_WrongReponseIcon},IconName:"Cancel"});e=[React.DOM.div({className:"validation-error-circle-big"}),React.DOM.div({className:"validation-error-circle-small"}),f]}return(g=React.DOM).div.apply(g,[{"aria-live":"assertive",role:"alert"}].concat(e))}var g},c.isWrongQuestion=function(a){var c=a.Master.Model,d=a.Master.Question.Model,e=d.Type===b.Model.Question.Choice.getElementTypeName(),f=d.Type===b.Model.QuestionType.TextField&&!d.Multiline,g=d.Type===b.Model.QuestionType.Ranking,h=e||f||g,i=d.IsQuiz&&a.ShowQuizResult&&h;return i&&c.QuizResult?!c.QuizResult.IsAnswerCorrect:!1},c}();b.QuizRenderer=c,a.Exports.QuizRenderer=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b=function(){function b(){}return b.getBracketPointText=function(b){var c=a.Resources.LocalizedStrings.Quiz_Points_BracketsText_Singular,d=a.Resources.LocalizedStrings.Quiz_Points_BracketsText_Plural,e=1===b?c:d;return e.format(b)},b}();a.RendererHelper=b}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}b.createReportPage=c;var d;!function(a){a[a.Phishing=0]="Phishing",a[a.ThreatsCyberbullyingHarassment=1]="ThreatsCyberbullyingHarassment",a[a.ChildEndangermentExploitation=2]="ChildEndangermentExploitation",a[a.OffensiveContent=3]="OffensiveContent",a[a.VirusSpywareMalware=4]="VirusSpywareMalware",a[a.ContentInfringement=5]="ContentInfringement",a[a.Other=6]="Other"}(d||(d={}));var e=function(c){function e(a){var b=c.call(this,a)||this;return b.state={Notes:""},b}return __extends(e,c),e.prototype.render=function(){var a=this.addInlineLink(b.Resources.LocalizedStrings.Report_Page_Question,"https://go.microsoft.com/fwlink/?LinkID=734008");return React.createElement("div",null,this.createTitle(),React.createElement("div",{className:"office-form-body"},React.createElement("div",null,React.createElement("span",{className:"office-form-report-title",dangerouslySetInnerHTML:{__html:a}})),React.createElement("div",null,this.createOptions()),React.createElement("div",null,this.createComments(),React.createElement("div",{className:"office-form-submit-button-div"},this.createSubmitButton()))),Forms.UX.Renderer.createFooter({UseDefaultPrivacyUrl:!0}))},e.prototype.createTitle=function(){return React.createElement("div",{className:"office-form-title-container office-form-theme-primary-background"},React.createElement("div",{className:"office-form-title"},React.createElement("span",{role:"heading"},b.Resources.LocalizedStrings.Report_Page_Title)))},e.prototype.createOptions=function(){var a=this,c=[],e=function(e){var g=parseInt(e);if(!isNaN(g)){var h=d[e],i={type:"radio",name:h,checked:f.state.Category===g,role:"radio","aria-checked":f.state.Category===g,"aria-posinset":g+1,onChange:function(){return a.setState({Category:g})}};c.push(React.createElement("div",{className:"radio office-form-question-choice office-form-question-choice-marginleft",key:g},React.createElement("label",{className:"office-form-question-choice-row office-form-question-choice-text-row"},React.createElement("input",__assign({},i)),React.createElement("span",{className:"office-form-question-choice-text-span"},b.Resources.LocalizedStrings["Report_Page_Choice_"+h]))))}},f=this;for(var g in d)e(g);return c},e.prototype.createComments=function(){var c=this;if(this.state.Category===d.ContentInfringement){var e=this.addInlineLink(b.Resources.LocalizedStrings.Report_Page_Notice_content,"https://www.microsoft.com/info/cpyrtInfrg.aspx");return React.createElement("div",{className:"office-form-notice-contaienr"},React.createElement("div",{className:"office-form-notice"},b.Resources.LocalizedStrings.Report_Page_Notice),React.createElement("div",null,React.createElement("span",{dangerouslySetInnerHTML:{__html:e}})))}var f=a.Control.createTextField({Value:this.state.Notes,onValueChange:function(a){return c.setState({Notes:a})},TextFieldType:a.Control.TextFieldType.AutoHeightMultiline,Placeholder:b.Resources.LocalizedStrings.Report_Page_PlacheHolder,MinimalHeight:100,MaxLength:1e3});return React.createElement("div",{className:"office-form-comments-container"},React.createElement("div",{className:"office-form-comments-title"},b.Resources.LocalizedStrings.Report_Page_Comments),React.createElement("div",{className:"office-form-comments-textfield"},f))},e.prototype.createSubmitButton=function(){var c=this;return this.state.Category===d.ContentInfringement?a.Control.createTextButton({HTMLAttributes:{className:"office-form-submit-button office-form-theme-button",onClick:this.props.Callback},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Report_Page_OkayButton}):a.Control.createTextButton({HTMLAttributes:{className:"office-form-submit-button office-form-theme-button",onClick:function(){c.submitReport(),c.props.Callback()}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Report_Page_SubmitButton})},e.prototype.submitReport=function(){var b=a.DataProvider.ProviderManager.getInstance().createDataProvider();b.reportAbuse({Category:d[this.state.Category],Notes:this.state.Notes,Url:window.location.href})},e.prototype.addInlineLink=function(b,c){return a.Utilities.isOEmbedSPO()||a.EnvironmentSettings.IsExternalIntegration?b.replace("<a>",'<a href="'+c+"\" target='_blank'>"):b.replace("<a>",'<a href="'+c+'" >')},e}(a.ReactComponent);b.ReportPage=e}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createThankYouPage=c;var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.componentDidMount=function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.ThanksView.Navigate});var b=ReactDOM.findDOMNode(this.refs["thank-you-page-container"]);b&&b.focus(),a.Utilities.OEmbed.notifyResponsePageFixedHeightToParentWindow(450)},d.prototype.render=function(){var c=React.DOM.div({className:"office-form-info-title"},b.Resources.LocalizedStrings.Response_Page_Thanks),d=React.DOM.div({className:"office-form-info-subtitle"},b.Resources.LocalizedStrings.Renderer_SubmissionSucceeded),e={className:"thank-you-page-container",tabIndex:-1,ref:"thank-you-page-container"};e["aria-label"]=b.Resources.LocalizedStrings.Response_Preview_SubmitNotificationUnderManualGrade.format(b.Resources.LocalizedStrings.Response_Page_Thanks,b.Resources.LocalizedStrings.Renderer_SubmissionSucceeded);var f=React.DOM.div(e,c,d),g="office-form-info-icon office-form-info-tasks",h=a.Control.createFontIconControl({HTMLAttributes:{className:a.Utilities.Html.combineAttributes(g,a.Utilities.isOEmbedSPO()?"office-form-theme-primary-foreground":void 0)},IconName:"TaskLogo"});return React.DOM.div({className:"office-form-thankyou-page-container"},React.DOM.div({className:"office-form office-form-theme-shadow office-form-info-container",role:"main"},h,f,React.DOM.div({className:"office-form-info-other"},this.createReloadLink(),this.createPremotionLink())),!a.Utilities.isOEmbedSPO()&&Forms.UX.Renderer.createFooter({}))},d.prototype.createReloadLink=function(){var c=this,d="office-form-info-reload office-form-info-children";return a.Utilities.isOEmbedSPO()&&(d+=" office-form-theme-spo-link"),this.props.submitAnother?React.DOM.div(null,React.DOM.a({className:d,href:"javascript:void(0)",onClick:function(){return c.props.submitAnother()}},b.Resources.LocalizedStrings.Response_Submit_Again_Link)):void 0},d.prototype.createPremotionLink=function(){var c=this,d="office-form-info-reload office-form-info-children";if(a.Utilities.isOEmbedSPO()&&(d+=" office-form-theme-spo-link"),this.props.ShowPromotionMessage&&!a.Utilities.Flight.isPPTIntegration()&&!a.EnvironmentSettings.IsAssignmentsIntegration){var e={className:d,href:"DesignPage.aspx",onClick:function(){return c.onNavigateToPortal(),!0}};return(a.Utilities.isOEmbed()||a.EnvironmentSettings.IsExternalIntegration||a.Utilities.isOEmbedSPO())&&(e.href="javascript:void(0)",e.onClick=function(){c.onNavigateToPortal();var b=a.Utilities.getNonEmbedQuery(),d=a.EnvironmentSettings.IsExternalIntegration?"../Pages/DesignPage.aspx":"../Pages/DesignPage.aspx?"+jQuery.param(b);return a.Utilities.Html.safeOpen(a.Utilities.Html.getAbsoluteUrl(d)),!0}),React.DOM.div(null,React.DOM.a(e,b.Resources.LocalizedStrings.Renderer_PromotionMessage))}},d.prototype.onNavigateToPortal=function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.ThanksView.NavigateToPortal})},d}(a.ReactComponent)}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createThemeRender=c;var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.mounted=!0,a.imgToLoadBackground=new Image,a}return __extends(d,c),d.prototype.componentWillMount=function(){var a=this,c=this.props.ThemeMaster;c&&(this.observerCallback=function(c){c.NewValues.Name===b.Resources.LocalizedStrings.Customized_Theme_Name&&c.NewValues.BackgroundImage!==a.state.ImageUrl?a.setState({IsBackgroundImgCached:!1,ImageUrl:c.NewValues.BackgroundImage}):a.forceUpdate()},c.observe(this.observerCallback))},d.prototype.componentWillUnmount=function(){var a=this.props.ThemeMaster;this.mounted=!1,a&&a.unobserve(this.observerCallback)},d.prototype.render=function(){var c,d=this,e=this.props.ThemeMaster;if(c=a.Utilities.isOEmbedSPO()&&OfficeFormServerInfo.themeInfo?this.getSPOTheme(OfficeFormServerInfo.themeInfo):e&&e.Model,!c)return null;var f=c.Name,g=c.PrimaryColor,h=c.SecondaryColor,i=c.BackgroundColor,j=c.BackgroundImage;c.BackgroundImage&&c.BackgroundImage.match("url((.*))")&&(j=j.substring(4,j.length-1)),f===b.Resources.LocalizedStrings.Customized_Theme_Name&&j&&(this.state.IsBackgroundImgCached||(this.imgToLoadBackground.src=j,
this.imgToLoadBackground.onload=function(a){d.mounted&&d.setState({IsBackgroundImgCached:!0,ImageUrl:c.BackgroundImage})},j+="_mo"));var k="";return k+=".office-form-theme-primary-color { color : "+g+"; }",k+=".office-form-theme-secondary-color { color : "+h+"; }",k+=".office-form-theme-primary-background { background: "+g+"; }",k+=".office-form-theme-secondary-background { background: "+h+"; }",k+=".office-form-theme-primary-foreground, ",k+=".office-form-theme-primary-foreground a { color: "+g+"; }",k+=".office-form-theme-border-top { border-top-color : "+g+"; }",k+=".office-form-theme-interactive-color { color : "+g+"; }",k+=".office-form-theme-interactive-color:hover { color : "+h+"; }",k+=".office-form-theme-interactive-color:focus { color : "+h+"; }",k+=".office-form-theme-interactive-color:active { color : "+h+"; }",k+=".office-form-theme-button { color: white; background : "+g+"; }",k+=".office-form-theme-button:hover { background : "+h+"; }",k+=".office-form-theme-button:focus { background : "+h+"; }",k+=".office-form-theme-page-background-active.active { background: "+g+"; }",k+=".office-form-theme-page-foreground-active.active, ",k+=".office-form-theme-select-color.active *{ color: "+g+"; }",k+=".office-form-theme-toggle.active { background: "+g+"; border-color: "+g+"; }",k+=".office-form-theme-border { border-color: "+g+"; }",k+=".office-form-theme-button-foreground.active,.office-form-theme-button-foreground.touch.active:hover { color: white; background: "+g+"; outline-color: "+g+"; }",k+=".office-form-theme-button-foreground.active:hover { background: "+h+"; outline-color: "+h+"; }",k+=".office-form-theme-quiz-point { color: "+h+"; }",k+=".office-form-theme-quiz-totalPoints-bar { color: "+g+"; }",k+=".office-form-theme-image-question-background, .office-form-theme-video-question-background { background-color: "+i+"; outline: 1px solid transparent; }",k+=".office-form-theme-image-container-border { border: 3px solid "+i+"; }",k+=".office-form-sort-item.office-form-theme-primary-background { border-color: "+i+"; }",k+=".office-form-sortable-ghost .office-form-theme-sort-item { background:"+i+" }",k+=".office-form-sortable-fallback .office-form-theme-sort-item { background:"+g+" }",k+=".office-form-theme-focus-border .office-form-textfield-input:focus,.office-form-theme-focus-border .form-control:focus,.office-form-theme-focus-border .select-control:focus,.office-form-theme-focus-border .picker--focused .picker__holder:focus{ border-color: "+g+";outline-color: "+g+";}",k+=".design-question-matrix-str .design-question-matrix-subquestion.design-question-theme-border { border-color: "+g+"; }",k+=".office-form-theme-bgcolor-hover:hover { background : "+i+"; }",k+=".office-form-theme-button-color:hover *{ color:"+h+"; }",k+=".form-intelligence-question-row.office-form-intelligence-theme-li { outline: 1px solid "+h+";background-color: "+i+";}",k+=".office-form-insight-theme-control .simple-data-control-content { color : "+g+"; }",k+=".office-form-insight-theme-control .simple-data-control-description { color : "+g+"; }",k+=".office-form-insight-theme-control .simple-data-control-description:hover { color : "+h+"; }",k+=".office-form-insight-theme-control .simple-data-control-description:focus { color : "+h+"; }",k+=".office-form-insight-theme-control .simple-data-control-description:active { color : "+h+"; }",k+=".office-form-info-container .office-form-info-children.office-form-theme-spo-link { color: "+g+"; }",k+=".office-form-info-container .office-form-info-children.office-form-theme-spo-link:hover { color: "+h+"; }",k+=".office-form-spo-embed .office-form-footer-block .office-form-theme-spo-link { color: "+g+"; }",k+=".office-form-spo-embed .office-form-footer-block .office-form-theme-spo-link:hover { color: "+h+"; }",k+=".office-form-theme-spo-link { color: "+g+"; }",k+=".office-form-theme-spo-link:hover { color: "+h+"; }",a.Utilities.isOEmbedSPO()||(j?(k+=".office-form-theme-footer { background: rgba(244,244,244,.8); }",a.Utilities.isMobile()||(k+=".office-form-theme-page-background { background-image: url("+j+"); }")):(k+=".office-form-theme-footer { background : rgba(255,255,255,.5); }",k+=".office-form-theme-page-background { background-color: "+i+"; }")),k+=j&&f!==b.Resources.LocalizedStrings.Customized_Theme_Name?".office-form-theme-shadow { box-shadow : none; }":".office-form-theme-shadow { box-shadow: 0 4px 15px rgba(0,0,0,0.2); }",f===b.Resources.LocalizedStrings.Customized_Theme_Name&&(k+=".office-form-body { opacity: 0.97; }"),a.Utilities.Flight.isFormsProEnabled()&&(k+=".office-FormPro-email-background { background-color: white; }"),React.DOM.style(null,k)},d.prototype.getSPOTheme=function(b){var c=a.ColorHelper.normalizePrimaryColor(b),d={Name:"Customized Theme",Thumbnail:null,PrimaryColor:c,SecondaryColor:a.ColorHelper.primaryHexToSecondaryHex(c),BackgroundColor:a.ColorHelper.primaryHexToBackgroundHex(c),BackgroundImage:null};return d},d}(a.ReactComponent)}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=window.onerror;window.onerror=function(b,d,e,f,g){a.Utilities.OEmbed.notifyFormErrorToParentWindow(g),a.Event.ErrorEvent.logData({type:a.Event.ErrorType.UnhandleException,errorInfo:{message:b,fileName:d,lineNo:e,columnNo:f,stack:g&&g.stack}}),c&&c.apply(this,arguments)}}(b=a.Telemetry||(a.Telemetry={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b=function(){function a(){}return a.ENGAGEMENT="engagement_event",a.ERROR="error_event",a.NAVPERF="nav_perf_event",a.QOS="qos_event",a}();a.EventTypes=b}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},b.logData=function(a,b){void 0===b&&(b=!0),this.buffer.queue(a,b)},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.NavPerfEvent=c}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b=function(){function a(){this.Duration=0,this.TimeStamp=0,this.EventCorrelationId="",this.Properties=""}return a}();a.TelemetryProperties=b}(b=a.Telemetry||(a.Telemetry={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(){return h&&h.SessionId}function d(){var a=$.Deferred();return h?h.flush(function(){return a.resolve()}):a.resolve(),a.promise()}function e(){var b=a.EnvironmentSettings.GetHostString();if(b)return b;var c=a.Utilities.Html.getQueries().origin;if(c)return c;var d=a.Utilities.Html.getQueries().oembedsso;return d?"Forms WebPart":a.Utilities.Flight.isPPTIntegration()?"PowerPoint":void 0}b.getCurrentSessionId=c,b.flushLogs=d,b.getOrigin=e;var f;!function(a){a[a.Designer=0]="Designer",a[a.Responder=1]="Responder",a[a.Unknown=2]="Unknown",a[a.AnalyzeViewer=3]="AnalyzeViewer",a[a.TeamsConfigUser=4]="TeamsConfigUser"}(f||(f={}));var g=function(){function c(){this.sessionId=a.Utilities.Guid.newGuid(),this.sessionDbId="",this.sessionDeviceId=""}return Object.defineProperty(c.prototype,"SessionId",{get:function(){return this.sessionId},enumerable:!0,configurable:!0}),c.prototype.flush=function(a){a()},c.prototype.initialize=function(){var b=this;this.msaTenantIdInUpperCase=a.EnvironmentConfig.getMsaTenantId().toUpperCase(),this.userRole=this.getSessionRole(),this.userType=a.DataProvider.Models.UserType.Unknown,a.EnvironmentConfig.isOsi()&&a.DataProvider.FeaturePlanProvider.getUserType().done(function(a){return b.userType=a}).always(function(){var c={disableCookiesUsage:!0};switch(a.EnvironmentConfig.getEnvironmentType()){case a.EnvironmentType.USGovProd:c.collectorUri="https://tb.pipe.aria.microsoft.com/Collector/3.0";break;case a.EnvironmentType.USDoDProd:c.collectorUri="https://pf.pipe.aria.microsoft.com/Collector/3.0"}var d=b.getCollectorToken();AWTLogManager.initialize(d,c),b.logger=AWTLogManager.getLogger(d),a.Event.EngagementEvent.setLogHandler(b.handleEngagementEvent.bind(b)),a.Event.ErrorEvent.setLogHandler(b.handleErrorEvent.bind(b)),a.Event.NavPerfEvent.setLogHandler(b.handleNavPerfEvent.bind(b)),a.Event.QosEvent.setLogHandler(b.handleQosEvent.bind(b))})},c.prototype.handleEngagementEvent=function(c){var d=new b.TelemetryProperties;d.EventType=a.Event.EventTypes.ENGAGEMENT,d.EventName=(c&&c.name||"no_EngagementName").replace(" ",""),d.EventCorrelationId=a.Utilities.Guid.newGuid(),d.TimeStamp=a.Utilities.DateTime.getTimeStamp(),c&&(d.Properties=JSON.stringify(c.extraData)),this.logEvent(d)},c.prototype.handleErrorEvent=function(c){var d=new b.TelemetryProperties;d.EventType=a.Event.EventTypes.ERROR,d.EventName="no_ErrorName",c&&(d.EventName=a.Event.ErrorType[c.type],d.Properties=JSON.stringify(c.errorInfo||{})),d.EventCorrelationId=a.Utilities.Guid.newGuid(),d.TimeStamp=a.Utilities.DateTime.getTimeStamp(),this.logEvent(d)},c.prototype.handleQosEvent=function(c,d){var e=new b.TelemetryProperties;if(e.EventType=a.Event.EventTypes.QOS,e.TimeStamp=a.Utilities.DateTime.getTimeStamp(),e.EventName="no_QosName",c)if(null!=c.Name&&(e.EventName=c.Name,e.EventName=e.EventName.replace(" ","")),null!=c.CorrelationId&&(e.EventCorrelationId=c.CorrelationId),c.Data&&c.Data.extraData&&(e.Properties=JSON.stringify(c.Data.extraData)),d===a.Event.QosEventType.Start)e.EventName+="."+a.Event.QosEventType[a.Event.QosEventType.Start];else if(d===a.Event.QosEventType.Log)switch(c.Data.resultType){case a.Event.ResultType.Error:case a.Event.ResultType.Info:case a.Event.ResultType.Warning:e.EventName+=".Log."+a.Event.ResultType[c.Data.resultType],c.Data.resultCode&&(e.EventName+="."+c.Data.resultCode)}else if(d===a.Event.QosEventType.End)switch(c.Data.resultType){case a.Event.ResultType.Success:case a.Event.ResultType.Failure:case a.Event.ResultType.ExpectedFailure:e.EventName+="."+a.Event.ResultType[c.Data.resultType]}else e.EventName="no_eventData";d===a.Event.QosEventType.End&&(e.Duration=c.Duration),this.logEvent(e)},c.prototype.handleNavPerfEvent=function(c,d){var e=new b.TelemetryProperties;e.EventType=a.Event.EventTypes.NAVPERF,e.EventName=c&&c.name||"no_NavPerfName",e.EventCorrelationId=a.Utilities.Guid.newGuid(),e.TimeStamp=a.Utilities.DateTime.getTimeStamp(),c&&(d&&this.setCommonNavPerfExtraData(c),e.Properties=JSON.stringify(c.extraData)),this.logEvent(e)},c.prototype.enrichSessionInfo=function(b){if(b.Properties){var c=JSON.parse(b.Properties);c&&(this.sessionDbId=c.DbId,this.sessionDeviceId=c.DeviceId)}var d={};d.DbId=this.sessionDbId,d.DeviceId=this.sessionDeviceId,d.BuildVersion=this.getBuildVersion(),d.SessionRing=this.getSessionRing(),d.SessionUrlPath=window.location.origin+window.location.pathname,d.UserAgent=navigator.userAgent,d.IsMobile=a.Utilities.isMobile(),d.Origin=a.Telemetry.getOrigin(),d.JQueryLoaded=!!window.$;var e=a.Event.EngagementEvent.EVENTNAME_SESSION_START;b.EventType=e,b.EventName=e,b.Duration=0,b.Properties=JSON.stringify(d),b.TimeStamp=a.Utilities.DateTime.getTimeStamp()},c.prototype.logEvent=function(b){b.EventName===a.Event.EngagementEvent.EVENTNAME_SESSION_START&&this.enrichSessionInfo(b),this.logEventWorker(b)},c.prototype.logEventWorker=function(b){var d=new AWTEventProperties;d.setName(b.EventType),d.setProperty(c.EVENT_NAME_KEY,b.EventName),d.setProperty(c.EVENT_CORRELATION_ID_KEY,b.EventCorrelationId),d.setProperty(c.EVENT_DURATION_KEY,this.getNumberAsString(b.Duration)),d.setProperty(c.EVENT_TIMESTAMP_KEY,this.getNumberAsString(b.TimeStamp)),d.setProperty(c.EVENT_DATA_KEY,b.Properties),a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableIntelligenceStatisticLog)&&b.EventName&&b.EventName.indexOf(a.Event.EngagementEvent.IntelligenceStatistic)>=0?this.sendSingleTelemetryEventWithoutUserInfo(d):this.sendSingleTelemetryEvent(d)},c.prototype.sendSingleTelemetryEventWithoutUserInfo=function(b){a.Telemetry.getOrigin()!==a.HostApps[a.HostApps.OneNoteUwp]&&(b.setProperty(c.SOURCE_APP_KEY,c.APPLICATION_NAME),b.setProperty(c.USER_ROLE_ID,this.userRole),b.setProperty(c.USER_TYPE_KEY,this.userType),this.logger.logEvent(b))},c.prototype.sendSingleTelemetryEvent=function(b){if(a.Telemetry.getOrigin()!==a.HostApps[a.HostApps.OneNoteUwp]){var d=OfficeFormServerInfo.userInfo.UserId,e=OfficeFormServerInfo.userInfo.TenantId,f=Forms.Common.getCurrentFormId();if(b.setProperty(c.SOURCE_APP_KEY,c.APPLICATION_NAME),b.setProperty(c.USER_ID_KEY,d),b.setProperty(c.USER_TENANT_ID_KEY,e),b.setProperty(c.USER_ROLE_ID,this.userRole),b.setProperty(c.USER_TYPE_KEY,this.userType),b.setProperty(c.FORM_ID_KEY,f),b.setProperty(c.SESSION_ID_KEY,this.sessionId),e)if(e.toUpperCase()===this.msaTenantIdInUpperCase){var g=OfficeFormServerInfo.userInfo.PUID;b.setProperty(c.USERINFO_ID_KEY,g),b.setProperty(c.USERINFO_IDTYPE_KEY,"MSAPUID")}else b.setProperty(c.USERINFO_ID_KEY,d),b.setProperty(c.USERINFO_IDTYPE_KEY,"UserObjectId"),b.setProperty(c.USERINFO_OMSTENANTID_KEY,e);this.logger.logEvent(b)}},c.prototype.getCollectorToken=function(){var b=a.EnvironmentConfig.getEnvironmentType();switch(b){case a.EnvironmentType.Int:return c.ARIA_INT_TOKEN;case a.EnvironmentType.EDog:return c.ARIA_EDOG_TOKEN;case a.EnvironmentType.WWProd:return a.DataProvider.FeaturePlanProvider.isMsaUser()||Forms.Common.isOwnerMsaUser()?c.ARIA_PROD_RING2_TOKEN:c.ARIA_PROD_TOKEN;case a.EnvironmentType.USGovGccProd:return c.ARIA_GCC_TOKEN;case a.EnvironmentType.USGovProd:return c.ARIA_GCCHigh_TOKEN;case a.EnvironmentType.USDoDProd:return c.ARIA_DoD_TOKEN;default:return c.ARIA_SANDBOX_TOKEN}},c.prototype.getBuildVersion=function(){return OfficeFormServerInfo.version},c.prototype.getSessionRing=function(){var b=a.EnvironmentConfig.getEnvironmentType();switch(b){case a.EnvironmentType.Int:return"Int";case a.EnvironmentType.EDog:return"PreProd";case a.EnvironmentType.WWProd:case a.EnvironmentType.USGovProd:return"Prod";default:return"DevEnv"}},c.prototype.getNumberAsString=function(a){return isNaN(a)||void 0===a||null===a?"0":a.toString()},c.prototype.getSessionRole=function(){var b=a.EnvironmentConfig.getPageType();switch(b){case"Design":return f.Designer;case"Response":return f.Responder;case"Analyze":return f.AnalyzeViewer;case"TeamsConfig":return f.TeamsConfigUser;default:return f.Unknown}},c.prototype.setCommonNavPerfExtraData=function(a){if(a.extraData=a.extraData||{},window.performance){var b=window.performance.timing,c={navigationType:window.performance.navigation.type};c.navigationStart=b.navigationStart,c.unloadEventStart=b.unloadEventStart-b.navigationStart,c.unloadEventEnd=b.unloadEventEnd-b.navigationStart,c.redirectStart=0===b.redirectStart?0:b.redirectStart-b.navigationStart,c.redirectEnd=0===b.redirectEnd?0:b.redirectEnd-b.navigationStart,c.fetchStart=b.fetchStart-b.navigationStart,c.domainLookupStart=b.domainLookupStart-b.navigationStart,c.domainLookupEnd=b.domainLookupEnd-b.navigationStart,c.connectStart=b.connectStart-b.navigationStart,c.connectEnd=b.connectEnd-b.navigationStart,c.requestStart=b.requestStart-b.navigationStart,c.responseStart=b.responseStart-b.navigationStart,c.responseEnd=b.responseEnd-b.navigationStart,c.domLoading=b.domLoading-b.navigationStart,c.domInteractive=b.domInteractive-b.navigationStart,c.domContentLoadedEventStart=b.domContentLoadedEventStart-b.navigationStart,c.domContentLoadedEventEnd=b.domContentLoadedEventEnd-b.navigationStart,c.domComplete=b.domComplete-b.navigationStart,c.loadEventStart=b.loadEventStart-b.navigationStart,c.loadEventEnd=b.loadEventEnd-b.navigationStart,a.extraData.rawTiming=c}},c.APPLICATION_NAME="Office Forms BrowserApp",c.SOURCE_APP_KEY="source_application",c.SESSION_ID_KEY="session_id",c.USER_ID_KEY="user_id",c.USER_TENANT_ID_KEY="user_tenant_id",c.USER_ROLE_ID="user_role",c.USER_TYPE_KEY="user_type",c.FORM_ID_KEY="form_id",c.EVENT_NAME_KEY="event_name",c.EVENT_CORRELATION_ID_KEY="event_correlation_id",c.EVENT_TIMESTAMP_KEY="timestamp",c.EVENT_DURATION_KEY="duration",c.EVENT_DATA_KEY="properties",c.USERINFO_ID_KEY="UserInfo.Id",c.USERINFO_IDTYPE_KEY="UserInfo.IdType",c.USERINFO_OMSTENANTID_KEY="UserInfo.OMSTenantId",c.ARIA_SANDBOX_TOKEN="e132e188c609439ab47cd7b06511fc0a-433f81b3-fab9-415a-882a-ba9e2f91abea-6917",c.ARIA_INT_TOKEN="79beea9c4fdb49a5adab4843729e1fa0-19b42cd4-5bd4-4bf8-8e49-05dc0f7f97f8-7484",c.ARIA_EDOG_TOKEN="725da52713e94a7f8c04e11418b8378d-67b7892c-33c8-439c-a03e-bd0305e0bc8e-6732",c.ARIA_PROD_TOKEN="2ddc7e5f54754fc68f3ae1c5b7f3eb20-1883aa8c-4c7b-42d1-b3d6-c9cdb5956783-7092",c.ARIA_PROD_RING2_TOKEN="5f4ebf0f9a11474199e89f94bc7e2f50-61b8420a-22b1-4220-b531-4a4b96e4edb9-7406",c.ARIA_GCC_TOKEN="aa96061debfd4ec7b9704f62060b4ca6-a498d428-fdba-43da-bc8b-4fe51865cb7f-7984",c.ARIA_GCCHigh_TOKEN="577e32a3275e48c5a639a92c9a8af033-4028cb75-b5f4-4ad0-835e-0e26d79ff209-6823",c.ARIA_DoD_TOKEN="291cebec6b9a4cbf9489bc8cf3a0cc50-06f4c682-bd49-4f88-a8c2-ac582180b7f9-7725",c}(),h=new g;h.initialize()}(b=a.Telemetry||(a.Telemetry={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.Event=b}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){}return a.DefaultPage="Endpoint.DefaultPage",a.DesignPagePortalView="Endpoint.DesignPagePortalView",a.ResponsePage="Endpoint.ResponsePage",a.SurveyAnalyzePage="Endpoint.SurveyAnalyzePage",a.ShareAnalysisPage="Endpoint.ShareAnalysisPage",a.OutlookCreatePollPage="Endpoint.OutlookCreatePollPage",a}();a.Endpoints=b}(b=a.Scenario||(a.Scenario={}))}(b=a.NavPerfEventNames||(a.NavPerfEventNames={}))}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a.SettingsAllowResponderGetAllResponses="Settings.AllowResponderGetAllResponses",a.DisableEditForm="DisableEditForm",a.ResponsePagePollView="ResponsePage.PollView"}(c=b.ExtensionPoints||(b.ExtensionPoints={})),a.Exports.ExtensionPoints=c;var d,e={Poll:[c.SettingsAllowResponderGetAllResponses,c.DisableEditForm,c.ResponsePagePollView],"Teams Poll":[c.DisableEditForm]};!function(c){function d(c,d){var f;if(a.Utilities.Type.isString(c))f=c;else if(c){var g=c;if(g.isFieldReady(b.Model.FormMaster.Schema.OwnerId)&&!g.IsGroupForm&&g.Model.OwnerId!==OfficeFormServerInfo.userInfo.UserId)return!1;f=g.Model.Category}return f?_.contains(e[f],d):!1}c.supportsExtensionPoint=d}(d=b.CategoryExtensionPoints||(b.CategoryExtensionPoints={})),a.Exports.CategoryExtensionPoints=d}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){a[a.Win32OneNote=0]="Win32OneNote",a[a.UWPOneNote=1]="UWPOneNote",a[a.OneNoteClient=2]="OneNoteClient"}(b=a.OEmbedClients||(a.OEmbedClients={}))}(b=a.OEmbed||(a.OEmbed={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(c,d){var f=c.Model.Id;Forms.Common.setFormIdGetter(function(){return f}),Forms.Common.setFormGetter(function(){return b.Model.exportConverter(c)});var h,i=Forms.PerformanceAnalysis,j=i.requestWithPromise("loadForm",d()),n=i.requestWithPromise("responseStrings",b.Resources.loadLocalizedStrings());h=OfficeFormServerInfo.combineScripts?["combined-response"]:["BootStrap","JQuery_RateIt","Linkify","Linkify_JQuery","JQuery_Picker","JQuery_Picker_Date","JQuery_Picker_Time"];var p=i.requestWithPromise("scripts",a.JavaScriptLoader.loadJavaScripts(h));n.fail(function(b){a.Utilities.OEmbed.notifyFormErrorToParentWindow({message:"LoadLocalizedStrings failure, error: "+(b&&b.message)})}),p.fail(function(b){a.Utilities.OEmbed.notifyFormErrorToParentWindow({message:"LoadDependencies failure, error: "+(b&&b.message)})}),j.fail(o).then(function(){return g(c)}).then(function(){return k(c).fail(o)}).done(function(b){$.when(n,p).done(function(){i.onPageReadyToRender(),b&&b.length?l(b,c):m(c),a.Utilities.Flight.isRuntimePageAutoRefreshEnabled()&&e(c)})})}function e(a){var c=a.Synchronizer.query(b.Model.FormMaster.FieldsToResponse);c.done(function(){setTimeout(function(){return e(a)},1e4)}).fail(function(){setTimeout(function(){return e(a)},1e4)})}function f(c){var d,e=Forms.PerformanceAnalysis,f=e.requestWithPromise("responseStrings",b.Resources.loadLocalizedStrings());d=OfficeFormServerInfo.combineScripts?["combined-response"]:["BootStrap","JQuery_RateIt","Linkify","Linkify_JQuery","JQuery_Picker","JQuery_Picker_Date","JQuery_Picker_Time"];var g=e.requestWithPromise("scripts",a.JavaScriptLoader.loadJavaScripts(d));f.fail(function(b){a.Utilities.OEmbed.notifyFormErrorToParentWindow({message:"LoadLocalizedStrings failure, error: "+(b&&b.message)})}),g.fail(function(b){a.Utilities.OEmbed.notifyFormErrorToParentWindow({message:"LoadDependencies failure, error: "+(b&&b.message)})}),$.when(f,g).done(function(){e.onPageReadyToRender(),m(c)})}function g(c){a.Utilities.OEmbed.notifyFormInfoToParentWindow(c);var d=c.SyncContext===b.Model.FormSyncContext.SharedTimeForm;if(j(c))return $.Deferred().reject();var e=a.Utilities.Flight.isPPTIntegration()||a.EnvironmentSettings.IsAssignmentsIntegration;if(window.parent!==window&&!e&&(window.innerWidth<320||window.innerHeight<320||a.Utilities.isAndroid()))return a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.EmbedView.BlockEmbed,extraData:{iFrameWidth:window.innerWidth,iFrameHeight:window.innerHeight,isAndroid:a.Utilities.isAndroid()}}),i(c),$.Deferred().reject();document.title=c.Model.Title;c.SettingMaster;d?a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ShareFormPage.Copy.Navigate}):a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.Navigate})}function h(c,d,e){void 0===d&&(d=!0);var f;e&&(f=e instanceof Error?e.message:e.innerMessage),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.ShowErrorPage,extraData:{errorType:c,message:f}}),b.Resources.loadLocalizedStrings().done(function(){var f=b.createErrorPage({Error:e,ErrorType:c,FormId:a.Utilities.Html.getQueries().id,IsResponsePage:!0,ShowCreateFormLink:d});if(a.Utilities.isOEmbedSPO()&&d){var g=React.DOM.div({className:"embed-view-spo"},b.createThemeRender(),f);ReactDOM.render(g,document.getElementById("content-root"))}else ReactDOM.render(f,document.getElementById("content-root"))})}function i(c){b.Resources.loadLocalizedStrings().done(function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.EmbedView.Navigate});var c=a.Utilities.isOEmbedSPO()?"embed-view office-form-theme-primary-background":"embed-view",d=React.DOM.div({className:c},React.DOM.div({className:"embed-view-container"},a.Control.createFontIconControl({HTMLAttributes:{className:"embed-view-icon"},IconName:"OfficeFormsLogo"}),React.DOM.span({className:"embed-view-content"},b.Resources.LocalizedStrings.Page_Title),React.DOM.a({className:"embed-view-content",onClick:function(){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.EmbedView.OpenInBrowser});var b=a.Utilities.getNonEmbedQuery(),c=window.location.pathname+"?";c+=jQuery.param(b),a.Utilities.Html.safeOpen(a.Utilities.Html.getAbsoluteUrl(c),"_blank","toolbar=yes, menubar=yes")}},b.Resources.LocalizedStrings.EmbedPage_Link)));a.Utilities.isOEmbedSPO()&&(d=React.DOM.div({className:"embed-view-spo"},b.createThemeRender(),d)),ReactDOM.render(d,document.getElementById("content-root"))})}function j(c){if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.ResponseInApp)||!c.Model.Settings.RespondInAppOnly)return!1;var d=!1,e=void 0!==window.browser;if(e)a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.OpenInTakeATest});else{if(a.Utilities.isWin10()){var f="ms-edu-secureassessment:",g="_self",i="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no",j="!enforceLockdown";a.Utilities.Html.safeOpen(f.concat(window.location.href).concat(j),g,i),h("Information",!1,Error(b.Resources.LocalizedStrings.TakeATest_Win10))}else h("Information",!1,Error(b.Resources.LocalizedStrings.TakeATest_NotWin10));d=!0}return d}function k(a){return a.Model.Settings.IsQuizMode&&a.SyncContext===b.Model.FormSyncContext.ResponseTimeForm?Forms.PerformanceAnalysis.requestWithPromise("releasedResponses",a.getReleasedResponsesByResponder(OfficeFormServerInfo.userInfo.Email)):$.Deferred().resolve().promise()}function l(c,d){a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.StudentView.Navigate});var e=c[c.length-1],f={Master:d,ViewMode:b.ViewMode.Auto,Response:e};n(b.createFormRenderer(f))}function m(a){var c=(a.getDefaultResponse(),!a.Model.Settings.IsAnonymous),d=new q(a.Model.Id,c),e={PersistedAnswers:d.Answers,Master:a,DisableSubmitButton:!1,ViewMode:b.ViewMode.Auto,persistAnswer:function(c){d.Answers=c,a.SyncContext===b.Model.FormSyncContext.ResponseTimeForm&&(c?window.onbeforeunload=function(){return""}:window.onbeforeunload=null)}};b.CategoryExtensionPoints.supportsExtensionPoint(a.Model.Category,b.ExtensionPoints.ResponsePagePollView)?b.PollUtil.isDetailResultView()?$.when(a.ensureFieldsReady([b.Model.FormMaster.Schema.Questions,b.Model.FormMaster.Schema.Responses]),a.syncRuntimeResponses()).then(function(){n(b.createPollRenderer(e))},o):n(b.createPollRenderer(e)):n(b.createFormRenderer(e))}function n(b){var c;c=a.Utilities.isOEmbedSPO()?"office-form-theme-page-background office-form-spo-embed":"office-form-theme-page-background",ReactDOM.render(React.DOM.div({id:"form-container",className:c},React.DOM.div({className:"form-content"},b)),document.getElementById("content-root")),window.performance&&a.Event.NavPerfEvent.logData({name:a.Event.NavPerfEventNames.Scenario.Endpoints.ResponsePage,extraData:{timeToSpin:window.performance.timing.domInteractive-window.performance.timing.navigationStart,timeToContentReady:a.Utilities.DateTime.getTimeStamp()-window.performance.timing.navigationStart}})}function o(b){if(b)switch(a.Utilities.OEmbed.notifyFormErrorToParentWindow(b),b.innerCode){case p.FormClosed:h("Information",!0,b);break;case p.EmbedFormNeedAuth:a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.EmbedView.NeedAuth});var c=function(){setTimeout(function(){a.Authenticator.signInThenRefresh()})};a.Authenticator.detectUserLoggedInAAD(c,i);break;case p.NetworkIssue:h("Information",!1,b);break;case p.NoPermission:case p.DisabledByTenantAdmin:case p.InvalidFormId:case p.MultiResponseNotAllowed:case p.FormNotStarted:case p.FormEnded:case p.FormSettingJSONParseError:case p.CopyNotAllowed:case p.IncorrectShareToken:case p.SurveyUrlInvalid:case p.UnableToConnectToFormsPro:h("Information",!0,b);break;case p.GetFormFailed:case p.CDBTableNotFound:default:h("Error",!0,b)}else h("Error",!0)}a.Exports.RuntimeFormPage={showPrintForm:function(a){return f(b.Model.exportConverter(a))},showForm:function(a,c){return d(b.Model.exportConverter(a),c)},showErrorPage:h};var p=a.DataProvider.ErrorCode.InnerCode,q=function(){function b(b,c){void 0===c&&(c=!0),this.storage=c?a.SafeStorage.LocalStorage:a.SafeStorage.SessionStorage,this.formId=b}return b.prototype.getAnswerMapId=function(){return b.KeyPrefix_AnswerMap+this.formId+"."+OfficeFormServerInfo.userInfo.UserId},Object.defineProperty(b.prototype,"Answers",{get:function(){var a=this.storage.getItem(this.getAnswerMapId());if(a){var b=JSON.parse(a);return Array.isArray(b)?b:void(this.Answers=void 0)}},set:function(a){a?this.storage.setItem(this.getAnswerMapId(),JSON.stringify(a)):this.storage.removeItem(this.getAnswerMapId())},enumerable:!0,configurable:!0}),b.KeyPrefix_AnswerMap="officeforms.answermap.",b}();c.showForm=d,c.showPrintForm=f,c.showErrorPage=h}(c=b.RuntimeFormPage||(b.RuntimeFormPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(){e();var c=Forms.PerformanceAnalysis.requestWithPromise("pre-auth",a.Authenticator.handleAuthForContentPage(!1));c.done(function(){a.Event.EngagementEvent.logSessionStartEvent();var c=b.Model.createResponseFormMaster(a.Utilities.Html.getQueries().id);if(b.RuntimeFormPage.showForm(c,function(){return c.ensureReadyToResponse()}),a.Utilities.Html.getQueries().qrcode&&a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.QRCode}),a.Utilities.isOEmbed()){var d=a.Utilities.Html.getQueries().platform,e=a.Utilities.Html.getQueries().host,f=null;(d||e)&&(f={platform:d,host:e}),a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.EmbedView.IsEmbeddedSession,extraData:f})}}).fail(function(a){return b.RuntimeFormPage.showErrorPage("Error",!1,a)})}function e(){var b="forms.scriptloadinglog";if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CheckScriptLoading)){var c=a.SafeStorage.LocalStorage.getItem(b),d=JSON.parse(c);c&&d&&0!==d.length&&(d.forEach(function(b){switch(b.result){case"start":a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.LoadingScript.Start,extraData:{timestamp:b.timestamp,session:b.session}});break;case"success":a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.LoadingScript.Success,extraData:{timestamp:b.timestamp,script:b.script,session:b.session}});break;case"failure":a.Event.EngagementEvent.logData({name:a.Event.EngagementEventNames.ResponsePage.LoadingScript.Failure,extraData:{timestamp:b.timestamp,script:b.script,session:b.session}})}}),a.SafeStorage.LocalStorage.removeItem(b))}}a.Exports.ResponsePage=c,c.initializePage=d}(c=b.ResponsePage||(b.ResponsePage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={})),function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=145)}([function(a,b){a.exports=React},function(a,b,c){"use strict";function d(a){var b=a;j.forEach(function(c){var d=b[c];d&&(b[c]=function(){for(var b=[],f=0;f<arguments.length;f++)b[f]=arguments[f];try{return d.apply(a,b)}catch(g){return e(a,c,g),null}})})}function e(a,b,c){try{if(c&&c.stack&&console.log(c.stack),window.onerror){var d=h.findDOMNode(a),e=d&&d.getAttribute("data-reactId")||"",f="Exception in "+a.constructor.name+"["+e+"]:"+b;c&&c.message&&(f+=" Message: "+c.message),window.onerror(f,"",0,0,c)}}catch(c){}}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(6);c(24),c(25);var i=function(a){function b(b){var c=a.call(this,b)||this;return c.state={},d(c),c}return f(b,a),b}(g.Component);b.ReactComponent=i;var j=["componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount","render"]},function(a,b){a.exports=_},function(a,b,c){"use strict";a.exports=Nerve},function(a,b,c){"use strict";function d(a,b){g[a]=b}function e(a){var b=a.Master.Question.Model.Type,c=g[b];if(c)return f.createElement(c,a);throw Error('Type "'+b+'" has not been registered.')}Object.defineProperty(b,"__esModule",{value:!0});var f=c(0);b.registerRendererComponentClass=d,b.createRendererElement=e;var g={};Forms.UX.Renderer.createRendererElement=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b;
}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(2),h=c(31),i=c(27),j=c(1),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.CategoryExtensionPoints,m=OfficeForm.Exports.ExtensionPoints,n=OfficeForm.Exports.FormLimitation,o=OfficeForm.Exports.Models,p=OfficeForm.Exports.QuizRenderer,q=OfficeForm.Exports.Resources,r=OfficeForm.Exports.Utilities,s=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.questionElementRef=f.createRef(),b.videoRatioHeight=9,b.videoRatioWidth=16,b.idPrefix=g.uniqueId("question"),b}return d(b,a),b.prototype.componentWillMount=function(){var a=this;this.update=function(){return a.forceUpdate(function(){var b=a.props.onHeightChange;b&&b()})};var b=this.props.Master;b.Question.Form.observe(this.update,[o.FormMaster.Schema.HasQuestionMedia]),b.observe(this.update),b.Question.observe(this.update);var c=o.ImageInfoMaster.Schema;b.Question.ImageInfoMaster.observe(this.update,[c.ResourceUrl,c.ContentType,c.OriginalFileName]),b.Question.ImageSettingsMaster.observe(this.update)},b.prototype.componentWillUnmount=function(){var a=this.props.Master;a.Question.ImageSettingsMaster.unobserve(this.update),a.Question.ImageInfoMaster.unobserve(this.update),a.Question.unobserve(this.update),a.unobserve(this.update),a.Question.Form.unobserve(this.update)},b.prototype.componentDidMount=function(){var a=$(this.questionElementRef.current),b=a.find(".office-form-question-formula span"),c=a.find(".office-form-question-choice-formula span");a.find("span").not(b).not(c).linkify()},b.prototype.render=function(){var a={className:"office-form-question",ref:this.questionElementRef};if(this.getValidationStyle()===k.ValidationStyles.Error||p.isWrongQuestion(this.props)){var b=this.props.IsMobile?"office-form-error-question-mobile":"office-form-error-question";a.className=r.Html.combineAttributes(a.className,b)}var c=null;this.isRequiredQuestionError()&&(c=k.createLabel({HTMLAttributes:{className:"validation-error-message-label",role:"alert"},Label:q.LocalizedStrings.Required_Question_Error_Message}));var d={className:"office-form-question-content office-form-theme-focus-border"},g=this.props.HTMLAttributes;g&&(d=r.Html.mergeReactProps(g,d));var h=f.createElement("div",e({},d),this.createWrongResultLabel(),this.createTitleContainer(),this.createReactNodes(),c),i=this.createFeedbackBox(),j=null;return void 0!==i&&(a.className=r.Html.combineAttributes(a.className,"office-form-studentview-question"),j=f.createElement("div",{className:"office-form-feedback-marginbottom-box"})),f.createElement("div",e({},a),this.createCoAuthorFacePile(),h,i,j)},b.prototype.createWrongResultLabel=function(){return p.createWrongResultLabel(this.props)},b.prototype.createReactNodes=function(){throw Error("to be overridden.")},b.prototype.isRequiredQuestionError=function(){if(!this.props.ShowValidationStyle)return!1;var a=this.props.Master,b=a.Question.verify(a.Model.Answer);return a.SubQuestionRuntimeMasters.forEach(function(a){a.Question.verify(a.Model.Answer)===o.QuestionValidationResult.RequiredError&&(b=o.QuestionValidationResult.RequiredError)}),b===o.QuestionValidationResult.RequiredError},b.prototype.getValidationStyle=function(){if(!this.props.ShowValidationStyle)return k.ValidationStyles.None;var a=this.props.Master,b=a.Question.verify(a.Model.Answer);return a.SubQuestionRuntimeMasters.forEach(function(a){a.Question.verify(a.Model.Answer)===o.QuestionValidationResult.RequiredError&&(b=o.QuestionValidationResult.RequiredError)}),b===o.QuestionValidationResult.Success?k.ValidationStyles.Success:k.ValidationStyles.Error},b.prototype.getQuestionId=function(){return this.idPrefix},b.prototype.getRequiredId=function(){return this.props.Master.Question.Model.Required?this.idPrefix+"-required":void 0},b.prototype.getQuestionTypeId=function(){return this.idPrefix+"-questiontype"},b.prototype.getElementProps=function(a){var b={"aria-describedby":this.getSubtitleId(),"aria-labelledby":r.Html.combineAttributes(this.getOrdinalId(),this.getTitleId(),this.getRequiredId(),this.getQuestionTypeId())};return a?r.Html.mergeReactProps(a,b):b},b.prototype.createFeedbackBox=function(){var a=this.props.Master.SubQuestionRuntimeMasters,b=a[a.length-1],c=b&&b.Model,d=(c||this.props.Master.Model).AnswerEntity,e=d&&d.Feedback;if(!this.props.IsStudentViewMode||!e)return void 0;var g={HTMLAttributes:{className:r.Html.combineAttributes("feedback-icon forms-icon-size16x16",r.isEdge()?"edge":void 0,r.isIE()?"ie":void 0),role:"presentation"},IconName:"Chat"};return f.createElement("div",{className:"office-form-feedback-box"},k.createFontIconControl(g),f.createElement("div",{className:"office-form-feedback-content"},k.createRenderNewlines({content:e})))},b.prototype.createTitleLabel=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Question.Form.Model.HasQuestionMedia,c=this.isImageLayout()?a.Title:q.LocalizedStrings.Renderer_QuestionTitle.format(this.props.Ordinal,a.Title),d=!this.props.HideMedia&&(a.ImageInfo&&a.ImageInfo.ResourceUrl||b)?"office-form-question-title with-image":"office-form-question-title",e=this.props.Master.Question.Form,g=l.supportsExtensionPoint(e,m.ResponsePagePollView);g&&(c=a.Title);var h={"aria-level":2,className:d,id:this.getTitleId(),role:"heading"},i=a.Required?q.LocalizedStrings.Accessibility_RequiredAnswer:void 0,j=null;i&&(j=f.createElement("div",null,f.createElement("span",{className:"accessibility-reader-no-display",id:this.getRequiredId()},i)));var n=this.createQuestionTypeHint(),o=null;n&&(o=f.createElement("div",null,f.createElement("span",{className:"accessibility-reader-no-display",id:this.getQuestionTypeId()},n)));var r={children:[j,o,p.createQuizPointLabel(this.props)],HTMLAttributes:h,Label:c,Ordinal:this.props.Ordinal,QuestionSuffix:this.createQuestionSuffix(),ShowRequiredStar:a.Required,Theme:this.props.Theme};return k.createLabel(r)},b.prototype.createQuestionTypeHint=function(){var a=this.props.Master.Question.Model,b=a.Type,c="";switch(b){case o.QuestionType.Choice:c=a.ChoiceType===o.ChoiceType.MultiChoice?q.LocalizedStrings.QuestionType_MultiChoice:q.LocalizedStrings.QuestionType_SingleChoice;break;case o.QuestionType.DateTime:c=q.LocalizedStrings.QuestionType_DateTime;break;case o.QuestionType.Rating:c=q.LocalizedStrings.QuestionType_Rating;break;case o.QuestionType.TextField:c=a.Multiline?q.LocalizedStrings.QuestionType_MultiLineText:q.LocalizedStrings.QuestionType_SingleLineText;break;case o.QuestionType.Ranking:c=q.LocalizedStrings.QuestionType_Ranking;break;case o.QuestionType.MatrixChoiceGroup:c=q.LocalizedStrings.QuestionType_MatrixChoiceGroup}return c},b.prototype.createQuestionSuffix=function(){var a=this.props.Master.Question.Model;return a.Type===o.QuestionType.Choice&&a.ChoiceType===o.ChoiceType.MultiChoice&&a.HasMaxSelectionCount?q.LocalizedStrings.Question_MaxSelectionCountSuffix.format(a.MaxSelectionCount):void 0},b.prototype.createTitleOrdinal=function(){return f.createElement("div",{className:"office-form-question-ordinal office-form-theme-primary-background"},f.createElement("span",{id:this.getOrdinalId()},this.props.Ordinal))},b.prototype.createTitleContainer=function(){var a,b,c,d=this.props.Master.Question,g=d.Model,h=d.Form.Model.HasQuestionMedia,i={},j="office-form-question-subtitle",l=this.props.IsMobile||r.isSmallScreen()||g.ImageSettings.Layout===o.ImageLayout.Horizontal&&g.ImageSettings.Size===o.ImageSize.Large,m=l||g.VideoInfo&&g.VideoInfo.Url;if(this.props.HideMedia||g.VideoInfo&&g.VideoInfo.Url||!(g.ImageInfo&&g.ImageInfo.ResourceUrl||h||g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Uploading||g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Picking)){if(!this.props.HideMedia&&g.VideoInfo&&g.VideoInfo.Url){i.className=r.Html.combineAttributes(i.className,"question-title-container office-form-theme-video-question-background");var p={allowFullScreen:!0,frameBorder:"0",height:this.calcVideoDisplayHeight(),sandbox:"allow-scripts allow-same-origin allow-popups",src:g.VideoInfo.Url,width:"100%"};a=f.createElement("div",{className:"office-form-question-video-container"},f.createElement("iframe",e({},p))),j="office-form-question-subtitle with-video"}}else{i.className="question-title-container office-form-theme-image-question-background",j="office-form-question-subtitle with-image";var q=l?"office-form-question-horizontal-large-image-container office-form-theme-image-container-border":"office-form-question-image-container office-form-theme-image-container-border";if(g.ImageInfo&&g.ImageInfo.ResourceUrl){var s=d.ImageSettingsMaster.validateImageSettings(),t={className:q,style:l?void 0:{width:"{0}px".format(s.ContainerWidth)}},u=OfficeForm.Exports.createImageSpinner(g.ImageInfo);a=f.createElement("div",e({},t),f.createElement(OfficeForm.Exports.ImageRenderer,{Image:d.ImageInfoMaster,ImageSettings:d.ImageSettingsMaster,ImageType:"Question"}),u)}else if(g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Uploading||g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Picking){var t={className:q,style:{height:"{0}px".format(n.ImagePlaceHolderHeight),width:"{0}px".format(n.ImagePlaceHolderWidth)}};a=f.createElement("div",e({},t),OfficeForm.Exports.createImageSpinner())}}if(this.isSubtitleLayout())if(g.IsMathQuiz&&!g.IsPlainTextInMathField){var v=k.createFormulaRenderer({DisableLinebreaks:this.props.DisableFormulaLinebreak,Formula:g.Subtitle,onRenderComplete:this.props.onHeightChange});b=f.createElement("div",{className:"office-form-question-formula"},v)}else c=k.createLabel({HTMLAttributes:{className:j,id:this.getSubtitleId()},Label:g.Subtitle});return f.createElement("div",{className:"question-title-box"},f.createElement("div",e({},i),m?void 0:a,this.isImageLayout()?this.createTitleOrdinal():void 0,this.createTitleLabel(),c,m?a:void 0,b))},b.prototype.createCoAuthorFacePile=function(){var a,b=this,c=this.props.Master.Question.Model,d=c.CoAuthors&&c.CoAuthors.length>0;if(d&&c.CoAuthors[c.CoAuthors.length-1].userId!==OfficeFormServerInfo.userInfo.UserId){var j=g.map(c.CoAuthors,function(a){if(a.userId!==OfficeFormServerInfo.userInfo.UserId){var c={ariaLabel:q.LocalizedStrings.DesignPage_NavBar_CoAuthor_Screen_Reader.format(a.displayName||a.userId,b.props.Ordinal),displayText:i.getDisplayText(a.firstName||"",a.lastName||""),email:a.email,isCoAuthUser:!0,key:a.userId,name:a.displayName,tooltip:a.displayName||a.userId};return f.createElement(h.AuthorFacePile,e({},c))}});a=f.createElement("div",{className:"question-coAuthor-notification-container-render-mode"},j)}return a},b.prototype.calcVideoDisplayHeight=function(){if(r.isMobile()){var a=$(window).width();return 0===a&&(a=document.body.scrollWidth),a/(this.videoRatioWidth/this.videoRatioHeight)}return n.DefaultVideoHeight},b.prototype.getOrdinalId=function(){return this.isImageLayout()?this.idPrefix+"-ordinal":void 0},b.prototype.getTitleId=function(){return this.idPrefix+"-title"},b.prototype.getSubtitleId=function(){return this.isSubtitleLayout()?this.idPrefix+"-subtitle":void 0},b.prototype.isImageLayout=function(){var a=this.props.Master.Question.Form.Model.HasQuestionMedia;return a&&!this.props.HideMedia},b.prototype.isSubtitleLayout=function(){var a=this.props.Master.Question.Model;return a.ShowSubtitle&&!!a.Subtitle},b}(j.ReactComponent);b.QuestionRendererBase=s},function(a,b){a.exports=ReactDOM},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d;!function(a){a[a.BackSpace=8]="BackSpace",a[a.Tab=9]="Tab",a[a.Enter=13]="Enter",a[a.Shift=16]="Shift",a[a.Esc=27]="Esc",a[a.Space=32]="Space",a[a.End=35]="End",a[a.Home=36]="Home",a[a.ArrowLeft=37]="ArrowLeft",a[a.ArrowUp=38]="ArrowUp",a[a.ArrowRight=39]="ArrowRight",a[a.ArrowDown=40]="ArrowDown",a[a.Delete=46]="Delete",a[a.Eight=56]="Eight",a[a.PlaceHolder=229]="PlaceHolder"}(d=b.KeyCode||(b.KeyCode={}))},function(a,b,c){"use strict";function d(a){return a.map(f)}function e(a,b){var c=o.FieldsForCreatingForm.map(n.getFieldSchemaInfo).map(function(a){return a.Name});a=m.pick(a,c);var d=new o(p.DesignTimeForm,{ExistingInDataSource:!1,InitialData:a},"Group"===b);return r[d.getInstanceId()]=d,d.fieldsReady([o.Schema.Id]).done(function(){q[d.Model.Id]=d}),s.trigger(d),d}function f(a){var b=q[a.Id];if(b){var c=n.convertToSourceData(a,o.Schema);return b.Synchronizer.onSourceDataReceived(c),b}var d=OfficeForm.Exports.Utilities.FormId.decodeFormId(a.Id);return a=m.clone(a),a.OwnerId=d.OwnerId,a.OwnerTenantId=d.OrgId,a.TableId=d.TableId,b=new o(p.DesignTimeForm,{ExistingInDataSource:!0,InitialData:a},d.IsGroupOwner),r[b.getInstanceId()]=b,q[a.Id]=b,s.trigger(b),b}function g(a){return r[a]}function h(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a);return new o(p.ResponseTimeForm,{ExistingInDataSource:!0,InitialData:{Id:a,OwnerId:b.OwnerId,OwnerTenantId:b.OrgId,TableId:b.TableId}},b.IsGroupOwner)}function i(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a);return new o(p.SharedTimeForm,{ExistingInDataSource:!0,InitialData:{Id:a,OwnerId:b.OwnerId,OwnerTenantId:b.OrgId,TableId:b.TableId}},b.IsGroupOwner)}function j(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a);return new o(p.AnalysisTimeForm,{ExistingInDataSource:!0,InitialData:{Id:a,OwnerId:b.OwnerId,OwnerTenantId:b.OrgId,TableId:b.TableId}},b.IsGroupOwner)}function k(a){return new o(p.LocalForm,{InitialData:a},!1)}function l(a){s.register(a)}Object.defineProperty(b,"__esModule",{value:!0});var m=c(2),n=c(3);c(13);var o=OfficeForm.Exports.Models.FormMaster,p=OfficeForm.Exports.Models.FormSyncContext,q={},r={},s=new OfficeForm.Exports.Utilities.Process.CallbackManager;b.getDesignFormMasters=d,b.createNewFormMaster=e,b.getDesignFormMaster=f,b.getFormMasterByInstanceId=g,b.createResponseFormMaster=h,b.createSharedFormMaster=i,b.createAnalysisFormMaster=j,b.createLocalFormMaster=k;var t=Forms.Models.FormManager;t.createNewFormMaster=e,t.getDesignFormMaster=f,t.onFormMasterCreated=l},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=OfficeForm.Exports.EnvironmentConfig,e=OfficeForm.Exports.Utilities.FormId,f=null,g=null;Forms.Common.setFormIdGetter=function(a){return f=a},Forms.Common.getCurrentFormId=function(){return f&&f()},Forms.Common.setFormGetter=function(a){return g=a},Forms.Common.getCurrentForm=function(){return g&&g()},Forms.Common.isOwnerMsftUser=function(){var a=e.decodeFormId(Forms.Common.getCurrentFormId()||"");return!!a.OrgId&&a.OrgId.toLowerCase()===d.getMsftTenantId()},Forms.Common.isOwnerMsaUser=function(){var a=e.decodeFormId(Forms.Common.getCurrentFormId()||"");return!!a.OrgId&&a.OrgId.toLowerCase()===d.getMsaTenantId()}},function(a,b,c){"use strict";function d(a){return a?e[a]||null:b.defaultPredefinedTheme}Object.defineProperty(b,"__esModule",{value:!0});var e={};b.getPredefinedThemeByName=d,b.predefinedThemes=[{BackgroundColor:"#E8F2F4",BackgroundImage:null,Name:"Teal",PrimaryColor:"#008272",SecondaryColor:"#004B50",Thumbnail:null},{BackgroundColor:"#F7F1F7",BackgroundImage:null,Name:"Raspberry",PrimaryColor:"#8D398F",SecondaryColor:"#712E72",Thumbnail:null},{BackgroundColor:"#FCF2F0",BackgroundImage:null,Name:"Dark_Orange",PrimaryColor:"#CE4B28",SecondaryColor:"#BC2E1B",Thumbnail:null},{BackgroundColor:"#F6EFF2",BackgroundImage:null,Name:"Pomegranate",PrimaryColor:"#911844",SecondaryColor:"#4E0D25",Thumbnail:null},{BackgroundColor:"#FAEDF7",BackgroundImage:null,Name:"Pink",PrimaryColor:"#BF3088",SecondaryColor:"#BC2075",Thumbnail:null},{BackgroundColor:"#F2F8E7",BackgroundImage:null,Name:"Bright_Green",PrimaryColor:"#0E8906",SecondaryColor:"#448715",Thumbnail:null},{BackgroundColor:"#ECF8FE",BackgroundImage:null,Name:"Bright_Blue",PrimaryColor:"#0078D7",SecondaryColor:"#0D5BC3",Thumbnail:null},{BackgroundColor:"#E7EDF3",BackgroundImage:null,Name:"Medium_Dark_Blue",PrimaryColor:"#004B8B",SecondaryColor:"#032D63",Thumbnail:null},{BackgroundColor:"#F4EBDC",BackgroundImage:"../../Images/Theme/office.png",Name:"Office",PrimaryColor:"#B84F22",SecondaryColor:"#cb6a07",Thumbnail:"../../Images/Theme/office-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/ocean.png",Name:"Ocean",PrimaryColor:"#1D5482",SecondaryColor:"#143350",Thumbnail:"../../Images/Theme/ocean-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/sky.png",Name:"Sky",PrimaryColor:"#006DB2",SecondaryColor:"#075F9C",Thumbnail:"../../Images/Theme/sky-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/ski.png",Name:"Ski",PrimaryColor:"#006DB2",SecondaryColor:"#075F9C",Thumbnail:"../../Images/Theme/ski-thumbnail.png"},{BackgroundColor:"#EAF4DC",BackgroundImage:"../../Images/Theme/city01.png",Name:"City01",PrimaryColor:"#3A501D",SecondaryColor:"#2A3B13",Thumbnail:"../../Images/Theme/city01-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/city02.png",Name:"City02",PrimaryColor:"#024582",SecondaryColor:"#00315D",Thumbnail:"../../Images/Theme/city02-thumbnail.png"},{BackgroundColor:"#EAF4DC",BackgroundImage:"../../Images/Theme/chemistry.png",Name:"Chemistry",PrimaryColor:"#025700",SecondaryColor:"#013D00",Thumbnail:"../../Images/Theme/chemistry-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/astronomy.png",Name:"Astronomy",PrimaryColor:"#0A1431",SecondaryColor:"#030716",Thumbnail:"../../Images/Theme/astronomy-thumbnail.png"},{BackgroundColor:"#F5F2FF",BackgroundImage:"../../Images/Theme/office2.png",Name:"Office02",PrimaryColor:"#562685",SecondaryColor:"#32145A",Thumbnail:"../../Images/Theme/office2-thumbnail.png"},{BackgroundColor:"#E6EDF3",BackgroundImage:"../../Images/Theme/meeting.png",Name:"Meeting",PrimaryColor:"#053870",SecondaryColor:"#032D63",Thumbnail:"../../Images/Theme/meeting-thumbnail.png"}],b.predefinedThemes.forEach(function(a,c){a=Object.freeze(a),b.predefinedThemes[c]=a,e[a.Name]=a}),b.defaultPredefinedTheme=b.predefinedThemes[0],b.customizedThemeName="Customized Theme",b.defaultCustomizedBackgroundColor="#E8F2F4",b.defaultCustomizedPrimaryColor="#008272",b.defaultCustomizedSecondaryColor="#004B50",Forms.Models.predefinedThemes=b.predefinedThemes,Forms.Models.defaultTheme=b.defaultPredefinedTheme,Forms.Models.defaultCustomizedBackgroundColor=b.defaultCustomizedBackgroundColor,Forms.Models.defaultCustomizedPrimaryColor=b.defaultCustomizedPrimaryColor,Forms.Models.defaultCustomizedSecondaryColor=b.defaultCustomizedSecondaryColor},function(a,b,c){"use strict";function d(a){var b=[],c=Object.keys(a);return c.forEach(function(c){a[c]&&(b=b.concat(t[c]))}),b}function e(a){var b=g(a),c={className:"forms-icon-size20x20 office-form-theme-quiz-point analyze-view-file-icon",style:{color:b.Color}};return h.createElement(i.FontIconControl,{HTMLAttributes:c,IconName:b.Name})}function f(a){switch(a){case"Audio":return j.LocalizedStrings.UploadFile_Type_Audio;case"Excel":return j.LocalizedStrings.UploadFile_Type_Excel;case"Image":return j.LocalizedStrings.UploadFile_Type_Image;case"PDF":return j.LocalizedStrings.UploadFile_Type_PDF;case"PowerPoint":return j.LocalizedStrings.UploadFile_Type_PowerPoint;case"Text":return j.LocalizedStrings.UploadFile_Type_Text;case"Video":return j.LocalizedStrings.UploadFile_Type_Video;case"Word":return j.LocalizedStrings.UploadFile_Type_Word;default:return""}}function g(a){var b=a.split("."),c=b[b.length-1].toLowerCase(),d=u[s[c]];return d||{Color:"#666666",Name:"TextDocument"}}Object.defineProperty(b,"__esModule",{value:!0});var h=c(0),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Resources,k=["mp3","aif","iff","m3u","m4a","mid","mpa","ra","wav","wma"],l=["xls","xlt","xlm","xlsx","xlsm","xltx","xltm"],m=["jpg","jpeg","png","gif","bmp","tiff","psd","thm","yuv","ai","drw","eps","ps","svg","3dm","max"],n=["pdf"],o=["ppt","pot","pps","pptx","pptm","potx","potm","ppam","ppsx","ppsm","sldx","sldm"],p=["txt","rtf","wpd","wps","log","msg","pages"],q=["avi","mp4","mov","wmv","asf","3g2","3gp","asx","flv","mpg","rm","swf","vob"],r=["doc","dot","wbk","docx","docm","dotx","dotm","docb"],s={};k.forEach(function(a){return s[a]="Audio"}),l.forEach(function(a){return s[a]="Excel"}),m.forEach(function(a){return s[a]="Image"}),n.forEach(function(a){return s[a]="PDF"}),o.forEach(function(a){return s[a]="PowerPoint"}),p.forEach(function(a){return s[a]="Text"}),q.forEach(function(a){return s[a]="Video"}),r.forEach(function(a){return s[a]="Word"});var t={Audio:k,Excel:l,Image:m,PDF:n,PowerPoint:o,Text:p,Video:q,Word:r},u={Audio:{Color:"#666666",Name:"Microphone"},Excel:{Color:"#217346",Name:"ExcelDocument"},Image:{Color:"#666666",Name:"Photo2"},PDF:{Color:"#666666",Name:"PDF"},PowerPoint:{Color:"#B7472A",Name:"PowerPointDocument"},Text:{Color:"#666666",Name:"TextField"},Video:{Color:"#666666",Name:"Video"},Word:{Color:"#2B579A",Name:"WordDocument"}};b.getAcceptedFileTypes=d,b.getFileIcon=e,b.convertFileTypeToString=f,Forms.UX.FileUpload.getFileIcon=e,Forms.UX.FileUpload.getFileIconInDetailTable=function(a){var b=g(a);return'<i class="ms-Icon ms-Icon--'+b.Name+' forms-icon-size20x20 response-dialog-fileIcon office-form-theme-quiz-point" style="color: '+b.Color+';"></i>'}},,function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(14)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=c(10),g=OfficeForm.Exports.Models.FormMaster,h=e.Spec,i={BackgroundColor:h.string({IsLocalField:!0}),BackgroundImage:h.string({IsLocalField:!0}),Name:h.string(),PrimaryColor:h.string({IsLocalField:!0}),SecondaryColor:h.string({IsLocalField:!0}),Thumbnail:h.string({IsLocalField:!0})},j=function(a){function b(b){var c=a.call(this,b)||this;if(b.MasterTreeReady){var d=g.Schema;b.MasterTreeReady.then(function(){return c.Form.fieldsReady([d.Theme])}).then(function(){return c.Form.ensureFieldsReady([d.PrimaryCustomizedThemeColor,d.SecondaryCustomizedThemeColor,d.TertiaryCustomizedThemeColor,d.Background])}).done(function(){return c.initialize()})}return c}return d(b,a),Object.defineProperty(b.prototype,"Form",{get:function(){return this.Parent},enumerable:!0,configurable:!0}),b.prototype.isCustomized=function(){var a=this.Model.Name;return!!a&&!f.getPredefinedThemeByName(a)},b.prototype.getCustomizedTheme=function(){var a=this.Form.Model;return{BackgroundColor:a.TertiaryCustomizedThemeColor||f.defaultCustomizedBackgroundColor,BackgroundImage:a.Background.ResourceUrl,Name:f.customizedThemeName,PrimaryColor:a.PrimaryCustomizedThemeColor||f.defaultCustomizedPrimaryColor,SecondaryColor:a.SecondaryCustomizedThemeColor||f.defaultCustomizedSecondaryColor,Thumbnail:null}},b.prototype.initialize=function(){var a=this;this.addRule({Name:"calculate theme basing on name",onChange:function(b){b.BeingDeleted||a.calculateThemeProperties()}});var b=g.Schema;this.Form.observe(function(){return a.calculateThemeProperties()},[b.PrimaryCustomizedThemeColor,b.SecondaryCustomizedThemeColor,b.TertiaryCustomizedThemeColor,b.Background.ResourceUrl]),this.calculateThemeProperties()},b.prototype.calculateThemeProperties=function(){var a=f.getPredefinedThemeByName(this.Model.Name)||this.getCustomizedTheme();this.setData(a)},b}(e.createObjectMasterClass("FormTheme",i));b.FormThemeMaster=j,Forms.Models.FormThemeMaster=j},,,function(a,b,c){"use strict";function d(){return g&&"rejected"!==g.state()||(g=i.createDataProvider().getOD4BToken()),g}function e(){return g&&"pending"===g.state()||(g=i.createDataProvider().getOD4BToken()),g}function f(a){return d().then(a).then(function(a){return a},function(b){return b&&b.response&&b.response.statusCode===h.Unauthorized?e().then(a):b})}Object.defineProperty(b,"__esModule",{value:!0});var g,h,i=OfficeForm.Exports.DataProvider;!function(a){a[a.Unauthorized=401]="Unauthorized"}(h||(h={})),b.sendRequestWithToken=f},function(a,b,c){"use strict";function d(a){var b=JSON.stringify({item:{"@microsoft.graph.conflictBehavior":"rename"}});return f.sendRequestWithToken(function(c){return g.OData.send({body:b,headers:{Authorization:c,"Content-Type":"application/json"},method:"POST",qosEventName:j,requestUri:a}).then(function(a){if(null==a)return $.Deferred().reject(new Error("no data return")).promise();var b={bytesToSend:0,deferred:$.Deferred(),exporationDateTime:a.expirationDateTime,uploadUrl:a.uploadUrl};return b})})}function e(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a),c=b.OwnerId,d=b.OrgId,e=b.IsGroupOwner?"groups":"users";return d+"/"+e+"/"+c}Object.defineProperty(b,"__esModule",{value:!0});var f=c(17),g=OfficeForm.Exports.DataProvider,h=OfficeForm.Exports.EnvironmentConfig,i="FileUpload.CancelUploadFile",j="FileUpload.CreateUploadSession",k="FileUpload.DeleteFile",l="FileUpload.GetOD4BFolderPath",m="FileUpload.UploadLargeFile",n="FileUpload.UploadFile",o=h.isProduction()?"https://graph.microsoft.com/v1.0/":"https://graph.microsoft-ppe.com/v1.0/",p=function(){function a(a){this.formId=a}return a.prototype.createFileUploadSession=function(a){var b=""+o+e(this.formId)+"/drive/special/approot:/Temp/"+(a+":/createUploadSession");return d(b)},a.prototype.createFileUploadSessionWithTempFolder=function(a,b){var c=""+o+e(this.formId)+"/drive/items/"+a+(":/"+b+":/createUploadSession");return d(c)},a.prototype.cancelUploadFile=function(a){return f.sendRequestWithToken(function(b){return g.OData.send({headers:{Authorization:b},method:"DELETE",qosEventName:i,requestUri:a})})},a.prototype.deleteUploadFile=function(a){var b=this;return f.sendRequestWithToken(function(c){return g.OData.send({headers:{Authorization:c},method:"DELETE",qosEventName:k,requestUri:""+o+e(b.formId)+"/drive/items/"+a})})},a.prototype.uploadBytesToSession=function(a,b,c,d,e,h){return f.sendRequestWithToken(function(c){return g.OData.send({body:b,headers:{"Content-Range":"bytes "+d+"-"+e+"/"+h,"Content-Type":"*/*"},method:"PUT",qosEventName:m,requestUri:a.uploadUrl}).then(function(a){return e===h-1?{fileType:a.file.mimeType,id:a.id,link:a.webUrl,name:a.name,referenceId:a.parentReference.id,size:a.size,status:1}:void 0})})},a.prototype.uploadSmallFile=function(a,b){var c=this,d=$.Deferred(),h=new FileReader;return h.readAsArrayBuffer(a),h.onloadend=function(){f.sendRequestWithToken(function(a){return g.OData.send({body:h.result,headers:{Authorization:a,"Content-Type":"text/plain"},method:"PUT",qosEventName:n,requestUri:""+o+e(c.formId)+"/drive/special/approot:/Temp/"+(b+":/content")}).then(function(a){d.resolve({fileType:a.file.mimeType,id:a.id,link:a.webUrl,name:a.name,referenceId:a.parentReference.id,size:a.size,status:1})},function(a){d.reject(a)})})},d.promise()},a.prototype.getFileFolder=function(a){var b=this;return f.sendRequestWithToken(function(c){return g.OData.send({headers:{Authorization:c,"Content-Type":"*/*"},method:"GET",qosEventName:l,requestUri:""+o+e(b.formId)+"/drive/items/"+a}).then(function(a){return a.webUrl})})},a}();b.FileUploadProcessProvider=p,Forms.DataProvider.FileUploadProcessProvider=p},function(a,b,c){"use strict";function d(a,b){var c=b.bytesToSend?b.bytesToSend:0,d=i.FileUploadMaxChunkBytes,e=a.size-b.bytesToSend;e>d&&(e=d);var f=c+e-1;return{chunkSize:e,finalByteIndex:f,initialByteIndex:c}}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(3),g=c(18),h=f.Spec,i=OfficeForm.Exports.FormLimitation,j={fileId:h.string(),hasFile:h["boolean"](),uploadSession:h.reference()},k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.formId="",b}return e(b,a),b.prototype.uploadLargeFile=function(a,b,c){var d=this;return new g.FileUploadProcessProvider(c).createFileUploadSession(b).then(function(b){return d.uploadLargeFileInternal(a,b)})},b.prototype.uploadLargeFileWithTempFolder=function(a,b,c,d){var e=this;return new g.FileUploadProcessProvider(d).createFileUploadSessionWithTempFolder(b,c).then(function(b){return e.uploadLargeFileInternal(a,b)})},b.prototype.uploadSmallFile=function(a,b,c){return new g.FileUploadProcessProvider(c).uploadSmallFile(a,b)},b.prototype.deleteUploadFile=function(a,b){return new g.FileUploadProcessProvider(b).deleteUploadFile(a)},b.prototype.cancelUploadFile=function(a){return new g.FileUploadProcessProvider(this.formId).cancelUploadFile(a.uploadUrl).done(function(){return a.deferred.reject()})},b.prototype.uploadBytesToSession=function(a,b,c){var e=this;void 0===c&&(c=0);var f=2;if(b&&"rejected"!==b.deferred.state()){if(c>=f)return void this.cancelUploadFile(b);var g=d(a,b),h=new FileReader;h.onerror=function(a){e.cancelUploadFile(b)},h.onload=function(d){e.uploadReadBytesToSession(h.result,a,b,c,g)};var i=a.slice(g.initialByteIndex,g.finalByteIndex+1);h.readAsArrayBuffer(i)}},b.prototype.uploadReadBytesToSession=function(a,b,c,d,e){var f=this;return new g.FileUploadProcessProvider(this.formId).uploadBytesToSession(c,a,e.chunkSize,e.initialByteIndex,e.finalByteIndex,b.size).done(function(a){e.finalByteIndex<b.size-1?(c.bytesToSend=e.finalByteIndex+1,f.uploadBytesToSession(b,c)):c.deferred.resolve(a)}).fail(function(a){f.uploadBytesToSession(b,c,d+1)})},b.prototype.uploadLargeFileInternal=function(a,b){return this.Model.uploadSession=b,this.uploadBytesToSession(a,b),b.deferred.promise()},b}(f.createObjectMasterClass("UploadFileProcessMaster",j));b.FileUploadProcessMaster=k},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0);c(39);var g=c(19),h=c(11),i=c(1),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.Event,l=OfficeForm.Exports.Flighting,m=OfficeForm.Exports.Resources,n="ResponsePage.FileUpload.UploadFile",o="ResponsePage.FileUpload.CancelUpload",p="ResponsePage.FileUpload.DeleteFile",q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.showFileNameTimeOut=2e3,b.waitingToShowErrorAlert=1e3,b.errorMessageTimeOut=1e4,b.mounted=!1,b.fileUploadElementRef=f.createRef(),b.fileInputRef=f.createRef(),b.state={ErrorMessage:"",IsFocusedOnButton:!0,IsFocusedOnFileContainer:!1,IsUploadingFile:!1,ShowFileName:!1},b.cancelUploadFileCallBack=function(){return b.cancelFileUpload()},b.deleteFileCallBack=function(){return b.deleteFile()},b.uploadFileInPutCallBack=function(){return b.uploadFileInPut()},b}return d(b,a),b.prototype.componentWillMount=function(){this.fileUploadProcessMaster||(this.fileUploadProcessMaster=new g.FileUploadProcessMaster),this.setState({ShowFileName:this.props.IsStudentViewMode}),this.mounted=!0},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.componentDidUpdate=function(){this.fileUploadElementRef.current&&!this.state.IsFocusedOnButton&&this.fileUploadElementRef.current.focus()},b.prototype.render=function(){
return f.createElement("div",e({},this.props.FileUploadProps),this.createShowFileInfoButton(),this.createFileUploadedButton(),this.createUploadingFileButton(),this.createFileUploadDefaultButton(),this.fileInputContainer(),this.errorMessageContainer())},b.prototype.errorMessageContainer=function(){return f.createElement("div",{className:"office-form-upload-file-error-message-container",role:"alert"},this.state.ErrorMessage)},b.prototype.createShowFileInfoButton=function(){if(this.props.Answer&&this.props.ShowFileInfo){var a=JSON.parse(this.props.Answer);if(a.length>0){var b=a[0],c=h.getFileIcon(b.name);return f.createElement("div",{className:"office-form-upload-file-container"},c,f.createElement("a",{href:b.link,target:"_blank"},b.name))}}},b.prototype.createFileUploadedButton=function(){var a=this,b=this.props;if(b.Answer&&this.fileUploadProcessMaster.Model.hasFile||b.IsStudentViewMode){var c=JSON.parse(b.Answer);if(c.length>0){var d=c[0],g=this.state,i=g.ShowFileName?h.getFileIcon(d.name):j.createFontIconControl({HTMLAttributes:{className:"forms-icon-size20x20"},IconName:"CheckMark"}),k={className:"office-form-uploadFile",onBlur:function(b){b.stopPropagation(),a.setState({IsFocusedOnButton:!0})},ref:this.fileUploadElementRef,tabIndex:0,title:g.ShowFileName?d.name:void 0},l={className:"office-form-uploadFile-container",onBlur:function(){a.setState({IsFocusedOnFileContainer:!1})},onFocus:function(){a.setState({IsFocusedOnFileContainer:!0})}},n=g.ShowFileName?void 0:m.LocalizedStrings.UploadFile_Done;return f.createElement("div",e({},l),f.createElement("div",e({},k,{"aria-label":n}),i,this.createFileNameContainer(),this.createUploadedDoneMessage()),this.createDeleteButton())}}},b.prototype.createFileNameContainer=function(){if(this.state.ShowFileName){var a=JSON.parse(this.props.Answer);if(a.length>0){var b=a[0],c="office-form-uploadFile-text office-form-uploadFile-name";return this.props.Disabled?f.createElement("span",{className:c},b.name):f.createElement("a",{className:c,href:b.link,target:"_blank"},b.name)}}},b.prototype.createUploadedDoneMessage=function(){return this.state.ShowFileName?void 0:f.createElement("span",{className:"office-form-uploadFile-text"},m.LocalizedStrings.UploadFile_Done)},b.prototype.createDeleteButton=function(){return this.state.ShowFileName&&!this.props.HideDeleteButton?j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:this.state.IsFocusedOnFileContainer?"office-form-delete-button inline-display":"office-form-delete-button none-display",onClick:this.deleteFileCallBack,title:m.LocalizedStrings.Delete_Button_Narrator},Icon:"Delete",IconClassName:"delete-file-button forms-icon-size16x16",key:"deleteFileButton"}):void 0},b.prototype.createUploadingFileButton=function(){if(!this.props.Answer&&!this.props.IsStudentViewMode&&this.state.IsUploadingFile){var a=j.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"office-form-cancel-fileUpload office-form-theme-primary-foreground office-form-theme-button-color",onClick:this.cancelUploadFileCallBack},Text:m.LocalizedStrings.UploadFile_Cancel_Button}),b={className:"office-form-uploadFile",ref:this.fileUploadElementRef,tabIndex:0},c=m.LocalizedStrings.UploadFile_Doing,d="uploading office-form-theme-primary-color forms-icon-size14x14";return f.createElement("div",{className:"office-form-uploadFile-container"},f.createElement("div",e({},b,{"aria-label":c}),f.createElement(j.FontIconControl,{HTMLAttributes:{className:d},IconName:"Sync"}),f.createElement("span",{className:"office-form-uploadFile-text"},c)),a)}},b.prototype.createFileUploadDefaultButton=function(){var a=this;if(!(this.props.Answer||this.props.IsStudentViewMode||this.state.IsUploadingFile)){var b=this.props,c={className:"office-form-upload-container office-form-theme-primary-foreground",disabled:b.Disabled,onBlur:function(){a.setState({IsFocusedOnButton:!0})},onClick:this.uploadFileInPutCallBack,ref:this.fileUploadElementRef},d=m.LocalizedStrings.UploadFile_Button+"\n                            "+m.LocalizedStrings.UploadFile_AllowFileType_Text.format(this.allowedFileText);c["aria-label"]=d;var e=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"Horizontal",HTMLAttributes:c,Icon:"Upload",IconClassName:"forms-icon-size18x18",Text:m.LocalizedStrings.UploadFile_Button,TextClassName:"office-form-upload-text"});return f.createElement("div",null,e,this.allowedFileTypesMessage())}},b.prototype.uploadFileInPut=function(){$(this.fileInputRef.current).val("").click()},b.prototype.allowedFileTypesMessage=function(){var a=this,b=[],c=Object.keys(this.props.FileTypes);return c.forEach(function(c){a.props.FileTypes[c]&&b.push(h.convertFileTypeToString(c))}),this.allowedFileText=b.join(m.LocalizedStrings.UploadFile_Comma),f.createElement("span",{className:"office-form-upload-allowTypes"},m.LocalizedStrings.UploadFile_AllowFileType_Text.format(this.allowedFileText))},b.prototype.fileInputContainer=function(){var a=this,b=h.getAcceptedFileTypes(this.props.FileTypes),c="";b.forEach(function(a){c+="."+a+","});var d={accept:c,className:"file-upload-question-file-reader",onChange:function(c){var d=c&&c.target,e=d&&d.files,f=e&&e[0];if(f){var g=f.name.split("."),h=g[g.length-1].toLowerCase();if(-1!==b.indexOf(h)){a.setState({ErrorMessage:""});var i=a.fileInputRef.current.value,j=i.replace(/^.*[\\\/]/,"");j=j.replace(/[%#]/g,"-"),a.uploadFile(f,j)}else a.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_WrongFileType_ErrorMessage)}},ref:this.fileInputRef,type:"file"};return f.createElement("input",e({},d))},b.prototype.uploadFile=function(a,b){var c=this;OfficeFormServerInfo.userInfo.UserId||OfficeForm.Exports.Authenticator.redirectToLogin(),this.props.increaseUploadingFileCountCallBack&&this.props.increaseUploadingFileCountCallBack(),this.setState({IsFocusedOnButton:!1,IsUploadingFile:!0,ShowFileName:!1});var d=this.fileUploadProcessMaster;l.Flight.isEnabled(l.Flights.FileUploadOnlyLargeFileAPI)||a.size>OfficeForm.Exports.FormLimitation.FileUploadSmallFileBytes?l.Flight.isEnabled(l.Flights.FileUploadTempFolder)?this.props.createOD4BTempFolderCallBack&&this.props.createOD4BTempFolderCallBack().done(function(d){if(d)c.fileUploadProcessMaster.uploadLargeFileWithTempFolder(a,d,b,c.props.FormId).done(function(a){c.setAnswer(a),setTimeout(function(){c.mounted&&!c.state.ShowFileName&&c.setState({ShowFileName:!0})},c.showFileNameTimeOut)}).fail(function(a){c.uploadFileErrorHandling(a)});else{var e=new Error(m.LocalizedStrings.UploadFile_Default_ErrorMessage);c.uploadFileErrorHandling(e)}}).fail(function(a){c.uploadFileErrorHandling(a)}):d.uploadLargeFile(a,b,this.props.FormId).done(function(a){c.setAnswer(a),setTimeout(function(){c.mounted&&!c.state.ShowFileName&&c.setState({ShowFileName:!0})},c.showFileNameTimeOut)}).fail(function(a){c.uploadFileErrorHandling(a)}):d.uploadSmallFile(a,b,this.props.FormId).done(function(a){c.setAnswer(a)}).fail(function(a){c.uploadFileErrorHandling(a)})},b.prototype.uploadFileErrorHandling=function(a){a&&(this.setState({IsUploadingFile:!1}),this.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_Default_ErrorMessage),this.props.decreaseUploadingFileCountCallBack&&this.props.decreaseUploadingFileCountCallBack())},b.prototype.setAnswer=function(a){k.EngagementEvent.logData({name:n});var b=this.fileUploadProcessMaster.Model;b.fileId=a.id,b.hasFile=!0,this.props.setAnswerCallback(JSON.stringify([a])),this.setState({IsUploadingFile:!1}),this.props.decreaseUploadingFileCountCallBack&&this.props.decreaseUploadingFileCountCallBack()},b.prototype.deleteFile=function(){var a=this,b=this.fileUploadProcessMaster;b.deleteUploadFile(b.Model.fileId,this.props.FormId).done(function(){k.EngagementEvent.logData({name:p}),b.Model.hasFile=!1,a.setState({IsFocusedOnButton:!1}),a.props.setAnswerCallback(null)}).fail(function(){a.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_FailedToDelete_ErrorMessage)})},b.prototype.cancelFileUpload=function(){var a=this,b=this.fileUploadProcessMaster;b.Model.uploadSession&&(k.EngagementEvent.logData({name:o}),b.cancelUploadFile(b.Model.uploadSession).done(function(){a.props.decreaseUploadingFileCountCallBack&&a.props.decreaseUploadingFileCountCallBack(),a.setState({IsUploadingFile:!1})}).fail(function(){a.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_FailedToCancel_ErrorMessage)}))},b.prototype.setErrorMessageWithTimeOut=function(a){var b=this;setTimeout(function(){b.setState({ErrorMessage:a})},this.waitingToShowErrorAlert),setTimeout(function(){b.mounted&&b.state.ErrorMessage&&b.setState({ErrorMessage:""})},this.errorMessageTimeOut)},b}(i.ReactComponent);b.FileUploadQuestionRenderer=q},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(2),h=c(1),i=OfficeForm.Exports.Control.FontIconControl,j=OfficeForm.Exports.Models,k=OfficeForm.Exports.Utilities,l=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.onQuestionChangeCallback=function(){return b.forceUpdate()},b}return d(b,a),b.prototype.componentWillMount=function(){this.props.QuestionMaster.observe(this.onQuestionChangeCallback,[j.QuestionMaster.Schema.Title])},b.prototype.componentWillUnmount=function(){this.props.QuestionMaster.unobserve(this.onQuestionChangeCallback)},b.prototype.render=function(){var a=this.props,b=a.IsMobile,c=a.QuestionIndex;if(b)return f.createElement("div",{className:"office-form-mobile-matrix-points",key:c},this.createMobileQuestionRow());var d=this.props.QuestionOrdinal+"-row-"+(c+1);return f.createElement("tr",{"aria-labelledby":d,className:"office-form-matrix-str",key:c,role:"radiogroup"},this.createQuestionRow(d))},b.prototype.createQuestionRow=function(a){var b=this,c=[],d=f.createElement("span",{className:"office-form-matrix-subquestion",id:a},this.props.QuestionMaster.Model.Title),e=f.createElement("td",{className:"office-form-matrix-std",key:"subQuestionTitle"},d);c.push(e);var h=g.map(this.props.Choices,function(a,c){var d=!1;if(!b.props.ShowDesignInfo){var e=b.props.QuestionRuntimeMaster&&b.props.QuestionRuntimeMaster.Model.Answer;d=e&&g.isEqual(e.id,a.Id)}return b.createMatrixRadio(b.props.QuestionMaster.Model.Id,c,!!d)});return c=c.concat(h)},b.prototype.createMatrixRadio=function(a,b,c){var d=this,g=this.props,h=g.Disabled,i=g.Choices,j=g.IsMobile,k={"aria-checked":c,"aria-labelledby":this.getLabelId(b),"aria-posinset":b+1,"aria-setsize":i.length,checked:c,disabled:h,name:"subquestion-radio"+a,onChange:j?function(){return d.onValueChange(i[b].Id,c)}:void 0,role:"radio",type:"radio"},l=f.createElement("input",e({},k)),m=f.createElement("label",{className:"office-form-matrix-label"},l);if(j)return l;var n={className:"office-form-matrix-radio",key:b,onClick:h?void 0:function(){return d.onValueChange(i[b].Id,c)}};return f.createElement("td",e({},n),m)},b.prototype.getLabelId=function(a){return this.props.QuestionOrdinal+"-col-"+(a+1)},b.prototype.createMobileQuestionRow=function(){var a=this,b=this.props,c=b.QuestionMaster,d=b.Choices,e=b.QuestionRuntimeMaster,h=b.QuestionIndex,i=-1,j=g.map(d,function(b,d){var h=!1;if(!a.props.ShowDesignInfo){var j=e&&e.Model.Answer;h=j&&g.isEqual(j.id,b.Id)}var l=a.createMatrixRadio(c.Model.Id,d,h),m=f.createElement("span",{className:"office-form-question-choice-text-span"},b.Description),n=f.createElement("label",{className:"office-form-question-choice-row office-form-question-choice-text-row"},l,m),o="radio office-form-question-choice-mobile office-form-theme-page-background-active";return h&&(i=d,o=k.Html.combineAttributes(o,"active")),f.createElement("div",{className:o,key:d},n)}),l=f.createElement("div",{className:"office-form-mobile-matrix-choices"},j),m=-1!==i?d[i].Description:"",n=this.createQuestionTitle(c.Model.Title,m,h);return[n,l]},b.prototype.createQuestionTitle=function(a,b,c){var d=this,g={className:"office-form-mobile-matrix-title",onClick:this.props.IsMobile?function(){return d.props.onChange(c,!d.props.IsExpanded)}:void 0,ref:function(a){if(a){var b=a.parentElement,c=a.offsetHeight;d.props.IsExpanded&&(c+=a.nextElementSibling.offsetHeight),b&&(b.style.height=c+"px")}}};return f.createElement("div",e({},g),f.createElement("div",{className:"office-form-mobile-matrix-title-header"},f.createElement("span",null,a),f.createElement(i,{HTMLAttributes:{className:"select-dropdown-arrow forms-icon-size24x24"},IconName:this.props.IsExpanded?"ChevronUp":"ChevronDown"})),f.createElement("div",{className:"office-form-mobile-matrix-answered-indicator"},f.createElement("span",null,b)))},b.prototype.onValueChange=function(a,b){var c=this.props.QuestionRuntimeMaster,d=b?void 0:{id:a};c&&(this.props.IsMobile?(this.props.onChange(this.props.QuestionIndex+1,!0),c.Model.Answer=d):(c.Model.Answer=d,this.forceUpdate()))},b}(h.ReactComponent);b.LikertSubQuestionRenderer=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=c(30),h=OfficeForm.Exports.Models,i=OfficeForm.Exports.Flighting,j=OfficeForm.Exports.Utilities,k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.subTitleRef=e.createRef(),b}return d(b,a),b.prototype.componentWillMount=function(){var a=this;this.update=function(){return a.forceUpdate()};var b=h.FormMaster.Schema;this.props.Form.observe(this.update,[b.Title,b.Description,b.LogoInfo])},b.prototype.componentDidMount=function(){$(this.subTitleRef.current).linkify()},b.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.update)},b.prototype.render=function(){var a,b,c=this.props.Form,d=c.Model,f=d.LogoInfo;if(d.Logo&&d.Logo.ResourceUrl&&f.TargetResourceId){var k=c.getImageMaster(h.FormMaster.Schema.Logo),l=c.getImageSettingsMaster(h.FormMaster.Schema.LogoInfo);if(i.Flight.isEnabled(i.Flights.FormLogoBrand)){var m="Mobile"===this.props.ViewMode||j.isMobile(),n=l.calcLogoLayout(this.props.IsSmallSize,m);b=n.Layout===h.ImageLayout.Vertical,a=e.createElement(g.TitleImageRenderer,{Image:k,ImageSettings:l,ImageWidth:n.ActualWidth,ImageHeight:n.ActualHeight})}else a=e.createElement("div",{className:"logo-image-container old"},e.createElement(OfficeForm.Exports.ImageRenderer,{Image:k,ImageSettings:c.getImageSettingsMaster(h.FormMaster.Schema.LogoInfo),ImageType:"Logo"}),OfficeForm.Exports.createImageSpinner(k.Model))}var o;d.Description&&!this.props.IsSmallSize&&(o=e.createElement("div",{className:"office-form-subtitle",ref:this.subTitleRef},d.Description));var p=j.Html.combineAttributes("office-form-title-container office-form-theme-primary-background",this.props.IsSmallSize?"small-size":void 0),q=j.Html.combineAttributes("office-form-logo-title",b?"vertical":"horizontal");return e.createElement("div",{className:p},e.createElement("div",{className:q},a,e.createElement("div",{className:"office-form-title"},e.createElement("span",{role:"heading","aria-level":1},d.Title))),o)},b}(f.ReactComponent);b.TitleContainer=k,Forms.UX.Renderer.TitleContainer=k},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(9),c(8)},function(a,b,c){"use strict";function d(){function a(a){b.current=a}var b=a;return b}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0);e.createRef||(e.createRef=d)},function(a,b){"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/,b=a.exec(this.toString());return b&&b.length>1?b[1].trim():""}})},,function(a,b,c){"use strict";function d(a,b){var c=a.replace(/\s/,"");return b?c[c.length-1]:c[0]}function e(a,b){var c=a.replace(/\s/,"");return c.length<=2?b?c[0]:c[c.length-1]:b?c.substr(0,2):c.substr(c.length-2,c.length)}function f(a,b){var c="",d=a.split(" ");return 2===d.length?(c+=d[0].charAt(0).toUpperCase(),c+=d[1].charAt(0).toUpperCase()):3===d.length?(c+=d[0].charAt(0).toUpperCase(),c+=d[2].charAt(0).toUpperCase()):0!==d.length&&(c+=d[0].charAt(0).toUpperCase()),b&&c.length>1?c.charAt(1)+c.charAt(0):c}function g(a){return a=a.replace(k,""),a=a.replace(l,""),a=a.replace(m," "),a=a.trim()}function h(a,b){return null==a?"":(arguments.length<2&&(b=j.isRtl()),a=g(a),n.test(a)?d(a,!!b):o.test(a)||p.test(a)?e(a,!!b):f(a,!!b))}function i(a,b){return h(((a||"")+" "+(b||"")).trim())}Object.defineProperty(b,"__esModule",{value:!0});var j=OfficeForm.Exports.Utilities,k=new RegExp("\\(([^)]*)\\)","gi"),l=new RegExp("(?:[\x00-/:-@[-^`{-퟿-￿]|[�-�][�-�]|[�-�](?![�-�])|(?:[^�-�]|^)[�-�]) ","gi"),m=new RegExp("\\s+","gi"),n=new RegExp("[ء-ي٠-٩]"),o=new RegExp("[ᄀ-ᇿ|㄰-㆏|ꥠ-꥿|가-힯|ힰ-퟿]"),p=new RegExp("[一-鿌㐀-䶵﨎﨏﨑﨓﨔﨟﨡﨣﨤﨧-﨩]|[�-�][�-�]|�[�-��-�]|[�-�][�-�]|�[�-��-�]|�[�-�]");b.getInitials=h,b.getDisplayText=i,Forms.UX.getDisplayText=i,Forms.UX.getInitials=h},function(a,b,c){"use strict";function d(a){switch(a){case"ShowStatement":return l.createElement("div",{className:"office-form-footer-block"},n.LocalizedStrings.Response_Page_Footer_Statement_2);case"ShowStatementWithNotice":return l.createElement("div",{className:"office-form-footer-block"},n.LocalizedStrings.Response_Page_Footer_Statement);default:return null}}function e(){var a={className:o.isOEmbedSPO()?"office-form-theme-spo-link":void 0,href:window.location.origin,target:"_blank"};return l.createElement("div",{className:"office-form-footer-inline"},l.createElement("a",k({},a),n.LocalizedStrings.Form_Footer_Powered))}function f(){return l.createElement("div",{className:"office-form-footer-inline"},n.LocalizedStrings.Form_Footer_Powered)}function g(a){var b="https://go.microsoft.com/fwlink/?LinkId=521839";q.Flight.isEnabled(q.Flights.Privacy)?a.PrivacyStatement?b=a.PrivacyStatement:p.ErrorEvent.logData({errorInfo:{message:"Footer.createFooterLinks: privacyStatement is undefine"},type:p.ErrorType.InvalidPrivacyStatement}):b="http://go.microsoft.com/fwlink/?LinkId=521839";var c={className:o.isOEmbedSPO()?"office-form-theme-spo-link":void 0,href:b,target:"_blank"};return l.createElement("div",{className:a.Multiline?"office-form-footer-block":"office-form-footer-inline"},l.createElement("a",k({},c),n.LocalizedStrings.Form_Footer_PrivacyStatement))}function h(a){return r.FeaturePlanProvider.isMsaUser()?"https://go.microsoft.com/fwlink/?LinkId=521839":a&&r.FeaturePlanProvider.isMsftUser()?"http://msdpn.azurewebsites.net/default?LID=62":"https://go.microsoft.com/fwlink/p/?linkid=857875"}function i(a){return l.createElement(s,k({},a))}var j=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),k=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var l=c(0),m=c(1),n=OfficeForm.Exports.Resources,o=OfficeForm.Exports.Utilities,p=OfficeForm.Exports.Event,q=OfficeForm.Exports.Flighting,r=OfficeForm.Exports.DataProvider,s=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.mounted=!0,b}return j(b,a),b.prototype.componentDidMount=function(){var a=this;this.formMaster=Forms.Common.getCurrentForm(),this.props.UseDefaultPrivacyUrl?this.setState({PrivacyUrl:h(!1)}):this.ensurePrivacy().then(function(b){a.mounted&&b&&a.setState({PrivacyUrl:b})})},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.render=function(){var a=this.props.TopExtraContent&&l.createElement("div",{className:"office-form-footer-block"},this.props.TopExtraContent),b=o.isOEmbedSPO()?e():f();return l.createElement("div",{className:"office-form-footer office-form-theme-footer",role:"contentinfo"},l.createElement("div",{className:"office-form-footer-container"},a,d(this.props.FooterType),l.createElement("div",{className:"office-form-footer-block"},b,l.createElement(g,{PrivacyStatement:this.state.PrivacyUrl}))))},b.prototype.ensurePrivacy=function(){var a=this;if(this.formMaster&&this.formMaster.isFieldReady(this.formMaster.Schema.PrivacyUrl))return this.formMaster.ensureFieldsReady([this.formMaster.Schema.PrivacyUrl]).then(function(){return a.formMaster&&a.formMaster.Model.PrivacyUrl});var b=$.Deferred();return b.reject(),b.promise()},b}(m.ReactComponent);b.createFooter=i,Forms.UX.Renderer.createFooter=i,Forms.UX.Renderer.FooterLinks=g,Forms.UX.Renderer.getDefaultPrivacyurl=h},function(a,b,c){"use strict";function d(a){return 7>a?l.LocalizedStrings.NPS_Detractors:a>8?l.LocalizedStrings.NPS_Promoters:l.LocalizedStrings.NPS_Passives}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(2),i=c(1),j=OfficeForm.Exports.Utilities.Html.combineAttributes,k=OfficeForm.Exports.Utilities.Guid,l=OfficeForm.Exports.Resources,m=function(a){function b(c){var d=a.call(this,c)||this;return d.popUpRef=g.createRef(),d.uuid=k.newGuid(),d.options=b.createNPSOptions(),d.valueChangeCallback=function(a){var b=d.props.onValueChange;b&&b(parseInt(a.currentTarget.value,10))},d.inputOnFocusCallback=function(a){d.setState({FocusValue:parseInt(a.currentTarget.value,10)})},d.inputOnBlurCallback=function(){d.setState({FocusValue:void 0})},d.touchStartCallback=function(a){return d.touchStart(a)},d.touchMoveCallback=function(){return d.canceled=!0},d.touchCancelCallback=function(a){d.canceled=!1,d.setState({Touch:-1})},d.touchEndCallback=function(a){return d.touchEnd(a)},d}return e(b,a),b.prototype.render=function(){var a="nps-control clearfix unselectable-text",b="nps-control-table reset";this.props.Disabled||(b=j(b,"enabled"));var c=this.props.HTMLAttributes,d={};return c&&(a=j(a,c.className),h.extend(d,c)),d.className=b,g.createElement("div",{className:a,role:"radiogroup"},this.createPopUp(),g.createElement("table",f({},d),this.createThead(),this.createTbody()),this.props.LeftLabel||this.props.RightLabel?this.createLabels():void 0)},b.prototype.createPopUp=function(){var a=this.state.Touch,b=j(void 0!==a&&-1!==a?"nps-pop-up show":"nps-pop-up",this.props.ClassNameForInnerLabel,a===this.props.Value?"active":"");return g.createElement("div",{className:b,ref:this.popUpRef},g.createElement("span",{className:"nps-pop-up-text"},this.state.Touch))},b.prototype.createLabels=function(){return g.createElement("div",{className:"nps-control-label-container clearfix"},g.createElement("div",{className:"left-label"},g.createElement("span",null,this.props.LeftLabel)),g.createElement("div",{className:"right-label"},g.createElement("span",null,this.props.RightLabel)))},b.createNPSOptions=function(){for(var a=11,b=[],c=0;a>c;c++)b.push({DisplayName:d(c),Key:c,Value:c});return b},b.prototype.createThead=function(){return g.createElement("thead",null,g.createElement("tr",{className:"nps-head-row"},this.options.map(function(a){return g.createElement("th",{className:"nps-head-column",key:a.Key},a.Value)})))},b.prototype.createTbody=function(){var a=this,b=this.options.map(function(b,c){return a.createTd(b,c)});return g.createElement("tbody",null,g.createElement("tr",null,b))},b.prototype.createTd=function(a,b){var c=this.props.Value,d=this.props.Disabled;h.isString(c)&&(c=parseInt(c,10));var e=c===a.Value,i="nps-"+this.uuid+"-"+a.Value,k={"aria-label":a.Value.toString(),"aria-posinset":b+1,"aria-setsize":this.options.length,checked:e,disabled:this.props.Disabled,id:i,name:"nps-"+this.uuid,type:"radio",value:a.Value},l={htmlFor:i};return d||(h.extend(k,{onBlur:-1===this.state.Touch?void 0:this.inputOnBlurCallback,onChange:this.valueChangeCallback,onFocus:-1===this.state.Touch?void 0:this.inputOnFocusCallback}),h.extend(l,{htmlFor:i,onTouchCancel:this.touchCancelCallback,onTouchEnd:this.touchEndCallback,onTouchMove:this.touchMoveCallback,onTouchStart:this.touchStartCallback})),l.className=j("answer-label",void 0!==this.state.Touch?"touch":"",this.props.ClassNameForInnerLabel,e?"active":"",this.state.FocusValue===a.Value?"focus":""),g.createElement("td",{key:a.Key,className:"radio-button-item"},g.createElement("div",{className:"radio-button"},g.createElement("input",f({},k)),g.createElement("label",f({},l),g.createElement("span",{"data-text":a.Value,className:"radio-button-display"}))))},b.prototype.touchStart=function(a){var b=a.currentTarget,c=this.popUpRef.current,d=c.parentElement.getBoundingClientRect(),e=b.getBoundingClientRect(),f=e.width/2,g=e.height/2;c.style.left=e.left-d.left-f/2+"px",c.style.top=e.top-d.top-g/2+"px",c.style.width=e.width+f+"px",c.style.height=e.height+g+"px";var h=b.firstElementChild,i="text";this.setState({Touch:parseInt(h.dataset[i],10)})},b.prototype.touchEnd=function(a){var b=this;if(this.canceled)this.canceled=!1,this.setState({Touch:-1});else{var c=this.state.Touch;this.setState({Touch:-1},function(){var a=b.props.onValueChange;a&&a(c)})}a.preventDefault()},b}(i.ReactComponent);b.NPSControl=m,Forms.UX.Controls.NPSControl=m,Forms.UX.Controls.getNpsCategoryDescription=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(2),i=c(1),j=OfficeForm.Exports.Event,k=OfficeForm.Exports.EngagementEventNames.Image,l=OfficeForm.Exports.Models,m=OfficeForm.Exports.Utilities.Html.combineAttributes;!function(a){a[a.Loading=0]="Loading",a[a.Success=1]="Success",a[a.Error=2]="Error"}(f||(f={}));var n=function(a){function b(b){var c=a.call(this,b)||this;return c.mounted=!0,c.updateImage=c.updateImage.bind(c),c.update=function(){return c.forceUpdate()},c.onError=c.onError.bind(c),c.onLoad=c.onLoad.bind(c),c.state={ImageLoadStatus:f.Loading,RetryCount:0},c}return d(b,a),b.prototype.componentDidMount=function(){var a=l.ImageInfoMaster.Schema;this.props.ImageSettings.observe(this.update),this.props.Image.observe(this.updateImage,[a.ResourceUrl])},b.prototype.componentWillUnmount=function(){this.mounted=!1,this.props.ImageSettings.unobserve(this.update),this.props.Image.unobserve(this.updateImage)},b.prototype.render=function(){var a=this.state.RetryCount,b=this.props.Image.Model,c=b.ResourceUrl;this.state.ImageLoadStatus===f.Error&&a>0&&(c+="?"+a);var d,i;this.showSpinner()?i=g.createElement("div",{className:"image-spinner"},g.createElement("div",{className:"spinner-tile-animation"})):this.state.ImageLoadStatus===f.Success&&(d="visiable");var j=h.extend({},this.props.HTMLAttributes);return j.className=m(j.className,"logo-image-container"),g.createElement("div",e({},j),g.createElement("img",{alt:b.AltText,className:d,height:this.props.ImageHeight+"px",onError:this.onError,onLoad:this.onLoad,src:c,title:b.AltText,width:this.props.ImageWidth+"px"}),i)},b.prototype.onLoad=function(){j.EngagementEvent.logData({extraData:{imageType:"Logo",location:"1"},name:k.ImageOnLoad.Success}),this.setState({ImageLoadStatus:f.Success})},b.prototype.onError=function(){var a=this,b=this.state.RetryCount;3>b?window.setTimeout(function(){a.mounted&&a.setState({RetryCount:++b})},1e3):(j.EngagementEvent.logData({extraData:{imageSrc:this.props.Image.Model.ResourceUrl,imageType:"Logo",location:"1"},name:k.ImageOnLoad.Failure}),this.setState({ImageLoadStatus:f.Error}))},b.prototype.updateImage=function(a){var b=a.OldValues,c=a.NewValues;c.ResourceUrl&&b.ResourceUrl!==c.ResourceUrl&&this.setState({ImageLoadStatus:f.Loading})},b.prototype.showSpinner=function(){var a=this.props.Image.Model,b=this.props.ImageSettings.Model,c=this.state.ImageLoadStatus;return c===f.Loading||c===f.Error||a.ResourceId!==b.TargetResourceId||a.ImageProcessingStatus!==l.ImageProcessingStatus.Idle},b}(i.ReactComponent);b.TitleImageRenderer=n,Forms.UX.Renderer.TitleImageRenderer=n},function(a,b,c){"use strict";function d(a){return g.createElement(k,a)}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(1),i=OfficeForm.Exports.ColorHelper,j=OfficeForm.Exports.Control.createFontIconControl,k=function(a){function b(b){var c=a.call(this,b)||this;return c.state={ShowAlert:!1},c}return e(b,a),b.prototype.componentDidMount=function(){var a=this;setTimeout(function(){a.setState({ShowAlert:!0})},0)},b.prototype.render=function(){var a,b=this.createColorInfo();this.state.ShowAlert&&(a=this.props.displayText?this.props.displayText.toLocaleUpperCase():j({HTMLAttributes:{className:"author-notification-icon"},IconName:"Contact"}));var c={backgroundColor:b.backgroundColor,color:b.textColor},d={"aria-label":this.props.ariaLabel||this.props.tooltip,className:"author-notification-content",style:c,title:this.props.tooltip};return this.props.isCoAuthUser&&(d.role="alert"),g.createElement("div",f({},d),g.createElement("span",{"aria-hidden":!0},a))},b.createColor=function(a){for(var c=8,d=0,e=a.length-1;e>=0;e--){var f=a.charCodeAt(e),g=e%c;d^=(f<<g)+(f>>c-g)}var h=d%b.COLOR_SWATCHES_LOOKUP.length;return b.COLOR_SWATCHES_LOOKUP[h]},b.prototype.createColorInfo=function(){var a=this.props,c="",d="";a.backgroundColor&&(c=i.colorToHex(a.backgroundColor)),a.textColor&&(d=i.colorToHex(a.textColor));var e=a.email||a.name;return""!==d&&""!==c||!e||(c=c||b.createColor(e),d=d||i.colorToHex(i.contrastingColor(i.hexToRGB(c)))),c=c||b.defaultBackgroundColor,d=d||b.defaultTextColor,{backgroundColor:c,textColor:d}},b.COLOR_SWATCHES_LOOKUP=["#3765E4","#D83B01","#B91C49","#910A19","#E40089","#971497","#8150FD","#562685","#2C5797","#007B8A","#11723F","#6F292A","#A16412"],b.defaultBackgroundColor=b.COLOR_SWATCHES_LOOKUP[0],b.defaultTextColor="#FFFFFF",b}(h.ReactComponent);b.AuthorFacePile=k,b.createFacePile=d,Forms.UX.createFacePile=d},,,,,,function(a,b,c){"use strict";function d(a,b){var c=Date.now(),d={sa:c-g};return h[a]=d,b.done(function(){d.d=Date.now()-c}).fail(function(){
d.d=Date.now()-c,d.f=1})}function e(a){i[a]=Date.now()-g}function f(){var a="Forms.PerformanceAnalysis";OfficeForm.Exports.Event.EngagementEvent.logData({extraData:{checkPoints:i,requests:h,requestsAll:Date.now()-g,scriptDownload:window.FormsPageStartTime&&g-window.FormsPageStartTime,version:1},name:a})}Object.defineProperty(b,"__esModule",{value:!0});var g=Date.now(),h={},i={};b.requestWithPromise=d,b.addCheckPoint=e,b.onPageReadyToRender=f,Forms.PerformanceAnalysis={addCheckPoint:e,onPageReadyToRender:f,requestWithPromise:d}},function(a,b,c){"use strict";function d(a){return g.createElement(l,f({},a))}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(11),i=c(1),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.Resources,l=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.allowedTypesCount=0,b}return e(b,a),b.prototype.render=function(){var a=j.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Upload"}),b=g.createElement("span",{className:"design-question-upload-text"},k.LocalizedStrings.UploadFile_Button),c=g.createElement("div",{className:"design-question-upload-container",key:"addButton"},g.createElement("div",{className:"design-question-upload-button"},a,b));return g.createElement("div",null,c,this.createFileUploadValidation())},b.prototype.createFileUploadValidation=function(){var a=this.props.FileTypes;return this.props.HasSpecificFileType?(0===this.allowedTypesCount&&(this.allowedTypesCount=Object.keys(a).length),g.createElement("div",{className:"design-question-restrictions-container",key:"restrictionsContainer"},g.createElement("span",{className:"design-question-restrictions-title"},k.LocalizedStrings.UploadFile_Restrictions),g.createElement("div",{className:"design-question-fileUpload-fileType-container"},g.createElement("div",{className:"design-question-fileUpload-fileType"},this.createFileTypeButton("Word"),this.createFileTypeButton("Excel"),this.createFileTypeButton("PowerPoint"),this.createFileTypeButton("PDF")),g.createElement("div",{className:"design-question-fileUpload-fileType"},this.createFileTypeButton("Image"),this.createFileTypeButton("Text"),this.createFileTypeButton("Video"),this.createFileTypeButton("Audio"))))):null},b.prototype.createFileTypeButton=function(a){var b=this;return j.createCheckBox({Description:h.convertFileTypeToString(a),HTMLAttributes:{className:"inline-display design-question-upload-checkbox"},onValueChange:function(c){b.props.FileTypes[a]=c,c?b.allowedTypesCount++:b.allowedTypesCount--,0===b.allowedTypesCount&&b.props.setSpecificFileTypeCallback(!1)},Options:{classNameForInnerDiv:"inline-display"},SpanClassName:"design-question-file-type",Value:this.props.FileTypes[a]})},b}(i.ReactComponent);b.FileUploadQuestionDesigner=l,b.createFileUploadDesigner=d,Forms.UX.FileUpload.createFileUploadDesigner=d},function(a,b){},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(6),h=c(2),i=c(4),j=c(5),k=OfficeForm.Exports.CategoryExtensionPoints,l=OfficeForm.Exports.Control,m=OfficeForm.Exports.ExtensionPoints,n=OfficeForm.Exports.Flighting,o=OfficeForm.Exports.FormLimitation,p=OfficeForm.Exports.Models,q=OfficeForm.Exports.Resources,r=OfficeForm.Exports.Utilities,s="6c660282-db72-436c-87bb-8272cba504d3",t=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.otherAnswerTextRef=f.createRef(),b.shouldUpdateStateBasingOnAnswer=!0,b}return d(b,a),b.prototype.componentWillMount=function(){var b=this;a.prototype.componentWillMount.call(this),this.onQuestionChangeCallback=function(){return b.initializeState()},this.props.Master.Question.observe(this.onQuestionChangeCallback),this.onAnswerChangeCallback=function(){return b.onAnswerChange()},this.props.Master.observe(this.onAnswerChangeCallback,[p.QuestionRuntimeMaster.Schema.Answer]),this.initializeState()},b.prototype.componentWillUnmount=function(){a.prototype.componentWillUnmount.call(this),this.props.Master.Question.unobserve(this.onQuestionChangeCallback),this.props.Master.unobserve(this.onAnswerChangeCallback,[p.QuestionRuntimeMaster.Schema.Answer])},b.prototype.createReactNodes=function(){var a,b=this.props.Master.Question,c=b.Model,d=this.props.Master.Model,e=d.QuizResult,f=c.ChoiceType===p.ChoiceType.SingleChoice;if(n.Flight.isEnabled(n.Flights.MaxChoiceCount)&&!f&&!e){var g=b.verify(d.Answer);d.Answer&&g!==p.QuestionValidationResult.Success&&(a=l.createLabel({Alert:!0,HTMLAttributes:{className:"validation-error-message-label",role:"alert"},key:"error",Label:q.LocalizedStrings.ChoiceValidation_ExceedMaxSelectionCount_ErrorMessage.format(c.MaxSelectionCount)}))}if(n.Flight.isEnabled(n.Flights.DropDown)){if(!this.props.ExpandAll&&b.showAsDropdown()&&!this.props.IsMobile&&(!c.IsQuiz||!this.props.ShowQuizResult))return[this.createDropDown()]}else if(!this.props.ExpandAll&&b.showAsDropdown()&&!this.props.IsMobile&&!c.IsQuiz)return[this.createDropDown()];return[this.createChoices(f),a]},b.prototype.onAnswerChange=function(){this.shouldUpdateStateBasingOnAnswer?this.updateStateBasingOnAnswer(this.state.ChoiceOptions):this.shouldUpdateStateBasingOnAnswer=!0},b.prototype.updateAnswer=function(){var a,b=[],c=this.props.Master.Question.Model.ChoiceType===p.ChoiceType.SingleChoice,d=this.state.SelectedOptions;d&&d.forEach(function(a){return b.push(a)});var e=this.state.OtherOptionText;if(this.state.IsOtherOptionSelected&&e&&b.indexOf(e)<0&&b.push(e),c)a=b[0];else{var f=this.sortAnswers(b);a=JSON.stringify(f)}this.shouldUpdateStateBasingOnAnswer=!1,this.props.Master.Model.Answer=a},b.prototype.createChoices=function(a){var c=this,d=this.props.Master,g=d.Question.Model,h=r.Guid.newGuid(),i=this.state.ChoiceOptions,j=i.length+(g.AllowOtherAnswer?1:0),n=this.props.Master.Question.Form,o=k.supportsExtensionPoint(n,m.ResponsePagePollView),p=i.map(function(d,g){var i={className:r.Html.combineAttributes(a?"radio":"checkbox",c.props.IsMobile&&!o?"office-form-question-choice-mobile office-form-theme-page-background-active":"office-form-question-choice office-form-question-choice-marginleft")},k=!1,m=c.state.SelectedOptions;void 0!==m&&m.indexOf(d.Description)>=0&&(k=!0,c.props.IsMobile&&(i.className=r.Html.combineAttributes(i.className,"active")));var n={"aria-checked":k,checked:k,disabled:c.props.Disabled,name:a?h:void 0,onChange:function(){return c.onChange(d.Description,k,a)},type:"checkbox"};a&&(n.type="radio",n["aria-posinset"]=g+1,n["aria-setsize"]=j);var p,q=c.props.Master.Question.Model.IsQuiz,s="office-form-question-choice-row";if(q&&(s=r.Html.combineAttributes(s,"office-form-question-choice-quiz-row")),c.props.Master.Question.Model.IsMathQuiz&&d.IsMathOption){var t=l.createFormulaRenderer({DisableLinebreaks:c.props.DisableFormulaLinebreak,Formula:d.Description,onRenderComplete:c.props.onHeightChange});p=f.createElement("div",{className:"office-form-question-choice-formula"},t);var u={"aria-label":d.Description};n=r.Html.mergeReactProps(n,u)}else{var v={RenderMode:l.UserTextRenderMode.RichText,Text:d.Description},w=l.createUserTextRenderer(v);p=f.createElement("span",{className:"office-form-question-choice-text-span"},w),s=r.Html.combineAttributes(s,"office-form-question-choice-text-row")}var x=f.createElement("input",e({},n)),y=b.getAnswerKeyMark(c.props,d,k),z=b.getAnswerHintLabel(c.props,d,k);return f.createElement("div",e({},i,{key:g}),f.createElement("label",{className:s},x,p,y),z)}),q=this.getElementProps({role:a?"radiogroup":"group",key:"choicequestion-choices"});return f.createElement("div",e({},q),p,this.createOtherAnswer(h,a))},b.prototype.createOtherAnswer=function(a,b){var c=this.props.Master.Question.Form,d=k.supportsExtensionPoint(c,m.ResponsePagePollView);if(this.props.Master.Question.Model.AllowOtherAnswer){var g={className:this.props.IsMobile&&!d?"office-form-other-answer-mobile":"office-form-other-answer",key:"other-answer"};return f.createElement("div",e({},g),this.createOtherAnswerInput(a,b),this.createOtherAnswerTextbox(b))}},b.prototype.createOtherAnswerInput=function(a,b){var c=this,d="otherAnswerInput",h=this.state.ChoiceOptions,i={"aria-label":q.LocalizedStrings.Response_Page_OtherAnswerTitle,checked:this.state.IsOtherOptionSelected,disabled:this.props.Disabled,name:b?a:void 0,onChange:function(){if(b)c.onSingleChoiceOtherAnswerChange();else if(c.otherAnswerTextRef.current){var a=g.findDOMNode(c.otherAnswerTextRef.current),d=a.checked;c.onMultiChoiceOtherAnswerChange(d)}},ref:d,role:"checkbox",type:"checkbox"};return b&&(i.role="radio",i.type="radio",i["aria-posinset"]=h.length+1,i["aria-setsize"]=h.length+1),f.createElement("input",e({},i))},b.prototype.createOtherAnswerTextbox=function(a){var b=this,c={"aria-label":q.LocalizedStrings.Designer_OtherAnswer,className:"office-form-other-answer-textbox"},d={Disabled:this.props.Disabled,HTMLAttributes:{className:"inline-display office-form-other-answer-margin-left-mobile"},MaxLength:o.OtherOptionLength,onValueChange:function(c){var d=b.state.SelectedOptions;a&&(d=[]),b.setState({IsOtherOptionSelected:!!c,OtherOptionText:c,SelectedOptions:d},function(){return b.updateAnswer()})},Options:{HTMLPropsForInnerElement:c},Placeholder:q.LocalizedStrings.Designer_OtherAnswer,ref:this.otherAnswerTextRef,Value:this.state.OtherOptionText};return l.createTextField(d)},b.prototype.initializeState=function(){var a,b=this.props.Master,c=b.Question.Model;a=!c.ShuffleOptions||this.props.DisableShuffle?Nerve.convertToArray(c.Choices):h.shuffle(c.Choices),this.setState({ChoiceOptions:a}),this.updateStateBasingOnAnswer(a)},b.prototype.updateStateBasingOnAnswer=function(a){var b=this.props.Master,c=b.Question.Model,d=[],e=!1,f="";if(b.Model.Answer){var g=c.ChoiceType===p.ChoiceType.SingleChoice,h=g?[b.Model.Answer]:this.parseArrayAnswer(b.Model.Answer),i=a.map(function(a){return a.Description});h.forEach(function(a){i.indexOf(a)>=0?d.push(a):(e=!0,f=a)})}this.setState({IsOtherOptionSelected:e,OtherOptionText:f,SelectedOptions:d})},b.prototype.onChange=function(a,b,c){var d=this,e=this.state.SelectedOptions,f=this.state.IsOtherOptionSelected;if(c)e=[],f=!1,e.push(a);else{e||(e=[]);var g=e.indexOf(a);b?g>=0&&e.splice(g,1):0>g&&e.push(a)}this.setState({IsOtherOptionSelected:f,SelectedOptions:e},function(){return d.updateAnswer()})},b.prototype.onSingleChoiceOtherAnswerChange=function(){var a=this;if(this.otherAnswerTextRef.current){var b=g.findDOMNode(this.otherAnswerTextRef.current),c=b.lastChild&&b.lastChild.childNodes[0],d=[],e=!!c.value;this.setState({IsOtherOptionSelected:e,SelectedOptions:d},function(){return a.updateAnswer()})}},b.prototype.onMultiChoiceOtherAnswerChange=function(a){var b=this;if(this.otherAnswerTextRef.current){var c=g.findDOMNode(this.otherAnswerTextRef.current),d=c.lastChild&&c.lastChild.childNodes[0],e=!1;a&&(e=!0,d&&d.focus()),this.setState({IsOtherOptionSelected:e},function(){return b.updateAnswer()})}},b.prototype.parseArrayAnswer=function(a){var b=this.props.Master.Question,c=b.Model;return p.Question.getChoiceAnswer(a,c).SelectedOptions},b.prototype.createDropDown=function(){var a,c,d=this,e=this.props.Master,g=e.Question.Model,h=this.state.ChoiceOptions,i=h.map(function(a){var b={DisplayName:a.Description,Key:Nerve.getObjectMasterFromModel(a).getInstanceId(),Value:a.Description};return b}),j=r.Html.combineAttributes(this.getValidationStyle(),"office-form-question-dropdown"),k=e.Model.Answer;n.Flight.isEnabled(n.Flights.DropDown)?(g.AllowOtherAnswer&&i.push(b.createDropDownOtherOption()),this.state.IsOtherOptionSelected&&(k=s),this.props.ShowDesignInfo||(a=this.createDropDownOtherAnswer()),c=function(a){return d.onDropDownValueChange(a)}):c=function(a){return e.Model.Answer=a};var m=l.createSelect({AllowWrap:!0,HTMLAttributes:this.getElementProps({className:j,disabled:this.props.Disabled,title:g.Hint||q.LocalizedStrings.Dropdown_DefaultHint}),key:"choicequestion-dropdown",onValueChange:c,Placeholder:g.Hint||q.LocalizedStrings.Dropdown_DefaultHint,SelectOptions:i,Value:k});return f.createElement("div",{className:"office-form-question-element"},m,a)},b.prototype.onDropDownValueChange=function(a){var b=this,c=a===s,d=c?[]:[a];if(c&&this.otherAnswerTextRef.current){var e=g.findDOMNode(this.otherAnswerTextRef.current);e.classList.remove("none-display");var f=e.lastChild&&e.lastChild.childNodes[0];f.focus()}this.setState({IsOtherOptionSelected:c,SelectedOptions:d},function(){return b.updateAnswer()})},b.createDropDownOtherOption=function(){var a={DisplayName:q.LocalizedStrings.Designer_OtherAnswer,Key:s,Value:s};return a},b.prototype.createDropDownOtherAnswer=function(){var a=this,b="office-form-other-answer office-form-dropdown-other-answer";this.state.IsOtherOptionSelected||(b=r.Html.combineAttributes(b,"none-display"));var c={"aria-label":q.LocalizedStrings.TextField_DefaultPlaceholder,className:"office-form-other-answer-textbox"},d={Disabled:this.props.Disabled,HTMLAttributes:{className:b},onValueChange:function(b){a.setState({IsOtherOptionSelected:!0,OtherOptionText:b,SelectedOptions:[]},function(){return a.updateAnswer()})},Options:{HTMLPropsForInnerElement:c},Placeholder:q.LocalizedStrings.TextField_DefaultPlaceholder,ref:this.otherAnswerTextRef,Value:this.state.OtherOptionText};return l.createTextField(d)},b.prototype.sortAnswers=function(a){var b=this.props.Master.Question.Model.Choices,c=h.map(b,function(a){return a.Description});return a.sort(function(a,b){return c.indexOf(a)-c.indexOf(b)})},b.isQuizResultAnswerKey=function(a,b){if(!a||!a.IsAnswerKeys)return!1;var c=a.Choices;return c?a.IsAnswerKeys[c.indexOf(b.Description)]:!1},b.getAnswerKeyMark=function(a,c,d){var e,f,g,h=a.Master,i=h.Model.QuizResult,j=h.Question,k=b.isQuizResultAnswerKey(i,c);if(c.IsAnswerKey&&a.ShowDesignInfo&&j.Model.IsQuiz||k)g="CheckMark",e=a.IsMobile&&d?"image-button-checked-answerkey-mobile office-form-answerkey":"image-button-answerkey office-form-answerkey",f=q.LocalizedStrings.Quiz_CorrectAnswer;else{if(!(d&&i&&i.IsAnswerKeys&&i.IsAnswerKeys.some(function(a){return a}))||k)return void 0;e=a.IsMobile?"image-button-checked-wrong-answer-mobile office-form-answerkey":"",g=a.IsMobile?"Cancel":"",f=q.LocalizedStrings.Quiz_WrongAnswer}return e=r.Html.combineAttributes(e,"forms-icon-size20x20"),l.createFontIconControl({HTMLAttributes:{className:e,role:"tooltip",title:f},IconName:g})},b.getAnswerHintLabel=function(a,c,d){var e,g=a.Master.Model.QuizResult;if(!a.ShowDesignInfo&&d&&g){var h=g.Choices,i=h?h.indexOf(c.Description):-1,j=g.AnswerHints&&g.AnswerHints[i];if(j){var k=void 0;k=b.isQuizResultAnswerKey(g,c)?a.IsMobile?"validation-success-mobile":"validation-success":a.IsMobile?"validation-error-mobile":"validation-error",k=r.Html.combineAttributes("office-form-answerhint",k),e=f.createElement("div",{className:k},j)}}return e},b}(j.QuestionRendererBase);i.registerRendererComponentClass(p.QuestionType.Choice,t)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(5),g=OfficeForm.Exports.Control,h=OfficeForm.Exports.Models,i=OfficeForm.Exports.Resources,j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.createReactNodes=function(){var a,b=this,c=this.props.Master.Model;return this.isValueInvalid&&(a=g.createLabel({Alert:!0,HTMLAttributes:{className:"validation-error-message-label",role:"alert"},key:"error",Label:i.LocalizedStrings.DateValidation_ErrorMessage.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern)})),[g.createDateTimePicker({DateTitle:i.LocalizedStrings.QuestionType_DatePicker_DateTitle,Disabled:this.props.Disabled,HTMLAttributes:{className:"office-form-question-element"},IsLocaleInvariant:!0,key:"dateTime",onValueChange:function(a){c.Answer=a},onValueValidation:function(a){b.isValueInvalid=!a,b.forceUpdate()},Options:{classNameForInnerDiv:"office-form-textfield",HTMLPropsForInnerElement:this.getElementProps({className:"office-form-question-textbox"})},Placeholder:i.LocalizedStrings.QuestionType_DateTime_PlaceHolder.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern),ShowClearButton:!0,Theme:this.props.Theme,Type:g.PickerType.DatePicker,ValidationStyle:this.getValidationStyle(),Value:c.Answer}),a]},b}(f.QuestionRendererBase);e.registerRendererComponentClass(h.QuestionType.DateTime,j)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(20),g=c(4),h=c(5),i=OfficeForm.Exports.Models,j=function(a){function b(b){var c=a.call(this,b)||this;return c.createOD4BTempFolder=c.createOD4BTempFolder.bind(c),c.setAnswer=c.setAnswer.bind(c),c}return d(b,a),b.prototype.createReactNodes=function(){var a=this.props;return[e.createElement(f.FileUploadQuestionRenderer,{Answer:a.Master.Model.Answer,createOD4BTempFolderCallBack:this.createOD4BTempFolder,decreaseUploadingFileCountCallBack:a.decreaseUploadingFileCountCallBack,Disabled:a.Disabled,FileTypes:a.Master.Question.Model.FileTypes,FileUploadProps:this.getElementProps(),FormId:a.Master.Question.Form.Model.Id,HideDeleteButton:!!a.HideDeleteButton,increaseUploadingFileCountCallBack:a.increaseUploadingFileCountCallBack,IsStudentViewMode:!!a.IsStudentViewMode,setAnswerCallback:this.setAnswer,ShowFileInfo:!!a.ShowFileInfo})]},b.prototype.createOD4BTempFolder=function(){return this.props.Master.createOD4BTempFolder()},b.prototype.setAnswer=function(a){this.props.Master.Model.Answer=a||""},b}(h.QuestionRendererBase);g.registerRendererComponentClass(i.QuestionType.FileUpload,j)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(2),h=c(4),i=c(21),j=c(5),k=OfficeForm.Exports.Models,l=function(a){function b(b){var c=a.call(this,b)||this;return c.state={IsSubQuestionsExpanded:[!0]},c}return d(b,a),b.prototype.componentWillMount=function(){var b=this;a.prototype.componentWillMount.call(this);var c=this.props.Master;this.onSubQuestionListChangeCallback=function(a){return b.onSubQuestionListChange(a)};var d=Nerve.getCollectionMasterFromModel(c.Question.Form.Model.Questions);d.observe(this.onSubQuestionListChangeCallback)},b.prototype.componentWillUnmount=function(){var b=Nerve.getCollectionMasterFromModel(this.props.Master.Question.Form.Model.Questions);b.unobserve(this.onSubQuestionListChangeCallback),a.prototype.componentWillUnmount.call(this)},b.prototype.createReactNodes=function(){var a,b=this.props.IsMobile,c=this.createSubQuestionsLayout();if(b)a=f.createElement("div",{className:"office-form-mobile-matrix-container",key:"mobileMatrix"},c);else{var d=this.createHeaderLine(),g=this.getElementProps({className:"office-form-matrix-table",key:"Likert"});a=f.createElement("table",e({},g),d,f.createElement("tbody",{className:"office-form-matrix-stbody"},c))}return[a]},b.prototype.onSubQuestionListChange=function(a){var b=this.props.Master,c=a.AddedModels.concat(Nerve.convertToArray(a.RemovedModels)).map(Nerve.getObjectMasterFromModel).some(function(a){return a.Model.GroupId===b.Question.Model.Id});c&&this.forceUpdate()},b.prototype.createHeaderLine=function(){var a=this,b=this.props.Master.Question.Model,c=b.ChoiceGroup,d=f.createElement("td",{className:"office-form-matrix-ptd",key:"emptyTd"}),h=[];h.push(d);var i=539,j={className:"office-form-matrix-ptd",width:i/c.length+"px"},k=g.map(c,function(b,c){var d=f.createElement("span",null,b.Description),g=a.getLabelId(c);return f.createElement("td",e({},j,{key:c,id:g}),d)});h=h.concat(k);var l=f.createElement("tr",{className:"office-form-matrix-ptr"},h);return f.createElement("thead",{className:"office-form-matrix-pthead"},l)},b.prototype.createSubQuestionsLayout=function(){var a=this,b=this.props.Master,c=b.Question.Model.ChoiceGroup,d=b.SubQuestions,h=g.map(d,function(d,g){var h={Choices:c,Disabled:a.props.Disabled,IsExpanded:a.state.IsSubQuestionsExpanded[g],IsMobile:!!a.props.IsMobile,onChange:function(b,c){return a.questionExpandedChange(b,c)},QuestionIndex:g,QuestionMaster:d,QuestionOrdinal:a.getQuestionId(),QuestionRuntimeMaster:b.getSubQuestionRuntimeById(d.Model.Id),ShowDesignInfo:!!a.props.ShowDesignInfo};return f.createElement(i.LikertSubQuestionRenderer,e({},h))});return h},b.prototype.questionExpandedChange=function(a,b){var c=this.props.Master.SubQuestions.length,d=[];c>a&&(d[a]=b),this.setState({IsSubQuestionsExpanded:d})},b.prototype.getLabelId=function(a){return this.getQuestionId()+"-col-"+(a+1)},b}(j.QuestionRendererBase);h.registerRendererComponentClass(k.QuestionType.MatrixChoiceGroup,l)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(29),g=c(4),h=c(5),i=OfficeForm.Exports.Models,j=function(a){function b(b){var c=a.call(this,b)||this;return c.onValueChangeCallback=function(a){return c.props.Master.Model.Answer=a},c}return d(b,a),b.prototype.createReactNodes=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model;return[e.createElement("div",{key:"nps",className:"office-form-question-element office-form-question-nps-container"},e.createElement(f.NPSControl,{ClassNameForInnerLabel:"office-form-theme-button-foreground",Disabled:this.props.Disabled,HTMLAttributes:this.getElementProps(),LeftLabel:a.LeftDescription,RightLabel:a.RightDescription,onValueChange:this.onValueChangeCallback,Value:b.Answer}))]},b}(h.QuestionRendererBase);g.registerRendererComponentClass(i.QuestionType.NPS,j)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(6),i=c(2),j=c(7),k=c(4),l=c(5),m=OfficeForm.Exports.Control,n=OfficeForm.Exports.Event,o=OfficeForm.Exports.JavaScriptLoader,p=OfficeForm.Exports.Models,q=OfficeForm.Exports.Resources,r=OfficeForm.Exports.Utilities;!function(a){a[a.Up=0]="Up",a[a.Down=1]="Down"}(f=b.Direction||(b.Direction={}));var s;!function(a){a[a.MoveUp=0]="MoveUp",a[a.MoveDown=1]="MoveDown",a[a.ArrowUp=2]="ArrowUp",a[a.ArrowDown=3]="ArrowDown",a[a.MouseDrag=4]="MouseDrag"}(s=b.KeyBoardCode||(b.KeyBoardCode={}));var t=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.choices=null,b.keyCode=null,b.isDragging=!1,b.sortableInitialized=!1,b}return d(b,a),b.prototype.componentWillMount=function(){var b=this;a.prototype.componentWillMount.call(this),o.loadJavaScript("Sortable").done(function(){b.setState({SortableLoaded:!0})}),this.updateChoicesInternally(),this.choicesUpdate=function(){b.updateChoicesInternally(),b.forceUpdate()},this.props.Master.Question.observe(this.choicesUpdate,[p.QuestionMaster.Schema.ChoiceGroup])},b.prototype.componentWillUnmount=function(){this.sortable&&(this.sortable.destroy(),this.sortable=void 0),a.prototype.componentWillUnmount.call(this),this.props.Master.Question.unobserve(this.choicesUpdate)},b.prototype.componentWillReceiveProps=function(a){(a.ShowDesignInfo||a.Disabled)&&this.sortable&&(this.sortable.destroy(),this.sortable=void 0)},b.prototype.componentDidMount=function(){a.prototype.componentDidMount.call(this),this.props.ShowQuizResult&&(this.choices=null)},b.prototype.componentDidUpdate=function(){switch(this.keyCode){case s.ArrowUp:case s.ArrowDown:case s.MouseDrag:var a=this.state.SelectedElementIndex,b=h.findDOMNode(this.refs["item"+a]);b&&b.focus();break;case s.MoveDown:case s.MoveUp:this.updateMovingButtonStatus()}this.keyCode=null,this.props.ShowQuizResult&&(this.choices=null)},b.prototype.createReactNodes=function(){var a=this.createSortableList(),b=this.createCorrectAnswerList(),c=this.props.IsMobile?"office-form-mobile-sort-list":"office-form-sort-list",d=this.props.ShowDesignInfo||this.props.Disabled||!this.state.SortableLoaded?void 0:this.decorateSortableGroup.bind(this),f=this.getElementProps({className:c,ref:d,role:"listbox"});return[g.createElement("div",e({},f,{key:"Ranking"}),a,b)]},b.prototype.decorateSortableGroup=function(a){var c=this;if(a&&!this.sortable){var d=150,e={animation:d,chosenClass:"office-form-sortable-chosen",delay:this.props.IsMobile?d:0,fallbackClass:"office-form-sortable-fallback",filter:".office-form-ranking-arrow",forceFallback:!0,ghostClass:"office-form-sortable-ghost",handle:this.props.IsMobile?".office-form-mobile-sort-item":".office-form-sort-item",onChoose:function(a){c.state.SelectedElementIndex!==a.oldIndex&&c.setState({SelectedElementIndex:a.oldIndex})},onEnd:function(d){var e=d.oldIndex,f=d.newIndex,g=c.props.Master.Model.Answer;if(c.isDragging=!1,c.keyCode=s.MouseDrag,g&&e===f)d.item.firstChild.focus();else{var h=c.choices,i=h.splice(e,1);h.splice(f,0,i[0]),f>e?$(a).find(".office-form-sort-item-container:eq("+e+")").before($(d.item)):e>f&&$(a).find(".office-form-sort-item-container:eq("+e+")").after($(d.item)),c.setState({SelectedElementIndex:f},function(){c.props.Master.Model.Answer=b.stringifyAnswer(h)})}},onStart:function(){c.isDragging=!0},preventOnFilter:!1};try{this.sortable=Sortable.create(a,e),this.sortableInitialized||n.EngagementEvent.logData({extraData:{Successful:!0},name:"DesignPage.Questions.SortableInitialization"}),this.sortableInitialized=!0}catch(f){n.EngagementEvent.logData({extraData:{Successful:!1},name:"DesignPage.Questions.SortableInitialization"}),this.sortableInitialized=!1}}},b.prototype.createSortableList=function(){var a,c=this,d=this.props.Master.Model.Answer,h=this.shouldShowJudgeIcon();d&&0!==d.length||(a=g.createElement("span",{className:"office-form-sort-item-leftNum office-form-theme-primary-foreground"})),this.choices||this.updateChoicesInternally();var k=[];return i.forEach(this.choices,function(i,l){var n,o=c.state.SelectedElementIndex===l,p=h?"office-form-sort-list-judge-icon":"office-form-sort-list-no-icon";p=r.Html.combineAttributes(p,"office-form-sort-list-item");var s=g.createElement("p",{className:p},i.Description);d&&d.length>0&&(a=b.createOrderOnRanking(l));var t;if(h&&d&&d.length>0){var u=c.props.Master.Model.QuizResult,v=JSON.parse(u.GradingBasis),w=i.Key===v[l];t=b.getAnswerKeyMark(w)}var x,y,z=c.props.IsMobile?"office-form-mobile-sort-item":"office-form-sort-item",A=o?"office-form-theme-primary-background office-form-selected-item-color":"office-form-nonselected-item-color";A=c.props.Disabled?"office-form-item-color":A,z=r.Html.combineAttributes(z,A,"office-form-theme-sort-item");var B=c.getQuestionId()+"-"+l,C={"aria-posinset":l+1,"aria-setsize":c.choices&&c.choices.length,className:z,id:B,role:"option",tabIndex:0};if(!c.props.Disabled){var D={disabled:!0,tabIndex:-1},E=0===l,F={"aria-describedby":B,"aria-label":q.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator,className:E?r.Html.combineAttributes("office-form-ranking-arrow","office-sort-disabled-arrow"):"office-form-ranking-arrow office-form-active-arrow",onClick:function(a){a.stopPropagation(),c.rankUpOrDownItem(l,f.Up)},title:q.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator};F=E?r.Html.mergeReactProps(F,D):F,x=m.createButton({ButtonStyle:"LightBackground",children:m.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Up"}),HTMLAttributes:E?r.Html.mergeReactProps(F,D):F,key:"form-up-arrow"+l,ref:"move-up"+l});var G=c.choices&&l===c.choices.length-1,H={"aria-describedby":B,"aria-label":q.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator,className:G?r.Html.combineAttributes("office-form-ranking-arrow","office-sort-disabled-arrow"):"office-form-ranking-arrow office-form-active-arrow",onClick:function(a){a.stopPropagation(),c.rankUpOrDownItem(l,f.Down)},title:q.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator};H=G?r.Html.mergeReactProps(H,D):H,y=m.createButton({ButtonStyle:"LightBackground",children:m.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Down"}),HTMLAttributes:G?r.Html.mergeReactProps(H,D):H,key:"form-down-arrow"+l,ref:"move-down"+l}),C=r.Html.mergeReactProps(C,{onFocus:function(){o||c.isDragging||c.setState({SelectedElementIndex:l})},onKeyDown:function(a){a.keyCode!==j.KeyCode.Tab&&a.keyCode!==j.KeyCode.Enter&&(a.preventDefault(),c.onKeyDown(l,a))}}),o&&(C=r.Html.mergeReactProps(C,{onBlur:function(a){var b="item"+l,d=c.refs[b],e=r.Html.getTargetElementOfFocusEvent(a);c.isDragging||d&&e&&d.contains(e)||c.setState({SelectedElementIndex:-1})}}))}var I=o?"inline-block-display":"none-display";I=r.Html.combineAttributes(I,"office-form-sort-list-arrows");var J=g.createElement("div",{className:I},x,y),K="item"+l,L=g.createElement("div",e({},C,{ref:K}),t,a,s,J);n=g.createElement("div",{key:l,className:"office-form-sort-item-container office-form-unselectable"},L),k.push(n)}),k},b.prototype.rankUpOrDownItem=function(a,c){var d,e=this.choices;if(c===f.Up&&a>0){this.keyCode=s.MoveUp;var g=i.clone(e[a]);e[a]=i.clone(e[a-1]),e[a-1]=g,d=a-1}else if(c===f.Down&&a<e.length-1){this.keyCode=s.MoveDown;var g=i.clone(e[a]);e[a]=i.clone(e[a+1]),e[a+1]=g,d=a+1}var h=b.stringifyAnswer(e);this.props.Master.Model.Answer=h,this.setState({SelectedElementIndex:d})},b.getAnswerKeyMark=function(a){return a?m.createFontIconControl({HTMLAttributes:{className:"office-form-right-answerkey office-form-judge-icon forms-icon-size16x16"},IconName:"CheckMark"
}):m.createFontIconControl({HTMLAttributes:{className:"office-form-wrong-answerkey office-form-judge-icon forms-icon-size16x16"},IconName:"Cancel"})},b.stringifyAnswer=function(a){return i.map(a,function(a,b){return{answerOrder:b,id:a.Id}})},b.createOrderOnRanking=function(a){var b=a+1;return g.createElement("span",{className:"office-form-sort-item-leftNum office-form-theme-secondary-color"},b)},b.prototype.shouldShowJudgeIcon=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model.QuizResult,c=this.props.ShowDesignInfo;return a.IsQuiz&&!c&&b?!0:!1},b.prototype.createCorrectAnswerList=function(){var a=this.props.Master.Model.QuizResult;if(this.shouldHideCorrectAnswerList()||a.IsAnswerCorrect)return void 0;var b=this.props.Master.Question.Model.ChoiceGroup,c=JSON.parse(a.GradingBasis),d=c.map(function(a){return i.findWhere(b,{Key:a})}).filter(function(a){return!!a}).map(function(a){return a&&a.Description}),e=d.join(q.LocalizedStrings.VariousLocations_ItemList_Separator),f=r.Html.combineAttributes("office-form-right-answerkey","various-short-text-correct-answer-list-correctness-icon","forms-icon-size14x14"),h=m.createFontIconControl({HTMLAttributes:{"aria-hidden":!0,className:f,role:"presentation"},IconName:"CheckMark"});return g.createElement("div",{className:"office-form-question-element various-short-text-correct-answer-list"},h,g.createElement("b",null,q.LocalizedStrings.VariousLocations_CorrectAnswerList_Label," "),e)},b.prototype.shouldHideCorrectAnswerList=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model.QuizResult;return a.IsQuiz&&!this.props.ShowDesignInfo&&b?!1:!0},b.prototype.onKeyDown=function(a,b){var c;switch(b.keyCode){case j.KeyCode.ArrowUp:this.keyCode=s.ArrowUp,c=0===a?0:a-1,this.setState({SelectedElementIndex:c});break;case j.KeyCode.ArrowDown:this.keyCode=s.ArrowDown,this.choices&&(c=a===this.choices.length-1?this.choices.length-1:a+1,this.setState({SelectedElementIndex:c}))}},b.prototype.updateMovingButtonStatus=function(){var a=this.state.SelectedElementIndex,b=null,c=this.refs;switch(this.keyCode){case s.MoveUp:if(0===a){b=h.findDOMNode(c["move-down0"]);break}b=h.findDOMNode(c["move-up"+a]);break;case s.MoveDown:if(this.choices&&a===this.choices.length-1){b=h.findDOMNode(c["move-up"+(this.choices.length-1)]);break}b=h.findDOMNode(c["move-down"+a])}b&&b.focus()},b.prototype.updateChoicesInternally=function(){var a=this.props.Master,b=a.Question,c=b.Model,d=a.Model.Answer;d&&d.length>0?this.choices=i.clone(d).sort(function(a,b){return a.answerOrder-b.answerOrder}).map(function(a){return i.find(c.ChoiceGroup,function(b){return b.Id===a.id})}).filter(function(a){return!!a}):this.props.ShowDesignInfo||!c.IsQuiz||this.props.ShowQuizResult?this.choices=Nerve.convertToArray(c.ChoiceGroup):this.choices=i.shuffle(c.ChoiceGroup)},b}(l.QuestionRendererBase);k.registerRendererComponentClass(p.QuestionType.Ranking,t)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(5),g=OfficeForm.Exports.Control,h=OfficeForm.Exports.Models,i=OfficeForm.Exports.Resources,j=OfficeForm.Exports.Utilities,k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.createReactNodes=function(){var a=this.props.Master,b=a.Question.Model;return b.RatingShape===h.RatingShape.Number||j.isHighContrastMode()?[g.createNumberRating({Disabled:this.props.Disabled,HTMLAttributes:this.getElementProps({className:"office-form-question-element"}),key:"numberRating",LeftDescription:b.LeftDescription,Length:b.Length,MinRating:b.MinRating,onValueChange:function(b){return a.Model.Answer=b},RightDescription:b.RightDescription,ShowRatingLabel:b.ShowRatingLabel,Value:a.Model.Answer})]:($.rateit.aria.ratingLabel=i.LocalizedStrings.RateItControl_AriaLabel,j.isIOS()&&($.rateit.aria.ratingDescription=i.LocalizedStrings.RateItControl_AriaDescription),[g.createRating({Disabled:this.props.Disabled,HTMLAttributes:{className:"office-form-question-element"},IsMobile:!!this.props.IsMobile,key:"rating",Label:"",LeftDescription:b.LeftDescription,LeftDescriptionTitle:i.LocalizedStrings.RatingDescriptionTitle.format(1),Length:b.Length,onValueChange:function(b){return a.Model.Answer=b},Options:{HTMLPropsForInnerElement:this.getElementProps()},RightDescription:b.RightDescription,RightDescriptionTitle:i.LocalizedStrings.RatingDescriptionTitlePlural.format(b.Length),ShowRatingLabel:b.ShowRatingLabel,Theme:this.props.Theme,ValidationStyle:this.getValidationStyle(),Value:a.Model.Answer})])},b}(f.QuestionRendererBase);e.registerRendererComponentClass(h.QuestionType.Rating,k)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(2),h=c(4),i=c(5),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.FormLimitation,l=OfficeForm.Exports.Models,m=l.QuestionValidationResult,n=OfficeForm.Exports.Resources,o=OfficeForm.Exports.Utilities,p=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.domRole="presentation",b}return d(b,a),b.prototype.createReactNodes=function(){var a,b,c,d=this.props.Master.Model,e=this.props.Master.Question,g=e.Model,h=function(){};if(e.Model.IsNumber){var i=e.verify(d.Answer);if(d.Answer&&i!==m.Success){var l=e.getNumberValidationErrorMessage();c=j.createLabel({Alert:!0,HTMLAttributes:{className:"validation-error-message-label",role:"alert"},key:"textquestion-errorlabel",Label:l})}h=function(){var a=d.Answer;e.verify(a)===m.Success&&(d.Answer=o.NumberValidation.formatAsFloat(a))}}if(this.props.PrintView)a=f.createElement("div",{className:"office-form-question-element textbox-printview",key:"printView"},d.Answer);else{var p=j.createTextField({Disabled:this.props.Disabled,HTMLAttributes:{className:"office-form-question-element",onBlur:h},key:"textquestion-textfield",Label:void 0,MaxLength:k.AnswerTextfieldLength,onValueChange:function(a){return d.Answer=a},Options:{HTMLPropsForInnerElement:this.getElementProps({className:"office-form-question-textbox"})},Placeholder:g.IsNumber?e.getNumberValidationErrorMessage():g.Placeholder||n.LocalizedStrings.TextField_DefaultPlaceholder,TextFieldType:g.Multiline?j.TextFieldType.AutoHeightMultiline:j.TextFieldType.SingleLine,Theme:this.props.Theme,ValidationStyle:this.getValidationStyle(),Value:d.Answer}),q=this.getCorrectnessIcon();b=f.createElement("div",{className:"student-feedback-view-short-text-field-with-correctness",key:"normalView"},p,q)}return[a,b,this.createCorrectAnswerList(),c]},b.prototype.getCorrectnessIcon=function(){var a=this.props.Master,c=this.props.Master.Question,d=c.Model;if(!this.props.ShowQuizResult||d.Multiline||!d.IsQuiz)return void 0;var g=b.isAnswerCorrect(a);if(null===g)return void 0;if(!g&&!this.props.IsMobile)return void 0;var h="student-feedback-view-short-text-correctness-icon-container";this.props.IsMobile&&(h=o.Html.combineAttributes(h,"isMobile"));var i=g?n.LocalizedStrings.Quiz_CorrectAnswer:n.LocalizedStrings.Quiz_WrongAnswer,k={HTMLAttributes:{className:o.Html.combineAttributes("student-feedback-view-short-text-correctness-icon forms-icon-size14x14",g?"image-button-answerkey":"image-button-checked-wrong-answer"),title:i},IconName:g?"CheckMark":"Cancel"},l=o.Guid.isNullOrEmpty(a.Model.Answer)?d.Placeholder||n.LocalizedStrings.TextField_DefaultPlaceholder:a.Model.Answer,m={"aria-hidden":!0,className:"student-feedback-view-short-text-hidden-text-to-position-correctness-icon",role:this.domRole};return f.createElement("div",{className:h},f.createElement("span",e({},m),l),j.createFontIconControl(k))},b.isAnswerCorrect=function(a){var b=a.Model;if(null!=b.QuizResult)return b.QuizResult.IsAnswerCorrect;var c=new l.ShortTextAutograder(a.Question.Model);return c.areAnyAnswersDefined()?a.Question.isCorrectAnswer(b.Answer):null},b.prototype.createCorrectAnswerList=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model.QuizResult;if(!this.shouldShowCorrectAnswerList())return void 0;var c=null!=b?b:a,d=new l.ShortTextAutograder(c);if(!d.areAnyAnswersDefined())return void 0;var e=g.map(d.getAnswers(),function(a){return a.answer}),h=e.join(n.LocalizedStrings.VariousLocations_ItemList_Separator),i={"aria-hidden":!0,className:"office-form-right-answerkey various-short-text-correct-answer-list-correctness-icon",role:this.domRole},k={HTMLAttributes:i,IconName:""};return f.createElement("div",{className:"office-form-question-element various-short-text-correct-answer-list",key:"answerList"},j.createFontIconControl(k),f.createElement("b",null,n.LocalizedStrings.VariousLocations_CorrectAnswerList_Label," "),h)},b.prototype.shouldShowCorrectAnswerList=function(){var a=this.props.Master.Model,b=this.props.Master.Question.Model,c=this.props.Master.Model.QuizResult,d=b.Multiline||!b.IsQuiz;if(d)return!1;var e=!this.props.ShowDesignInfo&&null==c;if(e)return!1;var f=null!=c&&c.IsAnswerCorrect;if(f)return!1;var g=null==c&&this.props.Master.Question.isCorrectAnswer(a.Answer);return g?!1:!0},b}(i.QuestionRendererBase);h.registerRendererComponentClass(l.QuestionType.TextField,p)},function(a,b,c){"use strict";function d(){e();var a="/Pages/DesignPage.aspx";return m.IsExternalIntegration||(a+="?"+jQuery.param(o.getNonEmbedQuery())),o.Html.safeOpen(o.Html.getAbsoluteUrl(a)),!0}function e(){return l.EngagementEvent.logData({name:p.NavigateToPortal}),!0}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),g=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var h=c(0),i=c(1),j=c(22),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Event,m=OfficeForm.Exports.EnvironmentSettings,n=OfficeForm.Exports.Resources,o=OfficeForm.Exports.Utilities,p=OfficeForm.Exports.EngagementEventNames.ResponsePage.ThanksView,q=450,r=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.messageElementRef=h.createRef(),b}return f(b,a),b.prototype.componentDidMount=function(){l.EngagementEvent.logData({name:p.Navigate}),$(this.messageElementRef.current).linkify(),o.OEmbed.notifyResponsePageFixedHeightToParentWindow(q)},b.prototype.render=function(){var a="office-form thank-you-page-content";this.props.viewResultsHandler&&(a=o.Html.combineAttributes(a,"quiz")),this.props.submitAnother||(a=o.Html.combineAttributes(a,"one-response"));var b=!o.isOEmbedSPO()&&h.createElement("div",{className:"thank-you-page-footer-container"},this.createPromotionLink(),Forms.UX.Renderer.createFooter({}));return h.createElement("div",{className:"office-form-thankyou-page-container"},h.createElement(j.TitleContainer,{Form:this.props.FormMaster,IsSmallSize:!0}),h.createElement("div",{className:a},this.createMessageContent(),h.createElement("div",{className:"thank-you-page-other"},this.createQuizeButton(),this.createReloadLink())),b)},b.prototype.createMessageContent=function(){var a=null===this.props.FormMaster.Model.ThankYouMessage?n.LocalizedStrings.Response_Page_Default_Thank_You_Message:this.props.FormMaster.Model.ThankYouMessage;return h.createElement("div",{"aria-label":a,className:"thank-you-page-container thank-you-page-message",ref:this.messageElementRef,tabIndex:-1},a)},b.prototype.createQuizeButton=function(){return this.props.viewResultsHandler&&k.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"office-form-view-result-button office-form-theme-button",onClick:this.props.viewResultsHandler},Text:n.LocalizedStrings.Response_Thank_You_Page_Button_Quiz_ViewResults})},b.prototype.createReloadLink=function(){var a="office-form-info-children",b="thank-you-page-reload-link";return this.props.viewResultsHandler&&(b=o.Html.combineAttributes(b,"quiz")),o.isOEmbedSPO()&&(a=o.Html.combineAttributes(a,"office-form-theme-spo-link")),this.props.submitAnother?h.createElement("div",{className:b},h.createElement("a",{className:a,href:"javascript:void(0)",onClick:this.props.submitAnother},n.LocalizedStrings.Response_Submit_Again_Link)):void 0},b.prototype.createPromotionLink=function(){var a="office-form-info-children";if(this.props.ShowPromotionMessage&&!m.IsAssignmentsIntegration){var b={className:a,href:"/Pages/DesignPage.aspx",onClick:e};(o.isOEmbed()||m.IsExternalIntegration)&&(b.href="javascript:void(0)",b.onClick=d);var c="office-form-footer office-form-theme-footer thank-you-page-promotion";return h.createElement("div",{className:c},h.createElement("a",g({},b),n.LocalizedStrings.Renderer_PromotionMessage))}},b}(i.ReactComponent);Forms.UX.Renderer.ThankYouPage=r},,,,,,,,,,,,,,,,,,,,,function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(17),c(37),c(18),c(19),c(11),c(38),c(20),c(28),c(40),c(41),c(42),c(43),c(21),c(44),c(45),c(46),c(47),c(48),c(22),c(23)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(146)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(69),Forms.PerformanceAnalysis.addCheckPoint("0"),OfficeForm.Exports.ResponsePage.initializePage()}]);